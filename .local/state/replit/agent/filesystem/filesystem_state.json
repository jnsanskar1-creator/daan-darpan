{"file_contents":{"local-deployment/client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { z } from \"zod\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Download, Database, Settings as SettingsIcon } from \"lucide-react\";\n\n// Profile update schema\nconst profileSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  email: z.string().email(\"Please enter a valid email\"),\n  mobile: z.string().min(10, \"Mobile number should be at least 10 digits\").optional(),\n  address: z.string().optional()\n});\n\ntype ProfileFormValues = z.infer<typeof profileSchema>;\n\n// Corpus settings schema\nconst corpusSchema = z.object({\n  corpusValue: z.number().min(0, \"Corpus value must be positive\"),\n  baseDate: z.string().min(1, \"Base date is required\")\n});\n\ntype CorpusFormValues = z.infer<typeof corpusSchema>;\n\nexport default function Settings() {\n  const { user, logout, refreshUser } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [isEditing, setIsEditing] = useState(false);\n\n  // Fetch corpus settings (admin only)\n  const { data: corpusSettings } = useQuery({\n    queryKey: ['/api/corpus-settings'],\n    enabled: user?.role === 'admin',\n    retry: false\n  });\n\n  const profileForm = useForm<ProfileFormValues>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      name: user?.name || \"\",\n      email: user?.email || \"\",\n      mobile: user?.mobile || \"\",\n      address: user?.address || \"\"\n    }\n  });\n\n  const corpusForm = useForm<CorpusFormValues>({\n    resolver: zodResolver(corpusSchema),\n    defaultValues: {\n      corpusValue: 0,\n      baseDate: \"2025-07-31\"\n    }\n  });\n\n  // Update corpus form when settings data loads\n  useEffect(() => {\n    if (corpusSettings && typeof corpusSettings === 'object' && 'corpusValue' in corpusSettings) {\n      corpusForm.reset({\n        corpusValue: corpusSettings.corpusValue as number,\n        baseDate: corpusSettings.baseDate as string\n      });\n    }\n  }, [corpusSettings, corpusForm]);\n\n  // Update profile mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormValues) => {\n      const response = await apiRequest(\"PATCH\", \"/api/auth/profile\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: \"Your profile has been updated successfully\",\n      });\n      \n      // Refresh user data in auth context\n      refreshUser();\n      \n      // Invalidate cached data that might reference this user\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      setIsEditing(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update profile: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Profile update handler\n  const onUpdateProfile = (data: ProfileFormValues) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  // Corpus settings mutation\n  const updateCorpusMutation = useMutation({\n    mutationFn: async (data: CorpusFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/corpus-settings\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: \"Corpus settings updated successfully\",\n      });\n      \n      // Invalidate dashboard data to refresh overall summary\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/corpus-settings'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update corpus settings: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Corpus update handler\n  const onUpdateCorpus = (data: CorpusFormValues) => {\n    updateCorpusMutation.mutate(data);\n  };\n\n  // Database backup mutation\n  const backupMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/database/backup\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      // Automatically download the backup file\n      if (data.downloadUrl) {\n        const link = document.createElement('a');\n        link.href = data.downloadUrl;\n        link.download = data.filename || 'database-backup.xlsx';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n      \n      toast({\n        title: \"Success\",\n        description: data.message || \"Database backup created successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create database backup: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleBackup = () => {\n    backupMutation.mutate();\n  };\n\n  const handleLogout = async () => {\n    const success = await logout();\n    if (success) {\n      toast({\n        title: \"Logged out\",\n        description: \"You have been successfully logged out\",\n      });\n      setLocation(\"/\");\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Logout failed\",\n        description: \"An error occurred during logout\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-6\">\n      <h1 className=\"text-2xl font-bold mb-6\">Settings</h1>\n      \n      <Card className=\"mb-6\">\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle>Profile Information</CardTitle>\n              <CardDescription>\n                Update your personal information\n              </CardDescription>\n            </div>\n            {!isEditing && (\n              <Button \n                onClick={() => setIsEditing(true)}\n                variant=\"outline\"\n              >\n                Edit Profile\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isEditing ? (\n            <Form {...profileForm}>\n              <form onSubmit={profileForm.handleSubmit(onUpdateProfile)} className=\"space-y-4\">\n                <FormField\n                  control={profileForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Full Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Your full name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email Address</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Your email address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Your mobile number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Your address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <div className=\"pt-4 flex gap-2 justify-end\">\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsEditing(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={updateProfileMutation.isPending}\n                  >\n                    {updateProfileMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Name</h3>\n                  <p className=\"text-base\">{user?.name}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Username</h3>\n                  <p className=\"text-base\">{user?.username}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Email</h3>\n                  <p className=\"text-base\">{user?.email}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Role</h3>\n                  <p className=\"text-base capitalize\">{user?.role}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Mobile</h3>\n                  <p className=\"text-base\">{user?.mobile || \"-\"}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Account Status</h3>\n                  <div className=\"flex items-center\">\n                    <span className={`inline-block w-2 h-2 rounded-full mr-2 ${user?.status === 'active' ? 'bg-green-500' : 'bg-gray-400'}`}></span>\n                    <span className=\"capitalize\">{user?.status || 'Active'}</span>\n                  </div>\n                </div>\n              </div>\n              \n              {user?.address && (\n                <div className=\"mt-4\">\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Address</h3>\n                  <p className=\"text-base\">{user.address}</p>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Corpus Settings Section - Only visible to admins */}\n      {user?.role === 'admin' && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <SettingsIcon className=\"h-5 w-5\" />\n              Corpus Settings\n            </CardTitle>\n            <CardDescription>\n              Configure the corpus value as on 31st July 2025 for overall summary calculations\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...corpusForm}>\n              <form onSubmit={corpusForm.handleSubmit(onUpdateCorpus)} className=\"space-y-4\">\n                <FormField\n                  control={corpusForm.control}\n                  name=\"corpusValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Total Corpus as on 31st Jul'25 (‚Çπ)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          placeholder=\"Enter corpus value in rupees\" \n                          {...field} \n                          onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={corpusForm.control}\n                  name=\"baseDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Base Date</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <div className=\"pt-4 bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                  <p className=\"text-sm text-blue-800 mb-2\">\n                    <strong>About Corpus Settings:</strong>\n                  </p>\n                  <ul className=\"text-sm text-blue-700 list-disc list-inside space-y-1\">\n                    <li>This value represents the total corpus amount as on the specified base date</li>\n                    <li>Used in Overall Summary calculation: Corpus + Total Received + Advance Payments - Total Expenses = Cash in Bank</li>\n                    <li>Overall Summary is displayed at the top of the Dashboard and works independent of date filters</li>\n                    <li>Only admins can modify this setting</li>\n                  </ul>\n                </div>\n                \n                <Button \n                  type=\"submit\" \n                  disabled={updateCorpusMutation.isPending}\n                  className=\"w-full\"\n                >\n                  {updateCorpusMutation.isPending ? \"Updating...\" : \"Update Corpus Settings\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Database Backup Section - Only visible to operators and admins */}\n      {(user?.role === 'operator' || user?.role === 'admin') && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5\" />\n              Database Management\n            </CardTitle>\n            <CardDescription>\n              Create and email database backup to all operators\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                <p className=\"text-sm text-blue-800 mb-2\">\n                  <strong>Database Backup Features:</strong>\n                </p>\n                <ul className=\"text-sm text-blue-700 list-disc list-inside space-y-1\">\n                  <li>Exports all database tables as Excel sheets (6 worksheets)</li>\n                  <li>Includes: Users, Boli Entries, Advance Payments, Dravya Entries, Expense Entries, Transaction Logs</li>\n                  <li>Automatically downloads backup file to your device</li>\n                  <li>Emails backup to all operators (requires SendGrid API key)</li>\n                  <li>Timestamp included in filename: Database_Backup_YYYY-MM-DD.xlsx</li>\n                </ul>\n                <div className=\"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded\">\n                  <p className=\"text-xs text-yellow-800\">\n                    <strong>Note:</strong> Email functionality requires SendGrid API key configuration. \n                    Without it, backup will still be created and downloaded locally.\n                  </p>\n                </div>\n              </div>\n              <Button \n                onClick={handleBackup}\n                disabled={backupMutation.isPending}\n                className=\"w-full\"\n                variant=\"default\"\n              >\n                {backupMutation.isPending ? (\n                  <>\n                    <Database className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Creating Backup...\n                  </>\n                ) : (\n                  <>\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Create & Download Database Backup\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n      \n      <Card>\n        <CardHeader>\n          <CardTitle>Account Actions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Button \n              variant=\"destructive\" \n              className=\"w-full\" \n              onClick={handleLogout}\n            >\n              Logout\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":17582},"client/src/components/admin-entry-controls.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Entry } from \"@shared/schema\";\n\ninterface AdminEntryControlsProps {\n  entry: Entry;\n  onEdit?: () => void;\n  onDelete?: () => void;\n}\n\nexport default function AdminEntryControls({ entry, onEdit, onDelete }: AdminEntryControlsProps) {\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  \n  // Check if entry is fully paid (no pending amount)\n  const isFullyPaid = entry.status === \"full\";\n  \n  return (\n    <div className=\"flex gap-2\">\n      {/* Edit functionality has been disabled */}\n      <Button \n        variant=\"outline\" \n        size=\"sm\"\n        className=\"text-neutral-400 flex items-center gap-1\"\n        disabled\n        title=\"Edit entry functionality has been disabled\"\n      >\n        <span className=\"material-icons text-sm\">edit_off</span>\n        Edit Entry\n      </Button>\n      \n      {!isFullyPaid ? (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          className=\"text-red-600 flex items-center gap-1\"\n          onClick={() => setShowDeleteConfirm(true)}\n        >\n          <span className=\"material-icons text-sm\">delete</span>\n          Delete\n        </Button>\n      ) : (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          className=\"text-neutral-400 flex items-center gap-1\"\n          disabled\n          title=\"Fully paid entries cannot be deleted\"\n        >\n          <span className=\"material-icons text-sm\">delete_off</span>\n          Delete\n        </Button>\n      )}\n      \n      <AlertDialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you sure you want to delete this entry?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete entry \"{entry.description}\" and all associated payment records.\n              This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => {\n                if (onDelete) onDelete();\n                setShowDeleteConfirm(false);\n              }}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}","size_bytes":2821},"local-deployment/DATABASE-BACKUP-GUIDE.md":{"content":"# üóÑÔ∏è Database Backup & Restore Guide\n\n## Overview\n\nThe ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ application includes comprehensive database backup and restore functionality to ensure data safety and easy deployment.\n\n## Quick Commands\n\n```bash\n# Create backup\n./scripts/backup-database.sh\n\n# Restore latest backup\n./scripts/restore-database.sh latest\n\n# Restore specific backup\n./scripts/restore-database.sh database-backups/daan_darpan_backup_20250817_120000.sql.gz\n\n# Create sample data (for testing)\n./scripts/create-sample-data.sh\n```\n\n## Backup System Features\n\n### 1. Automated Backup Creation\n- **Complete Data**: All tables, sequences, and relationships\n- **Compressed Storage**: Automatic gzip compression\n- **Timestamped Files**: Format: `daan_darpan_backup_YYYYMMDD_HHMMSS.sql.gz`\n- **Latest Symlink**: Always points to most recent backup\n\n### 2. Safe Restoration\n- **Confirmation Prompts**: Prevents accidental data loss\n- **Application Shutdown**: Automatically stops running processes\n- **Clean Import**: Drops existing data before restore\n- **Error Handling**: Stops on any SQL errors\n\n### 3. Sample Data Generation\n- **Pre-configured Users**: Admin, operators, viewers, and sample members\n- **Financial Records**: Boli entries, payments, expenses, advance payments\n- **Test Environment**: Perfect for development and training\n\n## File Structure\n\n```\ndatabase-backups/\n‚îú‚îÄ‚îÄ daan_darpan_backup_20250817_120000.sql.gz\n‚îú‚îÄ‚îÄ daan_darpan_backup_20250817_140000.sql.gz\n‚îú‚îÄ‚îÄ latest_backup.sql.gz -> daan_darpan_backup_20250817_140000.sql.gz\n‚îî‚îÄ‚îÄ restoration-logs/\n```\n\n## Restoration Steps for New Installation\n\n### 1. Fresh Installation with Sample Data\n\n```bash\n# After extracting tar.gz and setting up PostgreSQL\ncd ~/Desktop/daan-darpan-local\n\n# Install dependencies\nnpm install\n\n# Setup database schema\nnpm run db:push\n\n# Create sample data for testing\nchmod +x scripts/create-sample-data.sh\n./scripts/create-sample-data.sh\n\n# Start application\nnpm run dev\n```\n\n### 2. Restoration from Production Backup\n\n```bash\n# After extracting tar.gz and setting up PostgreSQL\ncd ~/Desktop/daan-darpan-local\n\n# Install dependencies\nnpm install\n\n# Place your backup file in database-backups/ directory\nmkdir -p database-backups\ncp /path/to/your/backup.sql.gz database-backups/\n\n# Restore database\nchmod +x scripts/restore-database.sh\n./scripts/restore-database.sh database-backups/your-backup.sql.gz\n\n# Start application\nnpm run dev\n```\n\n### 3. Regular Backup Creation\n\n```bash\n# Create backup (run daily/weekly)\nchmod +x scripts/backup-database.sh\n./scripts/backup-database.sh\n\n# Output will be in database-backups/ directory\n```\n\n## Backup File Contents\n\nEach backup includes:\n\n### Core Tables\n- `users` - All user accounts and roles\n- `boli_entries` - Auction/bid entries with payment tracking\n- `boli_payments` - Individual payment records\n- `advance_payments` - Prepaid amounts\n- `expense_entries` - Temple expenses with receipts\n- `dravya_entries` - Spiritual donations (separate system)\n- `previous_outstanding_records` - Historical debt tracking\n\n### Configuration Tables\n- `corpus_settings` - Temple corpus/capital amount\n- `receipt_counter` - Auto-incrementing receipt numbers\n- `transaction_logs` - Complete audit trail\n\n### File System\n- Upload files in `uploads/` directory need separate backup\n- Configuration files (`.env`) should be backed up separately\n\n## Production Deployment Workflow\n\n### Initial Setup\n1. Extract `daan-darpan-local-v1.0.tar.gz`\n2. Run `./setup.sh` for basic configuration\n3. Configure PostgreSQL with `setup_database.sql`\n4. Edit `.env` with production database credentials\n5. Choose restoration method:\n   - **New Installation**: Use `./scripts/create-sample-data.sh`\n   - **Data Migration**: Use `./scripts/restore-database.sh your-backup.sql.gz`\n\n### Regular Maintenance\n1. **Daily Backups**: Set up cron job for `./scripts/backup-database.sh`\n2. **Weekly Testing**: Verify backup integrity by restoring to test environment\n3. **File Backups**: Separately backup `uploads/` directory and `.env` file\n\n## Sample Data Details\n\nThe sample data includes:\n\n### Users (Password: admin123)\n- **admin** - Full administrative access\n- **operator1** - Operator role access\n- **viewer1** - Read-only access\n- **ramesh_ji** - Sample temple member\n- **sunita_devi** - Sample temple member\n\n### Financial Data\n- **Corpus**: ‚Çπ139,084 initial temple capital\n- **Boli Entries**: 4 sample entries with various payment statuses\n- **Payments**: Mix of cash, UPI payments with proper receipt numbers\n- **Expenses**: Temple operational expenses with proper documentation\n- **Advance Payments**: Sample prepaid amounts\n\n### System Configuration\n- **Receipt Counter**: Starting from SPDJMSJ000001\n- **Transaction Logs**: Complete audit trail for all sample transactions\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Permission Denied**\n   ```bash\n   chmod +x scripts/*.sh\n   ```\n\n2. **PostgreSQL Connection Error**\n   ```bash\n   # Check if PostgreSQL is running\n   sudo systemctl status postgresql\n   \n   # Check credentials in .env file\n   cat .env | grep PG\n   ```\n\n3. **Backup File Not Found**\n   ```bash\n   # List available backups\n   ls -la database-backups/\n   \n   # Use absolute path\n   ./scripts/restore-database.sh /full/path/to/backup.sql.gz\n   ```\n\n4. **Application Still Running**\n   ```bash\n   # Manually stop processes\n   pkill -f \"tsx server/index.ts\"\n   pkill -f \"node dist/index.js\"\n   ```\n\n## Security Considerations\n\n1. **Backup Encryption**: For production, encrypt backup files\n2. **Access Control**: Restrict access to backup files (chmod 600)\n3. **Regular Testing**: Test restore procedures monthly\n4. **Off-site Storage**: Store backups in multiple locations\n5. **Retention Policy**: Keep backups for at least 90 days\n\n---\n\n**Note**: This backup system is designed specifically for the local PostgreSQL deployment and maintains full compatibility with the ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ application structure.","size_bytes":5957},"client/src/hooks/use-auth.ts":{"content":"import { useContext } from \"react\";\nimport { AuthContext } from \"@/lib/context/auth-context\";\nimport { logout } from \"@/lib/auth\";\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  \n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  \n  return {\n    ...context,\n    logout,\n  };\n}\n","size_bytes":358},"local-deployment/server/investigate-duplicates.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\n\nasync function investigateDuplicates() {\n  try {\n    console.log('Reading differential Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'Address_Mobile_Differential_Users.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} users in differential file`);\n\n    // Get all database users\n    const dbUsers = await db.select().from(users);\n    console.log(`Found ${dbUsers.length} users in database`);\n\n    // Check first 5 users for detailed comparison\n    console.log('\\n=== DETAILED COMPARISON OF FIRST 5 USERS ===');\n    \n    for (let i = 0; i < Math.min(5, excelData.length); i++) {\n      const excelRow = excelData[i];\n      const excelUser = {\n        name: String(excelRow.name || '').trim(),\n        username: String(excelRow.username || '').trim(),\n        email: String(excelRow.email || '').trim().toLowerCase(),\n        mobile: String(excelRow.mobile || '').trim(),\n        address: String(excelRow.address || '').trim()\n      };\n\n      console.log(`\\n--- Excel User ${i + 1} ---`);\n      console.log(`Name: ${excelUser.name}`);\n      console.log(`Username: ${excelUser.username}`);\n      console.log(`Email: ${excelUser.email}`);\n      console.log(`Mobile: ${excelUser.mobile}`);\n      console.log(`Address: ${excelUser.address}`);\n\n      // Find matching database users by different criteria\n      const usernameMatch = dbUsers.find(u => u.username.toLowerCase() === excelUser.username.toLowerCase());\n      const emailMatch = dbUsers.find(u => u.email.toLowerCase() === excelUser.email.toLowerCase());\n      const mobileMatch = dbUsers.find(u => u.mobile.trim() === excelUser.mobile.trim());\n      const addressMatch = dbUsers.find(u => u.address.toLowerCase().trim() === excelUser.address.toLowerCase());\n\n      console.log(`Database matches:`);\n      if (usernameMatch) {\n        console.log(`  Username match: ${usernameMatch.name} (${usernameMatch.username}) - Mobile: ${usernameMatch.mobile}, Address: ${usernameMatch.address}`);\n      } else {\n        console.log(`  Username match: NONE`);\n      }\n      \n      if (emailMatch) {\n        console.log(`  Email match: ${emailMatch.name} (${emailMatch.username})`);\n      } else {\n        console.log(`  Email match: NONE`);\n      }\n      \n      if (mobileMatch) {\n        console.log(`  Mobile match: ${mobileMatch.name} (${mobileMatch.username})`);\n      } else {\n        console.log(`  Mobile match: NONE`);\n      }\n      \n      if (addressMatch) {\n        console.log(`  Address match: ${addressMatch.name} (${addressMatch.username})`);\n      } else {\n        console.log(`  Address match: NONE`);\n      }\n    }\n\n    // Count unique vs duplicate usernames in Excel\n    const excelUsernames = excelData.map(row => String(row.username || '').trim().toLowerCase());\n    const uniqueUsernames = new Set(excelUsernames);\n    console.log(`\\n=== USERNAME ANALYSIS ===`);\n    console.log(`Total users in Excel: ${excelData.length}`);\n    console.log(`Unique usernames in Excel: ${uniqueUsernames.size}`);\n    console.log(`Duplicate usernames in Excel: ${excelData.length - uniqueUsernames.size}`);\n\n    // Check how many Excel usernames already exist in database\n    const dbUsernames = new Set(dbUsers.map(u => u.username.toLowerCase()));\n    const existingCount = excelUsernames.filter(username => dbUsernames.has(username)).length;\n    console.log(`Excel usernames that exist in database: ${existingCount}`);\n    console.log(`Excel usernames that don't exist in database: ${excelUsernames.length - existingCount}`);\n\n  } catch (error) {\n    console.error('Error investigating:', error);\n  }\n}\n\ninvestigateDuplicates();","size_bytes":3959},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        if (setOpenProp) {\n          return setOpenProp?.(\n            typeof value === \"function\" ? value(open) : value\n          )\n        }\n\n        _setOpen(value)\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${open}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full text-sidebar-foreground has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23337},"local-deployment/client/src/pages/entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type Entry, PaymentStatus, EntryType, PaymentRecord, recordPaymentSchema } from \"@shared/schema\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n// Create a simplified media query hook inline since the import is failing\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'bg-destructive';\n    case PaymentStatus.PARTIAL: return 'bg-orange-500';\n    case PaymentStatus.FULL: return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'Payment Pending';\n    case PaymentStatus.PARTIAL: return 'Partially Paid';\n    case PaymentStatus.FULL: return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nconst formatDate = (dateString: string) => {\n  try {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  } catch (e) {\n    return dateString;\n  }\n};\n\n// Function to send WhatsApp reminder\nconst sendWhatsAppReminder = (entry: Entry) => {\n  // Clean phone number (remove spaces, dashes, parentheses)\n  const cleanNumber = entry.userMobile?.replace(/[\\s\\-\\(\\)]/g, '');\n  \n  if (!cleanNumber) {\n    alert('No phone number available for this user');\n    return;\n  }\n  \n  // Format phone number for WhatsApp (ensure it starts with country code)\n  let formattedNumber = cleanNumber;\n  if (!formattedNumber.startsWith('91') && formattedNumber.length === 10) {\n    formattedNumber = '91' + formattedNumber; // Add India country code\n  }\n  \n  // Create reminder message with simple text markers\n  const message = \n    `‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•å‡§Æ‡•ç‡§Ø ‡§Ø‡§æ‡§¶ ‡§¶‡§ø‡§≤‡§æ‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡•á‡§∑‡§ø‡§§ ‡§π‡•à:\\n\\n` +\n    `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: ${entry.description}\\n` +\n    `üóìÔ∏è ‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(entry.auctionDate)}\\n` +\n    `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.totalAmount.toLocaleString()}\\n` +\n    `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ‚Çπ${entry.receivedAmount.toLocaleString()}\\n` +\n    `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${entry.pendingAmount.toLocaleString()}\\n\\n` +\n    `‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™‡§ø‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§ú‡§Æ‡§æ ‡§ï‡§∞ ‡§™‡•Å‡§£‡•ç‡§Ø ‡§≤‡§æ‡§≠ ‡§∏‡§Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§\\n\\n` +\n    `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n  \n  // Create WhatsApp URL using different encoding approach\n  const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedNumber}&text=${encodeURIComponent(message)}`;\n  \n  // Open WhatsApp in new tab/window\n  window.open(whatsappUrl, '_blank');\n};\n\n// Function to handle bulk WhatsApp reminders\nconst sendBulkWhatsAppReminders = (entries: Entry[], selectedIds: number[]) => {\n  const selectedEntries = entries.filter(entry => selectedIds.includes(entry.id));\n  const validEntries = selectedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0);\n  \n  if (validEntries.length === 0) {\n    alert('No valid entries selected for WhatsApp reminders. Entries must have mobile numbers and pending amounts.');\n    return;\n  }\n  \n  // Send reminders with a small delay between each\n  validEntries.forEach((entry, index) => {\n    setTimeout(() => {\n      sendWhatsAppReminder(entry);\n    }, index * 500); // 500ms delay between each message\n  });\n  \n  alert(`WhatsApp reminders will be sent to ${validEntries.length} recipients.`);\n};\n\nexport default function Entries() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [sortBy, setSortBy] = useState(\"serial-desc\");\n  const [boliDateRange, setBoliDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [updatedAtRange, setUpdatedAtRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [isFilterOpen, setIsFilterOpen] = useState(false);\n  const [selectedEntries, setSelectedEntries] = useState<number[]>([]);\n  const [showBulkActions, setShowBulkActions] = useState(false);\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: PaymentRecord | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  const isMobile = useMediaQuery(\"(max-width: 640px)\");\n  const { toast } = useToast();\n  \n  const { data: entries, isLoading } = useQuery<Entry[]>({\n    queryKey: ['/api/entries'],\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 30 * 1000 // Consider data stale after 30 seconds\n  });\n  \n  // Function to handle entry deletion\n  const handleDeleteEntry = async (entry: Entry) => {\n    if (confirm(`Are you sure you want to delete entry \"${entry.description}\"? This action cannot be undone.`)) {\n      try {\n        await apiRequest('DELETE', `/api/entries/${entry.id}`);\n        toast({\n          title: \"Entry Deleted\",\n          description: \"The entry has been successfully deleted and logged as a transaction.\"\n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      } catch (error) {\n        console.error(\"Error deleting entry:\", error);\n        toast({\n          title: \"Delete Failed\",\n          description: \"There was a problem deleting the entry. Please try again.\",\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n\n  // Filter only Boli entries (all entries in this system are boli entries)\n  // Add serial numbers: earliest entry gets serial 1, latest gets highest number\n  const boliEntries = useMemo(() => {\n    if (!entries) return [];\n    \n    // Sort entries by ID (creation order) to assign serial numbers\n    const sortedByCreation = [...entries].sort((a, b) => a.id - b.id);\n    \n    // Add serial numbers (earliest gets 1, latest gets highest)\n    return sortedByCreation.map((entry, index) => ({\n      ...entry,\n      serialNumber: index + 1\n    }));\n  }, [entries]);\n\n  // Filter and sort entries\n  const filteredAndSortedEntries = useMemo(() => {\n    if (!boliEntries) return [];\n    \n    // First apply filters\n    let filtered = boliEntries.filter(entry => {\n      // Apply text search independently\n      const searchLower = searchTerm.toLowerCase();\n      const matchesSearch = searchTerm === \"\" || \n        entry.description.toLowerCase().includes(searchLower) ||\n        entry.userName.toLowerCase().includes(searchLower) ||\n        entry.occasion.toLowerCase().includes(searchLower) ||\n        (entry.userMobile && entry.userMobile.toLowerCase().includes(searchLower)) ||\n        (entry.userAddress && entry.userAddress.toLowerCase().includes(searchLower));\n      \n      if (!matchesSearch) return false;\n      \n      // Apply status filter independently\n      const matchesStatus = statusFilter === \"all\" || entry.status === statusFilter;\n      if (!matchesStatus) return false;\n      \n      // Apply boli date range filter independently\n      if (boliDateRange[0] || boliDateRange[1]) {\n        const entryDate = new Date(entry.auctionDate);\n        \n        if (boliDateRange[0]) {\n          // Start date is set, check if entry date is on or after it\n          const startDate = new Date(boliDateRange[0]);\n          startDate.setHours(0, 0, 0, 0);\n          if (entryDate < startDate) {\n            return false;\n          }\n        }\n        \n        if (boliDateRange[1]) {\n          // End date is set, check if entry date is on or before it\n          const endDate = new Date(boliDateRange[1]);\n          // Set to end of day to include the full day\n          endDate.setHours(23, 59, 59, 999);\n          if (entryDate > endDate) {\n            return false;\n          }\n        }\n      }\n      \n      // Apply updated at range filter independently\n      if (updatedAtRange[0] || updatedAtRange[1]) {\n        // If entry doesn't have updatedAt, filter it out if filtering by updated date\n        if (!entry.updatedAt) {\n          return false;\n        }\n        \n        const entryUpdateDate = new Date(entry.updatedAt);\n        \n        if (updatedAtRange[0]) {\n          // Start date is set, check if entry date is on or after it\n          const startDate = new Date(updatedAtRange[0]);\n          startDate.setHours(0, 0, 0, 0);\n          if (entryUpdateDate < startDate) {\n            return false;\n          }\n        }\n        \n        if (updatedAtRange[1]) {\n          // End date is set, check if entry date is on or before it\n          const endDate = new Date(updatedAtRange[1]);\n          // Set to end of day to include the full day\n          endDate.setHours(23, 59, 59, 999);\n          if (entryUpdateDate > endDate) {\n            return false;\n          }\n        }\n      }\n      \n      // If it passes all filters, include it\n      return true;\n    });\n    \n    // Then sort\n    return filtered.sort((a, b) => {\n      switch(sortBy) {\n        case \"serial-asc\":\n          return (a as any).serialNumber - (b as any).serialNumber;\n        case \"serial-desc\":\n          return (b as any).serialNumber - (a as any).serialNumber;\n        case \"date-asc\":\n          return new Date(a.auctionDate).getTime() - new Date(b.auctionDate).getTime();\n        case \"date-desc\":\n          return new Date(b.auctionDate).getTime() - new Date(a.auctionDate).getTime();\n        case \"amount-asc\":\n          return a.totalAmount - b.totalAmount;\n        case \"amount-desc\":\n          return b.totalAmount - a.totalAmount;\n        case \"name-asc\":\n          return a.userName.localeCompare(b.userName);\n        case \"name-desc\":\n          return b.userName.localeCompare(a.userName);\n        default:\n          return (b as any).serialNumber - (a as any).serialNumber; // Default to serial desc\n      }\n    });\n  }, [entries, searchTerm, statusFilter, sortBy, boliDateRange, updatedAtRange]);\n  \n  const handleViewDetails = (entryId: number) => {\n    setLocation(`/entries/${entryId}`);\n  };\n  \n  // Bulk selection functions\n  const handleSelectEntry = (entryId: number) => {\n    setSelectedEntries(prev => {\n      const newSelection = prev.includes(entryId) \n        ? prev.filter(id => id !== entryId)\n        : [...prev, entryId];\n      setShowBulkActions(newSelection.length > 0);\n      return newSelection;\n    });\n  };\n  \n  const handleSelectAll = () => {\n    const eligibleEntries = filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0);\n    const allEligibleIds = eligibleEntries.map(entry => entry.id);\n    \n    if (selectedEntries.length === allEligibleIds.length) {\n      // Deselect all\n      setSelectedEntries([]);\n      setShowBulkActions(false);\n    } else {\n      // Select all eligible\n      setSelectedEntries(allEligibleIds);\n      setShowBulkActions(allEligibleIds.length > 0);\n    }\n  };\n  \n  const handleBulkWhatsAppReminder = () => {\n    if (selectedEntries.length === 0) return;\n    \n    if (confirm(`Send WhatsApp reminders to ${selectedEntries.length} selected entries?`)) {\n      sendBulkWhatsAppReminders(filteredAndSortedEntries, selectedEntries);\n      setSelectedEntries([]);\n      setShowBulkActions(false);\n    }\n  };\n\n  // Reset search when navigating away\n  useEffect(() => {\n    return () => {\n      setSearchTerm(\"\");\n      setStatusFilter(\"all\");\n      setSortBy(\"serial-desc\");\n    };\n  }, []);\n\n  // Mobile card view for each entry\n  const EntryCard = ({ entry }: { entry: Entry }) => (\n    <Card key={entry.id} className=\"mb-4\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex justify-between items-start\">\n          <div className=\"flex items-start gap-3 flex-1\">\n            {/* Checkbox for bulk selection */}\n            {entry.userMobile && entry.pendingAmount > 0 && (\n              <input\n                type=\"checkbox\"\n                checked={selectedEntries.includes(entry.id)}\n                onChange={() => handleSelectEntry(entry.id)}\n                className=\"mt-1 w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n              />\n            )}\n            <div>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs text-neutral-500 bg-neutral-100 px-2 py-0.5 rounded\">#{(entry as any).serialNumber}</span>\n                <h3 className=\"font-medium text-lg\">{entry.description}</h3>\n              </div>\n              <p className=\"text-sm text-neutral-500\">{entry.userName}</p>\n              {entry.userMobile && (\n                <p className=\"text-xs text-neutral-500\">üì± {entry.userMobile}</p>\n              )}\n            </div>\n          </div>\n          <Badge className={getStatusClass(entry.status)}>\n            {getStatusText(entry.status)}\n          </Badge>\n        </div>\n        <div className=\"grid grid-cols-2 gap-2 my-3 text-sm\">\n          <div>\n            <p className=\"text-neutral-500\">Amount:</p>\n            <p>‚Çπ{entry.amount.toLocaleString()} √ó {entry.quantity}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Total:</p>\n            <p>‚Çπ{entry.totalAmount.toLocaleString()}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Occasion:</p>\n            <p>{entry.occasion}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Boli Date:</p>\n            <p>{formatDate(entry.auctionDate)}</p>\n          </div>\n        </div>\n        {entry.userAddress && (\n          <div className=\"text-xs text-neutral-600 mt-1 mb-2\">\n            <span className=\"text-neutral-500\">üìç Address:</span> {entry.userAddress}\n          </div>\n        )}\n        {entry.updatedAt && (\n          <div className=\"text-xs text-neutral-600 mt-1\">\n            <span className=\"text-neutral-500\">Updated:</span> {formatDate(entry.updatedAt)}\n          </div>\n        )}\n        <div className=\"flex justify-between text-sm mt-4 pt-2 border-t border-neutral-200\">\n          <div>\n            <span className=\"text-neutral-500\">Received:</span>\n            <span className=\"text-green-500 font-medium ml-1\">‚Çπ{entry.receivedAmount.toLocaleString()}</span>\n          </div>\n          <div>\n            <span className=\"text-neutral-500\">Pending:</span>\n            <span className=\"text-destructive font-medium ml-1\">‚Çπ{entry.pendingAmount.toLocaleString()}</span>\n          </div>\n          <div className=\"flex gap-2\">\n            {entry.userMobile && entry.pendingAmount > 0 && (\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"text-green-600 border-green-200 hover:bg-green-50 px-2 py-1 h-auto\"\n                onClick={() => sendWhatsAppReminder(entry)}\n                title=\"Send WhatsApp Reminder\"\n              >\n                <span className=\"material-icons text-sm mr-1\">chat</span>\n                WhatsApp\n              </Button>\n            )}\n            <Button \n              variant=\"link\" \n              className=\"text-primary font-medium p-0\"\n              onClick={() => handleViewDetails(entry.id)}\n            >\n              View Details\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n\n  // Loading skeleton\n  if (isLoading) {\n    return (\n      <div className=\"flex-grow p-4\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"flex items-center gap-2\">\n            <Skeleton className=\"h-8 w-8 rounded-full\" />\n            <Skeleton className=\"h-8 w-8 rounded-full\" />\n          </div>\n        </div>\n        <Skeleton className=\"h-10 w-full mb-6\" />\n        {Array(3).fill(0).map((_, i) => (\n          <div key={i} className=\"mb-4\">\n            <Skeleton className=\"h-32 w-full rounded-lg\" />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <h1 className=\"text-xl font-medium\">Boli Entries</h1>\n          \n          {/* Bulk actions buttons */}\n          {showBulkActions && (\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-neutral-500\">\n                {selectedEntries.length} selected\n              </span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                onClick={handleBulkWhatsAppReminder}\n              >\n                <span className=\"material-icons text-sm mr-1\">chat</span>\n                Bulk WhatsApp\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center w-full sm:w-auto gap-2\">\n          {/* Past Records Button */}\n          {user && (user.role === 'admin' || user.role === 'operator') && (\n            <Button \n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setLocation('/previous-outstanding/new')}\n              className=\"bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 rounded-full shadow-sm flex gap-2 items-center\"\n            >\n              <span className=\"text-sm\">üìù</span>\n              <span>Past Records</span>\n            </Button>\n          )}\n          \n          {/* Mobile: Filter Dialog */}\n          {isMobile ? (\n            <Dialog open={isFilterOpen} onOpenChange={setIsFilterOpen}>\n              <DialogTrigger asChild>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"rounded-full bg-white shadow-sm flex gap-2 items-center\"\n                >\n                  <span className=\"material-icons text-neutral-500 text-sm\">filter_list</span>\n                  <span>Filter & Sort</span>\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Filter & Sort Entries</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4 pt-4\">\n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Boli Date Range</label>\n                    <div className=\"datepicker-container w-full\">\n                      <DatePicker\n                        selectsRange={true}\n                        startDate={boliDateRange[0]}\n                        endDate={boliDateRange[1]}\n                        onChange={(update) => {\n                          setBoliDateRange(update);\n                        }}\n                        isClearable={true}\n                        placeholderText=\"Select date range\"\n                        className=\"w-full border rounded-md p-2 text-sm\"\n                        dateFormat=\"MMM d, yyyy\"\n                        calendarClassName=\"calendar-popup\"\n                        monthsShown={2}\n                        showMonthDropdown\n                        showYearDropdown\n                        dropdownMode=\"select\"\n                        renderMonthContent={(month, shortMonth) => (\n                          <div>{shortMonth}</div>\n                        )}\n                        renderCustomHeader={({\n                          date,\n                          decreaseMonth,\n                          increaseMonth,\n                          prevMonthButtonDisabled,\n                          nextMonthButtonDisabled,\n                        }) => (\n                          <div className=\"flex items-center justify-between px-2 py-2\">\n                            <button\n                              onClick={decreaseMonth}\n                              disabled={prevMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_left</span>\n                            </button>\n                            <div className=\"text-lg font-medium\">\n                              {date.toLocaleDateString('en-US', {\n                                month: 'long',\n                                year: 'numeric',\n                              })}\n                            </div>\n                            <button\n                              onClick={increaseMonth}\n                              disabled={nextMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_right</span>\n                            </button>\n                          </div>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Last Updated Range</label>\n                    <div className=\"datepicker-container w-full\">\n                      <DatePicker\n                        selectsRange={true}\n                        startDate={updatedAtRange[0]}\n                        endDate={updatedAtRange[1]}\n                        onChange={(update) => {\n                          setUpdatedAtRange(update);\n                        }}\n                        isClearable={true}\n                        placeholderText=\"Select date range\"\n                        className=\"w-full border rounded-md p-2 text-sm\"\n                        dateFormat=\"MMM d, yyyy\"\n                        calendarClassName=\"calendar-popup\"\n                        monthsShown={2}\n                        showMonthDropdown\n                        showYearDropdown\n                        dropdownMode=\"select\"\n                        renderCustomHeader={({\n                          date,\n                          decreaseMonth,\n                          increaseMonth,\n                          prevMonthButtonDisabled,\n                          nextMonthButtonDisabled,\n                        }) => (\n                          <div className=\"flex items-center justify-between px-2 py-2\">\n                            <button\n                              onClick={decreaseMonth}\n                              disabled={prevMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_left</span>\n                            </button>\n                            <div className=\"text-lg font-medium\">\n                              {date.toLocaleDateString('en-US', {\n                                month: 'long',\n                                year: 'numeric',\n                              })}\n                            </div>\n                            <button\n                              onClick={increaseMonth}\n                              disabled={nextMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_right</span>\n                            </button>\n                          </div>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Status</label>\n                    <Select value={statusFilter} onValueChange={setStatusFilter}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Filter by status\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Statuses</SelectItem>\n                        <SelectItem value={PaymentStatus.PENDING}>Payment Pending</SelectItem>\n                        <SelectItem value={PaymentStatus.PARTIAL}>Partially Paid</SelectItem>\n                        <SelectItem value={PaymentStatus.FULL}>Fully Paid</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Sort By</label>\n                    <Select value={sortBy} onValueChange={setSortBy}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Sort entries\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"date-desc\">Boli Date (Newest First)</SelectItem>\n                        <SelectItem value=\"date-asc\">Boli Date (Oldest First)</SelectItem>\n                        <SelectItem value=\"amount-desc\">Amount (High to Low)</SelectItem>\n                        <SelectItem value=\"amount-asc\">Amount (Low to High)</SelectItem>\n                        <SelectItem value=\"name-asc\">Name (A to Z)</SelectItem>\n                        <SelectItem value=\"name-desc\">Name (Z to A)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <Button \n                    className=\"w-full\" \n                    onClick={() => setIsFilterOpen(false)}\n                  >\n                    Apply Filters\n                  </Button>\n                </div>\n              </DialogContent>\n            </Dialog>\n          ) : (\n            /* Desktop: Inline filters */\n            <div className=\"flex flex-wrap gap-4\">\n              <div>\n                <label className=\"text-sm whitespace-nowrap mb-1 block\">Boli Date Range</label>\n                <div className=\"datepicker-container w-full\">\n                  <DatePicker\n                    selectsRange={true}\n                    startDate={boliDateRange[0]}\n                    endDate={boliDateRange[1]}\n                    onChange={(update) => {\n                      setBoliDateRange(update);\n                    }}\n                    isClearable={true}\n                    placeholderText=\"Select date range\"\n                    className=\"w-full border rounded-md p-2 text-sm\"\n                    dateFormat=\"MMM d, yyyy\"\n                    monthsShown={2}\n                    showMonthDropdown\n                    showYearDropdown\n                    dropdownMode=\"select\"\n                    renderCustomHeader={({\n                      date,\n                      decreaseMonth,\n                      increaseMonth,\n                      prevMonthButtonDisabled,\n                      nextMonthButtonDisabled,\n                    }) => (\n                      <div className=\"flex items-center justify-between px-2 py-2\">\n                        <button\n                          onClick={decreaseMonth}\n                          disabled={prevMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_left</span>\n                        </button>\n                        <div className=\"text-lg font-medium\">\n                          {date.toLocaleDateString('en-US', {\n                            month: 'long',\n                            year: 'numeric',\n                          })}\n                        </div>\n                        <button\n                          onClick={increaseMonth}\n                          disabled={nextMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_right</span>\n                        </button>\n                      </div>\n                    )}\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <label className=\"text-sm whitespace-nowrap mb-1 block\">Updated Date Range</label>\n                <div className=\"datepicker-container w-full\">\n                  <DatePicker\n                    selectsRange={true}\n                    startDate={updatedAtRange[0]}\n                    endDate={updatedAtRange[1]}\n                    onChange={(update) => {\n                      setUpdatedAtRange(update);\n                    }}\n                    isClearable={true}\n                    placeholderText=\"Select date range\"\n                    className=\"w-full border rounded-md p-2 text-sm\"\n                    dateFormat=\"MMM d, yyyy\"\n                    monthsShown={2}\n                    showMonthDropdown\n                    showYearDropdown\n                    dropdownMode=\"select\"\n                    renderCustomHeader={({\n                      date,\n                      decreaseMonth,\n                      increaseMonth,\n                      prevMonthButtonDisabled,\n                      nextMonthButtonDisabled,\n                    }) => (\n                      <div className=\"flex items-center justify-between px-2 py-2\">\n                        <button\n                          onClick={decreaseMonth}\n                          disabled={prevMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_left</span>\n                        </button>\n                        <div className=\"text-lg font-medium\">\n                          {date.toLocaleDateString('en-US', {\n                            month: 'long',\n                            year: 'numeric',\n                          })}\n                        </div>\n                        <button\n                          onClick={increaseMonth}\n                          disabled={nextMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_right</span>\n                        </button>\n                      </div>\n                    )}\n                  />\n                </div>\n              </div>\n              \n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[160px]\">\n                  <SelectValue placeholder=\"Filter by status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  <SelectItem value={PaymentStatus.PENDING}>Payment Pending</SelectItem>\n                  <SelectItem value={PaymentStatus.PARTIAL}>Partially Paid</SelectItem>\n                  <SelectItem value={PaymentStatus.FULL}>Fully Paid</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={sortBy} onValueChange={setSortBy}>\n                <SelectTrigger className=\"w-[160px]\">\n                  <SelectValue placeholder=\"Sort by\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"serial-desc\">Serial No. (Latest First)</SelectItem>\n                  <SelectItem value=\"serial-asc\">Serial No. (Oldest First)</SelectItem>\n                  <SelectItem value=\"date-desc\">Date (Newest First)</SelectItem>\n                  <SelectItem value=\"date-asc\">Date (Oldest First)</SelectItem>\n                  <SelectItem value=\"amount-desc\">Amount (High to Low)</SelectItem>\n                  <SelectItem value=\"amount-asc\">Amount (Low to High)</SelectItem>\n                  <SelectItem value=\"name-asc\">Name (A to Z)</SelectItem>\n                  <SelectItem value=\"name-desc\">Name (Z to A)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n        </div>\n      </div>\n      \n      {/* Search Bar and Select All */}\n      <div className=\"flex gap-4 mb-6\">\n        <div className=\"relative flex-1\">\n          <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n            <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n          </span>\n          <Input \n            type=\"text\" \n            placeholder=\"Search by name, description, or occasion\" \n            className=\"w-full pl-10 pr-4 py-2\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n        \n        {/* Select All button */}\n        {filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length > 0 && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleSelectAll}\n            className=\"whitespace-nowrap\"\n          >\n            {selectedEntries.length === filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length \n              ? 'Deselect All' : 'Select All'}\n          </Button>\n        )}\n      </div>\n      \n      {/* Empty state */}\n      {(!filteredAndSortedEntries || filteredAndSortedEntries.length === 0) && (\n        <div className=\"text-center py-12 text-neutral-500\">\n          <span className=\"material-icons text-5xl mb-2\">search_off</span>\n          <p className=\"text-lg font-medium\">No entries found</p>\n          <p className=\"text-sm\">Try adjusting your search filters</p>\n        </div>\n      )}\n      \n      {/* Mobile view: Card layout */}\n      {isMobile && filteredAndSortedEntries.length > 0 && (\n        <div>\n          {filteredAndSortedEntries.map(entry => (\n            <EntryCard key={entry.id} entry={entry} />\n          ))}\n        </div>\n      )}\n      \n      {/* Desktop view: Table layout */}\n      {!isMobile && filteredAndSortedEntries.length > 0 && (\n        <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-12\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedEntries.length === filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length && selectedEntries.length > 0}\n                    onChange={handleSelectAll}\n                    className=\"w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n                  />\n                </TableHead>\n                <TableHead className=\"w-16\">Serial</TableHead>\n                <TableHead>Description</TableHead>\n                <TableHead>User</TableHead>\n                <TableHead className=\"hidden lg:table-cell\">Mobile</TableHead>\n                <TableHead className=\"hidden xl:table-cell\">Address</TableHead>\n                <TableHead>Amount</TableHead>\n                <TableHead className=\"hidden md:table-cell\">Occasion</TableHead>\n                <TableHead className=\"hidden md:table-cell\">Boli Date</TableHead>\n                <TableHead className=\"hidden lg:table-cell\">Updated At</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredAndSortedEntries.map(entry => (\n                <TableRow key={entry.id} className=\"hover:bg-neutral-50\">\n                  <TableCell>\n                    {entry.userMobile && entry.pendingAmount > 0 ? (\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedEntries.includes(entry.id)}\n                        onChange={() => handleSelectEntry(entry.id)}\n                        className=\"w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n                      />\n                    ) : (\n                      <span className=\"w-4 h-4 inline-block\"></span>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-sm text-neutral-600\">{(entry as any).serialNumber}</TableCell>\n                  <TableCell className=\"font-medium\">{entry.description}</TableCell>\n                  <TableCell>{entry.userName}</TableCell>\n                  <TableCell className=\"hidden lg:table-cell\">{entry.userMobile || \"-\"}</TableCell>\n                  <TableCell className=\"hidden xl:table-cell\">{entry.userAddress || \"-\"}</TableCell>\n                  <TableCell>\n                    <div>‚Çπ{entry.totalAmount.toLocaleString()}</div>\n                    <div className=\"text-xs text-neutral-500\">\n                      <span className=\"text-green-500\">‚Çπ{entry.receivedAmount.toLocaleString()}</span>\n                      {entry.pendingAmount > 0 && (\n                        <> / <span className=\"text-destructive\">‚Çπ{entry.pendingAmount.toLocaleString()}</span></>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"hidden md:table-cell\">{entry.occasion}</TableCell>\n                  <TableCell className=\"hidden md:table-cell\">{formatDate(entry.auctionDate)}</TableCell>\n                  <TableCell className=\"hidden lg:table-cell\">{entry.updatedAt ? formatDate(entry.updatedAt) : \"-\"}</TableCell>\n                  <TableCell>\n                    <Badge className={getStatusClass(entry.status)}>\n                      {getStatusText(entry.status)}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex justify-end items-center space-x-1\">\n                      {entry.userMobile && entry.pendingAmount > 0 && (\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                          onClick={() => sendWhatsAppReminder(entry)}\n                          title=\"Send WhatsApp Reminder\"\n                        >\n                          <span className=\"material-icons text-sm mr-1\">chat</span>\n                          WhatsApp\n                        </Button>\n                      )}\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleViewDetails(entry.id)}\n                      >\n                        View\n                      </Button>\n                      \n                      {/* Edit controls for both operators and admins */}\n                      {(user?.role === 'admin' || user?.role === 'operator') && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => setLocation(`/entries/${entry.id}/edit`)}\n                          className=\"text-blue-600\"\n                        >\n                          <span className=\"material-icons text-sm mr-1\">edit</span>\n                          Edit\n                        </Button>\n                      )}\n                      \n                      {/* Admin-only controls for deleting entries */}\n                      {user?.role === 'admin' && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-red-600\"\n                          onClick={() => handleDeleteEntry(entry)}\n                        >\n                          <span className=\"material-icons text-sm\">delete</span>\n                          <span className=\"sr-only\">Delete</span>\n                        </Button>\n                      )}\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":41771},"local-deployment/client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"server/db.ts":{"content":"import { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nconst client = postgres(process.env.DATABASE_URL);\nexport const db = drizzle(client, { schema });\n\n// Export query function for raw SQL queries (replaces pool.query)\nexport const query = async (sql: string, params: any[] = []) => {\n  const result = await client.unsafe(sql, params);\n  return { rows: result };\n};\n","size_bytes":573},"client/src/pages/previous-outstanding.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Calendar, User, Plus, X, Eye, Edit, MessageCircle } from \"lucide-react\";\nimport { Calendar as CalendarComponent } from \"@/components/ui/calendar\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { exportPreviousOutstanding } from \"@/lib/excel-export\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Create a simplified media query hook inline\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\ninterface PreviousOutstanding {\n  id: number;\n  serialNumber?: string;\n  recordNumber?: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  attachmentUrl?: string;\n  attachmentName?: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\nexport default function PreviousOutstanding() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const isMobile = useMediaQuery(\"(max-width: 640px)\");\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n  \n  // Edit dialog states\n  const [editingRecord, setEditingRecord] = useState<PreviousOutstanding | null>(null);\n  const [editAmount, setEditAmount] = useState<string>(\"\");\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editAttachment, setEditAttachment] = useState<File | null>(null);\n  const [editUserId, setEditUserId] = useState<number | undefined>(undefined);\n  const [editDescription, setEditDescription] = useState<string>(\"\");\n  \n  // Check if user has permission to view this page\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Access Denied</h2>\n          <p className=\"text-red-600\">You don't have permission to view previous outstanding records.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch previous outstanding records with date range query params\n  const queryParams = new URLSearchParams();\n  if (startDate) {\n    queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  }\n  if (endDate) {\n    queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n  }\n\n  const { data: records, isLoading } = useQuery<PreviousOutstanding[]>({\n    queryKey: ['/api/previous-outstanding', queryParams.toString()],\n    staleTime: 30000,\n    gcTime: 300000,\n  });\n\n\n\n  // Edit mutation\n  const editMutation = useMutation({\n    mutationFn: async ({ recordId, amount, attachment, userId, description }: { recordId: number; amount: number; attachment?: File; userId?: number; description?: string }) => {\n      if (attachment) {\n        // Use FormData for file upload\n        const formData = new FormData();\n        formData.append('outstandingAmount', amount.toString());\n        formData.append('attachmentFile', attachment);\n        if (userId) formData.append('userId', userId.toString());\n        if (description !== undefined) formData.append('description', description);\n        \n        const response = await fetch(`/api/previous-outstanding/${recordId}`, {\n          method: 'PATCH',\n          body: formData,\n          credentials: 'include',\n        });\n        \n        if (!response.ok) {\n          const error = await response.json();\n          throw new Error(error.message || 'Failed to update record');\n        }\n        \n        return response.json();\n      } else {\n        const updateData: any = { outstandingAmount: amount };\n        if (userId) updateData.userId = userId;\n        if (description !== undefined) updateData.description = description;\n        return apiRequest('PATCH', `/api/previous-outstanding/${recordId}`, updateData);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/previous-outstanding'] });\n      toast({\n        title: \"Success\",\n        description: \"Outstanding amount updated successfully\"\n      });\n      setIsEditDialogOpen(false);\n      setEditingRecord(null);\n      setEditAttachment(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update outstanding amount\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Apply filters\n  const filteredRecords = useMemo(() => {\n    return (records || []).filter(record => {\n      const matchesSearch = !searchTerm || \n        record.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.userMobile?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.createdBy.toLowerCase().includes(searchTerm.toLowerCase());\n      \n      const recordDate = new Date(record.createdAt);\n      const matchesDateRange = (!startDate || recordDate >= startDate) && \n                              (!endDate || recordDate <= endDate);\n      \n      return matchesSearch && matchesDateRange;\n    });\n  }, [records, searchTerm, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  const formatAmount = (amount: number) => {\n    return amount.toLocaleString();\n  };\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  const handleEditClick = (record: PreviousOutstanding) => {\n    setEditingRecord(record);\n    setEditAmount(record.outstandingAmount.toString()); // Amount already in rupees\n    setEditUserId(record.userId);\n    setEditDescription(record.description);\n    setEditAttachment(null);\n    setIsEditDialogOpen(true);\n  };\n\n  const handleEditSubmit = () => {\n    if (!editingRecord) return;\n    \n    const amount = parseFloat(editAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid amount\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const minAmount = editingRecord.receivedAmount; // Amount already in rupees\n    if (amount < minAmount) {\n      toast({\n        title: \"Error\",\n        description: `Amount cannot be less than already received amount of ‚Çπ${minAmount.toLocaleString()}`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    editMutation.mutate({\n      recordId: editingRecord.id, \n      amount: amount,\n      attachment: editAttachment || undefined,\n      userId: user?.role === 'admin' ? editUserId : undefined,\n      description: user?.role === 'admin' ? editDescription : undefined\n    });\n  };\n\n  const handleWhatsappClick = (record: PreviousOutstanding) => {\n    const message = \n      `üèõÔ∏è ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•å‡§Æ‡•ç‡§Ø ‡§Ø‡§æ‡§¶ ‡§¶‡§ø‡§≤‡§æ‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡•á‡§∑‡§ø‡§§ ‡§π‡•à:\\n\\n` +\n      `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: 31.07.2025 ‡§§‡§ï ‡§∂‡•á‡§∑ (outstanding)\\n` +\n      `üí∞ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${record.outstandingAmount.toLocaleString()}\\n` +\n      `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${record.pendingAmount.toLocaleString()}\\n\\n` +\n      `üôè ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™‡§ø‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§ú‡§Æ‡§æ ‡§ï‡§∞ ‡§™‡•Å‡§£‡•ç‡§Ø ‡§≤‡§æ‡§≠ ‡§∏‡§Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§\\n\\n` +\n      `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n    \n    // Create WhatsApp URL using different encoding approach\n    const phoneNumber = record.userMobile?.replace(/[^\\d]/g, '') || '';\n    \n    if (!phoneNumber) {\n      toast({\n        title: \"Error\",\n        description: \"Mobile number not available for this user\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Use the same approach as working boli payments\n    const whatsappUrl = `https://api.whatsapp.com/send?phone=91${phoneNumber}&text=${encodeURIComponent(message)}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  const totalAmount = filteredRecords.reduce((sum, record) => sum + record.outstandingAmount, 0);\n\n  return (\n    <div className=\"space-y-6 p-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Previous Outstanding Records</h1>\n          <p className=\"text-muted-foreground\">\n            Historical outstanding amounts from old system\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => exportPreviousOutstanding(filteredRecords)}\n            variant=\"outline\"\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n          >\n            üìä Export\n          </Button>\n          {(user?.role === 'admin' || user?.role === 'operator') && (\n            <Button onClick={() => setLocation('/previous-outstanding/new')}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Record\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Summary</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-blue-600\">{filteredRecords.length}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Records</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-amber-600\">‚Çπ{totalAmount.toLocaleString()}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Outstanding</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-green-600\">\n                ‚Çπ{filteredRecords.reduce((sum, record) => sum + (record.receivedAmount || 0), 0).toLocaleString()}\n              </div>\n              <p className=\"text-sm text-muted-foreground\">Total Received</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-red-600\">\n                ‚Çπ{filteredRecords.reduce((sum, record) => sum + (record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount), 0).toLocaleString()}\n              </div>\n              <p className=\"text-sm text-muted-foreground\">Total Pending</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <CardTitle>Filters</CardTitle>\n            <Button variant=\"outline\" size=\"sm\" onClick={clearFilters}>\n              <X className=\"h-4 w-4 mr-2\" />\n              Clear Filters\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search</label>\n              <Input\n                placeholder=\"Search by name, mobile, description...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">From Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !startDate && \"text-muted-foreground\"\n                    )}\n                  >\n                    <Calendar className=\"mr-2 h-4 w-4\" />\n                    {startDate ? format(startDate, \"PPP\") : \"Pick a date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <CalendarComponent\n                    mode=\"single\"\n                    selected={startDate || undefined}\n                    onSelect={(date) => setStartDate(date || null)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">To Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !endDate && \"text-muted-foreground\"\n                    )}\n                  >\n                    <Calendar className=\"mr-2 h-4 w-4\" />\n                    {endDate ? format(endDate, \"PPP\") : \"Pick a date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <CalendarComponent\n                    mode=\"single\"\n                    selected={endDate || undefined}\n                    onSelect={(date) => setEndDate(date || null)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Records Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Records ({filteredRecords.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n            </div>\n          ) : filteredRecords.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {records?.length === 0 ? \"No previous outstanding records found.\" : \"No records match your search criteria.\"}\n            </div>\n          ) : (\n            <>\n              {/* Mobile view: Card layout */}\n              {isMobile && (\n                <div className=\"space-y-4\">\n                  {filteredRecords.map((record) => (\n                    <Card key={record.id} className=\"border border-gray-200\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className=\"text-xs text-neutral-500 bg-neutral-100 px-2 py-0.5 rounded font-mono\">\n                                {record.recordNumber ? `REC-${record.recordNumber}` : record.serialNumber || `REC-${filteredRecords.length - filteredRecords.indexOf(record)}`}\n                              </span>\n                              {getStatusBadge(record.status || 'pending', record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}\n                            </div>\n                            <h3 className=\"font-medium text-lg\">{record.userName}</h3>\n                            <p className=\"text-sm text-neutral-500\">üì± {record.userMobile}</p>\n                            {record.userAddress && (\n                              <p className=\"text-xs text-neutral-600 mt-1\">üìç {record.userAddress}</p>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-2 my-3 text-sm\">\n                          <div>\n                            <p className=\"text-neutral-500\">Outstanding:</p>\n                            <p className=\"font-medium\">‚Çπ{formatAmount(record.outstandingAmount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Received:</p>\n                            <p className=\"text-green-600\">‚Çπ{formatAmount(record.receivedAmount || 0)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Pending:</p>\n                            <p className=\"text-red-600\">‚Çπ{formatAmount(record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Created:</p>\n                            <p>{formatDate(record.createdAt)}</p>\n                          </div>\n                        </div>\n                        \n                        {record.description && (\n                          <div className=\"text-sm text-neutral-600 mt-2 mb-3\">\n                            <span className=\"text-neutral-500\">Description:</span> {record.description}\n                          </div>\n                        )}\n                        \n                        {record.attachmentUrl && (\n                          <div className=\"text-sm mb-3\">\n                            <a \n                              href=\"#\"\n                              className=\"text-blue-600 hover:text-blue-800 flex items-center gap-1\"\n                              onClick={(e) => {\n                                e.preventDefault();\n                                let baseUrl = record.attachmentUrl?.startsWith('/uploads/') \n                                  ? record.attachmentUrl \n                                  : `/uploads/${record.attachmentUrl || ''}`;\n                                \n                                // URL encode the filename part\n                                const parts = baseUrl.split('/');\n                                if (parts.length > 0) {\n                                  parts[parts.length - 1] = encodeURIComponent(parts[parts.length - 1]);\n                                  baseUrl = parts.join('/');\n                                }\n                                \n                                window.open(baseUrl, '_blank');\n                              }}\n                            >\n                              üìé View Attachment\n                            </a>\n                          </div>\n                        )}\n                        \n                        <div className=\"text-xs text-neutral-500 mb-3\">\n                          Created by {record.createdBy}\n                        </div>\n                        \n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setLocation(`/previous-outstanding/${record.id}/details`)}\n                          >\n                            <Eye className=\"h-4 w-4 mr-1\" />\n                            View\n                          </Button>\n                          {record.userMobile && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleWhatsappClick(record)}\n                              className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n                            >\n                              <MessageCircle className=\"h-4 w-4 mr-1\" />\n                              WhatsApp\n                            </Button>\n                          )}\n                          {(user?.role === 'admin' || user?.role === 'operator') && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => setLocation(`/previous-outstanding/${record.id}/edit`)}\n                            >\n                              <Edit className=\"h-4 w-4 mr-1\" />\n                              Edit\n                            </Button>\n                          )}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n              \n              {/* Desktop view: Table layout */}\n              {!isMobile && (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Record Number</TableHead>\n                    <TableHead>User Details</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Payment Status</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Attachment</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredRecords.map((record) => (\n                    <TableRow key={record.id}>\n                      <TableCell>\n                        <div className=\"font-mono text-sm\">\n                          {record.recordNumber ? `REC-${record.recordNumber}` : record.serialNumber || `REC-${filteredRecords.length - filteredRecords.indexOf(record)}`}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{record.userName}</div>\n                          <div className=\"text-sm text-muted-foreground\">{record.userMobile}</div>\n                          <div className=\"text-xs text-muted-foreground\">{record.userAddress}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-medium\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n                        {(record.receivedAmount || 0) > 0 && (\n                          <div className=\"text-sm text-green-600\">Received: ‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n                        )}\n                        {(record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount) > 0 && (\n                          <div className=\"text-sm text-red-600\">Pending: ‚Çπ{formatAmount(record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}</div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {getStatusBadge(record.status || 'pending', record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}\n                      </TableCell>\n                      <TableCell>{record.description}</TableCell>\n                      <TableCell>\n                        {record.attachmentUrl ? (\n                          <a \n                            href=\"#\"\n                            target=\"_blank\" \n                            rel=\"noopener noreferrer\"\n                            className=\"text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1\"\n                            onClick={(e) => {\n                              e.preventDefault();\n                              let baseUrl = record.attachmentUrl?.startsWith('/uploads/') \n                                ? record.attachmentUrl \n                                : `/uploads/${record.attachmentUrl || ''}`;\n                              \n                              // URL encode the filename part while keeping the path structure\n                              const parts = baseUrl.split('/');\n                              if (parts.length > 0) {\n                                parts[parts.length - 1] = encodeURIComponent(parts[parts.length - 1]);\n                                baseUrl = parts.join('/');\n                              }\n                              \n                              window.open(baseUrl, '_blank');\n                            }}\n                          >\n                            <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\n                            </svg>\n                            View File\n                          </a>\n                        ) : (\n                          <span className=\"text-gray-400 text-sm\">No file</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"text-sm\">{formatDate(record.createdAt)}</div>\n                          <div className=\"text-xs text-muted-foreground\">by {record.createdBy}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setLocation(`/previous-outstanding/${record.id}/details`)}\n                          >\n                            <Eye className=\"h-4 w-4 mr-1\" />\n                            View\n                          </Button>\n                          {record.userMobile && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleWhatsappClick(record)}\n                              className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n                            >\n                              <MessageCircle className=\"h-4 w-4 mr-1\" />\n                              WhatsApp\n                            </Button>\n                          )}\n                          {(user?.role === 'admin' || user?.role === 'operator') && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => setLocation(`/previous-outstanding/${record.id}/edit`)}\n                            >\n                              <Edit className=\"h-4 w-4 mr-1\" />\n                              Edit\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                  </Table>\n                </div>\n              )}\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Edit Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Outstanding Amount</DialogTitle>\n          </DialogHeader>\n          \n          {editingRecord && (\n            <div className=\"space-y-4\">\n              {/* User Field - Dropdown for admin, readonly for others */}\n              {user?.role === 'admin' ? (\n                <div>\n                  <Label htmlFor=\"user-select\">Select User *</Label>\n                  <UserSelect\n                    value={editUserId}\n                    onValueChange={setEditUserId}\n                    placeholder=\"Search and select user\"\n                    className=\"w-full\"\n                  />\n                </div>\n              ) : (\n                <div>\n                  <Label htmlFor=\"user\">User</Label>\n                  <Input\n                    id=\"user\"\n                    value={editingRecord.userName}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n              \n              {/* Description Field - Editable for admin, readonly for operators */}\n              {user?.role === 'admin' ? (\n                <div>\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Input\n                    id=\"description\"\n                    value={editDescription}\n                    onChange={(e) => setEditDescription(e.target.value)}\n                    placeholder=\"Enter description\"\n                  />\n                </div>\n              ) : (\n                <div>\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Input\n                    id=\"description\"\n                    value={editingRecord.description}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n\n              <div>\n                <Label htmlFor=\"received\">Already Received</Label>\n                <Input\n                  id=\"received\"\n                  value={`‚Çπ${editingRecord.receivedAmount.toLocaleString()}`}\n                  disabled\n                  className=\"bg-gray-50 text-green-700 font-medium\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"amount\">Outstanding Amount (‚Çπ)</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={editAmount}\n                  onChange={(e) => setEditAmount(e.target.value)}\n                  min={editingRecord.receivedAmount}\n                  step=\"0.01\"\n                  placeholder=\"Enter amount in rupees\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Minimum: ‚Çπ{editingRecord.receivedAmount.toLocaleString()} (already received)\n                </p>\n              </div>\n\n              <div>\n                <Label htmlFor=\"attachment\">Replace Attachment (Optional)</Label>\n                <Input\n                  id=\"attachment\"\n                  type=\"file\"\n                  accept=\"image/*,application/pdf\"\n                  onChange={(e) => setEditAttachment(e.target.files?.[0] || null)}\n                  className=\"cursor-pointer\"\n                />\n                {editingRecord.attachmentUrl && (\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Current: <span className=\"text-blue-600\">File attached</span>\n                  </p>\n                )}\n                {editAttachment && (\n                  <p className=\"text-xs text-green-600 mt-1\">\n                    New file selected: {editAttachment.name}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsEditDialogOpen(false)}\n                  disabled={editMutation.isPending}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"button\"\n                  onClick={handleEditSubmit}\n                  disabled={editMutation.isPending}\n                >\n                  {editMutation.isPending ? \"Updating...\" : \"Update\"}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":33762},"client/src/pages/expense-entry-form.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { ArrowLeft, Plus, Upload, X, FileImage, Search, Save } from \"lucide-react\";\nimport { PaymentMode } from \"@shared/schema\";\nimport { Command, CommandInput, CommandItem, CommandList, CommandEmpty } from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function ExpenseEntryForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  \n  // Check if we're in edit mode\n  const [match, params] = useRoute(\"/expense-entry-form/:id\");\n  const expenseId = match ? params?.id : null;\n  const isEditMode = Boolean(expenseId);\n  \n  // Form state - ordered as per requirement\n  const [firmName, setFirmName] = useState(\"\");\n  const [billNo, setBillNo] = useState(\"\");\n  const [billDate, setBillDate] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [quantity, setQuantity] = useState(\"\");\n  const [reason, setReason] = useState(\"\");\n  const [expenseDate, setExpenseDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentMode, setPaymentMode] = useState(\"\");\n  const [approvedBy, setApprovedBy] = useState(\"\");\n  const [paidBy, setPaidBy] = useState(\"\");\n  \n  // User selection states\n  const [approvedByOpen, setApprovedByOpen] = useState(false);\n  const [paidByOpen, setPaidByOpen] = useState(false);\n  const [approvedBySearch, setApprovedBySearch] = useState(\"\");\n  const [paidBySearch, setPaidBySearch] = useState(\"\");\n  \n  // File upload states\n  const [receiptFile, setReceiptFile] = useState<File | null>(null);\n  const [paymentScreenshot, setPaymentScreenshot] = useState<File | null>(null);\n  const receiptFileRef = useRef<HTMLInputElement>(null);\n  const paymentFileRef = useRef<HTMLInputElement>(null);\n  \n  // Fetch users for dropdowns\n  const { data: users } = useQuery<any[]>({\n    queryKey: ['/api/users'],\n  });\n  \n  // Fetch expense entry data if editing\n  const { data: expenseEntry, isLoading: isLoadingEntry } = useQuery<any>({\n    queryKey: ['/api/expense-entries', expenseId],\n    queryFn: async () => {\n      const response = await fetch(`/api/expense-entries`);\n      if (!response.ok) throw new Error('Failed to fetch expense entries');\n      const entries = await response.json();\n      return entries.find((e: any) => e.id === parseInt(expenseId || '0'));\n    },\n    enabled: isEditMode && Boolean(expenseId),\n  });\n  \n  // Pre-fill form when editing\n  useEffect(() => {\n    if (isEditMode && expenseEntry) {\n      setFirmName(expenseEntry.firm_name || \"\");\n      setBillNo(expenseEntry.bill_no || \"\");\n      setBillDate(expenseEntry.bill_date || \"\");\n      setDescription(expenseEntry.description || \"\");\n      setAmount(expenseEntry.amount?.toString() || \"\");\n      setQuantity(expenseEntry.quantity?.toString() || \"\");\n      setReason(expenseEntry.reason || \"\");\n      setExpenseDate(expenseEntry.expense_date || new Date().toISOString().split('T')[0]);\n      setPaymentMode(expenseEntry.payment_mode || \"\");\n      setApprovedBy(expenseEntry.approved_by || \"\");\n      setPaidBy(expenseEntry.paid_by || \"\");\n    }\n  }, [isEditMode, expenseEntry]);\n\n  const saveExpenseEntryMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const url = isEditMode ? `/api/expense-entries/${expenseId}` : '/api/expense-entries';\n      const method = isEditMode ? 'PATCH' : 'POST';\n      \n      const response = await fetch(url, {\n        method,\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || `Failed to ${isEditMode ? 'update' : 'create'} expense entry`);\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (savedEntry) => {\n      toast({\n        title: \"Success\",\n        description: `Expense entry ${isEditMode ? 'updated' : 'created'} successfully for ‚Çπ${savedEntry.amount.toFixed(2)}.`,\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/expense-entries'] });\n      \n      // Navigate to list\n      setTimeout(() => setLocation('/expense-entries'), 1000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || `Failed to ${isEditMode ? 'update' : 'create'} expense entry`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Basic validation - only mandatory fields marked with *\n    if (!description.trim() || !amount || !paymentMode || !approvedBy.trim() || !paidBy.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill in all required fields: Line Item Description, Amount, Mode of Payment, Approved By, and Paid By.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate amount\n    const numAmount = parseFloat(amount);\n    if (isNaN(numAmount) || numAmount <= 0) {\n      toast({\n        title: \"Validation Error\", \n        description: \"Please enter a valid amount greater than 0.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate quantity if provided\n    if (quantity.trim()) {\n      const numQuantity = parseInt(quantity);\n      if (isNaN(numQuantity) || numQuantity < 1) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Quantity must be at least 1 if provided.\",\n          variant: \"destructive\", \n        });\n        return;\n      }\n    }\n\n    // Validate receipt file is provided (only for create mode, in edit mode it's optional)\n    if (!isEditMode && !receiptFile) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please upload an expense receipt.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate payment screenshot for non-cash payments (only for create mode, in edit mode it's optional)\n    if (!isEditMode && paymentMode !== 'cash' && !paymentScreenshot) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Payment screenshot is required for non-cash payments.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Create FormData for file uploads\n    const formData = new FormData();\n    formData.append('firmName', firmName.trim());\n    formData.append('billNo', billNo.trim());\n    formData.append('billDate', billDate);\n    formData.append('description', description.trim());\n    formData.append('amount', numAmount.toString()); // Amount in rupees\n    formData.append('quantity', quantity.trim() || '0');\n    formData.append('reason', reason.trim());\n    formData.append('expenseDate', expenseDate);\n    formData.append('paymentMode', paymentMode);\n    formData.append('approvedBy', approvedBy.trim());\n    formData.append('paidBy', paidBy.trim());\n    formData.append('createdBy', user?.username || \"system\");\n    \n    // Add files (only if provided - in edit mode, existing files will be kept if not replaced)\n    if (receiptFile) {\n      formData.append('receiptFile', receiptFile);\n    }\n    if (paymentScreenshot) {\n      formData.append('paymentScreenshot', paymentScreenshot);\n    }\n\n    saveExpenseEntryMutation.mutate(formData);\n  };\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can {isEditMode ? 'edit' : 'create'} expense entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n  \n  // Show loading skeleton when fetching expense entry data in edit mode\n  if (isEditMode && isLoadingEntry) {\n    return (\n      <div className=\"container mx-auto p-4 max-w-2xl\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-8 w-64\" />\n              <Skeleton className=\"h-4 w-full\" />\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {[...Array(12)].map((_, i) => (\n                <Skeleton key={i} className=\"h-10 w-full\" />\n              ))}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/expense-entries')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Expense Entries\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            {isEditMode ? <Save className=\"h-5 w-5\" /> : <Plus className=\"h-5 w-5\" />}\n            {isEditMode ? 'Edit Expense Entry' : 'Create New Expense Entry'}\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            {isEditMode \n              ? 'Update the expense entry details below.' \n              : 'Record a new expense with all required details and approvals.'}\n          </p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Firm Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"firm-name\">Firm Name</Label>\n              <Input \n                id=\"firm-name\"\n                value={firmName}\n                onChange={(e) => setFirmName(e.target.value)}\n                placeholder=\"Enter firm name (optional)\"\n              />\n            </div>\n\n            {/* Bill No and Bill Date */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bill-no\">Bill No</Label>\n                <Input \n                  id=\"bill-no\"\n                  value={billNo}\n                  onChange={(e) => setBillNo(e.target.value)}\n                  placeholder=\"Enter bill number (optional)\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bill-date\">Bill Date</Label>\n                <Input \n                  id=\"bill-date\"\n                  type=\"date\" \n                  value={billDate}\n                  onChange={(e) => setBillDate(e.target.value)}\n                />\n              </div>\n            </div>\n\n            {/* Line Item Description */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Line Item Description *</Label>\n              <Input \n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"Enter item description\"\n              />\n            </div>\n\n            {/* Amount and Quantity */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                <Input \n                  id=\"amount\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={amount}\n                  onChange={(e) => setAmount(e.target.value)}\n                  placeholder=\"0.00\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"quantity\">Quantity</Label>\n                <Input \n                  id=\"quantity\"\n                  type=\"number\"\n                  min=\"1\"\n                  value={quantity}\n                  onChange={(e) => setQuantity(e.target.value)}\n                  placeholder=\"Enter quantity (optional)\"\n                />\n              </div>\n            </div>\n\n            {/* Reason for Expense */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reason\">Reason for Expense</Label>\n              <Textarea \n                id=\"reason\"\n                value={reason}\n                onChange={(e) => setReason(e.target.value)}\n                placeholder=\"Explain the reason for this expense (optional)\"\n                rows={3}\n              />\n            </div>\n\n            {/* Date and Payment Mode */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"expense-date\">Date of Expense *</Label>\n                <Input \n                  id=\"expense-date\"\n                  type=\"date\" \n                  value={expenseDate}\n                  onChange={(e) => setExpenseDate(e.target.value)}\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"payment-mode\">Mode of Payment *</Label>\n                <Select value={paymentMode} onValueChange={setPaymentMode}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select payment mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                    <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                    <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                    <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Receipt File Upload */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"receipt-file\">Expense Receipt *</Label>\n              <div className=\"flex gap-2\">\n                <Input \n                  ref={receiptFileRef}\n                  id=\"receipt-file\"\n                  type=\"file\"\n                  accept=\".jpg,.jpeg,.png,.pdf\"\n                  onChange={(e) => setReceiptFile(e.target.files?.[0] || null)}\n                  className=\"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90\"\n                />\n                {receiptFile && (\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => {\n                      setReceiptFile(null);\n                      if (receiptFileRef.current) receiptFileRef.current.value = \"\";\n                    }}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n              {receiptFile && (\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <FileImage className=\"h-4 w-4\" />\n                  <span>{receiptFile.name} ({(receiptFile.size / 1024).toFixed(1)} KB)</span>\n                </div>\n              )}\n              <p className=\"text-xs text-muted-foreground\">\n                Upload the expense receipt (JPG, JPEG, PNG, PDF)\n              </p>\n            </div>\n\n            {/* Payment Screenshot (conditional) */}\n            {paymentMode && paymentMode !== PaymentMode.CASH && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"payment-screenshot\">Payment Screenshot *</Label>\n                <div className=\"flex gap-2\">\n                  <Input \n                    ref={paymentFileRef}\n                    id=\"payment-screenshot\"\n                    type=\"file\"\n                    accept=\".jpg,.jpeg,.png,.pdf\"\n                    onChange={(e) => setPaymentScreenshot(e.target.files?.[0] || null)}\n                    className=\"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90\"\n                  />\n                  {paymentScreenshot && (\n                    <Button \n                      type=\"button\" \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        setPaymentScreenshot(null);\n                        if (paymentFileRef.current) paymentFileRef.current.value = \"\";\n                      }}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n                {paymentScreenshot && (\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <FileImage className=\"h-4 w-4\" />\n                    <span>{paymentScreenshot.name} ({(paymentScreenshot.size / 1024).toFixed(1)} KB)</span>\n                  </div>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  Upload payment screenshot for {paymentMode.toUpperCase()} transaction (JPG, JPEG, PNG, PDF)\n                </p>\n              </div>\n            )}\n\n            {/* Approved By - User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"approved-by\">Approved By *</Label>\n              <Popover open={approvedByOpen} onOpenChange={setApprovedByOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={approvedByOpen}\n                    className=\"w-full justify-between\"\n                  >\n                    {approvedBy ? \n                      users?.find((user) => user.name === approvedBy)?.name || approvedBy :\n                      \"Select approver...\"\n                    }\n                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-full p-0\">\n                  <Command>\n                    <CommandInput \n                      placeholder=\"Search users...\" \n                      value={approvedBySearch}\n                      onValueChange={setApprovedBySearch}\n                    />\n                    <CommandList>\n                      <CommandEmpty>No user found.</CommandEmpty>\n                      {users?.filter(user => \n                        user.name.toLowerCase().includes(approvedBySearch.toLowerCase()) ||\n                        user.username.toLowerCase().includes(approvedBySearch.toLowerCase())\n                      ).map((user) => (\n                        <CommandItem\n                          key={user.id}\n                          value={user.name}\n                          onSelect={(currentValue) => {\n                            setApprovedBy(currentValue === approvedBy ? \"\" : currentValue);\n                            setApprovedByOpen(false);\n                            setApprovedBySearch(\"\");\n                          }}\n                        >\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{user.name}</span>\n                            <span className=\"text-xs text-muted-foreground\">@{user.username}</span>\n                          </div>\n                        </CommandItem>\n                      ))}\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            {/* Paid By - User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"paid-by\">Paid By *</Label>\n              <Popover open={paidByOpen} onOpenChange={setPaidByOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={paidByOpen}\n                    className=\"w-full justify-between\"\n                  >\n                    {paidBy ? \n                      users?.find((user) => user.name === paidBy)?.name || paidBy :\n                      \"Select payer...\"\n                    }\n                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-full p-0\">\n                  <Command>\n                    <CommandInput \n                      placeholder=\"Search users...\" \n                      value={paidBySearch}\n                      onValueChange={setPaidBySearch}\n                    />\n                    <CommandList>\n                      <CommandEmpty>No user found.</CommandEmpty>\n                      {users?.filter(user => \n                        user.name.toLowerCase().includes(paidBySearch.toLowerCase()) ||\n                        user.username.toLowerCase().includes(paidBySearch.toLowerCase())\n                      ).map((user) => (\n                        <CommandItem\n                          key={user.id}\n                          value={user.name}\n                          onSelect={(currentValue) => {\n                            setPaidBy(currentValue === paidBy ? \"\" : currentValue);\n                            setPaidByOpen(false);\n                            setPaidBySearch(\"\");\n                          }}\n                        >\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{user.name}</span>\n                            <span className=\"text-xs text-muted-foreground\">@{user.username}</span>\n                          </div>\n                        </CommandItem>\n                      ))}\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setLocation('/expense-entries')}\n                className=\"flex-1\"\n                data-testid=\"button-cancel\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={saveExpenseEntryMutation.isPending}\n                className=\"flex-1\"\n                data-testid=\"button-submit-expense\"\n              >\n                {saveExpenseEntryMutation.isPending \n                  ? (isEditMode ? \"Updating...\" : \"Creating...\") \n                  : (isEditMode ? \"Update Expense Entry\" : \"Create Expense Entry\")\n                }\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":23502},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":777},"local-deployment/client/src/pages/previous-outstanding-details.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { ArrowLeft, Plus, FileText, CreditCard } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PreviousOutstandingRecord {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\nexport default function PreviousOutstandingDetails() {\n  const { id } = useParams();\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Payment form state\n  const [isPaymentDialogOpen, setIsPaymentDialogOpen] = useState(false);\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n  const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentMode, setPaymentMode] = useState(\"cash\");\n\n  const [paymentFile, setPaymentFile] = useState<File | null>(null);\n\n  // Check permissions\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Access Denied</h2>\n          <p className=\"text-red-600\">You don't have permission to view previous outstanding details.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch record details\n  const { data: record, isLoading, error } = useQuery<PreviousOutstandingRecord>({\n    queryKey: [`/api/previous-outstanding/${id}`],\n    enabled: !!id,\n  });\n\n  // Record payment mutation\n  const recordPaymentMutation = useMutation({\n    mutationFn: async (paymentData: FormData) => {\n      const response = await fetch(`/api/previous-outstanding/${id}/payment`, {\n        method: 'POST',\n        body: paymentData,\n      });\n      if (!response.ok) {\n        throw new Error('Failed to record payment');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate both the specific record and the list\n      queryClient.invalidateQueries({ queryKey: [`/api/previous-outstanding/${id}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/previous-outstanding`] });\n      setIsPaymentDialogOpen(false);\n      resetPaymentForm();\n      toast({\n        title: \"Success\",\n        description: \"Payment recorded successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetPaymentForm = () => {\n    setPaymentAmount(\"\");\n    setPaymentDate(new Date().toISOString().split('T')[0]);\n    setPaymentMode(\"cash\");\n    setPaymentFile(null);\n  };\n\n  const handleRecordPayment = () => {\n    if (!paymentAmount || !paymentDate || !paymentMode) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate payment screenshot for non-cash payments\n    if (paymentMode !== \"cash\" && !paymentFile) {\n      toast({\n        title: \"Error\", \n        description: \"Payment screenshot is required for non-cash payments\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append('amount', parseFloat(paymentAmount).toString()); // Keep in rupees\n    formData.append('date', paymentDate);\n    formData.append('mode', paymentMode);\n    if (paymentFile) formData.append('paymentFile', paymentFile);\n\n    recordPaymentMutation.mutate(formData);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const formatAmount = (amount: number | undefined) => {\n    if (!amount && amount !== 0) return '0';\n    return amount.toLocaleString('en-IN');\n  };\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Error Loading Record</h2>\n          <p className=\"text-red-600\">Failed to load the previous outstanding record. Please try again.</p>\n          <pre className=\"text-xs mt-2\">{JSON.stringify(error, null, 2)}</pre>\n        </div>\n      </div>\n    );\n  }\n\n  if (!record) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Record Not Found</h2>\n          <p className=\"text-red-600\">The previous outstanding record you're looking for doesn't exist.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Debug: Log the record data\n  console.log('Record data:', record);\n  console.log('Record ID from params:', id);\n  console.log('Is loading:', isLoading);\n  console.log('Error:', error);\n\n  return (\n    <div className=\"space-y-6 p-4\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"outline\" onClick={() => setLocation('/previous-outstanding')}>\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Records\n        </Button>\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Previous Outstanding Details</h1>\n          <p className=\"text-muted-foreground\">\n            Outstanding record for {record.userName}\n          </p>\n        </div>\n      </div>\n\n      {/* User & Record Info */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>User Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Name</Label>\n              <p className=\"font-medium\">{record.userName}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Mobile</Label>\n              <p>{record.userMobile}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Address</Label>\n              <p>{record.userAddress}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Record Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Description</Label>\n              <p className=\"font-medium\">{record.description}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Created Date</Label>\n              <p>{formatDate(record.createdAt)}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Created By</Label>\n              <p>{record.createdBy}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Payment Summary */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            Payment Summary\n            {getStatusBadge(record.status, record.pendingAmount)}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"text-center p-4 bg-amber-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-amber-600\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Outstanding</p>\n            </div>\n            <div className=\"text-center p-4 bg-green-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-green-600\">‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n              <p className=\"text-sm text-muted-foreground\">Received Amount</p>\n            </div>\n            <div className=\"text-center p-4 bg-red-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-red-600\">‚Çπ{formatAmount(record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}</div>\n              <p className=\"text-sm text-muted-foreground\">Pending Amount</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Payment History & Record Payment */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Payment History</CardTitle>\n            {((record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount) || 0) > 0 && (\n              <Dialog open={isPaymentDialogOpen} onOpenChange={setIsPaymentDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Record Payment\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>Record Payment</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                      <Input\n                        id=\"amount\"\n                        type=\"number\"\n                        value={paymentAmount}\n                        onChange={(e) => setPaymentAmount(e.target.value)}\n                        placeholder=\"Enter amount\"\n                        max={(record.pendingAmount || record.outstandingAmount) / 100}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"date\">Date *</Label>\n                      <Input\n                        id=\"date\"\n                        type=\"date\"\n                        value={paymentDate}\n                        onChange={(e) => setPaymentDate(e.target.value)}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"mode\">Payment Mode *</Label>\n                      <Select value={paymentMode} onValueChange={setPaymentMode}>\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"cash\">Cash</SelectItem>\n                          <SelectItem value=\"upi\">UPI</SelectItem>\n                          <SelectItem value=\"cheque\">Cheque</SelectItem>\n                          <SelectItem value=\"netbanking\">Net Banking</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    {paymentMode !== \"cash\" && (\n                      <div>\n                        <Label htmlFor=\"file\">Payment Screenshot *</Label>\n                        <Input\n                          id=\"file\"\n                          type=\"file\"\n                          accept=\"image/*,.pdf\"\n                          onChange={(e) => setPaymentFile(e.target.files?.[0] || null)}\n                          required={paymentMode !== \"cash\"}\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Upload proof of payment (screenshot, receipt, etc.)\n                        </p>\n                      </div>\n                    )}\n                    <div className=\"flex gap-2\">\n                      <Button \n                        onClick={handleRecordPayment} \n                        disabled={recordPaymentMutation.isPending}\n                        className=\"flex-1\"\n                      >\n                        <CreditCard className=\"h-4 w-4 mr-2\" />\n                        {recordPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                      </Button>\n                      <Button variant=\"outline\" onClick={() => setIsPaymentDialogOpen(false)}>\n                        Cancel\n                      </Button>\n                    </div>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {!record.payments || record.payments.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No payments recorded yet.\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Mode</TableHead>\n                    <TableHead>Recorded By</TableHead>\n                    <TableHead>Proof</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {record.payments.map((payment, index) => (\n                    <TableRow key={index}>\n                      <TableCell>{formatDate(payment.date)}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\">‚Çπ{formatAmount(payment.amount)}</Badge>\n                      </TableCell>\n                      <TableCell className=\"capitalize\">{payment.mode}</TableCell>\n                      <TableCell>{payment.updatedBy || '-'}</TableCell>\n                      <TableCell>\n                        {payment.fileUrl ? (\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => window.open(payment.fileUrl, '_blank')}\n                          >\n                            <FileText className=\"h-4 w-4 mr-1\" />\n                            View\n                          </Button>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">No file</span>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":16238},"local-deployment/client/src/components/daily-earnings-calendar.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ntype DailyEarningsData = {\n  [date: string]: number;\n};\n\nconst MONTHS = [\n  \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n  \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n];\n\nconst DAYS_IN_MONTH = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n\nconst isLeapYear = (year: number) => {\n  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n};\n\nconst getDaysInMonth = (month: number, year: number) => {\n  if (month === 1 && isLeapYear(year)) return 29; // February in leap year\n  return DAYS_IN_MONTH[month];\n};\n\nconst formatAmount = (amount: number) => {\n  // Amount is already in rupees, no need to divide by 100\n  if (amount >= 100000) {\n    return `${(amount / 100000).toFixed(1)}L`;\n  } else if (amount >= 1000) {\n    return `${(amount / 1000).toFixed(1)}K`;\n  } else {\n    return amount.toString();\n  }\n};\n\nexport default function DailyEarningsCalendar() {\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  \n  // Generate year options (current year and 5 years back/forward)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = [];\n  for (let year = currentYear - 5; year <= currentYear + 5; year++) {\n    yearOptions.push(year);\n  }\n  \n  // Fetch daily earnings data\n  const { data: dailyEarnings, isLoading } = useQuery<DailyEarningsData>({\n    queryKey: ['/api/daily-earnings', selectedYear],\n    queryFn: () => fetch(`/api/daily-earnings?year=${selectedYear}`).then(res => res.json()),\n  });\n  \n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Daily Earnings Calendar</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex justify-center p-8\">Loading calendar data...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n  \n  // Calculate monthly totals\n  const monthlyTotals = Array(12).fill(0);\n  if (dailyEarnings) {\n    Object.entries(dailyEarnings).forEach(([dateStr, amount]) => {\n      const date = new Date(dateStr);\n      const month = date.getMonth();\n      monthlyTotals[month] += amount;\n    });\n  }\n  \n\n  \n  // Generate calendar grid\n  const generateCalendar = () => {\n    const calendar = [];\n    \n    for (let month = 0; month < 12; month++) {\n      const row = [];\n      const daysInMonth = getDaysInMonth(month, selectedYear);\n      \n      // Month name\n      row.push(\n        <div key={`month-${month}`} className=\"font-medium text-sm bg-primary text-primary-foreground p-2 text-center\">\n          {MONTHS[month]}\n        </div>\n      );\n      \n      // Days in month\n      for (let day = 1; day <= 31; day++) {\n        if (day <= daysInMonth) {\n          const dateKey = `${selectedYear}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n          const amount = dailyEarnings?.[dateKey] || 0;\n          \n\n          \n          row.push(\n            <div \n              key={`${month}-${day}`} \n              className={`p-1 text-xs text-center border border-neutral-200 min-h-[24px] flex items-center justify-center ${\n                amount > 0 \n                  ? 'bg-green-100 text-green-800 font-medium' \n                  : 'bg-neutral-50 text-neutral-400'\n              }`}\n              title={amount > 0 ? `‚Çπ${amount.toLocaleString()}` : 'No earnings'}\n            >\n              {amount > 0 ? formatAmount(amount) : ''}\n            </div>\n          );\n        } else {\n          // Empty cell for days that don't exist in this month\n          row.push(\n            <div key={`${month}-${day}-empty`} className=\"p-1 text-xs bg-neutral-100 border border-neutral-200 min-h-[24px]\">\n            </div>\n          );\n        }\n      }\n      \n      // Monthly total\n      row.push(\n        <div key={`total-${month}`} className=\"font-medium text-sm bg-blue-100 text-blue-800 p-1 text-center min-h-[24px] flex items-center justify-center\">\n          ‚Çπ{monthlyTotals[month].toLocaleString()}\n        </div>\n      );\n      \n      calendar.push(\n        <div key={month} className=\"grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          {row}\n        </div>\n      );\n    }\n    \n    return calendar;\n  };\n  \n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle>Daily Earnings Calendar</CardTitle>\n          <Select value={selectedYear.toString()} onValueChange={(value) => setSelectedYear(parseInt(value))}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {yearOptions.map(year => (\n                <SelectItem key={year} value={year.toString()}>\n                  {year}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Header row with day numbers */}\n        <div className=\"mb-2 grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Month</div>\n          {Array.from({ length: 31 }, (_, i) => (\n            <div key={i + 1} className=\"font-medium text-xs p-1 text-center bg-neutral-100 border border-neutral-200\">\n              {i + 1}\n            </div>\n          ))}\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Total</div>\n        </div>\n        \n        {/* Calendar grid */}\n        <div className=\"space-y-0\">\n          {generateCalendar()}\n        </div>\n        \n        {/* Legend */}\n        <div className=\"mt-4 flex items-center gap-4 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-green-100 border border-green-200\"></div>\n            <span>Earnings recorded</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-neutral-50 border border-neutral-200\"></div>\n            <span>No earnings</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6289},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/pages/previous-outstanding-payments.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Receipt, MessageCircle, Search, X, RefreshCw, Printer, Eye } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { OutstandingPaymentReceipt } from \"@/components/outstanding-payment-receipt\";\n\n// Create a simplified media query hook inline\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\ntype PreviousOutstandingPayment = {\n  id: string;\n  recordId: number;\n  recordNumber?: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: string;\n  paymentDate: string;\n  paymentAmount: number;\n  paymentMode: string;\n  receiptNo: string;\n  fileUrl?: string;\n  updatedBy: string;\n  description: string;\n  createdBy: string;\n  createdAt: string;\n};\n\nexport default function PreviousOutstandingPayments() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const isMobile = useMediaQuery(\"(max-width: 640px)\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  \n  // Receipt dialog state\n  const [selectedPayment, setSelectedPayment] = useState<PreviousOutstandingPayment | null>(null);\n  const [showReceipt, setShowReceipt] = useState(false);\n  \n  // Attachment dialog state\n  const [selectedAttachment, setSelectedAttachment] = useState<string | null>(null);\n  const [showAttachment, setShowAttachment] = useState(false);\n\n  // Check permissions\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Access Denied</h2>\n          <p className=\"text-red-600\">You don't have permission to view previous outstanding payments.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch payments data\n  const { data: payments = [], isLoading, error } = useQuery<PreviousOutstandingPayment[]>({\n    queryKey: ['/api/previous-outstanding-payments'],\n  });\n\n  // Generate receipt numbers mutation\n  const generateReceiptsMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/previous-outstanding-payments/generate-receipts', {\n        method: 'POST',\n        credentials: 'include',\n      });\n      if (!response.ok) {\n        throw new Error('Failed to generate receipt numbers');\n      }\n      return response.json();\n    },\n    onSuccess: (response) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/previous-outstanding-payments'] });\n      toast({\n        title: \"Success\",\n        description: response.message || \"Receipt numbers generated successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate receipt numbers\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Filter and sort payments based on search term and receipt number\n  const filteredPayments = payments\n    .filter(payment =>\n      payment.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      payment.userMobile?.includes(searchTerm) ||\n      payment.receiptNo?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      payment.paymentMode.toLowerCase().includes(searchTerm.toLowerCase())\n    )\n    .sort((a, b) => {\n      // Extract receipt numbers (format: SPDJMSJ-2025-00001)\n      const getReceiptNumber = (receiptNo: string) => {\n        if (!receiptNo) return 0;\n        const match = receiptNo.match(/SPDJMSJ-\\d{4}-(\\d{5})/);\n        return match ? parseInt(match[1], 10) : 0;\n      };\n      \n      const aNum = getReceiptNumber(a.receiptNo || '');\n      const bNum = getReceiptNumber(b.receiptNo || '');\n      \n      return bNum - aNum; // Descending order (highest receipt number first)\n    });\n\n  const formatAmount = (amount: number) => {\n    return amount.toLocaleString();\n  };\n\n  const formatDate = (dateString: string) => {\n    try {\n      return format(new Date(dateString), \"dd/MM/yyyy\");\n    } catch {\n      return dateString;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusColors = {\n      pending: \"bg-red-100 text-red-800 border-red-200\",\n      partial: \"bg-yellow-100 text-yellow-800 border-yellow-200\",\n      full: \"bg-green-100 text-green-800 border-green-200\"\n    };\n    \n    return (\n      <Badge className={statusColors[status as keyof typeof statusColors] || statusColors.pending}>\n        {status === 'pending' ? 'Pending' : status === 'partial' ? 'Partial' : 'Paid'}\n      </Badge>\n    );\n  };\n\n  const generateReceipt = (payment: PreviousOutstandingPayment) => {\n    const receiptContent = `\n===========================================\n        ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞\n      Previous Outstanding Payment Receipt\n===========================================\n\nReceipt Number: ${payment.receiptNo}\nDate: ${formatDate(payment.paymentDate)}\n\nPayer Details:\nName: ${payment.userName}\nMobile: ${payment.userMobile || 'N/A'}\nAddress: ${payment.userAddress || 'N/A'}\n\nPayment Details:\nDescription: ${payment.description}\nTotal Outstanding: ‚Çπ${formatAmount(payment.outstandingAmount)}\nPayment Amount: ‚Çπ${formatAmount(payment.paymentAmount)}\nPayment Mode: ${payment.paymentMode.toUpperCase()}\nRemaining Balance: ‚Çπ${formatAmount(payment.pendingAmount)}\n\nRecorded By: ${payment.updatedBy}\nGenerated On: ${format(new Date(), \"dd/MM/yyyy HH:mm\")}\n\n===========================================\n        Thank you for your payment!\n           ‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!\n===========================================\n    `.trim();\n\n    // Create and download receipt\n    const blob = new Blob([receiptContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `Receipt-${payment.receiptNo}.txt`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Receipt Generated\",\n      description: `Receipt ${payment.receiptNo} has been downloaded`,\n    });\n  };\n\n  const handleWhatsappClick = (payment: PreviousOutstandingPayment) => {\n    const phoneNumber = payment.userMobile?.replace(/[^\\d]/g, '') || '';\n    \n    if (!phoneNumber) {\n      toast({\n        title: \"Error\",\n        description: \"Mobile number not available for this user\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Find all payments for this record ID to create combined message\n    const recordPayments = filteredPayments.filter(p => p.recordId === payment.recordId);\n    \n    let message = '';\n    \n    if (recordPayments.length === 1) {\n      // Single payment - use original format\n      message = \n        `üèõÔ∏è ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§Ü ‡§π‡•à:\\n\\n` +\n        `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: 31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø:- ‚Çπ${payment.outstandingAmount.toLocaleString()}\\n` +\n        `üóìÔ∏è ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(payment.paymentDate)}\\n` +\n        `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.outstandingAmount.toLocaleString()}\\n` +\n        `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ‚Çπ${payment.paymentAmount.toLocaleString()}\\n` +\n        `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${payment.pendingAmount.toLocaleString()}\\n` +\n        `üí≥ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ: ${payment.paymentMode}\\n` +\n        `üßæ ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞: ${payment.receiptNo}\\n\\n` +\n        `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n    } else {\n      // Multiple payments - use combined format\n      const totalOutstanding = payment.outstandingAmount;\n      const totalReceived = recordPayments.reduce((sum, p) => sum + p.paymentAmount, 0);\n      const pendingAmount = totalOutstanding - totalReceived;\n      \n      // Get unique payment date (assuming all payments on same date for same record)\n      const paymentDate = formatDate(payment.paymentDate);\n      \n      // Combine amounts, modes, and receipt numbers\n      const amounts = recordPayments.map(p => `‚Çπ${p.paymentAmount.toLocaleString()}`).join(' + ');\n      const modes = recordPayments.map(p => p.paymentMode).join(' + ');\n      const receiptNumbers = recordPayments.map(p => p.receiptNo).join(' + ');\n      \n      message = \n        `üèõÔ∏è ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§Ü ‡§π‡•à:\\n\\n` +\n        `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: 31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø:- ‚Çπ${totalOutstanding.toLocaleString()}\\n` +\n        `üóìÔ∏è ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${paymentDate}\\n` +\n        `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${totalOutstanding.toLocaleString()}\\n` +\n        `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ${amounts}\\n` +\n        `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${pendingAmount.toLocaleString()}\\n` +\n        `üí≥ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ: ${modes}\\n` +\n        `üßæ ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞: ${receiptNumbers}\\n\\n` +\n        `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n    }\n    \n    // Use the same approach as working boli payments\n    const whatsappUrl = `https://api.whatsapp.com/send?phone=91${phoneNumber}&text=${encodeURIComponent(message)}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  const totalPayments = filteredPayments.reduce((sum, payment) => sum + payment.paymentAmount, 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"text-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-2 text-gray-600\">Loading previous outstanding payments...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Error</h2>\n          <p className=\"text-red-600\">Failed to load previous outstanding payments</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">All Previous Outstanding Payments</h1>\n          <p className=\"text-gray-600\">View and manage all payment records for previous outstanding amounts</p>\n        </div>\n      </div>\n\n      {/* Summary Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Payment Summary</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"text-center p-4 bg-blue-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-blue-600\">{filteredPayments.length}</div>\n              <div className=\"text-sm text-blue-600\">Total Payments</div>\n            </div>\n            <div className=\"text-center p-4 bg-green-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-green-600\">‚Çπ{formatAmount(totalPayments)}</div>\n              <div className=\"text-sm text-green-600\">Total Amount Received</div>\n            </div>\n            <div className=\"text-center p-4 bg-purple-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-purple-600\">{new Set(filteredPayments.map(p => p.userId)).size}</div>\n              <div className=\"text-sm text-purple-600\">Unique Payers</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Search and Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex gap-4 items-center\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n              <Input\n                placeholder=\"Search by name, mobile, receipt number, or payment mode...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10\"\n              />\n              {searchTerm && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setSearchTerm(\"\")}\n                  className=\"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Payments Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Payment Records ({filteredPayments.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {filteredPayments.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <p className=\"text-gray-500\">No payment records found</p>\n            </div>\n          ) : (\n            <>\n              {/* Mobile view: Card layout */}\n              {isMobile && (\n                <div className=\"space-y-4\">\n                  {filteredPayments.map((payment) => (\n                    <Card key={payment.id} className=\"border border-gray-200\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className=\"text-xs text-neutral-500 bg-neutral-100 px-2 py-0.5 rounded font-mono\">\n                                {payment.recordNumber ? `REC-${payment.recordNumber}` : `REC-${payment.recordId}`}\n                              </span>\n                              {getStatusBadge(payment.status)}\n                            </div>\n                            <h3 className=\"font-medium text-lg\">{payment.userName}</h3>\n                            <p className=\"text-sm text-neutral-500\">üì± {payment.userMobile}</p>\n                            {payment.userAddress && (\n                              <p className=\"text-xs text-neutral-600 mt-1\">üìç {payment.userAddress}</p>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-2 my-3 text-sm\">\n                          <div>\n                            <p className=\"text-neutral-500\">Total Outstanding:</p>\n                            <p className=\"font-medium\">‚Çπ{formatAmount(payment.outstandingAmount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Payment Amount:</p>\n                            <p className=\"text-green-600 font-medium\">‚Çπ{formatAmount(payment.paymentAmount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Received:</p>\n                            <p className=\"text-green-600\">‚Çπ{formatAmount(payment.receivedAmount)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Pending:</p>\n                            <p className=\"text-red-600\">‚Çπ{formatAmount(payment.pendingAmount)}</p>\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-2 my-3 text-sm\">\n                          <div>\n                            <p className=\"text-neutral-500\">Payment Date:</p>\n                            <p>{formatDate(payment.paymentDate)}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-neutral-500\">Payment Mode:</p>\n                            <p>{payment.paymentMode.toUpperCase()}</p>\n                          </div>\n                        </div>\n                        \n                        <div className=\"text-sm mb-3\">\n                          <p className=\"text-neutral-500\">Receipt Number:</p>\n                          <p className=\"font-mono text-sm\">\n                            {!payment.receiptNo || payment.receiptNo === 'No Receipt Generated' ? (\n                              <span className=\"text-red-500 italic\">No Receipt Generated</span>\n                            ) : (\n                              payment.receiptNo\n                            )}\n                          </p>\n                        </div>\n                        \n                        <div className=\"text-xs text-neutral-500 mb-3\">\n                          Updated by {payment.updatedBy}\n                        </div>\n                        \n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedPayment(payment);\n                              setShowReceipt(true);\n                            }}\n                          >\n                            <Printer className=\"h-4 w-4 mr-1\" />\n                            Receipt\n                          </Button>\n                          {payment.fileUrl && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedAttachment(payment.fileUrl!);\n                                setShowAttachment(true);\n                              }}\n                              className=\"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100\"\n                            >\n                              <Eye className=\"h-4 w-4 mr-1\" />\n                              View File\n                            </Button>\n                          )}\n                          {payment.userMobile && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleWhatsappClick(payment)}\n                              className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n                            >\n                              <MessageCircle className=\"h-4 w-4 mr-1\" />\n                              WhatsApp\n                            </Button>\n                          )}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n              \n              {/* Desktop view: Table layout */}\n              {!isMobile && (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Record No.</TableHead>\n                    <TableHead>Payer Details</TableHead>\n                    <TableHead>Outstanding Details</TableHead>\n                    <TableHead>Payment Info</TableHead>\n                    <TableHead>Receipt & Status</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredPayments.map((payment) => (\n                    <TableRow key={payment.id}>\n                      <TableCell>\n                        <div className=\"font-mono text-sm font-medium\">\n                          {payment.recordNumber ? `REC-${payment.recordNumber}` : `REC-${payment.recordId}`}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{payment.userName}</div>\n                          <div className=\"text-sm text-muted-foreground\">{payment.userMobile}</div>\n                          <div className=\"text-xs text-muted-foreground\">{payment.userAddress}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"text-sm\">Total: ‚Çπ{formatAmount(payment.outstandingAmount)}</div>\n                          <div className=\"text-sm text-green-600\">Received: ‚Çπ{formatAmount(payment.receivedAmount)}</div>\n                          <div className=\"text-sm text-red-600\">Pending: ‚Çπ{formatAmount(payment.pendingAmount)}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">‚Çπ{formatAmount(payment.paymentAmount)}</div>\n                          <div className=\"text-sm text-muted-foreground\">{formatDate(payment.paymentDate)}</div>\n                          <div className=\"text-xs text-muted-foreground\">{payment.paymentMode.toUpperCase()}</div>\n                          <div className=\"text-xs text-muted-foreground\">by {payment.updatedBy}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"space-y-1\">\n                          <div className=\"text-sm font-mono\">\n                            {!payment.receiptNo || payment.receiptNo === 'No Receipt Generated' ? (\n                              <span className=\"text-red-500 italic\">No Receipt Generated</span>\n                            ) : (\n                              payment.receiptNo\n                            )}\n                          </div>\n                          {getStatusBadge(payment.status)}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2 flex-wrap\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedPayment(payment);\n                              setShowReceipt(true);\n                            }}\n                            disabled={false}\n                          >\n                            <Printer className=\"h-4 w-4 mr-1\" />\n                            Hindi Receipt\n                          </Button>\n                          {payment.fileUrl && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedAttachment(payment.fileUrl!);\n                                setShowAttachment(true);\n                              }}\n                              className=\"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100\"\n                            >\n                              <Eye className=\"h-4 w-4 mr-1\" />\n                              View Attachment\n                            </Button>\n                          )}\n                          {payment.userMobile && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleWhatsappClick(payment)}\n                              className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n                            >\n                              <MessageCircle className=\"h-4 w-4 mr-1\" />\n                              WhatsApp\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n                  </Table>\n                </div>\n              )}\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Receipt Dialog */}\n      {showReceipt && selectedPayment && (\n        <OutstandingPaymentReceipt \n          record={{\n            id: selectedPayment.recordId,\n            userId: selectedPayment.userId,\n            userName: selectedPayment.userName,\n            userMobile: selectedPayment.userMobile,\n            userAddress: selectedPayment.userAddress,\n            outstandingAmount: selectedPayment.outstandingAmount,\n            receivedAmount: selectedPayment.receivedAmount,\n            pendingAmount: selectedPayment.pendingAmount,\n            status: selectedPayment.status as 'pending' | 'partial' | 'full',\n            payments: [{\n              date: selectedPayment.paymentDate,\n              amount: selectedPayment.paymentAmount,\n              mode: selectedPayment.paymentMode,\n              receiptNo: selectedPayment.receiptNo,\n              updatedBy: selectedPayment.updatedBy\n            }],\n            description: selectedPayment.description,\n            createdBy: selectedPayment.createdBy,\n            createdAt: selectedPayment.createdAt,\n            updatedAt: selectedPayment.createdAt\n          }}\n          payment={{\n            date: selectedPayment.paymentDate,\n            amount: selectedPayment.paymentAmount,\n            mode: selectedPayment.paymentMode,\n            receiptNo: selectedPayment.receiptNo,\n            updatedBy: selectedPayment.updatedBy\n          }}\n          onClose={() => {\n            setShowReceipt(false);\n            setSelectedPayment(null);\n          }}\n        />\n      )}\n\n      {/* Attachment Dialog */}\n      {showAttachment && selectedAttachment && (\n        <Dialog open={showAttachment} onOpenChange={setShowAttachment}>\n          <DialogContent className=\"max-w-4xl max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle>Payment Attachment</DialogTitle>\n            </DialogHeader>\n            <div className=\"mt-4 overflow-auto\">\n              {selectedAttachment.toLowerCase().endsWith('.pdf') ? (\n                <iframe\n                  src={selectedAttachment}\n                  className=\"w-full h-[70vh] border-0\"\n                  title=\"Payment Attachment\"\n                />\n              ) : (\n                <img\n                  src={selectedAttachment}\n                  alt=\"Payment Attachment\"\n                  className=\"w-full h-auto max-h-[70vh] object-contain\"\n                />\n              )}\n            </div>\n            <div className=\"flex justify-end gap-2 mt-4\">\n              <Button\n                variant=\"outline\"\n                onClick={() => window.open(selectedAttachment, '_blank')}\n              >\n                Open in New Tab\n              </Button>\n              <Button onClick={() => setShowAttachment(false)}>\n                Close\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n}","size_bytes":28186},"client/src/components/entries-list-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesListMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isEntriesActive = location === '/entries' || location === '/dravya-entries' || location === '/expense-entries' || location === '/advance-payments';\n\n  const menuItems = [\n    {\n      path: '/entries',\n      icon: 'gavel',\n      label: 'Boli Entries',\n      description: user?.role === 'viewer' ? 'View your boli entries' : 'Manage boli-related entries'\n    },\n    {\n      path: '/dravya-entries',\n      icon: 'inventory_2',\n      label: 'Dravya Entries',\n      description: user?.role === 'viewer' ? 'View your dravya entries' : 'Manage dravya-related entries'\n    },\n    ...(user?.role === 'operator' ? [{\n      path: '/expense-entries',\n      icon: 'receipt_long',\n      label: 'Expense Entries',\n      description: 'Manage company expense records'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/advance-payments',\n      icon: 'account_balance_wallet',\n      label: 'Advance Payments',\n      description: 'Manage advance payment records'\n    }] : [])\n  ];\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isEntriesActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons\">list_alt</span>\n        <span className=\"text-xs\">Entries</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                View Entries\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":3640},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([_, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10466},"client/src/components/daily-earnings-calendar.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ntype DailyEarningsData = {\n  [date: string]: number;\n};\n\nconst MONTHS = [\n  \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n  \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n];\n\nconst DAYS_IN_MONTH = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n\nconst isLeapYear = (year: number) => {\n  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n};\n\nconst getDaysInMonth = (month: number, year: number) => {\n  if (month === 1 && isLeapYear(year)) return 29; // February in leap year\n  return DAYS_IN_MONTH[month];\n};\n\nconst formatAmount = (amount: number) => {\n  // Amount is already in rupees, no need to divide by 100\n  if (amount >= 100000) {\n    return `${(amount / 100000).toFixed(1)}L`;\n  } else if (amount >= 1000) {\n    return `${(amount / 1000).toFixed(1)}K`;\n  } else {\n    return amount.toString();\n  }\n};\n\nexport default function DailyEarningsCalendar() {\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  \n  // Generate year options (current year and 5 years back/forward)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = [];\n  for (let year = currentYear - 5; year <= currentYear + 5; year++) {\n    yearOptions.push(year);\n  }\n  \n  // Fetch daily earnings data\n  const { data: dailyEarnings, isLoading } = useQuery<DailyEarningsData>({\n    queryKey: ['/api/daily-earnings', selectedYear],\n    queryFn: () => fetch(`/api/daily-earnings?year=${selectedYear}`).then(res => res.json()),\n  });\n  \n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Daily Earnings Calendar</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex justify-center p-8\">Loading calendar data...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n  \n  // Calculate monthly totals\n  const monthlyTotals = Array(12).fill(0);\n  if (dailyEarnings) {\n    Object.entries(dailyEarnings).forEach(([dateStr, amount]) => {\n      const date = new Date(dateStr);\n      const month = date.getMonth();\n      monthlyTotals[month] += amount;\n    });\n  }\n  \n\n  \n  // Generate calendar grid\n  const generateCalendar = () => {\n    const calendar = [];\n    \n    for (let month = 0; month < 12; month++) {\n      const row = [];\n      const daysInMonth = getDaysInMonth(month, selectedYear);\n      \n      // Month name\n      row.push(\n        <div key={`month-${month}`} className=\"font-medium text-sm bg-primary text-primary-foreground p-2 text-center\">\n          {MONTHS[month]}\n        </div>\n      );\n      \n      // Days in month\n      for (let day = 1; day <= 31; day++) {\n        if (day <= daysInMonth) {\n          const dateKey = `${selectedYear}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n          const amount = dailyEarnings?.[dateKey] || 0;\n          \n\n          \n          row.push(\n            <div \n              key={`${month}-${day}`} \n              className={`p-1 text-xs text-center border border-neutral-200 min-h-[24px] flex items-center justify-center ${\n                amount > 0 \n                  ? 'bg-green-100 text-green-800 font-medium' \n                  : 'bg-neutral-50 text-neutral-400'\n              }`}\n              title={amount > 0 ? `‚Çπ${amount.toLocaleString()}` : 'No earnings'}\n            >\n              {amount > 0 ? formatAmount(amount) : ''}\n            </div>\n          );\n        } else {\n          // Empty cell for days that don't exist in this month\n          row.push(\n            <div key={`${month}-${day}-empty`} className=\"p-1 text-xs bg-neutral-100 border border-neutral-200 min-h-[24px]\">\n            </div>\n          );\n        }\n      }\n      \n      // Monthly total\n      row.push(\n        <div key={`total-${month}`} className=\"font-medium text-sm bg-blue-100 text-blue-800 p-1 text-center min-h-[24px] flex items-center justify-center\">\n          ‚Çπ{monthlyTotals[month].toLocaleString()}\n        </div>\n      );\n      \n      calendar.push(\n        <div key={month} className=\"grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          {row}\n        </div>\n      );\n    }\n    \n    return calendar;\n  };\n  \n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle>Daily Earnings Calendar</CardTitle>\n          <Select value={selectedYear.toString()} onValueChange={(value) => setSelectedYear(parseInt(value))}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {yearOptions.map(year => (\n                <SelectItem key={year} value={year.toString()}>\n                  {year}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Header row with day numbers */}\n        <div className=\"mb-2 grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Month</div>\n          {Array.from({ length: 31 }, (_, i) => (\n            <div key={i + 1} className=\"font-medium text-xs p-1 text-center bg-neutral-100 border border-neutral-200\">\n              {i + 1}\n            </div>\n          ))}\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Total</div>\n        </div>\n        \n        {/* Calendar grid */}\n        <div className=\"space-y-0\">\n          {generateCalendar()}\n        </div>\n        \n        {/* Legend */}\n        <div className=\"mt-4 flex items-center gap-4 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-green-100 border border-green-200\"></div>\n            <span>Earnings recorded</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-neutral-50 border border-neutral-200\"></div>\n            <span>No earnings</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6289},"local-deployment/client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"localhost-setup-guide.md":{"content":"# Localhost Setup Guide - Shivnagar Jain Temple Account Ledger\n\nThis guide provides step-by-step instructions to run the Account Ledger Management System on your local machine.\n\n## Prerequisites\n\nBefore starting, ensure you have the following installed:\n\n1. **Node.js** (version 18 or higher)\n   ```bash\n   # Check if Node.js is installed\n   node --version\n   npm --version\n   ```\n\n2. **PostgreSQL** (version 12 or higher)\n   ```bash\n   # Check if PostgreSQL is installed\n   psql --version\n   ```\n\n3. **Git** (for cloning the repository)\n   ```bash\n   git --version\n   ```\n\n## Step 1: Clone and Setup Project\n\n```bash\n# 1. Clone the repository (if not already done)\ngit clone <your-repository-url>\ncd <project-directory>\n\n# 2. Install dependencies\nnpm install\n```\n\n## Step 2: Database Setup\n\n### Option A: Local PostgreSQL Database\n\n```bash\n# 1. Start PostgreSQL service (varies by OS)\n# On macOS with Homebrew:\nbrew services start postgresql\n\n# On Ubuntu/Debian:\nsudo systemctl start postgresql\n\n# On Windows (if installed as service):\nnet start postgresql-x64-<version>\n\n# 2. Create database and user\nsudo -u postgres psql\n\n# In PostgreSQL shell:\nCREATE DATABASE temple_ledger;\nCREATE USER temple_admin WITH PASSWORD 'your_secure_password';\nGRANT ALL PRIVILEGES ON DATABASE temple_ledger TO temple_admin;\n\\q\n```\n\n### Option B: Use Neon Database (Recommended)\n\n1. Go to [Neon Database](https://neon.tech)\n2. Create a free account\n3. Create a new database project\n4. Copy the connection string\n\n## Step 3: Environment Configuration\n\n```bash\n# 1. Create environment file\ncp .env.example .env\n\n# 2. Edit .env file with your database credentials\nnano .env\n```\n\nAdd the following to your `.env` file:\n\n```env\n# Database Configuration\nDATABASE_URL=postgresql://temple_admin:your_secure_password@localhost:5432/temple_ledger\n\n# Or for Neon Database:\n# DATABASE_URL=postgresql://username:password@host.neon.tech/dbname?sslmode=require\n\n# Session Configuration\nSESSION_SECRET=your_very_secure_random_string_here\n\n# Server Configuration\nPORT=5000\nNODE_ENV=development\n```\n\n## Step 4: Database Schema Setup\n\n### Option A: Import from Existing Database (Recommended)\n\n```bash\n# 1. Export schema and data from your existing database\n# Replace with your production/existing database URL\npg_dump \"postgresql://username:password@host:port/dbname\" --schema-only > schema.sql\npg_dump \"postgresql://username:password@host:port/dbname\" --data-only > data.sql\n\n# 2. Import schema to local database\npsql -d temple_ledger -U temple_admin -f schema.sql\n\n# 3. Import data to local database\npsql -d temple_ledger -U temple_admin -f data.sql\n\n# 4. Verify import was successful\nnpm run db:studio\n```\n\n### Option B: Create Fresh Schema (Only if no existing data)\n\n```bash\n# 1. Push database schema (creates all tables)\nnpm run db:push\n\n# 2. Verify tables were created\nnpm run db:studio\n# This opens Drizzle Studio in your browser to view the database\n```\n\n## Step 5: Database Migration Methods\n\n### Method 1: Full Database Clone (Complete Migration)\n\n```bash\n# 1. Create complete dump from existing database\npg_dump \"postgresql://existing_user:password@existing_host:port/existing_db\" > complete_backup.sql\n\n# 2. Restore to local database\npsql -d temple_ledger -U temple_admin -f complete_backup.sql\n\n# 3. Verify migration\npsql -d temple_ledger -U temple_admin -c \"SELECT COUNT(*) FROM users;\"\npsql -d temple_ledger -U temple_admin -c \"SELECT COUNT(*) FROM entries;\"\n```\n\n### Method 2: Schema + Selective Data Migration\n\n```bash\n# 1. Export only schema structure\npg_dump \"postgresql://existing_user:password@existing_host:port/existing_db\" --schema-only > schema_only.sql\n\n# 2. Export specific tables data\npg_dump \"postgresql://existing_user:password@existing_host:port/existing_db\" --data-only --table=users > users_data.sql\npg_dump \"postgresql://existing_user:password@existing_host:port/existing_db\" --data-only --table=entries > entries_data.sql\n\n# 3. Import schema first\npsql -d temple_ledger -U temple_admin -f schema_only.sql\n\n# 4. Import data selectively\npsql -d temple_ledger -U temple_admin -f users_data.sql\npsql -d temple_ledger -U temple_admin -f entries_data.sql\n```\n\n### Method 3: Using Drizzle Migration (If no existing data to preserve)\n\n```bash\n# 1. Generate migration from current schema\nnpm run db:generate\n\n# 2. Apply migration to local database\nnpm run db:migrate\n\n# 3. Create initial admin user (only if no existing users)\npsql -d temple_ledger -U temple_admin -c \"\nINSERT INTO users (username, password, name, email, mobile, address, role, status) \nVALUES ('admin', 'admin123', 'Administrator', 'admin@temple.org', '9999999999', 'Temple Address', 'admin', 'active')\nON CONFLICT (username) DO NOTHING;\n\"\n```\n\n## Step 6: Start the Application\n\n```bash\n# Start the development server\nnpm run dev\n```\n\nThis command will:\n- Start the Express.js backend server on port 5000\n- Start the Vite frontend development server\n- Enable hot reloading for both frontend and backend\n\n## Step 7: Access the Application\n\n1. **Open your browser** and navigate to:\n   ```\n   http://localhost:5000\n   ```\n\n2. **Login with admin credentials:**\n   - Username: `admin`\n   - Password: `admin123`\n\n## Step 8: Verify Setup\n\nOnce logged in, verify the following features work:\n\n1. **Dashboard** - View summary statistics\n2. **User Management** - Create new users\n3. **Entry Management** - Create auction entries\n4. **Payment Recording** - Record payments against entries\n5. **Dravya Entries** - Create spiritual donations\n6. **Expense Entries** - Record expenses (operator role)\n\n## Database Migration Verification\n\nAfter importing your existing database, verify the migration:\n\n```bash\n# 1. Check all tables exist\npsql -d temple_ledger -U temple_admin -c \"\\dt\"\n\n# 2. Verify row counts match\npsql -d temple_ledger -U temple_admin -c \"\nSELECT \n  'users' as table_name, COUNT(*) as row_count FROM users\nUNION ALL\nSELECT \n  'entries' as table_name, COUNT(*) as row_count FROM entries\nUNION ALL\nSELECT \n  'dravya_entries' as table_name, COUNT(*) as row_count FROM dravya_entries\nUNION ALL\nSELECT \n  'expense_entries' as table_name, COUNT(*) as row_count FROM expense_entries\nUNION ALL\nSELECT \n  'transaction_logs' as table_name, COUNT(*) as row_count FROM transaction_logs;\n\"\n\n# 3. Test a sample query\npsql -d temple_ledger -U temple_admin -c \"SELECT username, name, role FROM users LIMIT 5;\"\n```\n\n## Remote Database Connection (Alternative)\n\nInstead of local database, you can connect directly to your existing database:\n\n```bash\n# In your .env file, use your existing database URL:\nDATABASE_URL=postgresql://your_existing_user:password@your_host:port/your_database\n\n# Then start the application normally:\nnpm run dev\n```\n\n**Note:** This connects directly to your production/existing database, so be careful with modifications.\n\n## Common Troubleshooting\n\n### Database Connection Issues\n\n```bash\n# Check if PostgreSQL is running\nps aux | grep postgres\n\n# Test database connection\npsql -d temple_ledger -U temple_admin -c \"SELECT 1;\"\n```\n\n### Port Already in Use\n\n```bash\n# Find process using port 5000\nlsof -i :5000\n\n# Kill the process (replace PID with actual process ID)\nkill -9 <PID>\n```\n\n### Node.js Version Issues\n\n```bash\n# Install Node Version Manager (nvm)\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\n\n# Install and use Node.js 18\nnvm install 18\nnvm use 18\n```\n\n### Dependencies Issues\n\n```bash\n# Clear npm cache and reinstall\nrm -rf node_modules package-lock.json\nnpm cache clean --force\nnpm install\n```\n\n## Development Scripts\n\n```bash\n# Start development server with hot reload\nnpm run dev\n\n# Build for production\nnpm run build\n\n# Start production server\nnpm start\n\n# Database operations\nnpm run db:push      # Apply schema changes\nnpm run db:studio    # Open database browser\nnpm run db:generate  # Generate migrations\n\n# Type checking\nnpm run type-check\n```\n\n## File Upload Configuration\n\nEnsure the uploads directory exists and has proper permissions:\n\n```bash\n# Create uploads directory\nmkdir -p uploads\n\n# Set permissions (Unix/Linux/macOS)\nchmod 755 uploads\n```\n\n## Production Deployment Notes\n\nFor production deployment:\n\n1. **Environment Variables:**\n   - Use strong SESSION_SECRET\n   - Use production database URL\n   - Set NODE_ENV=production\n\n2. **Security:**\n   - Enable HTTPS\n   - Configure proper CORS settings\n   - Use environment variables for sensitive data\n\n3. **Database:**\n   - Use connection pooling\n   - Regular backups\n   - Monitor performance\n\n## Support\n\nFor issues or questions:\n1. Check the console logs for error messages\n2. Verify all environment variables are set correctly\n3. Ensure database is accessible\n4. Check file permissions for uploads directory\n\n---\n\n**System Requirements:**\n- Node.js 18+\n- PostgreSQL 12+\n- 2GB RAM minimum\n- 1GB disk space\n\n**Browser Compatibility:**\n- Chrome 90+\n- Firefox 88+\n- Safari 14+\n- Edge 90+\n\n*Last Updated: July 27, 2025*","size_bytes":8901},"local-deployment/client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        if (setOpenProp) {\n          return setOpenProp?.(\n            typeof value === \"function\" ? value(open) : value\n          )\n        }\n\n        _setOpen(value)\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${open}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full text-sidebar-foreground has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23337},"local-deployment/client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Format a date string to a more readable format\n * @param dateString String date in YYYY-MM-DD format\n * @returns Formatted date string\n */\nexport function formatDate(dateString: string) {\n  try {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  } catch (e) {\n    return dateString;\n  }\n}\n","size_bytes":574},"client/src/temp-calendar-fix.css":{"content":"/* Fix for consecutive months in date picker */\n.react-datepicker__month-container:nth-child(1) .react-datepicker__current-month::after {\n  content: attr(data-month);\n}\n\n.react-datepicker__month-container:nth-child(2) .react-datepicker__current-month::after {\n  content: attr(data-next-month);\n}\n\n/* Ensure proper display of two consecutive months */\n.react-datepicker__month-container:nth-child(2) {\n  margin-left: 0;\n}\n\n/* Force display of consecutive months */\n.react-datepicker {\n  display: flex !important;\n  flex-wrap: nowrap !important;\n}","size_bytes":545},"local-deployment/client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"local-deployment/server/bulk-import-users.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\nimport bcrypt from 'bcrypt';\n\ninterface ExcelUser {\n  name: string;\n  username: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\nasync function bulkImportUsers() {\n  try {\n    console.log('Reading differential Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'Address_Mobile_Differential_Users.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} users to import`);\n\n    // Get current user count before import\n    const currentUsers = await db.select().from(users);\n    const currentCount = currentUsers.length;\n    console.log(`Current users in database: ${currentCount}`);\n\n    // Get the highest serial number to continue from\n    const maxSerialNumber = Math.max(...currentUsers.map(u => u.serialNumber), 0);\n    console.log(`Highest serial number: ${maxSerialNumber}`);\n\n    // Create sets of existing usernames and emails for quick lookup\n    const existingUsernames = new Set(currentUsers.map(u => u.username.toLowerCase()));\n    const existingEmails = new Set(currentUsers.map(u => u.email.toLowerCase()));\n    console.log(`Existing usernames: ${existingUsernames.size}, emails: ${existingEmails.size}`);\n\n    let importedCount = 0;\n    let skippedCount = 0;\n    let nextSerialNumber = maxSerialNumber + 1;\n\n    for (const [index, excelRow] of excelData.entries()) {\n      try {\n        // Normalize Excel row data\n        const excelUser: ExcelUser = {\n          name: String(excelRow.name || '').trim(),\n          username: String(excelRow.username || '').trim(),\n          email: String(excelRow.email || '').trim().toLowerCase(),\n          mobile: String(excelRow.mobile || '').trim(),\n          address: String(excelRow.address || '').trim(),\n          role: String(excelRow.role || 'viewer').trim().toLowerCase(),\n          status: String(excelRow.status || 'active').trim().toLowerCase()\n        };\n\n        // Skip empty rows\n        if (!excelUser.name || !excelUser.username || !excelUser.email) {\n          console.log(`Skipping row ${index + 1}: Missing required fields`);\n          skippedCount++;\n          continue;\n        }\n\n        // Handle duplicate usernames by adding suffix\n        let finalUsername = excelUser.username;\n        let usernameCounter = 1;\n        while (existingUsernames.has(finalUsername.toLowerCase())) {\n          finalUsername = `${excelUser.username}${usernameCounter}`;\n          usernameCounter++;\n        }\n        \n        if (finalUsername !== excelUser.username) {\n          console.log(`Modified username from '${excelUser.username}' to '${finalUsername}'`);\n        }\n\n        // Handle duplicate emails by adding suffix\n        let finalEmail = excelUser.email;\n        let emailCounter = 1;\n        while (existingEmails.has(finalEmail.toLowerCase())) {\n          const emailParts = excelUser.email.split('@');\n          if (emailParts.length === 2) {\n            finalEmail = `${emailParts[0]}${emailCounter}@${emailParts[1]}`;\n          } else {\n            finalEmail = `${excelUser.email}${emailCounter}`;\n          }\n          emailCounter++;\n        }\n        \n        if (finalEmail !== excelUser.email) {\n          console.log(`Modified email from '${excelUser.email}' to '${finalEmail}'`);\n        }\n\n        // Validate role\n        if (!['admin', 'operator', 'viewer'].includes(excelUser.role)) {\n          excelUser.role = 'viewer';\n        }\n\n        // Validate status\n        if (!['active', 'inactive'].includes(excelUser.status)) {\n          excelUser.status = 'active';\n        }\n\n        // Create user with auto-generated password (can be changed later)\n        const defaultPassword = 'password123'; // Users should change this\n\n        // Insert user with serial number using final (unique) values\n        await db.insert(users).values({\n          serialNumber: nextSerialNumber,\n          username: finalUsername,\n          password: defaultPassword,\n          name: excelUser.name,\n          email: finalEmail,\n          mobile: excelUser.mobile,\n          address: excelUser.address,\n          role: excelUser.role as 'admin' | 'operator' | 'viewer',\n          status: excelUser.status\n        });\n\n        // Add to existing sets to prevent duplicates in the same batch\n        existingUsernames.add(finalUsername.toLowerCase());\n        existingEmails.add(finalEmail.toLowerCase());\n\n        console.log(`Imported user ${nextSerialNumber}: ${excelUser.name} (${finalUsername})`);\n        importedCount++;\n        nextSerialNumber++;\n\n      } catch (error) {\n        console.error(`Error importing user at row ${index + 1}:`, error);\n        skippedCount++;\n      }\n    }\n\n    // Get final user count\n    const finalUsers = await db.select().from(users);\n    const finalCount = finalUsers.length;\n\n    console.log('\\n=== BULK IMPORT COMPLETE ===');\n    console.log(`Users before import: ${currentCount}`);\n    console.log(`Users imported: ${importedCount}`);\n    console.log(`Users skipped: ${skippedCount}`);\n    console.log(`Users after import: ${finalCount}`);\n    console.log(`Total increase: ${finalCount - currentCount}`);\n\n    return {\n      beforeCount: currentCount,\n      importedCount,\n      skippedCount,\n      afterCount: finalCount,\n      increase: finalCount - currentCount\n    };\n\n  } catch (error) {\n    console.error('Error during bulk import:', error);\n    throw error;\n  }\n}\n\n// Run the import\nbulkImportUsers()\n  .then(result => {\n    console.log('\\n=== FINAL SUMMARY ===');\n    console.log(`Successfully imported ${result.importedCount} users`);\n    console.log(`Database now contains ${result.afterCount} total users`);\n    console.log(`Net increase: ${result.increase} users`);\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Bulk import failed:', error);\n    process.exit(1);\n  });","size_bytes":6139},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/pages/previous-outstanding-details.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation, useParams } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { ArrowLeft, Plus, FileText, CreditCard, Receipt } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { OutstandingPaymentReceipt } from \"@/components/outstanding-payment-receipt\";\n\ninterface PreviousOutstandingRecord {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  attachmentUrl?: string;\n  attachmentName?: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\nexport default function PreviousOutstandingDetails() {\n  const { id } = useParams();\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Payment form state\n  const [isPaymentDialogOpen, setIsPaymentDialogOpen] = useState(false);\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n  const [paymentDate, setPaymentDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentMode, setPaymentMode] = useState(\"cash\");\n  const [paymentFile, setPaymentFile] = useState<File | null>(null);\n  \n  // Receipt dialog state\n  const [selectedPayment, setSelectedPayment] = useState<PaymentRecord | null>(null);\n  const [showReceipt, setShowReceipt] = useState(false);\n\n  // Check permissions\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Access Denied</h2>\n          <p className=\"text-red-600\">You don't have permission to view previous outstanding details.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch record details\n  const { data: record, isLoading, error } = useQuery<PreviousOutstandingRecord>({\n    queryKey: [`/api/previous-outstanding/${id}`],\n    enabled: !!id,\n  });\n\n  // Record payment mutation\n  const recordPaymentMutation = useMutation({\n    mutationFn: async (paymentData: FormData) => {\n      const response = await fetch(`/api/previous-outstanding/${id}/payment`, {\n        method: 'POST',\n        body: paymentData,\n      });\n      if (!response.ok) {\n        throw new Error('Failed to record payment');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate both the specific record and the list\n      queryClient.invalidateQueries({ queryKey: [`/api/previous-outstanding/${id}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/previous-outstanding`] });\n      setIsPaymentDialogOpen(false);\n      resetPaymentForm();\n      toast({\n        title: \"Success\",\n        description: \"Payment recorded successfully\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to record payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetPaymentForm = () => {\n    setPaymentAmount(\"\");\n    setPaymentDate(new Date().toISOString().split('T')[0]);\n    setPaymentMode(\"cash\");\n    setPaymentFile(null);\n  };\n\n  const handleRecordPayment = () => {\n    if (!paymentAmount || !paymentDate || !paymentMode) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate payment screenshot for non-cash payments\n    if (paymentMode !== \"cash\" && !paymentFile) {\n      toast({\n        title: \"Error\", \n        description: \"Payment screenshot is required for non-cash payments\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append('amount', parseFloat(paymentAmount).toString()); // Keep in rupees\n    formData.append('date', paymentDate);\n    formData.append('mode', paymentMode);\n    if (paymentFile) formData.append('paymentFile', paymentFile);\n\n    recordPaymentMutation.mutate(formData);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const formatAmount = (amount: number | undefined) => {\n    if (!amount && amount !== 0) return '0';\n    return amount.toLocaleString('en-IN');\n  };\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center items-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Error Loading Record</h2>\n          <p className=\"text-red-600\">Failed to load the previous outstanding record. Please try again.</p>\n          <pre className=\"text-xs mt-2\">{JSON.stringify(error, null, 2)}</pre>\n        </div>\n      </div>\n    );\n  }\n\n  if (!record) {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Record Not Found</h2>\n          <p className=\"text-red-600\">The previous outstanding record you're looking for doesn't exist.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Debug: Log the record data\n  console.log('Record data:', record);\n  console.log('Record ID from params:', id);\n  console.log('Is loading:', isLoading);\n  console.log('Error:', error);\n\n  return (\n    <div className=\"space-y-6 p-4\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4\">\n        <Button variant=\"outline\" onClick={() => setLocation('/previous-outstanding')}>\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Records\n        </Button>\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Previous Outstanding Details</h1>\n          <p className=\"text-muted-foreground\">\n            Outstanding record for {record.userName}\n          </p>\n        </div>\n      </div>\n\n      {/* User & Record Info */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>User Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Name</Label>\n              <p className=\"font-medium\">{record.userName}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Mobile</Label>\n              <p>{record.userMobile}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Address</Label>\n              <p>{record.userAddress}</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Record Information</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Description</Label>\n              <p className=\"font-medium\">{record.description}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Created Date</Label>\n              <p>{formatDate(record.createdAt)}</p>\n            </div>\n            <div>\n              <Label className=\"text-sm font-medium text-muted-foreground\">Created By</Label>\n              <p>{record.createdBy}</p>\n            </div>\n            {record.attachmentUrl && (\n              <div>\n                <Label className=\"text-sm font-medium text-muted-foreground\">Attachment</Label>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      // Check if file exists by making a HEAD request first\n                      fetch(record.attachmentUrl!, { method: 'HEAD' })\n                        .then(response => {\n                          if (response.ok) {\n                            window.open(record.attachmentUrl, '_blank');\n                          } else {\n                            toast({\n                              title: \"File Not Found\",\n                              description: \"The attachment file could not be found. It may have been moved or deleted.\",\n                              variant: \"destructive\"\n                            });\n                          }\n                        })\n                        .catch(() => {\n                          toast({\n                            title: \"Error\",\n                            description: \"Could not access the attachment file.\",\n                            variant: \"destructive\"\n                          });\n                        });\n                    }}\n                  >\n                    <FileText className=\"h-4 w-4 mr-1\" />\n                    View Attachment\n                  </Button>\n                  {record.attachmentName && (\n                    <span className=\"text-sm text-muted-foreground\">{record.attachmentName}</span>\n                  )}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Payment Summary */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            Payment Summary\n            {getStatusBadge(record.status, record.pendingAmount)}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"text-center p-4 bg-amber-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-amber-600\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Outstanding</p>\n            </div>\n            <div className=\"text-center p-4 bg-green-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-green-600\">‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n              <p className=\"text-sm text-muted-foreground\">Received Amount</p>\n            </div>\n            <div className=\"text-center p-4 bg-red-50 rounded-lg\">\n              <div className=\"text-2xl font-bold text-red-600\">‚Çπ{formatAmount(record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount)}</div>\n              <p className=\"text-sm text-muted-foreground\">Pending Amount</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Payment History & Record Payment */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle>Payment History</CardTitle>\n            {((record.pendingAmount !== undefined ? record.pendingAmount : record.outstandingAmount) || 0) > 0 && (\n              <Dialog open={isPaymentDialogOpen} onOpenChange={setIsPaymentDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Record Payment\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-md\">\n                  <DialogHeader>\n                    <DialogTitle>Record Payment</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                      <Input\n                        id=\"amount\"\n                        type=\"number\"\n                        value={paymentAmount}\n                        onChange={(e) => setPaymentAmount(e.target.value)}\n                        placeholder=\"Enter amount\"\n                        max={(record.pendingAmount || record.outstandingAmount) / 100}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"date\">Date *</Label>\n                      <Input\n                        id=\"date\"\n                        type=\"date\"\n                        value={paymentDate}\n                        onChange={(e) => setPaymentDate(e.target.value)}\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"mode\">Payment Mode *</Label>\n                      <Select value={paymentMode} onValueChange={setPaymentMode}>\n                        <SelectTrigger>\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"cash\">Cash</SelectItem>\n                          <SelectItem value=\"upi\">UPI</SelectItem>\n                          <SelectItem value=\"cheque\">Cheque</SelectItem>\n                          <SelectItem value=\"netbanking\">Net Banking</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    {paymentMode !== \"cash\" && (\n                      <div>\n                        <Label htmlFor=\"file\">Payment Screenshot *</Label>\n                        <Input\n                          id=\"file\"\n                          type=\"file\"\n                          accept=\"image/*,.pdf\"\n                          onChange={(e) => setPaymentFile(e.target.files?.[0] || null)}\n                          required={paymentMode !== \"cash\"}\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Upload proof of payment (screenshot, receipt, etc.)\n                        </p>\n                      </div>\n                    )}\n                    <div className=\"flex gap-2\">\n                      <Button \n                        onClick={handleRecordPayment} \n                        disabled={recordPaymentMutation.isPending}\n                        className=\"flex-1\"\n                      >\n                        <CreditCard className=\"h-4 w-4 mr-2\" />\n                        {recordPaymentMutation.isPending ? \"Recording...\" : \"Record Payment\"}\n                      </Button>\n                      <Button variant=\"outline\" onClick={() => setIsPaymentDialogOpen(false)}>\n                        Cancel\n                      </Button>\n                    </div>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {!record.payments || record.payments.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              No payments recorded yet.\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Date</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Mode</TableHead>\n                    <TableHead>Recorded By</TableHead>\n                    <TableHead>Receipt No</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {record.payments.map((payment, index) => (\n                    <TableRow key={index}>\n                      <TableCell>{formatDate(payment.date)}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\">‚Çπ{formatAmount(payment.amount)}</Badge>\n                      </TableCell>\n                      <TableCell className=\"capitalize\">{payment.mode}</TableCell>\n                      <TableCell>{payment.updatedBy || '-'}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\">{payment.receiptNo || 'No Receipt'}</Badge>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          {payment.receiptNo && (\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              onClick={() => {\n                                setSelectedPayment(payment);\n                                setShowReceipt(true);\n                              }}\n                            >\n                              <Receipt className=\"h-4 w-4 mr-1\" />\n                              Receipt\n                            </Button>\n                          )}\n                          {payment.fileUrl && (\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              onClick={() => window.open(payment.fileUrl, '_blank')}\n                            >\n                              <FileText className=\"h-4 w-4 mr-1\" />\n                              Proof\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Receipt Dialog */}\n      {showReceipt && selectedPayment && record && (\n        <OutstandingPaymentReceipt \n          record={record}\n          payment={selectedPayment}\n          onClose={() => {\n            setShowReceipt(false);\n            setSelectedPayment(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":19393},"client/src/pages/expense-entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { FileText, ExternalLink, Eye, Image, Pencil, Trash2 } from \"lucide-react\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { exportExpenseEntries } from \"@/lib/excel-export\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nexport default function ExpenseEntries() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [paymentModeFilter, setPaymentModeFilter] = useState(\"all-modes\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n  \n  // Delete confirmation state\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [entryToDelete, setEntryToDelete] = useState<number | null>(null);\n\n  const { data: expenseEntries, isLoading, error } = useQuery<any[]>({\n    queryKey: ['/api/expense-entries'],\n  });\n  \n  // Delete mutation\n  const deleteExpenseMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/expense-entries/${id}`, {\n        method: 'DELETE',\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to delete expense entry');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Expense entry deleted successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/expense-entries'] });\n      setDeleteDialogOpen(false);\n      setEntryToDelete(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete expense entry\",\n        variant: \"destructive\",\n      });\n      setDeleteDialogOpen(false);\n      setEntryToDelete(null);\n    },\n  });\n  \n  const handleDeleteClick = (id: number) => {\n    setEntryToDelete(id);\n    setDeleteDialogOpen(true);\n  };\n  \n  const handleDeleteConfirm = () => {\n    if (entryToDelete !== null) {\n      deleteExpenseMutation.mutate(entryToDelete);\n    }\n  };\n  \n  const handleEditClick = (id: number) => {\n    setLocation(`/expense-entry-form/${id}`);\n  };\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-500\">\n          <p>Error loading expense entries: {error.message}</p>\n          <Button onClick={() => window.location.reload()} className=\"mt-4\">\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Get unique payment modes from expense entries\n  const uniquePaymentModes = Array.from(new Set((expenseEntries || []).map(entry => entry.payment_mode).filter(Boolean)));\n\n  // Apply filters\n  const filteredEntries = useMemo(() => {\n    return (expenseEntries || []).filter(entry => {\n      const matchesSearch = !searchTerm || \n        entry.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (entry.reason && entry.reason.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        entry.approved_by.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (entry.firm_name && entry.firm_name.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        (entry.bill_no && entry.bill_no.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        (entry.paid_by && entry.paid_by.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      const matchesPaymentMode = !paymentModeFilter || paymentModeFilter === \"all-modes\" || \n        entry.payment_mode?.toLowerCase() === paymentModeFilter.toLowerCase();\n      \n      const entryDate = new Date(entry.expense_date);\n      const matchesDateRange = (!startDate || entryDate >= startDate) && \n                              (!endDate || entryDate <= endDate);\n      \n      return matchesSearch && matchesPaymentMode && matchesDateRange;\n    });\n  }, [expenseEntries, searchTerm, paymentModeFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setPaymentModeFilter(\"all-modes\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatAmount = (amountInRupees: number) => {\n    return amountInRupees.toFixed(2);\n  };\n\n  const getPaymentModeColor = (mode: string) => {\n    switch (mode.toLowerCase()) {\n      case 'cash': return 'bg-green-100 text-green-800';\n      case 'upi': return 'bg-blue-100 text-blue-800';\n      case 'cheque': return 'bg-yellow-100 text-yellow-800';\n      case 'netbanking': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  // Parse attachment URLs\n  const parseAttachments = (attachmentUrl: string | null) => {\n    if (!attachmentUrl) return { receipt: null, paymentScreenshot: null };\n    \n    const urls = attachmentUrl.split(';').filter(Boolean);\n    const receipt = urls.find(url => url.includes('receiptFile')) || null;\n    const paymentScreenshot = urls.find(url => url.includes('paymentScreenshot')) || null;\n    \n    return { receipt, paymentScreenshot };\n  };\n\n  // File preview component\n  const FilePreview = ({ url, title }: { url: string; title: string }) => {\n    const isPDF = url.toLowerCase().endsWith('.pdf');\n    \n    return (\n      <div className=\"space-y-2\">\n        <h4 className=\"font-medium\">{title}</h4>\n        {isPDF ? (\n          <div className=\"border rounded-lg p-4 text-center\">\n            <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n            <p className=\"text-sm text-muted-foreground mb-2\">PDF Document</p>\n            <a \n              href={url} \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n              className=\"text-blue-600 hover:underline flex items-center justify-center gap-1\"\n            >\n              View PDF <ExternalLink className=\"h-3 w-3\" />\n            </a>\n          </div>\n        ) : (\n          <div className=\"border rounded-lg overflow-hidden\">\n            <img \n              src={url} \n              alt={title}\n              className=\"w-full h-auto max-h-96 object-contain\"\n              onError={(e) => {\n                const target = e.currentTarget as HTMLImageElement;\n                const nextElement = target.nextElementSibling as HTMLElement;\n                target.style.display = 'none';\n                if (nextElement) nextElement.style.display = 'block';\n              }}\n            />\n            <div className=\"hidden p-4 text-center\">\n              <Image className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n              <p className=\"text-sm text-muted-foreground\">Could not load image</p>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can view expense entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-10\" />\n            ))}\n          </div>\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n        <h1 className=\"text-2xl font-bold\">Expense Entries</h1>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => exportExpenseEntries(filteredEntries)}\n            variant=\"outline\"\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n          >\n            üìä Export\n          </Button>\n          <Button onClick={() => setLocation('/expense-entry-form')}>\n            Add Expense Entry\n          </Button>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Search</label>\n              <Input\n                placeholder=\"Search by description, reason, or approver\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Payment Mode</label>\n              <Select value={paymentModeFilter} onValueChange={setPaymentModeFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All payment modes\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-modes\">All payment modes</SelectItem>\n                  {uniquePaymentModes.map((mode) => (\n                    <SelectItem key={mode} value={mode}>\n                      {mode.charAt(0).toUpperCase() + mode.slice(1)}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Actions</label>\n              <Button variant=\"outline\" onClick={clearFilters} className=\"w-full\">\n                Clear Filters\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n              <DatePicker\n                selected={startDate}\n                onChange={(date) => setStartDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select start date\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n              <DatePicker\n                selected={endDate}\n                onChange={(date) => setEndDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select end date\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results Summary */}\n      <div className=\"mb-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Showing {filteredEntries.length} of {(expenseEntries || []).length} expense entries\n        </p>\n      </div>\n\n      {/* Entries Table/Cards */}\n      {isMobile ? (\n        <div className=\"space-y-4\">\n          {filteredEntries.map((entry) => (\n            <Card key={entry.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n              <CardContent className=\"pt-4\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg\">{entry.description}</h3>\n                    <p className=\"text-lg font-bold text-green-600\">‚Çπ{formatAmount(entry.amount)}</p>\n                  </div>\n                  <Badge className={getPaymentModeColor(entry.payment_mode)}>\n                    {entry.payment_mode}\n                  </Badge>\n                </div>\n                \n                <div className=\"space-y-2 text-sm\">\n                  {entry.firm_name && <div><strong>Firm:</strong> {entry.firm_name}</div>}\n                  {entry.bill_no && <div><strong>Bill No:</strong> {entry.bill_no}</div>}\n                  {entry.quantity && <div><strong>Quantity:</strong> {entry.quantity}</div>}\n                  {entry.reason && <div><strong>Reason:</strong> {entry.reason}</div>}\n                  <div><strong>Date:</strong> {entry.expense_date ? new Date(entry.expense_date).toLocaleDateString() : 'N/A'}</div>\n                  <div><strong>Approved by:</strong> {entry.approved_by}</div>\n                  {entry.paid_by && <div><strong>Paid by:</strong> {entry.paid_by}</div>}\n                  <div><strong>Created by:</strong> {entry.created_by}</div>\n                  \n                  {/* Attachments */}\n                  {entry.attachment_url && (\n                    <div className=\"space-y-2\">\n                      {(() => {\n                        const { receipt, paymentScreenshot } = parseAttachments(entry.attachment_url);\n                        return (\n                          <div className=\"flex flex-wrap gap-2\">\n                            {receipt && (\n                              <Dialog>\n                                <DialogTrigger asChild>\n                                  <button className=\"flex items-center gap-1 text-blue-600 hover:underline text-sm\">\n                                    <FileText className=\"h-4 w-4\" />\n                                    View Receipt\n                                  </button>\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-2xl\">\n                                  <DialogHeader>\n                                    <DialogTitle>Expense Receipt</DialogTitle>\n                                  </DialogHeader>\n                                  <FilePreview url={receipt} title=\"Expense Receipt\" />\n                                </DialogContent>\n                              </Dialog>\n                            )}\n                            \n                            {paymentScreenshot && entry.payment_mode !== 'cash' && (\n                              <Dialog>\n                                <DialogTrigger asChild>\n                                  <button className=\"flex items-center gap-1 text-green-600 hover:underline text-sm\">\n                                    <Image className=\"h-4 w-4\" />\n                                    Payment Proof\n                                  </button>\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-2xl\">\n                                  <DialogHeader>\n                                    <DialogTitle>Payment Screenshot</DialogTitle>\n                                  </DialogHeader>\n                                  <FilePreview url={paymentScreenshot} title=\"Payment Screenshot\" />\n                                </DialogContent>\n                              </Dialog>\n                            )}\n                          </div>\n                        );\n                      })()}\n                    </div>\n                  )}\n                  \n                  {/* Action Buttons */}\n                  <div className=\"flex gap-2 mt-4 pt-4 border-t\">\n                    {(user?.role === 'admin' || user?.role === 'operator') && (\n                      <Button\n                        onClick={() => handleEditClick(entry.id)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"flex-1\"\n                        data-testid={`button-edit-expense-${entry.id}`}\n                      >\n                        <Pencil className=\"h-4 w-4 mr-1\" />\n                        Edit\n                      </Button>\n                    )}\n                    {user?.role === 'admin' && (\n                      <Button\n                        onClick={() => handleDeleteClick(entry.id)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"flex-1 text-red-600 hover:bg-red-50 hover:text-red-700\"\n                        data-testid={`button-delete-expense-${entry.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 mr-1\" />\n                        Delete\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Firm/Bill</TableHead>\n                  <TableHead>Amount</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Payment Mode</TableHead>\n                  <TableHead>Approved By</TableHead>\n                  <TableHead>Paid By</TableHead>\n                  <TableHead>Receipt</TableHead>\n                  <TableHead>Payment Proof</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredEntries.map((entry) => (\n                  <TableRow key={entry.id}>\n                    <TableCell className=\"font-medium\">\n                      <div>{entry.description}</div>\n                      {entry.reason && <div className=\"text-xs text-muted-foreground\">{entry.reason}</div>}\n                    </TableCell>\n                    <TableCell>\n                      {entry.firm_name && <div className=\"font-medium\">{entry.firm_name}</div>}\n                      {entry.bill_no && <div className=\"text-xs text-muted-foreground\">Bill: {entry.bill_no}</div>}\n                      {entry.bill_date && <div className=\"text-xs text-muted-foreground\">{new Date(entry.bill_date).toLocaleDateString()}</div>}\n                      {!entry.firm_name && !entry.bill_no && !entry.bill_date && <span className=\"text-muted-foreground\">-</span>}\n                    </TableCell>\n                    <TableCell className=\"font-bold text-green-600\">\n                      ‚Çπ{formatAmount(entry.amount)}\n                      {entry.quantity && <div className=\"text-xs text-muted-foreground\">Qty: {entry.quantity}</div>}\n                    </TableCell>\n                    <TableCell>{entry.expense_date ? new Date(entry.expense_date).toLocaleDateString() : 'N/A'}</TableCell>\n                    <TableCell>\n                      <Badge className={getPaymentModeColor(entry.payment_mode)}>\n                        {entry.payment_mode}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{entry.approved_by}</TableCell>\n                    <TableCell>{entry.paid_by || entry.approved_by}</TableCell>\n                    \n                    {/* Receipt Column */}\n                    <TableCell>\n                      {(() => {\n                        const { receipt } = parseAttachments(entry.attachment_url);\n                        return receipt ? (\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <button className=\"flex items-center gap-1 text-blue-600 hover:underline\">\n                                <Eye className=\"h-4 w-4\" />\n                                View\n                              </button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-2xl\">\n                              <DialogHeader>\n                                <DialogTitle>Expense Receipt</DialogTitle>\n                              </DialogHeader>\n                              <FilePreview url={receipt} title=\"Expense Receipt\" />\n                            </DialogContent>\n                          </Dialog>\n                        ) : (\n                          <span className=\"text-muted-foreground\">No receipt</span>\n                        );\n                      })()}\n                    </TableCell>\n                    \n                    {/* Payment Proof Column */}\n                    <TableCell>\n                      {(() => {\n                        const { paymentScreenshot } = parseAttachments(entry.attachment_url);\n                        if (entry.payment_mode === 'cash') {\n                          return <span className=\"text-muted-foreground\">Not required</span>;\n                        }\n                        \n                        return paymentScreenshot ? (\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <button className=\"flex items-center gap-1 text-green-600 hover:underline\">\n                                <Eye className=\"h-4 w-4\" />\n                                View\n                              </button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-2xl\">\n                              <DialogHeader>\n                                <DialogTitle>Payment Screenshot</DialogTitle>\n                              </DialogHeader>\n                              <FilePreview url={paymentScreenshot} title=\"Payment Screenshot\" />\n                            </DialogContent>\n                          </Dialog>\n                        ) : (\n                          <span className=\"text-red-500\">Missing</span>\n                        );\n                      })()}\n                    </TableCell>\n                    \n                    {/* Actions Column */}\n                    <TableCell>\n                      <div className=\"flex gap-2\">\n                        {(user?.role === 'admin' || user?.role === 'operator') && (\n                          <Button\n                            onClick={() => handleEditClick(entry.id)}\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0\"\n                            data-testid={`button-edit-expense-${entry.id}`}\n                          >\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                        {user?.role === 'admin' && (\n                          <Button\n                            onClick={() => handleDeleteClick(entry.id)}\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50\"\n                            data-testid={`button-delete-expense-${entry.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      )}\n\n      {filteredEntries.length === 0 && !isLoading && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-lg text-muted-foreground\">No expense entries found.</p>\n          <Button onClick={() => setLocation('/expense-entry-form')} className=\"mt-4\">\n            Add First Expense Entry\n          </Button>\n        </div>\n      )}\n      \n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you sure?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete the expense entry from the database.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}","size_bytes":25575},"client/src/pages/users.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type User, UserRole } from \"@shared/schema\";\nimport { Link } from \"wouter\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport BulkUserUpload from \"@/components/bulk-user-upload\";\nimport { exportUsers } from \"@/lib/excel-export\";\n\n// User form schema - dynamic based on user role\nconst createUserFormSchema = (currentUserRole: string) => z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  email: z.string().email(\"Please enter a valid email\"),\n  mobile: z.string().min(10, \"Mobile number should be at least 10 digits\"),\n  address: z.string().optional(),\n  role: currentUserRole === 'admin' \n    ? z.enum([\"admin\", \"operator\", \"viewer\"])\n    : z.enum([\"operator\", \"viewer\"]), // Operators can only create operator/viewer users\n  status: z.enum([\"active\", \"inactive\"])\n});\n\nexport default function Users() {\n  const { user, isLoading } = useAuth();\n  const { toast } = useToast();\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [isNewUserDialogOpen, setIsNewUserDialogOpen] = useState(false);\n  const [isEditUserDialogOpen, setIsEditUserDialogOpen] = useState(false);\n  const [showBulkUpload, setShowBulkUpload] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  \n  // Show loading while authentication is being checked\n  if (isLoading) {\n    return (\n      <div className=\"flex-grow flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2\"></div>\n          <p className=\"text-neutral-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  // Only allow access for admin and operator\n  if (!user || (user.role !== 'admin' && user.role !== 'operator')) {\n    return (\n      <div className=\"flex-grow flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold mb-2\">Access Denied</h2>\n          <p className=\"text-neutral-600\">You don't have permission to access user management.</p>\n        </div>\n      </div>\n    );\n  }\n  \n  const userFormSchema = createUserFormSchema(user.role);\n  type UserFormValues = z.infer<typeof userFormSchema>;\n  \n  // Form for new user\n  const newUserForm = useForm<UserFormValues>({\n    resolver: zodResolver(userFormSchema),\n    defaultValues: {\n      name: \"\",\n      username: \"\",\n      password: \"\",\n      email: \"\",\n      mobile: \"\",\n      address: \"\",\n      role: \"viewer\",\n      status: \"active\"\n    }\n  });\n  \n  // Form for editing user\n  const editUserForm = useForm<Partial<UserFormValues>>({\n    resolver: zodResolver(userFormSchema.partial()),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      mobile: \"\",\n      address: \"\",\n      role: \"viewer\",\n      status: \"active\"\n    }\n  });\n  \n  // Fetch users\n  const { data: allUsers, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n\n  // Filter users based on role and search term\n  const users = useMemo(() => {\n    if (!allUsers) return [];\n    \n    // All users are visible to both admin and operator roles\n    // Edit permissions are controlled separately in the edit dialog\n    let filteredUsers = allUsers;\n    \n    // Search filtering across all displayed user details\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filteredUsers = filteredUsers.filter(u => \n        u.name.toLowerCase().includes(searchLower) ||\n        u.username.toLowerCase().includes(searchLower) ||\n        u.email.toLowerCase().includes(searchLower) ||\n        (u.mobile && u.mobile.toLowerCase().includes(searchLower)) ||\n        (u.address && u.address.toLowerCase().includes(searchLower)) ||\n        u.role.toLowerCase().includes(searchLower) ||\n        u.status.toLowerCase().includes(searchLower)\n      );\n    }\n    \n    // Sort by serial number in ascending order\n    return filteredUsers.sort((a, b) => a.serialNumber - b.serialNumber);\n  }, [allUsers, user?.role, searchTerm]);\n  \n  // Create user mutation\n  const createUserMutation = useMutation({\n    mutationFn: async (userData: UserFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/users\", userData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"User created successfully\",\n      });\n      setIsNewUserDialogOpen(false);\n      newUserForm.reset();\n      // Invalidate all user-related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create user: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Update user mutation\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number, data: Partial<UserFormValues> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/users/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"User updated successfully\",\n      });\n      setIsEditUserDialogOpen(false);\n      editUserForm.reset();\n      \n      // Invalidate all user-related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // If the updated user is the current logged-in user, also refresh the auth user data\n      if (user && selectedUser && user.id === selectedUser.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      }\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update user: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Submit handlers\n  const onCreateUser = (data: UserFormValues) => {\n    createUserMutation.mutate(data);\n  };\n  \n  const onUpdateUser = (data: Partial<UserFormValues>) => {\n    if (!selectedUser) return;\n    updateUserMutation.mutate({ id: selectedUser.id, data });\n  };\n  \n  // Handle edit button click\n  const handleEditUser = (user: User) => {\n    setSelectedUser(user);\n    editUserForm.reset({\n      name: user.name,\n      email: user.email,\n      mobile: user.mobile || \"\",\n      address: user.address || \"\",\n      role: user.role as \"admin\" | \"operator\" | \"viewer\",\n      status: user.status as \"active\" | \"inactive\"\n    });\n    setIsEditUserDialogOpen(true);\n  };\n\n  if (usersLoading) {\n    return <div className=\"flex justify-center p-8\">Loading users...</div>;\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-xl font-medium\">User Management</h1>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => exportUsers(users || [])}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100 flex items-center gap-2\"\n          >\n            <span className=\"text-sm\">üìä</span>\n            Export\n          </Button>\n          <Button \n            onClick={() => setShowBulkUpload(!showBulkUpload)}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"flex items-center gap-2\"\n          >\n            <span className=\"material-icons text-sm\">upload_file</span>\n            Bulk Upload\n          </Button>\n        </div>\n      </div>\n      \n      {/* Bulk Upload Section */}\n      {showBulkUpload && (\n        <div className=\"mb-6\">\n          <BulkUserUpload />\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <Dialog open={isNewUserDialogOpen} onOpenChange={setIsNewUserDialogOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"rounded-full h-10 w-10 p-0\" variant=\"default\">\n                <span className=\"material-icons\">person_add</span>\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Create New User</DialogTitle>\n            </DialogHeader>\n            <Form {...newUserForm}>\n              <form onSubmit={newUserForm.handleSubmit(onCreateUser)} className=\"space-y-4 py-4\">\n                <FormField\n                  control={newUserForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Full Name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Username</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Username\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <Input type=\"password\" placeholder=\"Password\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Email\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Mobile Number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select role\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {user.role === 'admin' && (\n                            <SelectItem value=\"admin\">Admin</SelectItem>\n                          )}\n                          <SelectItem value=\"operator\">Operator</SelectItem>\n                          <SelectItem value=\"viewer\">Viewer</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">Active</SelectItem>\n                          <SelectItem value=\"inactive\">Inactive</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={createUserMutation.isPending}\n                >\n                  {createUserMutation.isPending ? \"Creating...\" : \"Create User\"}\n                </Button>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n      \n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n            <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n          </span>\n          <Input \n            placeholder=\"Search users by name, username, email, mobile, address, role, or status\" \n            className=\"w-full pl-10 pr-4 py-2\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n        {searchTerm && (\n          <p className=\"text-sm text-neutral-600 mt-2\">\n            Found {users.length} user{users.length !== 1 ? 's' : ''} matching \"{searchTerm}\"\n          </p>\n        )}\n      </div>\n      \n      {/* User List */}\n      <div>\n        {!users || users.length === 0 ? (\n          <div className=\"text-center py-8 text-neutral-500\">No users found</div>\n        ) : (\n          users.map(userItem => (\n            <div \n              key={userItem.id} \n              className=\"bg-white rounded-lg shadow-md p-4 mb-4 flex justify-between items-center\"\n            >\n              <div>\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 font-mono\">\n                    #{userItem.serialNumber}\n                  </span>\n                  <Link href={`/users/${userItem.id}`}>\n                    <h3 className=\"font-medium text-primary hover:underline cursor-pointer\">{userItem.name}</h3>\n                  </Link>\n                </div>\n                <p className=\"text-sm text-neutral-500\">{userItem.email}</p>\n                {userItem.mobile && <p className=\"text-sm text-neutral-500\">üì± {userItem.mobile}</p>}\n                {userItem.address && <p className=\"text-sm text-neutral-500\">üè† {userItem.address}</p>}\n                <div className=\"flex items-center mt-1\">\n                  <span className={`text-xs ${userItem.role === UserRole.ADMIN ? 'bg-secondary' : 'bg-primary'} text-white px-2 py-0.5 rounded-full mr-2`}>\n                    {userItem.role}\n                  </span>\n                  <span className={`text-xs ${userItem.status === 'active' ? 'bg-green-500' : 'bg-neutral-500'} text-white px-2 py-0.5 rounded-full`}>\n                    {userItem.status}\n                  </span>\n                </div>\n              </div>\n              <div>\n                <Button \n                  variant=\"ghost\" \n                  className=\"text-primary p-2\"\n                  onClick={() => handleEditUser(userItem)}\n                  disabled={user?.role === 'operator' && userItem.role === 'admin'}\n                  title={user?.role === 'operator' && userItem.role === 'admin' ? 'Cannot edit admin users' : 'Edit user'}\n                >\n                  <span className=\"material-icons\">edit</span>\n                </Button>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n      \n      {/* Edit User Dialog */}\n      <Dialog open={isEditUserDialogOpen} onOpenChange={setIsEditUserDialogOpen}>\n        <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit User</DialogTitle>\n          </DialogHeader>\n          {selectedUser && (\n            <Form {...editUserForm}>\n              <form onSubmit={editUserForm.handleSubmit(onUpdateUser)} className=\"space-y-4 py-4\">\n                <FormField\n                  control={editUserForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Full Name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Email\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Mobile Number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select role\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {user.role === 'admin' && (\n                            <SelectItem value=\"admin\">Admin</SelectItem>\n                          )}\n                          <SelectItem value=\"operator\">Operator</SelectItem>\n                          <SelectItem value=\"viewer\">Viewer</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">Active</SelectItem>\n                          <SelectItem value=\"inactive\">Inactive</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={updateUserMutation.isPending}\n                >\n                  {updateUserMutation.isPending ? \"Updating...\" : \"Update User\"}\n                </Button>\n              </form>\n            </Form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":23190},"local-deployment/client/src/pages/previous-outstanding.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Calendar, User, Plus, X, Eye } from \"lucide-react\";\nimport { Calendar as CalendarComponent } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\ninterface PreviousOutstanding {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\nexport default function PreviousOutstanding() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n  \n  // Check if user has permission to view this page\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">Access Denied</h2>\n          <p className=\"text-red-600\">You don't have permission to view previous outstanding records.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Fetch previous outstanding records with date range query params\n  const queryParams = new URLSearchParams();\n  if (startDate) {\n    queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  }\n  if (endDate) {\n    queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n  }\n\n  const { data: records, isLoading } = useQuery<PreviousOutstanding[]>({\n    queryKey: ['/api/previous-outstanding', queryParams.toString()],\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Apply filters\n  const filteredRecords = useMemo(() => {\n    return (records || []).filter(record => {\n      const matchesSearch = !searchTerm || \n        record.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.userMobile?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        record.createdBy.toLowerCase().includes(searchTerm.toLowerCase());\n      \n      const recordDate = new Date(record.createdAt);\n      const matchesDateRange = (!startDate || recordDate >= startDate) && \n                              (!endDate || recordDate <= endDate);\n      \n      return matchesSearch && matchesDateRange;\n    });\n  }, [records, searchTerm, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  const formatAmount = (amount: number) => {\n    return amount.toLocaleString();\n  };\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  const totalAmount = filteredRecords.reduce((sum, record) => sum + record.outstandingAmount, 0);\n\n  return (\n    <div className=\"space-y-6 p-4\">\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Previous Outstanding Records</h1>\n          <p className=\"text-muted-foreground\">\n            Historical outstanding amounts from old system\n          </p>\n        </div>\n        {(user?.role === 'admin' || user?.role === 'operator') && (\n          <Button onClick={() => setLocation('/previous-outstanding/new')}>\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Record\n          </Button>\n        )}\n      </div>\n\n      {/* Summary Card */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Summary</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-blue-600\">{filteredRecords.length}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Records</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-amber-600\">‚Çπ{totalAmount.toLocaleString()}</div>\n              <p className=\"text-sm text-muted-foreground\">Total Outstanding</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-green-600\">\n                ‚Çπ{filteredRecords.reduce((sum, record) => sum + (record.receivedAmount || 0), 0).toLocaleString()}\n              </div>\n              <p className=\"text-sm text-muted-foreground\">Total Received</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-red-600\">\n                ‚Çπ{filteredRecords.reduce((sum, record) => sum + (record.pendingAmount || record.outstandingAmount), 0).toLocaleString()}\n              </div>\n              <p className=\"text-sm text-muted-foreground\">Total Pending</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <CardTitle>Filters</CardTitle>\n            <Button variant=\"outline\" size=\"sm\" onClick={clearFilters}>\n              <X className=\"h-4 w-4 mr-2\" />\n              Clear Filters\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search</label>\n              <Input\n                placeholder=\"Search by name, mobile, description...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">From Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !startDate && \"text-muted-foreground\"\n                    )}\n                  >\n                    <Calendar className=\"mr-2 h-4 w-4\" />\n                    {startDate ? format(startDate, \"PPP\") : \"Pick a date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <CalendarComponent\n                    mode=\"single\"\n                    selected={startDate || undefined}\n                    onSelect={(date) => setStartDate(date || null)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">To Date</label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className={cn(\n                      \"w-full justify-start text-left font-normal\",\n                      !endDate && \"text-muted-foreground\"\n                    )}\n                  >\n                    <Calendar className=\"mr-2 h-4 w-4\" />\n                    {endDate ? format(endDate, \"PPP\") : \"Pick a date\"}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                  <CalendarComponent\n                    mode=\"single\"\n                    selected={endDate || undefined}\n                    onSelect={(date) => setEndDate(date || null)}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Records Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Records ({filteredRecords.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900\"></div>\n            </div>\n          ) : filteredRecords.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              {records?.length === 0 ? \"No previous outstanding records found.\" : \"No records match your search criteria.\"}\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>User Details</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Payment Status</TableHead>\n                    <TableHead>Description</TableHead>\n                    <TableHead>Created</TableHead>\n                    <TableHead>Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredRecords.map((record) => (\n                    <TableRow key={record.id}>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">{record.userName}</div>\n                          <div className=\"text-sm text-muted-foreground\">{record.userMobile}</div>\n                          <div className=\"text-xs text-muted-foreground\">{record.userAddress}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-medium\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n                        {(record.receivedAmount || 0) > 0 && (\n                          <div className=\"text-sm text-green-600\">Received: ‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n                        )}\n                        {(record.pendingAmount || record.outstandingAmount) > 0 && (\n                          <div className=\"text-sm text-red-600\">Pending: ‚Çπ{formatAmount(record.pendingAmount || record.outstandingAmount)}</div>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {getStatusBadge(record.status || 'pending', record.pendingAmount || record.outstandingAmount)}\n                      </TableCell>\n                      <TableCell>{record.description}</TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"text-sm\">{formatDate(record.createdAt)}</div>\n                          <div className=\"text-xs text-muted-foreground\">by {record.createdBy}</div>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setLocation(`/previous-outstanding/${record.id}/details`)}\n                        >\n                          <Eye className=\"h-4 w-4 mr-1\" />\n                          View\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":12924},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"local-deployment/client/src/pages/expense-entry-form.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { ArrowLeft, Plus, Upload, X, FileImage, Search } from \"lucide-react\";\nimport { PaymentMode } from \"@shared/schema\";\nimport { Command, CommandInput, CommandItem, CommandList, CommandEmpty } from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\n\nexport default function ExpenseEntryForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  \n  // Form state - ordered as per requirement\n  const [firmName, setFirmName] = useState(\"\");\n  const [billNo, setBillNo] = useState(\"\");\n  const [billDate, setBillDate] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [quantity, setQuantity] = useState(\"\");\n  const [reason, setReason] = useState(\"\");\n  const [expenseDate, setExpenseDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentMode, setPaymentMode] = useState(\"\");\n  const [approvedBy, setApprovedBy] = useState(\"\");\n  const [paidBy, setPaidBy] = useState(\"\");\n  \n  // User selection states\n  const [approvedByOpen, setApprovedByOpen] = useState(false);\n  const [paidByOpen, setPaidByOpen] = useState(false);\n  const [approvedBySearch, setApprovedBySearch] = useState(\"\");\n  const [paidBySearch, setPaidBySearch] = useState(\"\");\n  \n  // File upload states\n  const [receiptFile, setReceiptFile] = useState<File | null>(null);\n  const [paymentScreenshot, setPaymentScreenshot] = useState<File | null>(null);\n  const receiptFileRef = useRef<HTMLInputElement>(null);\n  const paymentFileRef = useRef<HTMLInputElement>(null);\n  \n  // Fetch users for dropdowns\n  const { data: users } = useQuery<any[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const createExpenseEntryMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/expense-entries', {\n        method: 'POST',\n        body: formData, // No Content-Type header needed for FormData\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create expense entry');\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (createdEntry) => {\n      toast({\n        title: \"Success\",\n        description: `Expense entry created successfully for ‚Çπ${(createdEntry.amount / 100).toFixed(2)}.`,\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/expense-entries'] });\n      \n      // Clear form\n      setFirmName(\"\");\n      setBillNo(\"\");\n      setBillDate(\"\");\n      setDescription(\"\");\n      setAmount(\"\");\n      setQuantity(\"\");\n      setReason(\"\");\n      setExpenseDate(new Date().toISOString().split('T')[0]);\n      setPaymentMode(\"\");\n      setApprovedBy(\"\");\n      setPaidBy(\"\");\n      setReceiptFile(null);\n      setPaymentScreenshot(null);\n      if (receiptFileRef.current) receiptFileRef.current.value = \"\";\n      if (paymentFileRef.current) paymentFileRef.current.value = \"\";\n      \n      // Navigate to list\n      setTimeout(() => setLocation('/expense-entries'), 1000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create expense entry\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Basic validation - only mandatory fields marked with *\n    if (!description.trim() || !amount || !paymentMode || !approvedBy.trim() || !paidBy.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill in all required fields: Line Item Description, Amount, Mode of Payment, Approved By, and Paid By.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate amount\n    const numAmount = parseFloat(amount);\n    if (isNaN(numAmount) || numAmount <= 0) {\n      toast({\n        title: \"Validation Error\", \n        description: \"Please enter a valid amount greater than 0.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate quantity if provided\n    if (quantity.trim()) {\n      const numQuantity = parseInt(quantity);\n      if (isNaN(numQuantity) || numQuantity < 1) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Quantity must be at least 1 if provided.\",\n          variant: \"destructive\", \n        });\n        return;\n      }\n    }\n\n    // Validate receipt file is provided\n    if (!receiptFile) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please upload an expense receipt.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate payment screenshot for non-cash payments\n    if (paymentMode !== 'cash' && !paymentScreenshot) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Payment screenshot is required for non-cash payments.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Create FormData for file uploads\n    const formData = new FormData();\n    formData.append('firmName', firmName.trim());\n    formData.append('billNo', billNo.trim());\n    formData.append('billDate', billDate);\n    formData.append('description', description.trim());\n    formData.append('amount', Math.round(numAmount * 100).toString()); // Convert to paisa\n    formData.append('quantity', quantity.trim() || '0');\n    formData.append('reason', reason.trim());\n    formData.append('expenseDate', expenseDate);\n    formData.append('paymentMode', paymentMode);\n    formData.append('approvedBy', approvedBy.trim());\n    formData.append('paidBy', paidBy.trim());\n    formData.append('createdBy', user?.username || \"system\");\n    \n    // Add files\n    formData.append('receiptFile', receiptFile);\n    if (paymentScreenshot) {\n      formData.append('paymentScreenshot', paymentScreenshot);\n    }\n\n    createExpenseEntryMutation.mutate(formData);\n  };\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can create expense entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/expense-entries')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Expense Entries\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Plus className=\"h-5 w-5\" />\n            Create New Expense Entry\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Record a new expense with all required details and approvals.\n          </p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Firm Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"firm-name\">Firm Name</Label>\n              <Input \n                id=\"firm-name\"\n                value={firmName}\n                onChange={(e) => setFirmName(e.target.value)}\n                placeholder=\"Enter firm name (optional)\"\n              />\n            </div>\n\n            {/* Bill No and Bill Date */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bill-no\">Bill No</Label>\n                <Input \n                  id=\"bill-no\"\n                  value={billNo}\n                  onChange={(e) => setBillNo(e.target.value)}\n                  placeholder=\"Enter bill number (optional)\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bill-date\">Bill Date</Label>\n                <Input \n                  id=\"bill-date\"\n                  type=\"date\" \n                  value={billDate}\n                  onChange={(e) => setBillDate(e.target.value)}\n                />\n              </div>\n            </div>\n\n            {/* Line Item Description */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Line Item Description *</Label>\n              <Input \n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"Enter item description\"\n              />\n            </div>\n\n            {/* Amount and Quantity */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                <Input \n                  id=\"amount\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={amount}\n                  onChange={(e) => setAmount(e.target.value)}\n                  placeholder=\"0.00\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"quantity\">Quantity</Label>\n                <Input \n                  id=\"quantity\"\n                  type=\"number\"\n                  min=\"1\"\n                  value={quantity}\n                  onChange={(e) => setQuantity(e.target.value)}\n                  placeholder=\"Enter quantity (optional)\"\n                />\n              </div>\n            </div>\n\n            {/* Reason for Expense */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reason\">Reason for Expense</Label>\n              <Textarea \n                id=\"reason\"\n                value={reason}\n                onChange={(e) => setReason(e.target.value)}\n                placeholder=\"Explain the reason for this expense (optional)\"\n                rows={3}\n              />\n            </div>\n\n            {/* Date and Payment Mode */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"expense-date\">Date of Expense *</Label>\n                <Input \n                  id=\"expense-date\"\n                  type=\"date\" \n                  value={expenseDate}\n                  onChange={(e) => setExpenseDate(e.target.value)}\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"payment-mode\">Mode of Payment *</Label>\n                <Select value={paymentMode} onValueChange={setPaymentMode}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select payment mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                    <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                    <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                    <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Receipt File Upload */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"receipt-file\">Expense Receipt *</Label>\n              <div className=\"flex gap-2\">\n                <Input \n                  ref={receiptFileRef}\n                  id=\"receipt-file\"\n                  type=\"file\"\n                  accept=\".jpg,.jpeg,.png,.pdf\"\n                  onChange={(e) => setReceiptFile(e.target.files?.[0] || null)}\n                  className=\"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90\"\n                />\n                {receiptFile && (\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => {\n                      setReceiptFile(null);\n                      if (receiptFileRef.current) receiptFileRef.current.value = \"\";\n                    }}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n              {receiptFile && (\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <FileImage className=\"h-4 w-4\" />\n                  <span>{receiptFile.name} ({(receiptFile.size / 1024).toFixed(1)} KB)</span>\n                </div>\n              )}\n              <p className=\"text-xs text-muted-foreground\">\n                Upload the expense receipt (JPG, JPEG, PNG, PDF)\n              </p>\n            </div>\n\n            {/* Payment Screenshot (conditional) */}\n            {paymentMode && paymentMode !== PaymentMode.CASH && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"payment-screenshot\">Payment Screenshot *</Label>\n                <div className=\"flex gap-2\">\n                  <Input \n                    ref={paymentFileRef}\n                    id=\"payment-screenshot\"\n                    type=\"file\"\n                    accept=\".jpg,.jpeg,.png,.pdf\"\n                    onChange={(e) => setPaymentScreenshot(e.target.files?.[0] || null)}\n                    className=\"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90\"\n                  />\n                  {paymentScreenshot && (\n                    <Button \n                      type=\"button\" \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        setPaymentScreenshot(null);\n                        if (paymentFileRef.current) paymentFileRef.current.value = \"\";\n                      }}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n                {paymentScreenshot && (\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <FileImage className=\"h-4 w-4\" />\n                    <span>{paymentScreenshot.name} ({(paymentScreenshot.size / 1024).toFixed(1)} KB)</span>\n                  </div>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  Upload payment screenshot for {paymentMode.toUpperCase()} transaction (JPG, JPEG, PNG, PDF)\n                </p>\n              </div>\n            )}\n\n            {/* Approved By - User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"approved-by\">Approved By *</Label>\n              <Popover open={approvedByOpen} onOpenChange={setApprovedByOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={approvedByOpen}\n                    className=\"w-full justify-between\"\n                  >\n                    {approvedBy ? \n                      users?.find((user) => user.name === approvedBy)?.name || approvedBy :\n                      \"Select approver...\"\n                    }\n                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-full p-0\">\n                  <Command>\n                    <CommandInput \n                      placeholder=\"Search users...\" \n                      value={approvedBySearch}\n                      onValueChange={setApprovedBySearch}\n                    />\n                    <CommandList>\n                      <CommandEmpty>No user found.</CommandEmpty>\n                      {users?.filter(user => \n                        user.name.toLowerCase().includes(approvedBySearch.toLowerCase()) ||\n                        user.username.toLowerCase().includes(approvedBySearch.toLowerCase())\n                      ).map((user) => (\n                        <CommandItem\n                          key={user.id}\n                          value={user.name}\n                          onSelect={(currentValue) => {\n                            setApprovedBy(currentValue === approvedBy ? \"\" : currentValue);\n                            setApprovedByOpen(false);\n                            setApprovedBySearch(\"\");\n                          }}\n                        >\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{user.name}</span>\n                            <span className=\"text-xs text-muted-foreground\">@{user.username}</span>\n                          </div>\n                        </CommandItem>\n                      ))}\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            {/* Paid By - User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"paid-by\">Paid By *</Label>\n              <Popover open={paidByOpen} onOpenChange={setPaidByOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={paidByOpen}\n                    className=\"w-full justify-between\"\n                  >\n                    {paidBy ? \n                      users?.find((user) => user.name === paidBy)?.name || paidBy :\n                      \"Select payer...\"\n                    }\n                    <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-full p-0\">\n                  <Command>\n                    <CommandInput \n                      placeholder=\"Search users...\" \n                      value={paidBySearch}\n                      onValueChange={setPaidBySearch}\n                    />\n                    <CommandList>\n                      <CommandEmpty>No user found.</CommandEmpty>\n                      {users?.filter(user => \n                        user.name.toLowerCase().includes(paidBySearch.toLowerCase()) ||\n                        user.username.toLowerCase().includes(paidBySearch.toLowerCase())\n                      ).map((user) => (\n                        <CommandItem\n                          key={user.id}\n                          value={user.name}\n                          onSelect={(currentValue) => {\n                            setPaidBy(currentValue === paidBy ? \"\" : currentValue);\n                            setPaidByOpen(false);\n                            setPaidBySearch(\"\");\n                          }}\n                        >\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{user.name}</span>\n                            <span className=\"text-xs text-muted-foreground\">@{user.username}</span>\n                          </div>\n                        </CommandItem>\n                      ))}\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setLocation('/expense-entries')}\n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createExpenseEntryMutation.isPending}\n                className=\"flex-1\"\n              >\n                {createExpenseEntryMutation.isPending ? \"Creating...\" : \"Create Expense Entry\"}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":21023},"server/read-excel-headers.ts":{"content":"import XLSX from 'xlsx';\nimport * as path from 'path';\n\nasync function readExcelHeaders() {\n  try {\n    console.log('Reading original Excel file headers...');\n    const filePath = path.join(process.cwd(), '..', 'attached_assets', 'Shivnagar Worksheet_1754753646977.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Get first row (headers)\n    const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1');\n    const headers: string[] = [];\n    \n    for (let col = range.s.c; col <= range.e.c; col++) {\n      const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });\n      const cell = worksheet[cellAddress];\n      if (cell && cell.v) {\n        headers.push(String(cell.v));\n      }\n    }\n    \n    console.log('Excel Headers:', headers);\n    \n    // Also get first few rows to see data structure\n    const jsonData = XLSX.utils.sheet_to_json(worksheet, { range: 5 }); // First 5 rows\n    console.log('Sample data structure:');\n    console.log(jsonData[0]);\n    \n    return headers;\n    \n  } catch (error) {\n    console.error('Error reading Excel file:', error);\n    throw error;\n  }\n}\n\nreadExcelHeaders();","size_bytes":1224},"local-deployment/README.md":{"content":"# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Local Installation Guide\n\n## Prerequisites\n- Node.js (v18 or higher)\n- PostgreSQL (v14 or higher)\n- Git\n\n## Installation Steps\n\n### 1. Extract and Setup\n```bash\n# Extract the ZIP file to your Desktop\ncd ~/Desktop/daan-darpan-local\n\n# Install dependencies\nnpm install\n```\n\n### 2. Database Setup\n```bash\n# Start PostgreSQL service\nsudo service postgresql start\n\n# Create database and user\nsudo -u postgres psql\nCREATE DATABASE daan_darpan;\nCREATE USER daan_user WITH PASSWORD 'daan_password';\nGRANT ALL PRIVILEGES ON DATABASE daan_darpan TO daan_user;\n\\q\n```\n\n### 3. Environment Configuration\n```bash\n# Copy environment file\ncp .env.example .env\n\n# Edit .env file with your database credentials\nnano .env\n```\n\n### 4. Database Setup\n\nChoose one option:\n\n**Option A: Fresh Installation with Sample Data**\n```bash\n# Push database schema\nnpm run db:push\n\n# Create sample data for testing\n./scripts/create-sample-data.sh\n```\n\n**Option B: Restore from Production Backup**\n```bash\n# Place your backup file in database-backups/\n# Then restore it\n./scripts/restore-database.sh database-backups/your-backup.sql.gz\n```\n\n### 5. Start Application\n```bash\n# Development mode\nnpm run dev\n\n# Production mode\nnpm run build\nnpm start\n```\n\n## Access URLs\n\n- **Local Network**: http://223.190.85.106:5000\n- **Localhost**: http://localhost:5000\n\n## Default Admin Credentials\n\n- Username: `admin`\n- Password: `admin123`\n\n## Important Notes\n\n1. **Security**: Change default admin password after first login\n2. **Backup**: Regular database backups are recommended\n3. **Updates**: Check for updates regularly\n4. **Support**: Refer to operator-help-guide.md for detailed usage instructions\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Port Already in Use**\n   ```bash\n   # Kill process on port 5000\n   sudo lsof -t -i:5000 | xargs kill -9\n   ```\n\n2. **Database Connection Error**\n   - Verify PostgreSQL is running\n   - Check database credentials in .env\n   - Ensure database exists\n\n3. **Permission Issues**\n   ```bash\n   # Fix npm permissions\n   sudo chown -R $(whoami) ~/.npm\n   ```\n\n## File Structure\n```\ndaan-darpan-local/\n‚îú‚îÄ‚îÄ client/              # Frontend React application\n‚îú‚îÄ‚îÄ server/              # Backend Express server\n‚îú‚îÄ‚îÄ shared/              # Shared TypeScript types\n‚îú‚îÄ‚îÄ uploads/             # File uploads directory\n‚îú‚îÄ‚îÄ package.json         # Dependencies\n‚îú‚îÄ‚îÄ .env.example         # Environment template\n‚îî‚îÄ‚îÄ README.md           # This file\n```","size_bytes":2501},"local-deployment/client/src/components/previous-outstanding-section.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { FileText, Eye } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\ninterface PreviousOutstandingRecord {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  attachmentUrl?: string;\n  attachmentName?: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PreviousOutstandingSectionProps {\n  userId: number;\n}\n\nexport function PreviousOutstandingSection({ userId }: PreviousOutstandingSectionProps) {\n  const [, setLocation] = useLocation();\n  \n  // Fetch previous outstanding records for this user\n  const { data: previousOutstandingRecords = [], isLoading } = useQuery<PreviousOutstandingRecord[]>({\n    queryKey: [`/api/previous-outstanding?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const formatAmount = (amountInRupees: number) => {\n    return amountInRupees.toLocaleString('en-IN');\n  };\n\n  const handleViewAttachment = (attachmentUrl: string) => {\n    window.open(attachmentUrl, '_blank');\n  };\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  if (isLoading) {\n    return <div>Loading previous outstanding records...</div>;\n  }\n\n  if (previousOutstandingRecords.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-muted-foreground\">\n        No previous outstanding records found for this user.\n      </div>\n    );\n  }\n\n  const totalOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + record.outstandingAmount, \n    0\n  );\n\n  const totalReceived = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.receivedAmount || 0), \n    0\n  );\n\n  const totalPending = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.pendingAmount || record.outstandingAmount), \n    0\n  );\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Enhanced Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"p-4 bg-amber-50 rounded-lg border border-amber-200\">\n          <div>\n            <h3 className=\"font-medium text-amber-800\">Total Outstanding</h3>\n            <p className=\"text-xs text-amber-600\">Original amounts</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-amber-800\">‚Çπ{formatAmount(totalOutstanding)}</p>\n            <p className=\"text-xs text-amber-600\">{previousOutstandingRecords.length} records</p>\n          </div>\n        </div>\n\n        <div className=\"p-4 bg-green-50 rounded-lg border border-green-200\">\n          <div>\n            <h3 className=\"font-medium text-green-800\">Total Received</h3>\n            <p className=\"text-xs text-green-600\">Payments made</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-green-800\">‚Çπ{formatAmount(totalReceived)}</p>\n            <p className=\"text-xs text-green-600\">\n              {totalOutstanding > 0 ? Math.round((totalReceived / totalOutstanding) * 100) : 0}% paid\n            </p>\n          </div>\n        </div>\n\n        <div className=\"p-4 bg-red-50 rounded-lg border border-red-200\">\n          <div>\n            <h3 className=\"font-medium text-red-800\">Total Pending</h3>\n            <p className=\"text-xs text-red-600\">Remaining balance</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-red-800\">‚Çπ{formatAmount(totalPending)}</p>\n            <p className=\"text-xs text-red-600\">\n              {totalOutstanding > 0 ? Math.round((totalPending / totalOutstanding) * 100) : 0}% remaining\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Records Table */}\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Description</TableHead>\n              <TableHead>Amount</TableHead>\n              <TableHead>Payment Status</TableHead>\n              <TableHead>Date Added</TableHead>\n              <TableHead>Added By</TableHead>\n              <TableHead>Proof</TableHead>\n              <TableHead>Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {previousOutstandingRecords.map((record) => (\n              <TableRow key={record.id}>\n                <TableCell className=\"font-medium\">{record.description}</TableCell>\n                <TableCell>\n                  <div className=\"font-medium\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n                  {(record.receivedAmount || 0) > 0 && (\n                    <div className=\"text-sm text-green-600\">Received: ‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n                  )}\n                  {(record.pendingAmount || record.outstandingAmount) > 0 && (\n                    <div className=\"text-sm text-red-600\">Pending: ‚Çπ{formatAmount(record.pendingAmount || record.outstandingAmount)}</div>\n                  )}\n                </TableCell>\n                <TableCell>\n                  {getStatusBadge(record.status || 'pending', record.pendingAmount || record.outstandingAmount)}\n                </TableCell>\n                <TableCell>{formatDate(record.createdAt)}</TableCell>\n                <TableCell>{record.createdBy}</TableCell>\n                <TableCell>\n                  {record.attachmentUrl ? (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleViewAttachment(record.attachmentUrl!)}\n                    >\n                      <FileText className=\"h-4 w-4 mr-1\" />\n                      View\n                    </Button>\n                  ) : (\n                    <span className=\"text-muted-foreground text-sm\">No attachment</span>\n                  )}\n                </TableCell>\n                <TableCell>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setLocation(`/previous-outstanding/${record.id}/details`)}\n                  >\n                    <Eye className=\"h-4 w-4 mr-1\" />\n                    Details\n                  </Button>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  );\n}","size_bytes":7489},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5046},"local-deployment/client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"local-deployment/client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport NotFound from \"@/pages/not-found\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Users from \"@/pages/users\";\nimport UserDetail from \"@/pages/user-detail\";\nimport Entries from \"@/pages/entries\";\nimport EntryForm from \"@/pages/entry-form\";\nimport EntryEdit from \"@/pages/entry-edit\";\nimport DravyaEntries from \"@/pages/dravya-entries\";\nimport DravyaEntryForm from \"@/pages/dravya-entry-form\";\nimport ExpenseEntries from \"@/pages/expense-entries\";\nimport ExpenseEntryForm from \"@/pages/expense-entry-form\";\nimport PreviousOutstandingForm from \"@/pages/previous-outstanding-form\";\nimport PreviousOutstanding from \"@/pages/previous-outstanding\";\nimport PreviousOutstandingDetails from \"@/pages/previous-outstanding-details\";\nimport AdvancePayments from \"@/pages/advance-payments\";\nimport AdvancePaymentForm from \"@/pages/advance-payment-form\";\nimport PaymentDetails from \"@/pages/payment-details\";\nimport Payments from \"@/pages/payments\";\nimport TransactionLogs from \"@/pages/logs\";\nimport Settings from \"@/pages/settings\";\nimport { SidebarNavigation } from \"@/components/sidebar-navigation\";\nimport CopyrightFooter from \"@/components/copyright-footer\";\nimport { AuthProvider } from \"@/lib/context/auth-context\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport LoginForm from \"@/components/auth/login-form\";\n\nfunction ProtectedRoutes() {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return <div className=\"flex justify-center items-center h-screen\">Loading...</div>;\n  }\n\n  if (!user) {\n    return <LoginForm />;\n  }\n\n  // Component for root route that redirects based on user role\n  function RootRedirect() {\n    const [, setLocation] = useLocation();\n    \n    // Redirect viewers to their account page\n    if (user?.role === 'viewer') {\n      setLocation('/my-account');\n      return null;\n    }\n    return <Dashboard />;\n  }\n\n  // Component for dashboard route that blocks viewers\n  function DashboardRoute() {\n    if (user?.role === 'viewer') {\n      return <div className=\"p-4 text-center\">Access denied. This page is not available for your role.</div>;\n    }\n    return <Dashboard />;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <SidebarNavigation />\n      <div className=\"flex-grow pl-4 pt-16 pb-16\">\n        <Switch>\n          <Route path=\"/\" component={RootRedirect} />\n          <Route path=\"/dashboard\" component={DashboardRoute} />\n          <Route path=\"/users\" component={Users} />\n          <Route path=\"/users/:id\" component={UserDetail} />\n          <Route path=\"/my-account\" component={UserDetail} />\n          <Route path=\"/entries\" component={Entries} />\n          <Route path=\"/entry/new\" component={EntryForm} />\n          <Route path=\"/entries/:id/edit\" component={EntryEdit} />\n          <Route path=\"/previous-outstanding\" component={PreviousOutstanding} />\n          <Route path=\"/previous-outstanding/new\" component={PreviousOutstandingForm} />\n          <Route path=\"/previous-outstanding/:id/details\" component={PreviousOutstandingDetails} />\n          <Route path=\"/dravya-entries\" component={DravyaEntries} />\n          <Route path=\"/dravya-entry-form\" component={DravyaEntryForm} />\n          <Route path=\"/expense-entries\" component={ExpenseEntries} />\n          <Route path=\"/expense-entry-form\" component={ExpenseEntryForm} />\n          <Route path=\"/advance-payments\" component={AdvancePayments} />\n          <Route path=\"/advance-payment-form\" component={AdvancePaymentForm} />\n          {/* Edit entry functionality has been disabled */}\n          <Route path=\"/entries/:id\" component={PaymentDetails} />\n          <Route path=\"/payment-details/:id\" component={PaymentDetails} />\n          <Route path=\"/payments\" component={Payments} />\n          <Route path=\"/logs\" component={TransactionLogs} />\n          <Route path=\"/settings\" component={Settings} />\n          <Route component={NotFound} />\n        </Switch>\n      </div>\n      <CopyrightFooter />\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <ProtectedRoutes />\n        <Toaster />\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4412},"client/src/components/auth/login-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport mandirLogo from \"@assets/new logo mandir color_1754807711657.jpg\";\nimport daanDarpanLogo from \"@assets/temple_logo_1755868550530.jpeg\";\n\nconst loginFormSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\")\n});\n\ntype LoginFormValues = z.infer<typeof loginFormSchema>;\n\nexport default function LoginForm() {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  \n  const form = useForm<LoginFormValues>({\n    resolver: zodResolver(loginFormSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\"\n    }\n  });\n  \n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", credentials);\n      return response.json();\n    },\n    onMutate: () => {\n      setIsSubmitting(true);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Authentication Failed\",\n        description: error.message || \"Invalid username or password\",\n        variant: \"destructive\"\n      });\n      setIsSubmitting(false);\n    },\n    onSettled: () => {\n      setIsSubmitting(false);\n    }\n  });\n  \n  const onSubmit = (data: LoginFormValues) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col lg:flex-row\">\n      {/* Left Panel - Welcome Section */}\n      <div className=\"flex-1 bg-gradient-to-br from-primary to-primary/80 text-white p-6 lg:p-12 flex flex-col justify-between hidden lg:flex\">\n        <div>\n          {/* Logo Section */}\n          <div className=\"flex items-center gap-3 mb-12\">\n            <img \n              src={mandirLogo} \n              alt=\"‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø\" \n              className=\"w-12 h-12 rounded-full\"\n            />\n            <span className=\"text-lg font-bold\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</span>\n          </div>\n          \n          {/* Welcome Content */}\n          <div className=\"space-y-8\">\n            <h1 className=\"text-4xl font-bold\">‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h1>\n            <p className=\"text-xl text-white/90 leading-relaxed\">\n              ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§®‡•ã‡§Ç ‡§î‡§∞ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§¶‡§æ‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ‡•§\n            </p>\n            \n            {/* Feature List */}\n            <ul className=\"space-y-4 text-white/90\">\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡§∞‡•á‡§∂‡§®</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡§π‡•Å‡§Å‡§ö ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£</span>\n              </li>\n            </ul>\n          </div>\n        </div>\n        \n        {/* Footer */}\n        <div className=\"text-white/70 text-sm\">\n          ¬© 2025 ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞. All rights reserved.\n        </div>\n      </div>\n      \n      {/* Right Panel - Login Form */}\n      <div className=\"flex-1 bg-gray-50 flex items-center justify-center p-4 lg:p-8\">\n        <div className=\"w-full max-w-md\">\n          {/* Header with Logo */}\n          <div className=\"text-center mb-8\">\n            {/* Mobile header with ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ logo */}\n            <div className=\"flex justify-center items-center gap-4 mb-4 lg:hidden\">\n              <img \n                src={daanDarpanLogo} \n                alt=\"‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Logo\" \n                className=\"w-16 h-16\"\n              />\n            </div>\n            \n            {/* Desktop header with app logo only */}\n            <div className=\"hidden lg:flex justify-center mb-4\">\n              <img \n                src={daanDarpanLogo} \n                alt=\"‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Logo\" \n                className=\"w-16 h-16\"\n              />\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Sign In</h2>\n            <p className=\"text-gray-600\">Enter your credentials to access your account</p>\n          </div>\n          \n          {/* Login Card */}\n          <Card className=\"shadow-lg border-0\">\n            <CardContent className=\"p-8\">\n              <h3 className=\"text-xl font-semibold text-gray-800 mb-6\">Welcome Back</h3>\n              \n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700\">Username</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Enter username\" \n                            className=\"h-12 border-gray-300 focus:border-primary\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700\">Password</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"password\" \n                            placeholder=\"Enter password\" \n                            className=\"h-12 border-gray-300 focus:border-primary\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <Button \n                    type=\"submit\" \n                    className=\"w-full h-12 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg\" \n                    disabled={isSubmitting}\n                  >\n                    {isSubmitting ? \"Signing In...\" : \"Sign In\"}\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8018},"local-deployment/client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"local-deployment/client/src/components/dravya-hindi-receipt.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DravyaEntry {\n  id: number;\n  userId: number;\n  userName: string;\n  description: string;\n  quantity: number;\n  createdAt: string;\n  userAddress?: string;\n  userMobile?: string;\n}\n\ninterface DravyaHindiReceiptProps {\n  entry: DravyaEntry;\n  receiptNo?: string;\n}\n\nexport function DravyaHindiReceipt({ entry, receiptNo }: DravyaHindiReceiptProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [editableData, setEditableData] = useState({\n    dharmanuyayi: entry.userName || \"\",\n    address: entry.userAddress || \"‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)\",\n    date: new Date().toLocaleDateString('hi-IN', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\\//g, '/'),\n    drayvaSankhya: (entry.quantity || 1).toString(),\n    receiptNumber: receiptNo || `SPDJMSJ-${new Date().getFullYear()}-${String(entry.id).padStart(5, '0')}`\n  });\n  const { toast } = useToast();\n\n  const formatDateDDMMYY = (date: string | Date) => {\n    const d = new Date(date);\n    const day = String(d.getDate()).padStart(2, '0');\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const year = String(d.getFullYear()).slice(-2);\n    return `${day}/${month}/${year}`;\n  };\n\n  const generateReceiptHTML = () => {\n    const formattedUserName = editableData.dharmanuyayi || entry.userName;\n    const hindiAddress = editableData.address;\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"hi\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${formattedUserName}</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');\n            \n            body {\n              font-family: 'Noto Sans Devanagari', sans-serif;\n              margin: 0;\n              padding: 10px;\n              background-color: #f5f5f5;\n            }\n            \n            .receipt-container {\n              max-width: 600px;\n              margin: 0 auto;\n              background: white;\n              border: 2px solid #000;\n              border-radius: 8px;\n              padding: 0;\n              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            }\n            \n            .receipt-header {\n              text-align: center;\n              border-bottom: 2px solid #000;\n              padding: 20px;\n              background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n              position: relative;\n              min-height: 120px;\n            }\n            \n            .temple-name {\n              font-size: 24px;\n              font-weight: 700;\n              color: #d97706;\n              margin: 10px 0 5px 0;\n              text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n            }\n            \n            .temple-subtitle {\n              font-size: 14px;\n              color: #374151;\n              margin: 5px 0;\n              font-weight: 500;\n            }\n            \n            .receipt-title {\n              font-size: 20px;\n              font-weight: 700;\n              color: #1f2937;\n              margin: 15px 0 5px 0;\n              padding: 8px 16px;\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 4px;\n              display: inline-block;\n            }\n            \n            .receipt-body {\n              padding: 20px;\n            }\n            \n            .receipt-section {\n              margin-bottom: 20px;\n            }\n            \n            .receipt-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 12px;\n              gap: 20px;\n            }\n            \n            .left-item, .right-item {\n              flex: 1;\n              display: flex;\n              align-items: baseline;\n              gap: 8px;\n            }\n            \n            .receipt-label {\n              font-weight: 600;\n              color: #6b7280;\n              white-space: nowrap;\n              min-width: fit-content;\n            }\n            \n            .receipt-value {\n              font-weight: 500;\n              color: #1f2937;\n              flex: 1;\n              text-align: left;\n            }\n            \n            .dravya-section {\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 6px;\n              padding: 16px;\n              margin: 20px 0;\n              text-align: center;\n            }\n            \n            .dravya-title {\n              font-size: 18px;\n              font-weight: 700;\n              color: #92400e;\n              margin-bottom: 8px;\n            }\n            \n            .dravya-description {\n              font-size: 16px;\n              font-weight: 600;\n              color: #1f2937;\n              margin-bottom: 8px;\n            }\n            \n            .dravya-quantity {\n              font-size: 14px;\n              color: #374151;\n              font-style: italic;\n            }\n            \n            .receipt-footer {\n              border-top: 1px solid #e5e7eb;\n              padding: 20px;\n              text-align: center;\n            }\n            \n            .signature-section {\n              display: flex;\n              justify-content: space-between;\n              margin-top: 40px;\n              padding-top: 20px;\n            }\n            \n            .signature-box {\n              text-align: center;\n              flex: 1;\n            }\n            \n            .signature-line {\n              border-bottom: 1px solid #000;\n              width: 150px;\n              margin: 0 auto 10px auto;\n            }\n            \n            .signature-label {\n              font-size: 12px;\n              color: #6b7280;\n              font-weight: 500;\n            }\n            \n            .footer-message {\n              font-size: 14px;\n              color: #6b7280;\n              margin-top: 20px;\n              font-style: italic;\n            }\n            \n            @media print {\n              body { \n                margin: 0; \n                padding: 10px; \n              }\n              .receipt-container {\n                border: 1px solid #000;\n                page-break-inside: avoid;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt-container\">\n            <!-- Header -->\n            <div class=\"receipt-header\" style=\"position: relative;\">\n              <!-- Left Logo - Jain Symbol -->\n              <div style=\"position: absolute; left: 15px; top: 15px;\">\n                <img src=\"/jain-symbol.png\" \n                     alt=\"Jain Symbol\" style=\"width: 60px; height: 60px; object-fit: contain;\">\n              </div>\n              \n              <!-- Right Logo - Temple Building -->\n              <div style=\"position: absolute; right: 15px; top: 15px;\">\n                <img src=\"/temple-logo.png\" \n                     alt=\"Temple Logo\" style=\"width: 60px; height: 60px; object-fit: contain; border-radius: 50%;\">\n              </div>\n              \n              <!-- Center Text -->\n              <div class=\"temple-name\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n              <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§¶‡§Æ‡•ã‡§π ‡§∞‡•ã‡§°, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n              <div class=\"receipt-title\">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n            </div>\n            \n            <!-- Body -->\n            <div class=\"receipt-body\">\n              <!-- Row 1: User Name and Address -->\n              <div class=\"receipt-section\">\n                <div class=\"receipt-row\">\n                  <div class=\"left-item\">\n                    <span class=\"receipt-label\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä:</span>\n                    <span class=\"receipt-value\">${formattedUserName}</span>\n                  </div>\n                  <div class=\"right-item\">\n                    <span class=\"receipt-label\">‡§™‡§§‡§æ:</span>\n                    <span class=\"receipt-value\">${hindiAddress}</span>\n                  </div>\n                </div>\n              </div>\n              \n              <!-- Row 2: Receipt Number and Date -->\n              <div class=\"receipt-section\">\n                <div class=\"receipt-row\">\n                  <div class=\"left-item\">\n                    <span class=\"receipt-label\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                    <span class=\"receipt-value\">${editableData.receiptNumber}</span>\n                  </div>\n                  <div class=\"right-item\">\n                    <span class=\"receipt-label\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                    <span class=\"receipt-value\">${editableData.date}</span>\n                  </div>\n                </div>\n              </div>\n              \n              <!-- Dravya Section -->\n              <div class=\"dravya-section\">\n                <div class=\"dravya-title\">‡§¶‡§æ‡§® ‡§µ‡§∏‡•ç‡§§‡•Å</div>\n                <div class=\"dravya-description\">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§®</div>\n                <div class=\"dravya-quantity\">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ: ${editableData.drayvaSankhya}</div>\n              </div>\n            </div>\n            \n            <!-- Footer -->\n            <div class=\"receipt-footer\">\n              <div class=\"signature-section\">\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\"></div>\n                  <div class=\"signature-label\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\"></div>\n                  <div class=\"signature-label\">‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§™‡•ç‡§∞‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä</div>\n                </div>\n              </div>\n              \n              <div class=\"footer-message\">\n                ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§\n              </div>\n            </div>\n          </div>\n        </body>\n      </html>\n    `;\n  };\n\n  const handleSaveAndPrint = () => {\n    const receiptHTML = generateReceiptHTML();\n    \n    // Create a new window for printing\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(receiptHTML);\n      printWindow.document.close();\n      \n      // Wait for content to load, then print\n      printWindow.onload = () => {\n        setTimeout(() => {\n          printWindow.print();\n        }, 100);\n      };\n      \n      toast({\n        title: \"Success\",\n        description: \"Receipt opened for printing\"\n      });\n    } else {\n      toast({\n        title: \"Error\", \n        description: \"Unable to open print window. Please check popup settings.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" className=\"bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100\">\n          üßæ Hindi Receipt\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Left side - Editable fields */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold\">Edit Receipt Details</h3>\n            \n            <div>\n              <Label htmlFor=\"dharmanuyayi\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä (Editable)</Label>\n              <Input\n                id=\"dharmanuyayi\"\n                value={editableData.dharmanuyayi}\n                onChange={(e) => setEditableData({...editableData, dharmanuyayi: e.target.value})}\n                placeholder=\"Name\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"address\">‡§™‡§§‡§æ (Editable)</Label>\n              <Textarea\n                id=\"address\"\n                value={editableData.address}\n                onChange={(e) => setEditableData({...editableData, address: e.target.value})}\n                placeholder=\"Address\"\n                rows={2}\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"date\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï (Editable)</Label>\n              <Input\n                id=\"date\"\n                value={editableData.date}\n                onChange={(e) => setEditableData({...editableData, date: e.target.value})}\n                placeholder=\"DD/MM/YY\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"drayvaSankhya\">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ (Editable)</Label>\n              <Input\n                id=\"drayvaSankhya\"\n                value={editableData.drayvaSankhya}\n                onChange={(e) => setEditableData({...editableData, drayvaSankhya: e.target.value})}\n                placeholder=\"Quantity\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"receiptNumber\">Receipt Number (Editable)</Label>\n              <Input\n                id=\"receiptNumber\"\n                value={editableData.receiptNumber}\n                onChange={(e) => setEditableData({...editableData, receiptNumber: e.target.value})}\n                placeholder=\"Receipt Number\"\n              />\n            </div>\n          </div>\n          \n          {/* Right side - Preview */}\n          <div className=\"border rounded-lg p-4 bg-gray-50\">\n            <h3 className=\"text-lg font-semibold mb-4\">Receipt Preview</h3>\n            <div \n              className=\"bg-white border rounded scale-75 origin-top-left\"\n              style={{ width: '133%', height: 'auto' }}\n              dangerouslySetInnerHTML={{ __html: generateReceiptHTML() }}\n            />\n          </div>\n        </div>\n        \n        <div className=\"flex justify-end gap-2 mt-6\">\n          <Button variant=\"outline\" onClick={() => setIsOpen(false)}>\n            Cancel\n          </Button>\n          <Button onClick={handleSaveAndPrint} className=\"bg-orange-600 hover:bg-orange-700\">\n            Save & Print Receipt\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":14635},"operator-help-guide.md":{"content":"# ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø - ‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§π‡•á‡§≤‡•ç‡§™ ‡§ó‡§æ‡§á‡§°\n# Operator Help Guide - Account Ledger Management System\n\n## ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä / Table of Contents\n\n1. [‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ì‡§µ‡§∞‡§µ‡•ç‡§Ø‡•Ç / Application Overview](#application-overview)\n2. [‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡§ø‡§Ø‡§æ‡§Ç / Roles and Responsibilities](#roles-and-responsibilities)\n3. [‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•á‡§ú ‡§î‡§∞ ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® / Main Pages and Navigation](#main-pages-and-navigation)\n4. [‡§≤‡•â‡§ó‡§ø‡§® ‡§î‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§∏‡•á‡§ü‡§Ö‡§™ / Login and Initial Setup](#login-and-initial-setup)\n5. [‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Boli Entry Management](#boli-entry-management)\n6. [‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Dravya Entry Management](#dravya-entry-management)\n7. [‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Payment Management](#payment-management)\n8. [‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ / Advance Payment System](#advance-payment-system)\n9. [‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó / Expense Tracking](#expense-tracking)\n10. [‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / User Management](#user-management)\n11. [‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° / Reports and Dashboard](#reports-and-dashboard)\n12. [‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§® / Receipt Generation](#receipt-generation)\n13. [‡§¨‡•à‡§ï‡§Ö‡§™ ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Backup and Data Management](#backup-and-data-management)\n14. [‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® / Common Issues and Solutions](#common-issues-and-solutions)\n\n---\n\n## Application Overview\n\n### ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø / Application Purpose\n‡§Ø‡§π ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç, ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§®, ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó, ‡§î‡§∞ ‡§µ‡§ø‡§§‡•ç‡§§‡•Ä‡§Ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡•á ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§\n\n### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ / Key Features\n- **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§®‡•Ä‡§≤‡§æ‡§Æ‡•Ä/‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó\n- **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ**: ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§¶‡§æ‡§® ‡§ï‡§æ ‡§Ö‡§≤‡§ó ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®\n- **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó**: ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§î‡§∞ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°\n- **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü**: ‡§™‡•Ç‡§∞‡•ç‡§µ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§î‡§∞ ‡§ë‡§ü‡•ã-‡§è‡§™‡•ç‡§≤‡§æ‡§à\n- **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§π‡§ø‡§∏‡§æ‡§¨-‡§ï‡§ø‡§§‡§æ‡§¨\n- **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶‡•á‡§Ç\n- **‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®\n\n---\n\n## Roles and Responsibilities\n\n### 1. Admin (‡§è‡§°‡§Æ‡§ø‡§®)\n- **‡§™‡•Ç‡§∞‡•ç‡§£ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó\n- **‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§®‡§è ‡§Ø‡•Ç‡§ú‡§∞ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§∞‡•ã‡§≤ ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§¨‡•à‡§ï‡§Ö‡§™, ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü/‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•ã ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n\n### 2. Operator (‡§ë‡§™‡§∞‡•á‡§ü‡§∞)\n- **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§¨‡•ã‡§≤‡•Ä, ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø, ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ/‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§∞‡§∏‡•Ä‡§¶‡•á‡§Ç ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§ï‡•á‡§µ‡§≤ ‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡•Ç‡§Ö‡§∞ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n\n### 3. Viewer (‡§µ‡•ç‡§Ø‡•Ç‡§Ö‡§∞)\n- **‡§ï‡•á‡§µ‡§≤ ‡§¶‡•á‡§ñ‡§®‡§æ**: ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§ï‡•ã‡§à ‡§è‡§°‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§®‡§π‡•Ä‡§Ç**: ‡§°‡•á‡§ü‡§æ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á\n\n---\n\n## Main Pages and Navigation\n\n### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç / Main Navigation Menu\n\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° / Dashboard** - ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®, ‡§∏‡§≠‡•Ä ‡§Ü‡§Ç‡§ï‡§°‡§º‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂\n2. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú / Boli Entries** - ‡§®‡•Ä‡§≤‡§æ‡§Æ‡•Ä/‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n3. **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú / Dravya Entries** - ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§¶‡§æ‡§® ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n4. **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ / Expenses** - ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n5. **‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / User Management** - ‡§Ø‡•Ç‡§ú‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® (‡§è‡§°‡§Æ‡§ø‡§®/‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è)\n6. **‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ / Reports** - ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§µ‡•ç‡§Ø‡•Ç\n\n### ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ / Sidebar Features\n- **‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç**: ‡§ä‡§™‡§∞‡•Ä ‡§¶‡§æ‡§è‡§Ç ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç\n- **‡§≤‡•â‡§ó‡§Ü‡§â‡§ü**: ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§∏‡•á\n- **‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§®**: ‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\n\n---\n\n## Login and Initial Setup\n\n### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ / Login Process\n\n1. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ñ‡•ã‡§≤‡•á‡§Ç**: Chrome, Firefox, ‡§Ø‡§æ Safari ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç\n2. **URL ‡§°‡§æ‡§≤‡•á‡§Ç**: ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§µ‡•á‡§¨ ‡§è‡§°‡•ç‡§∞‡•á‡§∏\n3. **‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•á‡§ú**: ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç\n4. **‡§≤‡•â‡§ó‡§ø‡§® ‡§¨‡§ü‡§®**: \"Sign In\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç\n\n### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§ï‡§æ ‡§∏‡•á‡§ü‡§Ö‡§™ / First Time Setup\n\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**: ‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§â‡§Ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§Ü‡§Ç‡§ï‡§°‡§º‡•á ‡§¶‡•á‡§ñ‡•á‡§Ç\n2. **‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§°‡•á‡§ü**: ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç\n3. **‡§™‡•á‡§∞‡•ç‡§Æ‡§ø‡§∂‡§® ‡§ö‡•á‡§ï**: ‡§Ü‡§™‡§ï‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ\n\n---\n\n## Boli Entry Management\n\n### ‡§®‡§à ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§®‡§æ / Creating New Boli Entry\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤‡§®‡§æ\n1. **\"Boli Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"+ New Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡§®‡§æ\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç**: \n   - ‡§∏‡§∞‡•ç‡§ö ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç\n   - ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n   - ‡§Ö‡§ó‡§∞ ‡§Ø‡•Ç‡§ú‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ ‡§§‡•ã \"Add New User\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç\n\n2. **‡§®‡§è ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è**:\n   - ‡§®‡§æ‡§Æ (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n   - ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n   - ‡§™‡§§‡§æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n   - \"Create User\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§¨‡•ã‡§≤‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡§®‡§æ\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£**: ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§™‡•Ç‡§∞‡•ç‡§µ-‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç\n2. **‡§∞‡§æ‡§∂‡§ø**: ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‡§∞‡•Å‡§™‡§è ‡§Æ‡•á‡§Ç)\n3. **‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï**: ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§∏‡•á ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç\n4. **‡§Ö‡§µ‡§∏‡§∞**: ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 4: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Save Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∏‡§´‡§≤ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ‡•á‡§∂‡§® ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n### ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§®‡§æ ‡§î‡§∞ ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡§®‡§æ / Viewing and Editing Boli Entries\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¶‡•á‡§ñ‡§®‡§æ\n1. **\"Boli Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§∏‡§≠‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä**\n3. **‡§∏‡§∞‡•ç‡§ö ‡§î‡§∞ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§¶‡•á‡§ñ‡§®‡§æ\n1. **‡§ï‡§ø‡§∏‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ** ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç:\n   - ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\n   - ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏\n   - ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä\n   - ‡§è‡§ï‡•ç‡§∂‡§® ‡§¨‡§ü‡§®‡•ç‡§∏\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡§®‡§æ\n1. **\"Edit Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç**\n3. **\"Update Entry\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó / Payment Status Tracking\n\n#### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:\n- **Pending**: ‡§ï‡•ã‡§à ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü\n- **Partial**: ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§π‡•Å‡§Ü\n- **Full**: ‡§™‡•Ç‡§∞‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§π‡•ã ‡§ó‡§Ø‡§æ\n\n#### ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ:\n1. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡§≤‡§∞ ‡§ï‡•ã‡§°‡§ø‡§Ç‡§ó ‡§¶‡•á‡§ñ‡•á‡§Ç**:\n   - ‡§≤‡§æ‡§≤ = Pending\n   - ‡§™‡•Ä‡§≤‡§æ = Partial\n   - ‡§π‡§∞‡§æ = Full\n2. **‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç**\n\n---\n\n## Dravya Entry Management\n\n### ‡§®‡§à ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§®‡§æ / Creating New Dravya Entry\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ\n1. **\"Dravya Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"+ New Dravya Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡§®‡§æ\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**: ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§§‡§∞‡§π\n2. **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞**: ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç\n3. **‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ**: ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ\n4. **‡§µ‡§ø‡§µ‡§∞‡§£**: ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n5. **‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **\"Save Dravya Entry\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§∏‡§´‡§≤ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ‡•á‡§∂‡§® ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ**\n\n### ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Dravya Entry Management\n\n#### ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¶‡•á‡§ñ‡§®‡§æ:\n1. **\"Dravya Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§∏‡§≠‡•Ä ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•Ä**\n3. **‡§∏‡§∞‡•ç‡§ö ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§è‡§°‡§ø‡§ü/‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ:\n1. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Edit\" ‡§Ø‡§æ \"Delete\" ‡§¨‡§ü‡§® ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã‡§Ç‡§ó‡•á**\n\n---\n\n## Payment Management\n\n### ‡§®‡§Ø‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording New Payment\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§ñ‡•ã‡§≤‡•á‡§Ç**\n2. **\"Add Payment\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡§®‡§æ\n1. **‡§∞‡§æ‡§∂‡§ø**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø (‡§™‡•Ç‡§∞‡•Ä ‡§Ø‡§æ ‡§Ü‡§Ç‡§∂‡§ø‡§ï)\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•ã‡§°**: \n   - Cash (‡§®‡§ï‡§¶)\n   - Bank Transfer (‡§¨‡•à‡§Ç‡§ï ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§∏‡§´‡§∞)\n   - UPI\n   - Cheque (‡§ö‡•á‡§ï)\n   - Other (‡§Ö‡§®‡•ç‡§Ø)\n3. **‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n4. **‡§®‡•ã‡§ü‡•ç‡§∏**: ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Record Payment\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§π‡•ã‡§ó‡§æ**\n4. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ**\n\n### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§®‡§æ / Viewing Payment History\n\n#### ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡•á‡§µ‡§≤ ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä:\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"Payment History\" ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•Ä**\n3. **‡§π‡§∞ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ë‡§™‡•ç‡§∂‡§® ‡§π‡•ã‡§ó‡§æ**\n\n#### ‡§ì‡§µ‡§∞‡§ë‡§≤ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó:\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡§Æ‡§∞‡•Ä ‡§î‡§∞ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§µ‡•ç‡§Ø‡•Ç ‡§¶‡•á‡§ñ‡•á‡§Ç**\n\n---\n\n## Advance Payment System\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording Advance Payment\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä\n1. **\"Boli Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"+ Advance Payment\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§∞‡§æ‡§∂‡§ø ‡§°‡§æ‡§≤‡•á‡§Ç**\n3. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•ã‡§° ‡§ö‡•Å‡§®‡•á‡§Ç**\n4. **‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§î‡§∞ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§≠‡§∞‡•á‡§Ç**\n5. **\"Record Advance Payment\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ / Checking Advance Balance\n\n#### ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏:\n1. **‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø**\n2. **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n3. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§ü‡•ã‡§ü‡§≤ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ë‡§ü‡•ã-‡§è‡§™‡•ç‡§≤‡§æ‡§à / Auto-Apply Advance Payment\n\n#### ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§®:\n1. **‡§®‡§à ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§§‡•á ‡§∏‡§Æ‡§Ø**\n2. **‡§Ö‡§ó‡§∞ ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§π‡•à**\n3. **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§è‡§™‡•ç‡§≤‡§æ‡§à ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§ë‡§™‡•ç‡§∂‡§® ‡§¶‡•á‡§ó‡§æ**\n\n#### ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§®:\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"Apply Advance\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∞‡§æ‡§∂‡§ø ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n## Expense Tracking\n\n### ‡§®‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording New Expense\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§´‡•â‡§∞‡•ç‡§Æ\n1. **\"Expenses\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"+ New Expense\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏\n1. **‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞\n2. **‡§µ‡§ø‡§µ‡§∞‡§£**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£\n3. **‡§∞‡§æ‡§∂‡§ø**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø\n4. **‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n5. **‡§∞‡§∏‡•Ä‡§¶ ‡§Ö‡§™‡§≤‡•ã‡§°**: ‡§∞‡§∏‡•Ä‡§¶ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã/PDF (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **\"Save Expense\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n### ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Expense Management\n\n#### ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¶‡•á‡§ñ‡§®‡§æ:\n1. **\"Expenses\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§∏‡§≠‡•Ä ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏‡•á‡§∏ ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•Ä**\n2. **‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n3. **‡§°‡•á‡§ü ‡§∞‡•á‡§Ç‡§ú ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n\n#### ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§è‡§°‡§ø‡§ü/‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ:\n1. **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Edit\" ‡§Ø‡§æ \"Delete\" ‡§ë‡§™‡•ç‡§∂‡§® ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ**\n\n---\n\n## User Management\n\n### ‡§®‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞ ‡§¨‡§®‡§æ‡§®‡§æ / Creating New User\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü ‡§™‡•á‡§ú\n1. **\"User Management\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç** (‡§è‡§°‡§Æ‡§ø‡§®/‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è)\n2. **\"+ Add User\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡§®‡§æ\n1. **‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ**: ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡•Ç‡§®‡•Ä‡§ï ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ\n2. **‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°**: ‡§∏‡•ç‡§ü‡•ç‡§∞‡•â‡§®‡•ç‡§ó ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°\n3. **‡§®‡§æ‡§Æ**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ\n4. **‡§∞‡•ã‡§≤ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**:\n   - Admin (‡§ï‡•á‡§µ‡§≤ Admin ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)\n   - Operator\n   - Viewer\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **\"Create User\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§®‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n### ‡§Ø‡•Ç‡§ú‡§∞ ‡§∞‡•ã‡§≤ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / User Role Management\n\n#### ‡§∞‡•ã‡§≤ ‡§¨‡§¶‡§≤‡§®‡§æ:\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Edit\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§®‡§Ø‡§æ ‡§∞‡•ã‡§≤ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n4. **\"Update User\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§∏‡•á‡§¨‡§≤/‡§á‡§®‡•á‡§¨‡§≤ ‡§ï‡§∞‡§®‡§æ:\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•Ä ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Disable/Enable\" ‡§¨‡§ü‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§¨‡§≤‡•ç‡§ï ‡§Ø‡•Ç‡§ú‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° / Bulk User Upload\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§ü‡•á‡§Æ‡•ç‡§™‡§≤‡•á‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°\n1. **\"Download Template\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **Excel ‡§´‡§æ‡§á‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã‡§ó‡•Ä**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§°‡•á‡§ü‡§æ ‡§≠‡§∞‡§®‡§æ\n1. **Excel ‡§´‡§æ‡§á‡§≤ ‡§ñ‡•ã‡§≤‡•á‡§Ç**\n2. **‡§∏‡§≠‡•Ä ‡§ï‡•â‡§≤‡§Æ ‡§≠‡§∞‡•á‡§Ç**: ‡§®‡§æ‡§Æ, ‡§´‡•ã‡§®, ‡§™‡§§‡§æ\n3. **‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ\n1. **\"Upload Users\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§≠‡§∞‡•Ä ‡§π‡•Å‡§à Excel ‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n3. **\"Upload\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n4. **‡§∏‡§´‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ø‡•Ç‡§ú‡§∞‡•ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á**\n\n---\n\n## Reports and Dashboard\n\n### ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ì‡§µ‡§∞‡§µ‡•ç‡§Ø‡•Ç / Dashboard Overview\n\n#### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏:\n1. **‡§ü‡•ã‡§ü‡§≤ ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü**: ‡§∏‡§≠‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡§æ ‡§ï‡•Å‡§≤\n2. **‡§∞‡§ø‡§∏‡•Ä‡§µ‡•ç‡§° ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü**: ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®\n3. **‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü**: ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø\n4. **‡§ü‡•ã‡§ü‡§≤ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú**: ‡§ï‡•Å‡§≤ ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú\n\n#### ‡§ï‡•ç‡§µ‡§ø‡§ï ‡§∏‡•ç‡§ü‡•á‡§ü‡•ç‡§∏:\n1. **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏**: ‡§ï‡•Å‡§≤ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§∞‡§æ‡§∂‡§ø\n2. **‡§Ü‡§ú ‡§ï‡•á ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏**: ‡§Ü‡§ú ‡§ï‡•á ‡§≠‡•Å‡§ó‡§§‡§æ‡§®\n3. **‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏**: ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§≠‡•Å‡§ó‡§§‡§æ‡§®\n\n### ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§µ‡•ç‡§Ø‡•Ç / Calendar View\n\n#### ‡§°‡•á‡§≤‡•Ä ‡§Ö‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞:\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ \"Daily Earnings\" ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç**\n2. **‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§Ö‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä**\n3. **‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§°‡§ø‡§ü‡•á‡§≤ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n\n#### ‡§°‡•á‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞:\n1. **\"Daily Payments\" ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§Ö‡§≤‡§ó ‡§∏‡•á ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n2. **‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•á ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä**\n\n### ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ / Reports Access\n\n#### ‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü:\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ \"View User Details\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§∏‡§≠‡•Ä ‡§Ø‡•Ç‡§ú‡§∞‡•ç‡§∏ ‡§ï‡•Ä ‡§∏‡§Æ‡§∞‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä**\n3. **‡§π‡§∞ ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§≤ ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü, ‡§™‡•á‡§° ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü, ‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n#### ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞‡•ç‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏:\n1. **‡§°‡•á‡§ü ‡§∞‡•á‡§Ç‡§ú ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n## Receipt Generation\n\n### ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§∏‡•Ä‡§¶ / Boli Payment Receipt\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§Ç**\n3. **‡§ï‡§ø‡§∏‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è \"Print Receipt\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§∞‡§∏‡•Ä‡§¶ ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡§®‡§æ\n1. **‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n2. **‡§è‡§°‡§ø‡§ü‡•á‡§¨‡§≤ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏**:\n   - ‡§∞‡•á‡§´‡§∞‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n   - ‡§¨‡•á‡§¶‡•Ä ‡§®‡§Ç‡§¨‡§∞\n   - ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n   - ‡§¨‡•ã‡§≤‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£\n   - ‡§Ö‡§µ‡§∏‡§∞\n3. **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§®‡§æ\n1. **\"Print\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **A5 ‡§∏‡§æ‡§á‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§π‡•ã‡§ó‡•Ä**\n3. **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§∞‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§π‡•ã‡§ó‡•Ä**\n\n### ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∞‡§∏‡•Ä‡§¶ / Dravya Receipt\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡§∞‡•á‡§∂‡§®\n1. **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§ï‡§ø‡§∏‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è \"Print Receipt\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§ø‡§Ç‡§ó\n1. **‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§¶‡•á‡§ñ‡•á‡§Ç**\n2. **A4 ‡§∏‡§æ‡§á‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§∞‡§∏‡•Ä‡§¶ ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä**\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§∏‡•Ä‡§¶ / Advance Payment Receipt\n\n#### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®:\n1. **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶**\n2. **\"Print Advance Receipt\" ‡§ë‡§™‡•ç‡§∂‡§® ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ**\n3. **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§π‡•ã‡§ó‡•Ä**\n\n### ‡§∞‡§∏‡•Ä‡§¶ ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ / Receipt Features\n\n#### ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞‡§ø‡§Ç‡§ó:\n- **‡§Ø‡•Ç‡§®‡§ø‡§´‡§æ‡§á‡§° ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ**: SPDJMSJ-YYYY-NNNNN ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü\n- **‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§∞‡§∏‡•Ä‡§¶‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•Ä‡§ï‡•ç‡§µ‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤ ‡§®‡§Ç‡§¨‡§∞‡§ø‡§Ç‡§ó**\n\n#### ‡§∞‡§∏‡•Ä‡§¶ ‡§è‡§≤‡§ø‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏:\n1. **‡§π‡•á‡§°‡§∞**: ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§≤‡•ã‡§ó‡•ã\n2. **‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏**: ‡§®‡§æ‡§Æ, ‡§™‡§§‡§æ\n3. **‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞ ‡§î‡§∞ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï**\n4. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏**: ‡§∞‡§æ‡§∂‡§ø, ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•ã‡§°\n5. **‡§´‡•Å‡§ü‡§∞**: ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§∏‡•ç‡§•‡§æ‡§® ‡§î‡§∞ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶ ‡§∏‡§Ç‡§¶‡•á‡§∂\n\n---\n\n## Backup and Data Management\n\n### ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§¨‡•à‡§ï‡§Ö‡§™ / Database Backup\n\n#### ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§¨‡•à‡§ï‡§Ö‡§™:\n1. **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∞‡•ã‡§ú‡§º‡§æ‡§®‡§æ ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à**\n2. **‡§¨‡•à‡§ï‡§Ö‡§™ ‡§´‡§æ‡§á‡§≤‡•ç‡§∏ server ‡§™‡§∞ ‡§∏‡•ç‡§ü‡•ã‡§∞ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç**\n3. **‡§è‡§°‡§Æ‡§ø‡§® ‡§ï‡•ã ‡§à‡§Æ‡•á‡§≤ ‡§∏‡•á ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§≠‡•á‡§ú‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à**\n\n#### ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§¨‡•à‡§ï‡§Ö‡§™:\n1. **‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§è‡§Ç**\n2. **\"Create Backup\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§¨‡•à‡§ï‡§Ö‡§™ ‡§´‡§æ‡§á‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã‡§ó‡•Ä**\n\n### ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü / Data Export\n\n#### ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü:\n1. **‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•á‡§ú ‡§™‡§∞ \"Export to Excel\" ‡§¨‡§ü‡§® ‡§π‡•ã‡§ó‡§æ**\n2. **‡§´‡§ø‡§≤‡•ç‡§ü‡§∞‡•ç‡§° ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n3. **‡§∏‡§≠‡•Ä ‡§ï‡•â‡§≤‡§Æ‡•ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ**\n\n#### ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü:\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§ï‡•ã PDF ‡§Æ‡•á‡§Ç ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n2. **‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§µ‡•ç‡§Ø‡•Ç ‡§ï‡•ã ‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n\n---\n\n## Common Issues and Solutions\n\n### ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç / Common Problems\n\n#### 1. ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ / Login Issues\n**‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ**: ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ ‡§∞‡§π‡§æ\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n- ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç\n- Caps Lock ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç\n- ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡§æ ‡§ï‡•à‡§∂ ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç\n- ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Æ‡§æ‡§Ç‡§ó‡•á‡§Ç\n\n#### 2. ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡§æ / Page Not Loading\n**‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ**: ‡§™‡•á‡§ú ‡§ñ‡•Å‡§≤‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n- ‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç\n- ‡§™‡•á‡§ú ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç (F5 ‡§¶‡§¨‡§æ‡§è‡§Ç)\n- ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§ï‡•á ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ñ‡•ã‡§≤‡•á‡§Ç\n- ‡§¶‡•Ç‡§∏‡§∞‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç\n\n#### 3. ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡•Ä / Receipt Not Printing\n**‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ**: ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡•Ä\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n- ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§∞ ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç\n- ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•á‡§™‡§∞ ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç\n- ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡•á ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç\n- ‡§™‡•á‡§™‡§∞ ‡§∏‡§æ‡§á‡§ú‡§º ‡§∏‡§π‡•Ä ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (A5 ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è, A4 ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è)\n\n#### 4. ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡§æ / Data Not Saving\n**‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡•Ä\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n- ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§≠‡§∞‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç\n- ‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§∏‡•ç‡§•‡§ø‡§∞ ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç\n- ‡§´‡•â‡§∞‡•ç‡§Æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§≠‡§∞‡§ï‡§∞ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç\n- ‡§™‡•á‡§ú ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡§ï‡•á ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç\n\n#### 5. ‡§ó‡§≤‡§§ ‡§°‡•á‡§ü‡§æ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä / Wrong Data Entry\n**‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ**: ‡§ó‡§≤‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞ ‡§¶‡•Ä\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n- ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç\n- ‡§Ö‡§ó‡§∞ ‡§è‡§°‡§ø‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§§‡•ã ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç\n- ‡§®‡§à ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§ï‡§∞ ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§°‡§ø‡§∏‡•á‡§¨‡§≤ ‡§ï‡§∞‡§µ‡§æ‡§è‡§Ç\n\n### ‡§™‡§∞‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§Ç‡§∏ ‡§ë‡§™‡•ç‡§ü‡§ø‡§Æ‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§® / Performance Optimization\n\n#### ‡§¨‡•á‡§π‡§§‡§∞ ‡§™‡§∞‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è:\n1. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡•à‡§∂ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§è‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§∏‡§æ‡§∞‡•á ‡§ü‡•à‡§¨‡•ç‡§∏ ‡§® ‡§ñ‡•ã‡§≤‡•á‡§Ç**\n3. **‡§∏‡•ç‡§ü‡•á‡§¨‡§≤ ‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n4. **‡§Ö‡§™‡§°‡•á‡§ü‡•á‡§° ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§î‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï / Help and Support\n\n#### ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è:\n1. **‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç**\n3. **‡§è‡§∞‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ï‡•ã ‡§®‡•ã‡§ü ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§î‡§∞ ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä / Backup and Recovery\n\n#### ‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ:\n1. **‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§≤‡•á‡§§‡•á ‡§∞‡§π‡•á‡§Ç**\n2. **‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§Ö‡§≤‡§ó ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∞‡§ñ‡•á‡§Ç**\n3. **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§¨‡§®‡§æ‡§è‡§Ç**\n\n---\n\n## ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä / Contact Information\n\n### ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ / Technical Support\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§è‡§°‡§Æ‡§ø‡§®**: [‡§è‡§°‡§Æ‡§ø‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï]\n- **‡§à‡§Æ‡•á‡§≤**: [‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§à‡§Æ‡•á‡§≤]\n- **‡§´‡•ã‡§®**: [‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞]\n\n### ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§î‡§∞ ‡§´‡•Ä‡§°‡§¨‡•à‡§ï / Suggestions and Feedback\n- **‡§®‡§à ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç**\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡•á ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§≠‡•á‡§ú‡•á‡§Ç**\n- **‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§π‡•ã ‡§§‡•ã ‡§¨‡§§‡§æ‡§è‡§Ç**\n\n---\n\n**‡§Ø‡§π ‡§ó‡§æ‡§á‡§° ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§µ‡§∞‡•ç‡§ú‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§**\n\n**This guide is regularly updated. Contact admin for the latest version.**","size_bytes":32310},"local-deployment/client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/pwa-install-prompt.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Download, X } from \"lucide-react\";\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\nexport function PWAInstallPrompt() {\n  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\n\n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e: Event) => {\n      // Prevent Chrome 67 and earlier from automatically showing the prompt\n      e.preventDefault();\n      // Stash the event so it can be triggered later\n      setDeferredPrompt(e as BeforeInstallPromptEvent);\n      setShowInstallPrompt(true);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n\n    // Check if app is already installed\n    window.addEventListener('appinstalled', () => {\n      setShowInstallPrompt(false);\n      setDeferredPrompt(null);\n    });\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    };\n  }, []);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) return;\n\n    // Show the install prompt\n    deferredPrompt.prompt();\n    \n    // Wait for the user to respond to the prompt\n    const { outcome } = await deferredPrompt.userChoice;\n    \n    if (outcome === 'accepted') {\n      console.log('User accepted the install prompt');\n    } else {\n      console.log('User dismissed the install prompt');\n    }\n    \n    setDeferredPrompt(null);\n    setShowInstallPrompt(false);\n  };\n\n  const handleDismiss = () => {\n    setShowInstallPrompt(false);\n  };\n\n  if (!showInstallPrompt || !deferredPrompt) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 right-4 z-50 md:left-auto md:right-4 md:w-80\">\n      <Card className=\"border-2 border-emerald-200 bg-emerald-50 shadow-lg\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-start justify-between mb-2\">\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-emerald-800 text-sm\">\n                Install Daan Darpan App\n              </h3>\n              <p className=\"text-xs text-emerald-700 mt-1\">\n                Add to your home screen for quick access\n              </p>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\" \n              onClick={handleDismiss}\n              className=\"h-6 w-6 p-0 text-emerald-600 hover:text-emerald-800\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button\n              onClick={handleInstallClick}\n              size=\"sm\"\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white flex-1\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Install\n            </Button>\n            <Button\n              onClick={handleDismiss}\n              variant=\"outline\" \n              size=\"sm\"\n              className=\"border-emerald-300 text-emerald-700 hover:bg-emerald-100\"\n            >\n              Not Now\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":3416},"server/temp-fix.ts":{"content":"// This file contains all the necessary fixes for the routes\n// Operator should have access to all data like admin, no Users page visibility\n// Admin should have edit/delete capabilities for payment records and entries\n\n// Fix for /api/entries endpoint\nexport const entriesGetFix = `\n  app.get(\"/api/entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      let entries;\n      \n      if (user.role === \"admin\" || user.role === \"operator\") {\n        entries = await storage.getEntries();\n      } else {\n        entries = await storage.getUserEntries(user.id);\n      }\n      \n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entries\" });\n    }\n  });\n`;\n\n// Fix for the dashboard endpoint\nexport const dashboardGetFix = `\n  app.get(\"/api/dashboard\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Dashboard should be accessible to admins and operators\n      if (user.role === \"admin\" || user.role === \"operator\") {\n        // Get all entries for stats\n        const entries = await storage.getEntries();\n        \n        // Calculate summary stats\n        const summary = {\n          totalAmount: 0,\n          receivedAmount: 0,\n          pendingAmount: 0,\n          pendingEntries: 0,\n          partialEntries: 0,\n          completedEntries: 0\n        };\n        \n        const recentActivity = [];\n        \n        // Only keep 5 most recent entries for the recent activity feed\n        entries.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n        \n        for (const entry of entries) {\n          // Update summary stats\n          summary.totalAmount += entry.totalAmount;\n          \n          const receivedAmount = entry.payments.reduce((total, payment) => total + payment.amount, 0);\n          summary.receivedAmount += receivedAmount;\n          \n          const pendingAmount = entry.totalAmount - receivedAmount;\n          summary.pendingAmount += pendingAmount;\n          \n          // Count entries by status\n          if (entry.status === \"pending\") {\n            summary.pendingEntries++;\n          } else if (entry.status === \"partial\") {\n            summary.partialEntries++;\n          } else if (entry.status === \"full\") {\n            summary.completedEntries++;\n          }\n          \n          // Add to recent activity if we have less than 5 entries\n          if (recentActivity.length < 5) {\n            recentActivity.push(entry);\n          }\n        }\n        \n        res.json({\n          summary,\n          recentActivity\n        });\n      } else {\n        // For regular users, only show their own entries\n        const entries = await storage.getUserEntries(user.id);\n        \n        // Calculate summary stats for just this user\n        const summary = {\n          totalAmount: 0,\n          receivedAmount: 0,\n          pendingAmount: 0,\n          pendingEntries: 0,\n          partialEntries: 0,\n          completedEntries: 0\n        };\n        \n        // Sort by updated date descending\n        entries.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n        \n        for (const entry of entries) {\n          // Update summary stats\n          summary.totalAmount += entry.totalAmount;\n          \n          const receivedAmount = entry.payments.reduce((total, payment) => total + payment.amount, 0);\n          summary.receivedAmount += receivedAmount;\n          \n          const pendingAmount = entry.totalAmount - receivedAmount;\n          summary.pendingAmount += pendingAmount;\n          \n          // Count entries by status\n          if (entry.status === \"pending\") {\n            summary.pendingEntries++;\n          } else if (entry.status === \"partial\") {\n            summary.partialEntries++;\n          } else if (entry.status === \"full\") {\n            summary.completedEntries++;\n          }\n        }\n        \n        // Only send back up to 5 entries for recent activity\n        const recentActivity = entries.slice(0, 5);\n        \n        res.json({\n          summary,\n          recentActivity\n        });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch dashboard data\" });\n    }\n  });\n`;","size_bytes":4284},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3835},"client/src/components/advance-payment-receipt.tsx":{"content":"import { useRef, useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Printer, Save, X } from \"lucide-react\";\n\ninterface AdvancePayment {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile?: string;\n  userAddress?: string;\n  date: string;\n  amount: number;\n  paymentMode: string;\n  receiptNo?: string;\n  createdBy: string;\n  createdAt: string;\n}\n\ninterface AdvancePaymentReceiptProps {\n  advancePayment: AdvancePayment;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\n// Local storage key for saved values\nconst SAVED_VALUES_KEY = 'advance_receipt_saved_values';\n\n// Interface for saved values\ninterface SavedValues {\n  referredBy: string;\n  recordedBy: string;\n}\n\n// Function to get payment mode in Hindi\nconst getPaymentModeHindi = (mode: string): string => {\n  const modeMap: { [key: string]: string } = {\n    'cash': '‡§®‡§ó‡§¶',\n    'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à',\n    'cheque': '‡§ö‡•á‡§ï',\n    'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó'\n  };\n  return modeMap[mode.toLowerCase()] || mode;\n};\n\n// Function to convert English names to Hindi (enhanced transliteration)\nconst convertNameToHindi = (name: string): string => {\n  if (!name) return name;\n  \n  // Comprehensive name mappings\n  const nameMap: { [key: string]: string } = {\n    // Common names\n    'shailesh': '‡§∂‡•à‡§≤‡•á‡§∂',\n    'aashi': '‡§Ü‡§∂‡•Ä',\n    'raj': '‡§∞‡§æ‡§ú',\n    'rajesh': '‡§∞‡§æ‡§ú‡•á‡§∂',\n    'suresh': '‡§∏‡•Å‡§∞‡•á‡§∂',\n    'ramesh': '‡§∞‡§Æ‡•á‡§∂',\n    'mukesh': '‡§Æ‡•Å‡§ï‡•á‡§∂',\n    'dinesh': '‡§¶‡§ø‡§®‡•á‡§∂',\n    'mahesh': '‡§Æ‡§π‡•á‡§∂',\n    'naresh': '‡§®‡§∞‡•á‡§∂',\n    'rakesh': '‡§∞‡§æ‡§ï‡•á‡§∂',\n    'umesh': '‡§â‡§Æ‡•á‡§∂',\n    'yogesh': '‡§Ø‡•ã‡§ó‡•á‡§∂',\n    'ritesh': '‡§∞‡§ø‡§§‡•á‡§∂',\n    'hitesh': '‡§π‡§ø‡§§‡•á‡§∂',\n    'nilesh': '‡§®‡•Ä‡§≤‡•á‡§∂',\n    'pradip': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'pradeep': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'deepak': '‡§¶‡•Ä‡§™‡§ï',\n    'deepika': '‡§¶‡•Ä‡§™‡§ø‡§ï‡§æ',\n    'priya': '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ',\n    'pooja': '‡§™‡•Ç‡§ú‡§æ',\n    'manish': '‡§Æ‡§®‡•Ä‡§∑',\n    'ashish': '‡§Ü‡§∂‡•Ä‡§∑',\n    'sanjay': '‡§∏‡§Ç‡§ú‡§Ø',\n    'ajay': '‡§Ö‡§ú‡§Ø',\n    'vijay': '‡§µ‡§ø‡§ú‡§Ø',\n    'ravi': '‡§∞‡§µ‡§ø',\n    'kiran': '‡§ï‡§ø‡§∞‡§£',\n    'aman': '‡§Ö‡§Æ‡§®',\n    'arun': '‡§Ö‡§∞‡•Å‡§£',\n    'anita': '‡§Ö‡§®‡•Ä‡§§‡§æ',\n    'sunita': '‡§∏‡•Å‡§®‡•Ä‡§§‡§æ',\n    'rekha': '‡§∞‡•á‡§ñ‡§æ',\n    'meera': '‡§Æ‡•Ä‡§∞‡§æ',\n    'seeta': '‡§∏‡•Ä‡§§‡§æ',\n    'geeta': '‡§ó‡•Ä‡§§‡§æ',\n    'rita': '‡§∞‡•Ä‡§§‡§æ',\n    'kavita': '‡§ï‡§µ‡§ø‡§§‡§æ',\n    'savita': '‡§∏‡§µ‡§ø‡§§‡§æ',\n    'mamta': '‡§Æ‡§Æ‡§§‡§æ',\n    'sushma': '‡§∏‡•Å‡§∑‡•ç‡§Æ‡§æ',\n    'krishna': '‡§ï‡•É‡§∑‡•ç‡§£‡§æ',\n    'radha': '‡§∞‡§æ‡§ß‡§æ',\n    'shanti': '‡§∂‡§æ‡§Ç‡§§‡§ø',\n    'bharti': '‡§≠‡§æ‡§∞‡§§‡•Ä',\n    'aarti': '‡§Ü‡§∞‡§§‡•Ä',\n    'sanskar': '‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    \n    // Surnames\n    'jain': '‡§ú‡•à‡§®',\n    'sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n    'kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n    'singh': '‡§∏‡§ø‡§Ç‡§π',\n    'gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n    'agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'agrawal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'shah': '‡§∂‡§æ‡§π',\n    'patel': '‡§™‡§ü‡•á‡§≤',\n    'mehta': '‡§Æ‡•á‡§π‡§§‡§æ',\n    'modi': '‡§Æ‡•ã‡§¶‡•Ä',\n    'verma': '‡§µ‡§∞‡•ç‡§Æ‡§æ',\n    'tiwari': '‡§§‡§ø‡§µ‡§æ‡§∞‡•Ä',\n    'pandey': '‡§™‡§æ‡§Ç‡§°‡•á',\n    'mishra': '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§æ',\n    'yadav': '‡§Ø‡§æ‡§¶‡§µ',\n    'soni': '‡§∏‡•ã‡§®‡•Ä',\n    'goel': '‡§ó‡•ã‡§Ø‡§≤',\n    'goyal': '‡§ó‡•ã‡§Ø‡§≤',\n    'bansal': '‡§¨‡§Ç‡§∏‡§≤',\n    'mittal': '‡§Æ‡§ø‡§§‡•ç‡§§‡§≤',\n    'singhal': '‡§∏‡§ø‡§Ç‡§ò‡§≤',\n    'jindal': '‡§ú‡§ø‡§Ç‡§¶‡§≤',\n    'chopra': '‡§ö‡•ã‡§™‡§°‡§º‡§æ',\n    'kapoor': '‡§ï‡§™‡•Ç‡§∞',\n    'malhotra': '‡§Æ‡§≤‡•ç‡§π‡•ã‡§§‡•ç‡§∞‡§æ',\n    'khanna': '‡§ñ‡§®‡•ç‡§®‡§æ',\n    'arora': '‡§Ö‡§∞‡•ã‡§°‡§º‡§æ',\n    'bhatia': '‡§≠‡§æ‡§ü‡§ø‡§Ø‡§æ',\n    'sethi': '‡§∏‡•á‡§†‡•Ä',\n    'tandon': '‡§ü‡§Ç‡§°‡§®',\n    'saxena': '‡§∏‡§ï‡•ç‡§∏‡•á‡§®‡§æ',\n    'srivastava': '‡§∂‡•ç‡§∞‡•Ä‡§µ‡§æ‡§∏‡•ç‡§§‡§µ',\n    'mathur': '‡§Æ‡§æ‡§•‡•Å‡§∞',\n    'chandra': '‡§ö‡§Ç‡§¶‡•ç‡§∞',\n    'prakash': '‡§™‡•ç‡§∞‡§ï‡§æ‡§∂',\n    \n    // Titles\n    'shree': '‡§∂‡•ç‡§∞‡•Ä',\n    'shri': '‡§∂‡•ç‡§∞‡•Ä',\n    'smt': '‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä',\n    'mr': '‡§∂‡•ç‡§∞‡•Ä',\n    'mrs': '‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä',\n    'ms': '‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä',\n    'dr': '‡§°‡•â',\n    'prof': '‡§™‡•ç‡§∞‡•ã'\n  };\n  \n  // Split name into words and process each\n  const words = name.toLowerCase().trim().split(/\\s+/);\n  const hindiWords = words.map(word => {\n    // Remove punctuation for mapping lookup\n    const cleanWord = word.replace(/[.,!?;:]/g, '');\n    \n    // Check direct mapping\n    if (nameMap[cleanWord]) {\n      return nameMap[cleanWord];\n    }\n    \n    // Check partial matches for compound names\n    for (const [eng, hindi] of Object.entries(nameMap)) {\n      if (cleanWord.includes(eng) && eng.length > 2) {\n        return hindi;\n      }\n    }\n    \n    // Return original with proper case if no mapping found\n    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n  });\n  \n  return hindiWords.join(' ');\n};\n\n// Function to convert addresses and locations to Hindi\nconst convertAddressToHindi = (address: string): string => {\n  if (!address) return address;\n  \n  const addressMap: { [key: string]: string } = {\n    'sector': '‡§∏‡•á‡§ï‡•ç‡§ü‡§∞',\n    'block': '‡§¨‡•ç‡§≤‡•â‡§ï',\n    'plot': '‡§™‡•ç‡§≤‡•â‡§ü',\n    'house': '‡§Æ‡§ï‡§æ‡§®',\n    'flat': '‡§´‡•ç‡§≤‡•à‡§ü',\n    'apartment': '‡§Ö‡§™‡§æ‡§∞‡•ç‡§ü‡§Æ‡•á‡§Ç‡§ü',\n    'colony': '‡§ï‡•â‡§≤‡•ã‡§®‡•Ä',\n    'nagar': '‡§®‡§ó‡§∞',\n    'city': '‡§∂‡§π‡§∞',\n    'road': '‡§∞‡•ã‡§°',\n    'street': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü',\n    'lane': '‡§≤‡•á‡§®',\n    'main': '‡§Æ‡•Å‡§ñ‡•ç‡§Ø',\n    'near': '‡§ï‡•á ‡§™‡§æ‡§∏',\n    'behind': '‡§ï‡•á ‡§™‡•Ä‡§õ‡•á',\n    'front': '‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á',\n    'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',\n    'shivnagar': '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞',\n    'bhopal': '‡§≠‡•ã‡§™‡§æ‡§≤',\n    'indore': '‡§á‡§Ç‡§¶‡•å‡§∞',\n    'gwalior': '‡§ó‡•ç‡§µ‡§æ‡§≤‡§ø‡§Ø‡§∞',\n    'ujjain': '‡§â‡§ú‡•ç‡§ú‡•à‡§®'\n  };\n  \n  let hindiAddress = address;\n  \n  // Replace each English word with Hindi if mapping exists\n  for (const [eng, hindi] of Object.entries(addressMap)) {\n    const regex = new RegExp(`\\\\b${eng}\\\\b`, 'gi');\n    hindiAddress = hindiAddress.replace(regex, hindi);\n  }\n  \n  return hindiAddress;\n};\n\n// Function to convert numbers to Hindi words\nconst convertToHindiWords = (amount: number): string => {\n  const ones = ['', '‡§è‡§ï', '‡§¶‡•ã', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Ç‡§ö', '‡§õ‡§π', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];\n  const teens = ['‡§¶‡§∏', '‡§ó‡•ç‡§Ø‡§æ‡§∞‡§π', '‡§¨‡§æ‡§∞‡§π', '‡§§‡•á‡§∞‡§π', '‡§ö‡•å‡§¶‡§π', '‡§™‡§Ç‡§¶‡•ç‡§∞‡§π', '‡§∏‡•ã‡§≤‡§π', '‡§∏‡§§‡•ç‡§∞‡§π', '‡§Ö‡§†‡§æ‡§∞‡§π', '‡§â‡§®‡•ç‡§®‡•Ä‡§∏'];\n  const tens = ['', '', '‡§¨‡•Ä‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†', '‡§∏‡§§‡•ç‡§§‡§∞', '‡§Ö‡§∏‡•ç‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];\n  \n  if (amount === 0) return '‡§∂‡•Ç‡§®‡•ç‡§Ø';\n  if (amount < 10) return ones[amount];\n  if (amount < 20) return teens[amount - 10];\n  if (amount < 100) {\n    const ten = Math.floor(amount / 10);\n    const one = amount % 10;\n    return tens[ten] + (one > 0 ? ' ' + ones[one] : '');\n  }\n  if (amount < 1000) {\n    const hundred = Math.floor(amount / 100);\n    const remainder = amount % 100;\n    return ones[hundred] + ' ‡§∏‡•å' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  if (amount < 100000) {\n    const thousand = Math.floor(amount / 1000);\n    const remainder = amount % 1000;\n    return convertToHindiWords(thousand) + ' ‡§π‡§ú‡§æ‡§∞' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  if (amount < 10000000) {\n    const lakh = Math.floor(amount / 100000);\n    const remainder = amount % 100000;\n    return convertToHindiWords(lakh) + ' ‡§≤‡§æ‡§ñ' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  \n  return amount.toString(); // Fallback for very large numbers\n};\n\nexport function AdvancePaymentReceipt({ advancePayment, isOpen, onClose }: AdvancePaymentReceiptProps) {\n  const printRef = useRef<HTMLDivElement>(null);\n  \n  // Saved values state\n  const [savedValues, setSavedValues] = useState<SavedValues>({\n    referredBy: '',\n    recordedBy: ''\n  });\n\n  // Load saved values on component mount\n  useEffect(() => {\n    const saved = localStorage.getItem(SAVED_VALUES_KEY);\n    if (saved) {\n      try {\n        setSavedValues(JSON.parse(saved));\n      } catch (error) {\n        console.error('Error loading saved values:', error);\n      }\n    }\n  }, []);\n\n  // Save values to localStorage\n  const handleSaveValues = () => {\n    localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(savedValues));\n    alert('‡§Æ‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•á ‡§ó‡§è!');\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('hi-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const handlePrint = () => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      const currentDate = new Date().toLocaleDateString('hi-IN');\n      const amountInWords = convertToHindiWords(advancePayment.amount);\n      const paymentModeHindi = getPaymentModeHindi(advancePayment.paymentMode);\n      \n      const html = `\n        <!DOCTYPE html>\n        <html lang=\"hi\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <title>‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${advancePayment.receiptNo}</title>\n            <style>\n              @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n              \n              body {\n                font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n                margin: 0;\n                padding: 20px;\n                background: white;\n                color: #000;\n                font-size: 16px;\n                line-height: 1.4;\n              }\n              \n              .receipt-container {\n                max-width: 600px;\n                margin: 0 auto;\n                border: 2px solid #000;\n                padding: 0;\n              }\n              \n              .receipt-header {\n                text-align: center;\n                padding: 15px;\n                background: #f8f9fa;\n                border-bottom: 2px solid #000;\n              }\n              \n              .temple-name {\n                font-size: 28px;\n                font-weight: 700;\n                margin-bottom: 8px;\n                color: #d97706;\n              }\n              \n              .temple-subtitle {\n                font-size: 16px;\n                margin-bottom: 5px;\n                color: #666;\n              }\n              \n              .receipt-title {\n                font-size: 20px;\n                font-weight: 600;\n                margin-top: 10px;\n                color: #000;\n              }\n              \n              .receipt-body {\n                padding: 20px;\n              }\n              \n              .receipt-section {\n                margin-bottom: 20px;\n              }\n              \n              .section-title {\n                font-size: 18px;\n                font-weight: 600;\n                margin-bottom: 10px;\n                color: #374151;\n                border-bottom: 1px solid #e5e7eb;\n                padding-bottom: 5px;\n              }\n              \n              .receipt-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                margin-bottom: 8px;\n                padding: 4px 0;\n              }\n              \n              .receipt-label {\n                font-weight: 600;\n                color: #374151;\n                flex: 1;\n              }\n              \n              .receipt-value {\n                flex: 2;\n                text-align: right;\n                color: #000;\n              }\n              \n              .amount-section {\n                background: #fef3c7;\n                padding: 15px;\n                border: 1px solid #f59e0b;\n                margin: 15px 0;\n                border-radius: 4px;\n              }\n              \n              .amount-large {\n                font-size: 24px;\n                font-weight: 700;\n                color: #d97706;\n              }\n              \n              .amount-words {\n                font-size: 14px;\n                font-style: italic;\n                margin-top: 5px;\n                color: #92400e;\n              }\n              \n              .signature-section {\n                display: flex;\n                justify-content: space-between;\n                margin-top: 30px;\n                padding-top: 20px;\n                border-top: 1px solid #e5e7eb;\n              }\n              \n              .signature-box {\n                text-align: center;\n                flex: 1;\n                margin: 0 10px;\n              }\n              \n              .signature-line {\n                border-top: 1px solid #000;\n                margin-top: 40px;\n                padding-top: 5px;\n                font-size: 12px;\n                color: #666;\n              }\n              \n              .receipt-footer {\n                text-align: center;\n                margin-top: 20px;\n                padding-top: 15px;\n                border-top: 2px solid #000;\n                font-size: 12px;\n                color: #666;\n              }\n              \n              .footer-note {\n                margin: 5px 0;\n              }\n              \n              @media print {\n                body { margin: 0; padding: 10px; }\n                .no-print { display: none !important; }\n                .receipt-container { border: 2px solid #000; }\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"receipt-container\">\n              <div class=\"receipt-header\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</div>\n                <div class=\"receipt-title\">‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <div class=\"receipt-body\">\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞:</div>\n                    <div class=\"receipt-value\" style=\"font-weight: 600;\">${advancePayment.receiptNo || '‡§Ö‡§®‡•Å‡§™‡§≤‡§¨‡•ç‡§ß'}</div>\n                  </div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</div>\n                    <div class=\"receipt-value\">${formatDate(advancePayment.date)}</div>\n                  </div>\n                </div>\n                \n                <div class=\"receipt-section\">\n                  <div class=\"section-title\">‡§¶‡§æ‡§§‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§®‡§æ‡§Æ:</div>\n                    <div class=\"receipt-value\" style=\"font-weight: 700;\">${convertNameToHindi(advancePayment.userName)}</div>\n                  </div>\n                  ${advancePayment.userMobile ? `\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</div>\n                    <div class=\"receipt-value\">${advancePayment.userMobile}</div>\n                  </div>\n                  ` : ''}\n                  ${advancePayment.userAddress ? `\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§™‡§§‡§æ:</div>\n                    <div class=\"receipt-value\">${convertAddressToHindi(advancePayment.userAddress)}</div>\n                  </div>\n                  ` : ''}\n                </div>\n                \n                <div class=\"amount-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ:</div>\n                    <div class=\"receipt-value\">${paymentModeHindi}</div>\n                  </div>\n                  <div class=\"receipt-row\" style=\"margin-top: 10px;\">\n                    <div class=\"receipt-label\">‡§∞‡§æ‡§∂‡§ø:</div>\n                    <div class=\"receipt-value amount-large\">‚Çπ${advancePayment.amount.toLocaleString('hi-IN')}</div>\n                  </div>\n                  <div class=\"amount-words\">\n                    <strong>‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç:</strong> ${amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                  </div>\n                </div>\n                \n                <div class=\"receipt-section\">\n                  <div class=\"section-title\">‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ:</div>\n                    <div class=\"receipt-value\">${savedValues.referredBy || '‡§Ö‡§®‡•Å‡§™‡§≤‡§¨‡•ç‡§ß'}</div>\n                  </div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ:</div>\n                    <div class=\"receipt-value\">${convertNameToHindi(savedValues.recordedBy || advancePayment.createdBy)}</div>\n                  </div>\n                </div>\n                \n                <div class=\"signature-section\">\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                </div>\n              </div>\n              \n              <div class=\"receipt-footer\">\n                <div class=\"footer-note\"><strong>‡§®‡•ã‡§ü:</strong> ‡§Ø‡§π ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§∞‡•Å‡§¶‡•ç‡§ß ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</div>\n                <div class=\"footer-note\"><strong>‡§Æ‡•Å‡§¶‡•ç‡§∞‡§£ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> ${currentDate}</div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;\n      \n      printWindow.document.open();\n      printWindow.document.write(html);\n      printWindow.document.close();\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </DialogTitle>\n        </DialogHeader>\n        \n        {/* Saved Values Section */}\n        <div className=\"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg mb-4\">\n          <div>\n            <Label htmlFor=\"referredBy\">‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ</Label>\n            <Input\n              id=\"referredBy\"\n              value={savedValues.referredBy}\n              onChange={(e) => setSavedValues(prev => ({ ...prev, referredBy: e.target.value }))}\n              placeholder=\"‡§∞‡•á‡§´‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"recordedBy\">‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ</Label>\n            <Input\n              id=\"recordedBy\"\n              value={savedValues.recordedBy}\n              onChange={(e) => setSavedValues(prev => ({ ...prev, recordedBy: e.target.value }))}\n              placeholder=\"‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç\"\n            />\n          </div>\n        </div>\n        \n        {/* Receipt Preview */}\n        <div className=\"border rounded-lg p-6 bg-white mb-4\">\n          <div className=\"text-center mb-6\">\n            <h1 className=\"text-2xl font-bold text-orange-600 mb-2\">‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</h1>\n            <p className=\"text-gray-600\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</p>\n            <h2 className=\"text-xl font-semibold mt-4\">‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</h2>\n          </div>\n          \n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞:</span>\n              <span>{advancePayment.receiptNo || 'N/A'}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n              <span>{formatDate(advancePayment.date)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§®‡§æ‡§Æ:</span>\n              <span className=\"font-bold\">{convertNameToHindi(advancePayment.userName)}</span>\n            </div>\n            {advancePayment.userMobile && (\n              <div className=\"flex justify-between\">\n                <span className=\"font-semibold\">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</span>\n                <span>{advancePayment.userMobile}</span>\n              </div>\n            )}\n            {advancePayment.userAddress && (\n              <div className=\"flex justify-between\">\n                <span className=\"font-semibold\">‡§™‡§§‡§æ:</span>\n                <span>{convertAddressToHindi(advancePayment.userAddress)}</span>\n              </div>\n            )}\n            <div className=\"bg-yellow-50 p-4 rounded-lg border border-yellow-200\">\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"font-semibold\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ:</span>\n                <span>{getPaymentModeHindi(advancePayment.paymentMode)}</span>\n              </div>\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"font-semibold\">‡§∞‡§æ‡§∂‡§ø:</span>\n                <span className=\"text-xl font-bold text-orange-600\">‚Çπ{advancePayment.amount.toLocaleString('hi-IN')}</span>\n              </div>\n              <div className=\"text-sm italic text-orange-800\">\n                <strong>‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç:</strong> {convertToHindiWords(advancePayment.amount)} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Action Buttons */}\n        <div className=\"flex gap-2\">\n          <Button onClick={handleSaveValues} variant=\"outline\" className=\"flex-1\">\n            <Save className=\"h-4 w-4 mr-2\" />\n            ‡§Æ‡§æ‡§® ‡§∏‡§π‡•á‡§ú‡•á‡§Ç\n          </Button>\n          <Button onClick={handlePrint} className=\"flex-1\">\n            <Printer className=\"h-4 w-4 mr-2\" />\n            ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":23380},"daan-darpan-installation-guide.md":{"content":"# üèõÔ∏è ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Local Installation Package\n\n## Package Contents\n**File:** `daan-darpan-local-v1.0.tar.gz`\n**Size:** Complete application with all dependencies\n**Target:** Ubuntu/Debian Linux systems\n\n## Prerequisites Installation\n\n### 1. Install Node.js (v18+)\n```bash\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt-get install -y nodejs\n```\n\n### 2. Install PostgreSQL (v14+)\n```bash\nsudo apt update\nsudo apt install postgresql postgresql-contrib\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n```\n\n### 3. Install Git\n```bash\nsudo apt install git\n```\n\n## Installation Steps\n\n### 1. Extract Package\n```bash\n# Create directory and extract\nmkdir -p ~/Desktop/daan-darpan-local\ncd ~/Desktop/daan-darpan-local\ntar -xzf ~/Downloads/daan-darpan-local-v1.0.tar.gz\n```\n\n### 2. Run Setup Script\n```bash\n# Make setup script executable and run\nchmod +x setup.sh\n./setup.sh\n```\n\n### 3. Configure Database\n```bash\n# Setup PostgreSQL database\nsudo -u postgres psql -f setup_database.sql\n\n# Edit environment variables\nnano .env\n# Update DATABASE_URL, PGUSER, PGPASSWORD as needed\n```\n\n### 4. Initialize Database Schema\n```bash\n# Install dependencies and setup database\nnpm install\nnpm run db:push\n```\n\n### 5. Start Application\n```bash\n# Development mode (recommended for testing)\nnpm run dev\n\n# Production mode\nnpm run build\nnpm start\n```\n\n## Access Points\n\n- **Local Network:** http://223.190.85.106:5000\n- **Localhost:** http://localhost:5000\n\n## Default Credentials\n\n- **Username:** `admin`\n- **Password:** `admin123`\n\n‚ö†Ô∏è **Important:** Change the default password immediately after first login\n\n## Key Features Included\n\n‚úÖ **Complete Authentication System**\n- Role-based access (Admin, Operator, Viewer)\n- Session management\n\n‚úÖ **Financial Management**\n- Boli entries with payment tracking\n- Dravya entries for spiritual donations\n- Expense management with receipts\n- Advance payments system\n- Previous outstanding records\n\n‚úÖ **Reporting & Analytics**\n- Dashboard with real-time calculations\n- Daily earnings and payment calendars\n- Comprehensive financial summaries\n- Hindi receipt generation\n\n‚úÖ **User Management**\n- Bulk user upload via Excel/CSV\n- Role-based navigation and access control\n\n## File Structure\n```\ndaan-darpan-local/\n‚îú‚îÄ‚îÄ client/              # React frontend\n‚îú‚îÄ‚îÄ server/              # Express.js backend\n‚îú‚îÄ‚îÄ shared/              # Shared TypeScript types\n‚îú‚îÄ‚îÄ uploads/             # File uploads directory\n‚îú‚îÄ‚îÄ .env.example         # Environment template\n‚îú‚îÄ‚îÄ setup.sh             # Automated setup script\n‚îî‚îÄ‚îÄ README.md           # Detailed documentation\n```\n\n## Support & Maintenance\n\n1. **Regular Backups:** Backup PostgreSQL database weekly\n2. **Updates:** Keep Node.js and PostgreSQL updated\n3. **Security:** Use strong passwords and enable firewall\n4. **Monitoring:** Check application logs regularly\n\n## Troubleshooting\n\n**Common Issues:**\n\n1. **Port 5000 in use:**\n   ```bash\n   sudo lsof -t -i:5000 | xargs kill -9\n   ```\n\n2. **Database connection error:**\n   - Verify PostgreSQL is running: `sudo systemctl status postgresql`\n   - Check credentials in `.env` file\n\n3. **Permission issues:**\n   ```bash\n   sudo chown -R $(whoami) ~/Desktop/daan-darpan-local\n   ```\n\n## System Requirements\n\n- **OS:** Ubuntu 20.04+ or Debian 11+\n- **RAM:** Minimum 2GB, Recommended 4GB\n- **Storage:** 500MB for application + database size\n- **Network:** Local network access for multi-user setup\n\n---\n\n**Developed for:** ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞  \n**Version:** 1.0  \n**Package Date:** August 17, 2025","size_bytes":3736},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/icon?family=Material+Icons');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* DatePicker Custom Styles - Google Flights style */\n.react-datepicker {\n  @apply shadow-lg border-0 rounded-lg font-sans !important;\n  width: auto !important;\n}\n\n.react-datepicker-wrapper {\n  @apply w-full;\n}\n\n.react-datepicker__month-container {\n  @apply float-left w-64;\n}\n\n.react-datepicker__header {\n  @apply bg-transparent border-b-0 rounded-none py-2 !important;\n}\n\n.react-datepicker__current-month {\n  @apply text-lg font-medium mb-4 !important;\n}\n\n.react-datepicker__day-names {\n  @apply flex justify-around mt-2;\n}\n\n.react-datepicker__day-name {\n  @apply text-xs text-neutral-500 w-8 !important;\n}\n\n.react-datepicker__month {\n  @apply m-0 !important;\n}\n\n.react-datepicker__week {\n  @apply flex justify-around;\n}\n\n.react-datepicker__day {\n  @apply w-8 h-8 m-0 text-sm rounded-full flex items-center justify-center cursor-pointer hover:bg-neutral-100 !important;\n  line-height: 2rem !important;\n}\n\n.react-datepicker__day--keyboard-selected, \n.react-datepicker__day--selected {\n  @apply bg-primary text-white hover:bg-primary/90 !important;\n}\n\n.react-datepicker__day--in-selecting-range, \n.react-datepicker__day--in-range {\n  @apply bg-primary/20 text-primary rounded-none !important;\n}\n\n.react-datepicker__day--range-start,\n.react-datepicker__day--range-end {\n  @apply bg-primary text-white rounded-full !important;\n}\n\n.react-datepicker__triangle {\n  @apply hidden !important;\n}\n\n.react-datepicker__navigation {\n  @apply top-4 !important;\n}\n\n.react-datepicker__navigation--previous {\n  @apply left-2 !important;\n}\n\n.react-datepicker__navigation--next {\n  @apply right-2 !important;\n}\n\n/* Month header styling */\n.react-datepicker__header {\n  @apply py-4 !important;\n}\n\n.datepicker-container {\n  @apply relative;\n}\n\n/* Make popover container large enough for two months */\n.react-datepicker-popper {\n  @apply z-50;\n  min-width: 36rem;\n}\n\n/* Done button styling */\n.datepicker-done-btn {\n  @apply mt-2 px-4 py-2 bg-primary text-white rounded-md float-right mr-4 mb-2;\n}\n\n/* Multi-month layout fixes */\n.react-datepicker__month-container + .react-datepicker__month-container {\n  @apply border-l border-neutral-200;\n}\n\n/* Custom styling to fix calendar display */\n.react-datepicker {\n  display: flex !important;\n  flex-direction: row !important;\n}\n\n/* Ensure second calendar shows next month */\n.react-datepicker .react-datepicker__month-container:nth-child(2) {\n  margin-left: 1rem !important;\n}\n\n/* Custom styling for second month display */\n.react-datepicker .react-datepicker__month-container:nth-child(2) {\n  position: relative;\n}\n\n/* Add a \"June 2025\" label for the second month */\n.react-datepicker .react-datepicker__month-container:nth-child(2)::before {\n  content: \"June 2025\";\n  position: absolute;\n  top: 1rem;\n  left: 0;\n  right: 0;\n  text-align: center;\n  font-weight: 500;\n  font-size: 1rem;\n}\n\n/* Hide the original second month header which would show May 2025 */\n.react-datepicker__month-container:nth-child(2) .react-datepicker__current-month {\n  visibility: hidden !important;\n}\n\n/* Fix specific styling for month containers */\n.react-datepicker__month-container {\n  width: 280px !important;\n  margin: 0 !important;\n}\n\n/* Force Datepicker to use separate month containers */\n.react-datepicker__month--selected {\n  background-color: transparent !important;\n}","size_bytes":3544},"client/src/pages/entry-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type Entry } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\n// Create edit schema that excludes auto-generated fields\nconst editEntrySchema = z.object({\n  userId: z.coerce.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  userMobile: z.string().optional(),\n  userAddress: z.string().optional(),\n  description: z.string().min(1, \"Description is required\"),\n  amount: z.coerce.number().positive(\"Amount must be positive\"),\n  totalAmount: z.coerce.number().positive(\"Total amount must be positive\"),\n  quantity: z.coerce.number().positive(\"Quantity must be positive\"),\n  occasion: z.string().min(1, \"Occasion is required\"),\n  bediNumber: z.string().min(1, \"‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï is required\"),\n  auctionDate: z.string().min(1, \"Auction date is required\"),\n});\n\ntype EditEntryValues = z.infer<typeof editEntrySchema>;\n\nexport default function EntryEdit() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [match, params] = useRoute(\"/entries/:id/edit\");\n  const entryId = match ? parseInt(params.id) : 0;\n  \n  // Fetch entry details for editing\n  const { data: entry, isLoading } = useQuery<Entry>({\n    queryKey: [`/api/entries/${entryId}`],\n    enabled: entryId > 0,\n  });\n\n  // Fetch users for selection\n  const { data: users } = useQuery<any[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const form = useForm<EditEntryValues>({\n    resolver: zodResolver(editEntrySchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      userMobile: \"\",\n      userAddress: \"\",\n      description: \"\",\n      amount: 0,\n      totalAmount: 0,\n      quantity: 1,\n      occasion: \"\",\n      bediNumber: \"1\",\n      auctionDate: new Date().toISOString().split('T')[0],\n    },\n  });\n\n  // Update form when entry data is loaded\n  useEffect(() => {\n    if (entry) {\n      form.reset({\n        userId: entry.userId,\n        userName: entry.userName,\n        userMobile: entry.userMobile || \"\",\n        userAddress: entry.userAddress || \"\",\n        description: entry.description,\n        amount: entry.amount,\n        totalAmount: entry.totalAmount, // Amount is already in rupees\n        quantity: entry.quantity,\n        occasion: entry.occasion,\n        bediNumber: entry.bediNumber || \"1\",\n        auctionDate: entry.auctionDate,\n      });\n    }\n  }, [entry, form]);\n\n  // Auto-calculate totalAmount when amount or quantity changes\n  const watchAmount = form.watch(\"amount\");\n  const watchQuantity = form.watch(\"quantity\");\n\n  useEffect(() => {\n    const amount = Number(watchAmount) || 0;\n    const quantity = Number(watchQuantity) || 1;\n    const total = amount * quantity;\n    form.setValue(\"totalAmount\", total);\n  }, [watchAmount, watchQuantity, form]);\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async (data: EditEntryValues) => {\n      const response = await apiRequest(\"PUT\", `/api/entries/${entryId}`, data);\n      return response.json();\n    },\n    onSuccess: async () => {\n      toast({\n        title: \"Success\",\n        description: \"Entry updated successfully\",\n      });\n      \n      // Force fresh data by clearing cache and refetching\n      queryClient.removeQueries({ queryKey: ['/api/entries'] });\n      queryClient.removeQueries({ queryKey: [`/api/entries/${entryId}`] });\n      \n      // Redirect immediately - the entries page will fetch fresh data\n      setLocation('/entries');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update entry\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: EditEntryValues) => {\n    updateMutation.mutate(data);\n  };\n\n  // Handle user selection\n  const handleUserSelect = (userId: number) => {\n    const selectedUser = users?.find(u => u.id === userId);\n    if (selectedUser) {\n      form.setValue('userId', selectedUser.id);\n      form.setValue('userName', selectedUser.name);\n      form.setValue('userMobile', selectedUser.mobile || '');\n      form.setValue('userAddress', selectedUser.address || '');\n    }\n  };\n\n  if (!user || (user.role !== 'admin' && user.role !== 'operator')) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Access Denied</h1>\n          <p className=\"text-neutral-600\">You don't have permission to edit entries.</p>\n          <Button onClick={() => setLocation('/entries')} className=\"mt-4\">\n            Back to Entries\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p>Loading entry details...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!entry) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Entry Not Found</h1>\n          <p className=\"text-neutral-600\">The entry you're trying to edit doesn't exist.</p>\n          <Button onClick={() => setLocation('/entries')} className=\"mt-4\">\n            Back to Entries\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <div className=\"max-w-2xl mx-auto p-4\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setLocation('/entries')}\n                >\n                  <ArrowLeft className=\"h-4 w-4 mr-1\" />\n                  Back\n                </Button>\n                <CardTitle>Edit Boli Entry</CardTitle>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* User Selection */}\n                <div className=\"space-y-2\">\n                  <Label>Select User *</Label>\n                  <UserSelect\n                    value={form.watch('userId') > 0 ? form.watch('userId') : undefined}\n                    onValueChange={(userId) => {\n                      if (userId) {\n                        handleUserSelect(userId);\n                      }\n                    }}\n                    className=\"w-full\"\n                    disabled={user?.role !== 'admin'}\n                  />\n                  {user?.role !== 'admin' && (\n                    <p className=\"text-xs text-orange-600\">Only administrators can change the user selection</p>\n                  )}\n                  {form.watch('userId') > 0 && (\n                    <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                      <p className=\"text-sm font-medium text-blue-800\">Selected User:</p>\n                      <p className=\"text-sm text-blue-700\">{form.watch('userName')}</p>\n                      {form.watch('userMobile') && (\n                        <p className=\"text-sm text-blue-600\">Mobile: {form.watch('userMobile')}</p>\n                      )}\n                      {form.watch('userAddress') && (\n                        <p className=\"text-sm text-blue-600\">Address: {form.watch('userAddress')}</p>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Hidden fields for user data */}\n                <FormField\n                  control={form.control}\n                  name=\"userName\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"userMobile\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"userAddress\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                {/* Description */}\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter boli description\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Amount field */}\n                <FormField\n                  control={form.control}\n                  name=\"amount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Amount (‚Çπ) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Enter amount per unit\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Quantity */}\n                <FormField\n                  control={form.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Quantity *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          placeholder=\"Enter quantity\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Total Amount - Read-only calculated field */}\n                <FormField\n                  control={form.control}\n                  name=\"totalAmount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Total Amount (‚Çπ) - Calculated</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          {...field}\n                          disabled\n                          className=\"bg-neutral-100 text-neutral-700 font-semibold\"\n                        />\n                      </FormControl>\n                      <p className=\"text-xs text-neutral-500\">\n                        Auto-calculated: Amount √ó Quantity\n                      </p>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Occasion */}\n                <FormField\n                  control={form.control}\n                  name=\"occasion\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Occasion *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter occasion\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï */}\n                <FormField\n                  control={form.control}\n                  name=\"bediNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï *</FormLabel>\n                      <FormControl>\n                        <Select value={field.value} onValueChange={field.onChange}>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"1\">1</SelectItem>\n                            <SelectItem value=\"2\">2</SelectItem>\n                            <SelectItem value=\"3\">3</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Date of Boli */}\n                <FormField\n                  control={form.control}\n                  name=\"auctionDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date of Boli *</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          max={new Date().toISOString().split('T')[0]}\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Submit Button */}\n                <div className=\"flex gap-4 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setLocation('/entries')}\n                    className=\"flex-1\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    className=\"flex-1\"\n                    disabled={updateMutation.isPending}\n                  >\n                    {updateMutation.isPending ? \"Updating...\" : \"Update Entry\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":15968},"local-deployment/client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"local-deployment/client/src/components/bulk-user-upload.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Download, Upload, Users, FileSpreadsheet } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function BulkUserUpload() {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Generate and download template\n  const downloadTemplate = () => {\n    // Create CSV template with sample data\n    const headers = ['username', 'password', 'name', 'email', 'mobile', 'address', 'role'];\n    const sampleData = [\n      'user1', 'password123', 'Sample User 1', 'user1@example.com', '9876543210', 'Sample Address 1', 'viewer',\n      'user2', 'password123', 'Sample User 2', 'user2@example.com', '9876543211', 'Sample Address 2', 'operator'\n    ];\n\n    const csvContent = [\n      headers.join(','),\n      sampleData.slice(0, 7).join(','),\n      sampleData.slice(7, 14).join(',')\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'sample_template.csv';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Template Downloaded\",\n      description: \"CSV template downloaded successfully. Fill it with user data and upload.\",\n    });\n  };\n\n  // Handle file selection\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file type\n      if (!file.name.endsWith('.csv') && !file.name.endsWith('.xlsx')) {\n        toast({\n          title: \"Invalid File Type\",\n          description: \"Please upload a CSV or Excel file.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  // Upload mutation\n  const uploadMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/users/bulk-upload', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Upload failed');\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      setSelectedFile(null);\n      setUploading(false);\n      \n      toast({\n        title: \"Upload Successful\",\n        description: `${data.created} users created successfully. ${data.errors || 0} errors encountered.`,\n      });\n      \n      // Reset file input\n      const fileInput = document.getElementById('bulk-upload-input') as HTMLInputElement;\n      if (fileInput) fileInput.value = '';\n    },\n    onError: (error: any) => {\n      setUploading(false);\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload users. Please check your file format.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle upload\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    const formData = new FormData();\n    formData.append('file', selectedFile);\n\n    uploadMutation.mutate(formData);\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n          Bulk User Upload\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Template Download Section */}\n        <div className=\"border rounded-lg p-4 bg-blue-50\">\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <h3 className=\"font-medium text-blue-900 mb-2\">Step 1: Download Template</h3>\n              <p className=\"text-sm text-blue-800 mb-3\">\n                Download the CSV template with required columns and sample data.\n              </p>\n              <div className=\"text-xs text-blue-700 space-y-1\">\n                <p><strong>Required columns:</strong></p>\n                <p>‚Ä¢ username, password, name, email, mobile, address, role</p>\n                <p><strong>Valid roles:</strong> admin, operator, viewer</p>\n              </div>\n            </div>\n            <Button \n              onClick={downloadTemplate}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-100\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Download Template\n            </Button>\n          </div>\n        </div>\n\n        {/* File Upload Section */}\n        <div className=\"border rounded-lg p-4\">\n          <h3 className=\"font-medium mb-3\">Step 2: Upload Filled Template</h3>\n          \n          <div className=\"space-y-4\">\n            {/* File Input */}\n            <div>\n              <input\n                id=\"bulk-upload-input\"\n                type=\"file\"\n                accept=\".csv,.xlsx\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              <Button\n                onClick={() => document.getElementById('bulk-upload-input')?.click()}\n                variant=\"outline\"\n                className=\"w-full flex items-center gap-2\"\n              >\n                <FileSpreadsheet className=\"h-4 w-4\" />\n                Select CSV/Excel File\n              </Button>\n            </div>\n\n            {/* Selected File Display */}\n            {selectedFile && (\n              <div className=\"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  <FileSpreadsheet className=\"h-4 w-4 text-green-600\" />\n                  <span className=\"text-sm font-medium text-green-800\">\n                    {selectedFile.name}\n                  </span>\n                  <span className=\"text-xs text-green-600\">\n                    ({(selectedFile.size / 1024).toFixed(1)} KB)\n                  </span>\n                </div>\n                <Button\n                  onClick={() => setSelectedFile(null)}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"text-green-700 hover:text-green-900\"\n                >\n                  Remove\n                </Button>\n              </div>\n            )}\n\n            {/* Upload Button */}\n            <Button\n              onClick={handleUpload}\n              disabled={!selectedFile || uploading}\n              className=\"w-full flex items-center gap-2\"\n            >\n              <Upload className=\"h-4 w-4\" />\n              {uploading ? 'Uploading...' : 'Upload Users'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div className=\"text-sm text-gray-600 space-y-2\">\n          <p><strong>Instructions:</strong></p>\n          <ul className=\"list-disc list-inside space-y-1 ml-2\">\n            <li>Download the template and fill in user details</li>\n            <li>Ensure all required fields are completed</li>\n            <li>Use valid roles: admin, operator, or viewer</li>\n            <li>Mobile numbers should be 10 digits</li>\n            <li>Usernames must be unique across the system</li>\n            <li>Save as CSV format before uploading</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":7849},"local-deployment/client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":7974},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1435},"deploy/install.sh":{"content":"#!/bin/bash\n\necho \"üöÄ Installing Daan Darpan Temple Management System...\"\n\n# Color codes for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\n# Function to print colored output\nprint_status() {\n    echo -e \"${BLUE}[INFO]${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\n# Check if Node.js is installed\nif ! command -v node &> /dev/null; then\n    print_error \"Node.js is not installed. Please install Node.js 18+ first.\"\n    print_status \"Visit: https://nodejs.org/en/download/\"\n    exit 1\nfi\n\n# Check Node.js version\nNODE_VERSION=$(node -v | cut -d'v' -f2 | cut -d'.' -f1)\nif [ \"$NODE_VERSION\" -lt 18 ]; then\n    print_error \"Node.js version 18 or higher is required. Current version: $(node -v)\"\n    exit 1\nfi\n\nprint_success \"Node.js $(node -v) detected\"\n\n# Check if PostgreSQL is installed\nif ! command -v psql &> /dev/null; then\n    print_warning \"PostgreSQL is not installed.\"\n    print_status \"Installing PostgreSQL...\"\n    \n    # Detect OS and install PostgreSQL\n    if [[ \"$OSTYPE\" == \"linux-gnu\"* ]]; then\n        # Ubuntu/Debian\n        if command -v apt-get &> /dev/null; then\n            sudo apt-get update\n            sudo apt-get install -y postgresql postgresql-contrib\n        # CentOS/RHEL\n        elif command -v yum &> /dev/null; then\n            sudo yum install -y postgresql-server postgresql-contrib\n            sudo postgresql-setup initdb\n        else\n            print_error \"Unsupported Linux distribution. Please install PostgreSQL manually.\"\n            exit 1\n        fi\n    elif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n        # macOS\n        if command -v brew &> /dev/null; then\n            brew install postgresql\n            brew services start postgresql\n        else\n            print_error \"Homebrew not found. Please install PostgreSQL manually.\"\n            exit 1\n        fi\n    else\n        print_error \"Unsupported operating system. Please install PostgreSQL manually.\"\n        exit 1\n    fi\nfi\n\nprint_success \"PostgreSQL detected\"\n\n# Install npm dependencies\nprint_status \"Installing npm dependencies...\"\nnpm install\n\nif [ $? -ne 0 ]; then\n    print_error \"Failed to install npm dependencies\"\n    exit 1\nfi\n\nprint_success \"Dependencies installed successfully\"\n\n# Create .env file if it doesn't exist\nif [ ! -f .env ]; then\n    print_status \"Creating .env file...\"\n    cp .env.example .env\n    print_warning \"Please update the .env file with your database credentials and other settings\"\n    print_status \"Edit .env file: nano .env\"\nelse\n    print_warning \".env file already exists. Please verify your settings.\"\nfi\n\n# Create uploads directory\nprint_status \"Creating uploads directory...\"\nmkdir -p uploads\nchmod 755 uploads\n\nprint_success \"Setup completed!\"\nprint_status \"\"\nprint_status \"Next steps:\"\nprint_status \"1. Update your .env file with database credentials\"\nprint_status \"2. Run: ./deploy/setup-database.sh to setup the database\"\nprint_status \"3. Run: npm run start to start the application\"\nprint_status \"\"\nprint_status \"The application will be available at: http://localhost:8484\"","size_bytes":3229},"local-deployment/client/src/components/user-form.tsx":{"content":"import { FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { UserRole } from \"@shared/schema\";\nimport { useState, useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function UserFormFields({ \n  form, \n  isNewUser = false, \n  isSubmitting = false \n}: { \n  form: UseFormReturn<any>;\n  isNewUser?: boolean;\n  isSubmitting?: boolean;\n}) {\n  const [mobileCheckResult, setMobileCheckResult] = useState<{ exists: boolean; user?: any } | null>(null);\n  const [isCheckingMobile, setIsCheckingMobile] = useState(false);\n  \n  // Watch mobile field changes\n  const mobileValue = form.watch(\"mobile\");\n  \n  // Check for duplicate mobile when mobile changes and is for new user\n  useEffect(() => {\n    if (!isNewUser || !mobileValue || mobileValue.length < 10) {\n      setMobileCheckResult(null);\n      return;\n    }\n    \n    const timeoutId = setTimeout(async () => {\n      if (mobileValue.length >= 10) {\n        setIsCheckingMobile(true);\n        try {\n          const response = await apiRequest('POST', '/api/users/check-mobile', {\n            mobile: mobileValue\n          });\n          const result = await response.json();\n          setMobileCheckResult(result);\n          \n          // Set form error if mobile exists\n          if (result.exists) {\n            form.setError('mobile', {\n              message: `Mobile number belongs to: ${result.user.name} (${result.user.username})`\n            });\n          } else {\n            form.clearErrors('mobile');\n          }\n        } catch (error) {\n          console.error('Error checking mobile:', error);\n        } finally {\n          setIsCheckingMobile(false);\n        }\n      }\n    }, 500); // Debounce for 500ms\n    \n    return () => clearTimeout(timeoutId);\n  }, [mobileValue, isNewUser, form]);\n  return (\n    <>\n      <FormField\n        control={form.control}\n        name=\"name\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Name</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Full Name\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      {isNewUser && (\n        <>\n          <FormField\n            control={form.control}\n            name=\"username\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Username</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Username\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          \n          <FormField\n            control={form.control}\n            name=\"password\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Password</FormLabel>\n                <FormControl>\n                  <Input type=\"password\" placeholder=\"Password\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </>\n      )}\n      \n      <FormField\n        control={form.control}\n        name=\"email\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Email</FormLabel>\n            <FormControl>\n              <Input type=\"email\" placeholder=\"Email\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"mobile\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Mobile Number</FormLabel>\n            <FormControl>\n              <div className=\"relative\">\n                <Input \n                  type=\"tel\" \n                  placeholder=\"Mobile Number\" \n                  {...field}\n                  className={mobileCheckResult?.exists ? \"border-red-500\" : \"\"}\n                />\n                {isCheckingMobile && (\n                  <div className=\"absolute right-3 top-2.5\">\n                    <div className=\"animate-spin h-4 w-4 border-2 border-gray-300 border-t-blue-600 rounded-full\"></div>\n                  </div>\n                )}\n              </div>\n            </FormControl>\n            <FormMessage />\n            {mobileCheckResult?.exists && (\n              <div className=\"text-sm text-red-600 mt-1\">\n                ‚ö†Ô∏è Mobile number belongs to: <strong>{mobileCheckResult.user.name}</strong> ({mobileCheckResult.user.username})\n              </div>\n            )}\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"address\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Address</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Address\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"role\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Role</FormLabel>\n            <Select \n              onValueChange={field.onChange} \n              defaultValue={field.value}\n            >\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select role\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value={UserRole.ADMIN}>Admin</SelectItem>\n                <SelectItem value={UserRole.OPERATOR}>Operator</SelectItem>\n                <SelectItem value={UserRole.VIEWER}>Viewer</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"status\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Status</FormLabel>\n            <Select \n              onValueChange={field.onChange} \n              defaultValue={field.value}\n            >\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select status\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"active\">Active</SelectItem>\n                <SelectItem value=\"inactive\">Inactive</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <Button \n        type=\"submit\" \n        className=\"w-full\" \n        disabled={isSubmitting || (isNewUser && mobileCheckResult?.exists)}\n      >\n        {isSubmitting \n          ? (isNewUser ? \"Creating...\" : \"Updating...\") \n          : (isNewUser ? \"Create User\" : \"Update User\")\n        }\n      </Button>\n    </>\n  );\n}","size_bytes":7112},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n      onError: (error: any) => {\n        // Handle authentication errors globally\n        if (error?.message?.includes('401')) {\n          queryClient.setQueryData(['/api/auth/user'], null);\n        }\n      },\n    },\n  },\n});\n","size_bytes":1586},"local-deployment/client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3835},"client/src/components/entries-form-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesFormMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isFormsActive = location === '/entry/new' || location === '/dravya-entry-form' || location === '/expense-entry-form' || location === '/advance-payment-form' || location === '/previous-outstanding/new';\n\n  // Only show this menu for operators and admins\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return null;\n  }\n\n  const menuItems = [\n    {\n      path: '/entry/new',\n      icon: 'add_circle',\n      label: 'New Boli Entry',\n      description: 'Create new boli entry'\n    },\n    {\n      path: '/dravya-entry-form',\n      icon: 'add_circle',\n      label: 'New Dravya Entry',\n      description: 'Create new dravya entry'\n    },\n    ...(user?.role === 'operator' ? [{\n      path: '/expense-entry-form',\n      icon: 'receipt_long',\n      label: 'New Expense Entry',\n      description: 'Create new expense entry'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/advance-payment-form',\n      icon: 'account_balance_wallet',\n      label: 'Add Advance Payment',\n      description: 'Record new advance payment'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/previous-outstanding/new',\n      icon: 'history',\n      label: 'Previous Outstanding',\n      description: 'Record past outstanding amounts with proof'\n    }] : [])\n  ];\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isFormsActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons text-primary\">add_circle</span>\n        <span className=\"text-xs\">Add Entry</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                Create New Entry\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg text-primary\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":4000},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"local-deployment/scripts/create-sample-data.sh":{"content":"#!/bin/bash\n\n# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Sample Data Creator\n# Creates sample data for testing and demonstration\n\nset -e\n\n# Load environment variables\nif [ -f .env ]; then\n    export $(cat .env | grep -v '#' | awk '/=/ {print $1}')\nfi\n\necho \"üèõÔ∏è  Creating ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Sample Data...\"\necho \"\"\n\n# Create sample data SQL\ncat > /tmp/sample_data.sql << 'EOF'\n-- Sample Data for ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Application\n\n-- Insert sample users with different roles\nINSERT INTO users (id, username, password_hash, role, name, mobile, address, serial_number) VALUES\n(1, 'admin', '$2b$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 'Administrator', '9876543210', 'Temple Office, Shivnagar', 1),\n(2, 'operator1', '$2b$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'operator', 'Operator One', '9876543211', 'Shivnagar, Jabalpur', 2),\n(3, 'viewer1', '$2b$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'viewer', 'Viewer One', '9876543212', 'Shivnagar, Jabalpur', 3),\n(4, 'ramesh_ji', '$2b$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'viewer', 'Ramesh Kumar Jain', '9876543213', 'Gandhi Nagar, Jabalpur', 4),\n(5, 'sunita_devi', '$2b$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'viewer', 'Sunita Devi Jain', '9876543214', 'Civil Lines, Jabalpur', 5)\nON CONFLICT (id) DO UPDATE SET\n  username = EXCLUDED.username,\n  name = EXCLUDED.name,\n  mobile = EXCLUDED.mobile,\n  address = EXCLUDED.address;\n\n-- Set corpus value\nINSERT INTO corpus_settings (id, corpus_value) VALUES (1, 13908400) -- ‚Çπ139,084 in paisa\nON CONFLICT (id) DO UPDATE SET corpus_value = EXCLUDED.corpus_value;\n\n-- Insert sample boli entries\nINSERT INTO boli_entries (user_id, amount, auction_date, entry_date, payment_status, received_amount, pending_amount, description, created_by) VALUES\n(4, 500000, '2025-07-01', '2025-07-01', 'completed', 500000, 0, 'Monthly Boli - Ramesh Ji', 1),\n(5, 300000, '2025-07-02', '2025-07-02', 'partial', 200000, 100000, 'Special Occasion Boli', 1),\n(4, 150000, '2025-07-15', '2025-07-15', 'pending', 0, 150000, 'Festival Boli', 2),\n(5, 250000, '2025-08-01', '2025-08-01', 'completed', 250000, 0, 'Puja Boli', 2);\n\n-- Insert sample advance payments\nINSERT INTO advance_payments (user_id, amount, payment_date, payment_mode, description, created_by) VALUES\n(4, 100000, '2025-06-15', 'cash', 'Advance for upcoming pujas', 1),\n(5, 50000, '2025-06-20', 'upi', 'General advance payment', 1);\n\n-- Insert sample expense entries\nINSERT INTO expense_entries (description, amount, expense_date, payment_mode, created_by, firm_name, bill_number, line_item, quantity, reason, approved_by, paid_by) VALUES\n('Prasad Materials', 250000, '2025-07-01', 'cash', 1, 'Krishna Stores', 'B001', 'Mishri, Dry Fruits', 5, 'Monthly prasad preparation', 'Pandit Ji', 'Treasurer'),\n('Electricity Bill', 180000, '2025-07-05', 'upi', 1, 'MP Electricity Board', 'EB202507', 'Temple electricity', 1, 'Monthly electricity charges', 'Secretary', 'Operator'),\n('Cleaning Supplies', 85000, '2025-07-10', 'cash', 1, 'Clean India Suppliers', 'C789', 'Phenyl, Detergent, Brooms', 10, 'Monthly cleaning supplies', 'Caretaker', 'Operator');\n\n-- Insert sample dravya entries (separate from main system)\nINSERT INTO dravya_entries (user_id, amount, entry_date, description, created_by) VALUES\n(4, 25000, '2025-07-01', 'Monthly Dravya Donation', 1),\n(5, 15000, '2025-07-15', 'Special Puja Dravya', 2);\n\n-- Insert sample previous outstanding records\nINSERT INTO previous_outstanding_records (user_id, total_outstanding_amount, received_amount, pending_amount, description, created_by) VALUES\n(4, 75000, 50000, 25000, 'Previous year pending amount', 1),\n(5, 30000, 30000, 0, 'Old temple contribution', 1);\n\n-- Insert sample boli payments\nINSERT INTO boli_payments (boli_entry_id, amount, payment_date, payment_mode, receipt_number, description, created_by) VALUES\n(1, 500000, '2025-07-01', 'cash', 'SPDJMSJ000001', 'Full payment for monthly boli', 1),\n(2, 200000, '2025-07-02', 'upi', 'SPDJMSJ000002', 'Partial payment', 1),\n(4, 250000, '2025-08-01', 'cash', 'SPDJMSJ000003', 'Festival boli payment', 2);\n\n-- Update receipt counter\nINSERT INTO receipt_counter (id, last_receipt_number) VALUES (1, 3)\nON CONFLICT (id) DO UPDATE SET last_receipt_number = EXCLUDED.last_receipt_number;\n\n-- Insert transaction logs for audit trail\nINSERT INTO transaction_logs (entry_type, entry_id, action, old_values, new_values, user_id, timestamp) VALUES\n('boli_entry', 1, 'create', '{}', '{\"amount\": 500000, \"payment_status\": \"completed\"}', 1, '2025-07-01 10:00:00'),\n('boli_payment', 1, 'create', '{}', '{\"amount\": 500000, \"payment_mode\": \"cash\"}', 1, '2025-07-01 10:30:00'),\n('advance_payment', 1, 'create', '{}', '{\"amount\": 100000, \"payment_mode\": \"cash\"}', 1, '2025-06-15 14:00:00');\n\nEOF\n\n# Execute sample data creation\necho \"üìä Inserting sample data...\"\n\n# Default values\nDB_NAME=${PGDATABASE:-\"daan_darpan\"}\nDB_USER=${PGUSER:-\"daan_user\"}\nDB_HOST=${PGHOST:-\"localhost\"}\nDB_PORT=${PGPORT:-\"5432\"}\n\nPGPASSWORD=\"$PGPASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" \\\n    -v ON_ERROR_STOP=1 \\\n    -f /tmp/sample_data.sql\n\n# Clean up\nrm /tmp/sample_data.sql\n\nif [ $? -eq 0 ]; then\n    echo \"‚úÖ Sample data created successfully!\"\n    echo \"\"\n    echo \"üîë Login Credentials:\"\n    echo \"   Admin:     admin / admin123\"\n    echo \"   Operator:  operator1 / admin123\"\n    echo \"   Viewer:    viewer1 / admin123\"\n    echo \"   User:      ramesh_ji / admin123\"\n    echo \"   User:      sunita_devi / admin123\"\n    echo \"\"\n    echo \"üìä Sample Data Includes:\"\n    echo \"   ‚Ä¢ 5 users with different roles\"\n    echo \"   ‚Ä¢ 4 boli entries with various payment statuses\"\n    echo \"   ‚Ä¢ 2 advance payments\"\n    echo \"   ‚Ä¢ 3 expense entries\"\n    echo \"   ‚Ä¢ 2 dravya entries\"\n    echo \"   ‚Ä¢ Outstanding records\"\n    echo \"   ‚Ä¢ Payment history\"\n    echo \"   ‚Ä¢ Corpus setting: ‚Çπ139,084\"\nelse\n    echo \"‚ùå Sample data creation failed!\"\n    exit 1\nfi","size_bytes":5991},"visual-operator-help-guide.md":{"content":"# ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø - ‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤ ‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§π‡•á‡§≤‡•ç‡§™ ‡§ó‡§æ‡§á‡§°\n# Visual Operator Help Guide - Account Ledger Management System\n\n## ‡§µ‡§ø‡§∑‡§Ø ‡§∏‡•Ç‡§ö‡•Ä / Table of Contents\n\n1. [‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ì‡§µ‡§∞‡§µ‡•ç‡§Ø‡•Ç / Application Overview](#application-overview)\n2. [‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡§ø‡§Ø‡§æ‡§Ç / Roles and Responsibilities](#roles-and-responsibilities)\n3. [‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ / Login Process](#login-process)\n4. [‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® / Dashboard Navigation](#dashboard-navigation)\n5. [‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Boli Entry Management](#boli-entry-management)\n6. [‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Dravya Entry Management](#dravya-entry-management)\n7. [‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / Payment Management](#payment-management)\n8. [‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ / Advance Payment System](#advance-payment-system)\n9. [‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó / Expense Tracking](#expense-tracking)\n10. [‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü / User Management](#user-management)\n11. [‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ / Reports and Calendar](#reports-and-calendar)\n12. [‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§® / Receipt Generation](#receipt-generation)\n13. [‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§®‡§ø‡§µ‡§æ‡§∞‡§£ / Troubleshooting](#troubleshooting)\n\n---\n\n## Application Overview\n\n### ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§â‡§¶‡•ç‡§¶‡•á‡§∂‡•ç‡§Ø / Application Purpose\n‡§Ø‡§π ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§π‡•Ä ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç, ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§®, ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó, ‡§î‡§∞ ‡§µ‡§ø‡§§‡•ç‡§§‡•Ä‡§Ø ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡•á ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§\n\n### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ / Key Features\n- **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§®‡•Ä‡§≤‡§æ‡§Æ‡•Ä/‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó\n- **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ**: ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§¶‡§æ‡§® ‡§ï‡§æ ‡§Ö‡§≤‡§ó ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®\n- **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó**: ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§î‡§∞ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°\n- **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü**: ‡§™‡•Ç‡§∞‡•ç‡§µ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§î‡§∞ ‡§ë‡§ü‡•ã-‡§è‡§™‡•ç‡§≤‡§æ‡§à\n- **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§æ ‡§π‡§ø‡§∏‡§æ‡§¨-‡§ï‡§ø‡§§‡§æ‡§¨\n- **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶‡•á‡§Ç\n- **‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®\n\n---\n\n## Roles and Responsibilities\n\n### 1. Admin (‡§è‡§°‡§Æ‡§ø‡§®)\n- **‡§™‡•Ç‡§∞‡•ç‡§£ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§®‡§è ‡§Ø‡•Ç‡§ú‡§∞ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§∞‡•ã‡§≤ ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§°‡•á‡§ü‡§æ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§¨‡•à‡§ï‡§Ö‡§™, ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü/‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•ã ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n\n### 2. Operator (‡§ë‡§™‡§∞‡•á‡§ü‡§∞) - ‡§Ü‡§™‡§ï‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ\n- **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§¨‡•ã‡§≤‡•Ä, ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø, ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ/‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§∞‡§∏‡•Ä‡§¶‡•á‡§Ç ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü**: ‡§ï‡•á‡§µ‡§≤ ‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡•Ç‡§Ö‡§∞ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n\n### 3. Viewer (‡§µ‡•ç‡§Ø‡•Ç‡§Ö‡§∞)\n- **‡§ï‡•á‡§µ‡§≤ ‡§¶‡•á‡§ñ‡§®‡§æ**: ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡•á‡§∏**: ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n- **‡§ï‡•ã‡§à ‡§è‡§°‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§®‡§π‡•Ä‡§Ç**: ‡§°‡•á‡§ü‡§æ ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á\n\n---\n\n## Login Process\n\n### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•á‡§ú ‡§ñ‡•ã‡§≤‡§®‡§æ / Opening Login Page\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§≤‡•â‡§ó‡§ø‡§® ‡§™‡•á‡§ú ‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ø‡§π‡§æ‡§Å ‡§π‡•ã‡§ó‡§æ\n\n#### ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ü‡•á‡§™‡•ç‡§∏:\n1. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ñ‡•ã‡§≤‡•á‡§Ç**: Chrome, Firefox, ‡§Ø‡§æ Safari ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç\n2. **URL ‡§°‡§æ‡§≤‡•á‡§Ç**: ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§µ‡•á‡§¨ ‡§è‡§°‡•ç‡§∞‡•á‡§∏\n3. **‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§≠‡§∞‡•á‡§Ç**: ‡§Ü‡§™‡§ï‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ\n4. **‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç**: ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°\n5. **\"Sign In\" ‡§¨‡§ü‡§®**: ‡§®‡•Ä‡§≤‡•á ‡§∞‡§Ç‡§ó ‡§ï‡•á ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç\n\n#### ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§æ‡§§‡•á‡§Ç:\n- ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° case-sensitive ‡§π‡•à‡§Ç\n- Caps Lock ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡•á‡§Ç\n- ‡§Ö‡§ó‡§∞ ‡§≠‡•Ç‡§≤ ‡§ó‡§è ‡§π‡•à‡§Ç ‡§§‡•ã ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç\n\n---\n\n## Dashboard Navigation\n\n### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° / Main Dashboard\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡•ç‡§Ø‡•Ç ‡§Ø‡§π‡§æ‡§Å ‡§π‡•ã‡§ó‡§æ\n\n#### ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≠‡§æ‡§ó:\n1. **‡§ü‡•â‡§™ ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® ‡§¨‡§æ‡§∞**: ‡§∏‡§≠‡•Ä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡•á‡§ï‡•ç‡§∂‡§®‡•ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§Ç‡§ï\n2. **‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç**: ‡§¨‡§æ‡§è‡§Ç ‡§§‡§∞‡§´ ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç\n3. **‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§è‡§∞‡§ø‡§Ø‡§æ**: ‡§°‡•á‡§ü‡§æ ‡§î‡§∞ ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏\n4. **‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç**: ‡§ä‡§™‡§∞‡•Ä ‡§¶‡§æ‡§è‡§Ç ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç\n\n#### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§°‡•ç‡§∏:\n1. **‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (Total Amount)**: ‡§∏‡§≠‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡§æ ‡§ï‡•Å‡§≤\n2. **‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§∞‡§æ‡§∂‡§ø (Received Amount)**: ‡§ï‡•Å‡§≤ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®\n3. **‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø (Pending Amount)**: ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®\n4. **‡§ï‡•Å‡§≤ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú (Total Entries)**: ‡§ï‡•Å‡§≤ ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú\n\n### ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§® / Sidebar Navigation\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡•ç‡§Ø‡•Ç\n\n#### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§Ü‡§á‡§ü‡§Æ‡•ç‡§∏:\n1. **üè† Dashboard** - ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®\n2. **üìã Boli Entries** - ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n3. **üôè Dravya Entries** - ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n4. **üí∞ Expenses** - ‡§ñ‡§∞‡•ç‡§ö ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n5. **üë• User Management** - ‡§Ø‡•Ç‡§ú‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® (‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è)\n6. **üìä Reports** - ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏\n\n#### ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç (‡§ä‡§™‡§∞‡•Ä ‡§¶‡§æ‡§è‡§Ç ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç):\n- **üë§ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Ü‡§á‡§ï‡§®** ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç\n- **‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ë‡§™‡•ç‡§∂‡§®** ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ\n\n---\n\n## Boli Entry Management\n\n### ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•á‡§ú / Boli Entries List Page\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡•Ä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≤‡§ø‡§∏‡•ç‡§ü\n\n#### ‡§™‡•á‡§ú ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§è‡§≤‡§ø‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏:\n1. **\"+ New Entry\" ‡§¨‡§ü‡§®**: ‡§π‡§∞‡•á ‡§∞‡§Ç‡§ó ‡§ï‡§æ, ‡§ä‡§™‡§∞‡•Ä ‡§¶‡§æ‡§è‡§Ç ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç\n2. **‡§∏‡§∞‡•ç‡§ö ‡§¨‡§æ‡§∞**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§®‡•á‡§Æ ‡§Ø‡§æ ‡§Ö‡§®‡•ç‡§Ø ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n3. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤**: ‡§∏‡§≠‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü\n4. **‡§™‡•á‡§ú‡§ø‡§®‡•á‡§∂‡§®**: ‡§™‡•á‡§ú ‡§®‡§Ç‡§¨‡§∞‡•ç‡§∏ ‡§®‡•Ä‡§ö‡•á\n\n#### ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤ ‡§ï‡•â‡§≤‡§Æ‡•ç‡§∏:\n- **User Name**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n- **Amount**: ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø\n- **Date**: ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n- **Status**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø (Pending/Partial/Full)\n- **Actions**: ‡§µ‡•ç‡§Ø‡•Ç/‡§è‡§°‡§ø‡§ü ‡§¨‡§ü‡§®‡•ç‡§∏\n\n#### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ï‡§≤‡§∞ ‡§ï‡•ã‡§°‡§ø‡§Ç‡§ó:\n- **üî¥ ‡§≤‡§æ‡§≤**: Pending (‡§ï‡•ã‡§à ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç)\n- **üü° ‡§™‡•Ä‡§≤‡§æ**: Partial (‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§≠‡•Å‡§ó‡§§‡§æ‡§®)\n- **üü¢ ‡§π‡§∞‡§æ**: Full (‡§™‡•Ç‡§∞‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®)\n\n### ‡§®‡§à ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§®‡§æ / Creating New Boli Entry\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§®‡•ç‡§Ø‡•Ç ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ï‡§æ ‡§µ‡•ç‡§Ø‡•Ç\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§®‡•ç‡§Ø‡•Ç ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤‡§®‡§æ\n1. **\"+ New Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ ‡§™‡•á‡§ú ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§∂‡§®\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡§∞‡•ç‡§ö ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§®\n\n1. **\"Select User\" ‡§´‡•Ä‡§≤‡•ç‡§° ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n4. **‡§Ö‡§ó‡§∞ ‡§Ø‡•Ç‡§ú‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ ‡§§‡•ã \"Add New User\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§®‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞ ‡§¨‡§®‡§æ‡§®‡§æ (‡§Ø‡§¶‡§ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•ã)\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§®‡•ç‡§Ø‡•Ç ‡§Ø‡•Ç‡§ú‡§∞ ‡§´‡•â‡§∞‡•ç‡§Æ\n\n1. **Name**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n2. **Phone**: ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n3. **Address**: ‡§™‡§§‡§æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n4. **\"Create User\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 4: ‡§¨‡•ã‡§≤‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡§®‡§æ\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¨‡•ã‡§≤‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§´‡•â‡§∞‡•ç‡§Æ\n\n1. **Description**: \n   - ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§™‡•Ç‡§∞‡•ç‡§µ-‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§®‡•á‡§Ç\n   - ‡§Ø‡§æ \"Custom Entry\" ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è \"Other\" ‡§ö‡•Å‡§®‡•á‡§Ç\n2. **Amount**: ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø (‡§∞‡•Å‡§™‡§è ‡§Æ‡•á‡§Ç)\n3. **Auction Date**: ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§∏‡•á ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç\n4. **Occasion**: ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 5: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§≠‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶**\n2. **\"Save Entry\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∏‡§´‡§≤ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§∏‡§ï‡•ç‡§∏‡•á‡§∏ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n### ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§¶‡•á‡§ñ‡§®‡§æ / Viewing Boli Entry Details\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú\n\n#### ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§ï‡•á ‡§∏‡•á‡§ï‡•ç‡§∂‡§®‡•ç‡§∏:\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§á‡§®‡•ç‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§∂‡§® ‡§ï‡§æ‡§∞‡•ç‡§°**: ‡§®‡§æ‡§Æ, ‡§´‡•ã‡§®, ‡§™‡§§‡§æ\n2. **‡§¨‡•ã‡§≤‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§°**: ‡§µ‡§ø‡§µ‡§∞‡§£, ‡§∞‡§æ‡§∂‡§ø, ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n3. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§ï‡•ç‡§∂‡§®**: ‡§∏‡§≠‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡•ç‡§∏\n4. **‡§è‡§ï‡•ç‡§∂‡§® ‡§¨‡§ü‡§®‡•ç‡§∏**: ‡§è‡§°‡§ø‡§ü, ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ê‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n\n#### ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§¨‡§ü‡§®‡•ç‡§∏:\n- **\"Edit Entry\"**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n- **\"Add Payment\"**: ‡§®‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n- **\"Apply Advance\"**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§≤‡§ó‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n\n---\n\n## Dravya Entry Management\n\n### ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§™‡•á‡§ú / Dravya Entries Page\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü\n\n#### ‡§™‡•á‡§ú ‡§≤‡•á‡§Ü‡§â‡§ü:\n1. **\"+ New Dravya Entry\" ‡§¨‡§ü‡§®**: ‡§®‡§à ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è\n2. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤**: ‡§∏‡§≠‡•Ä ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Ç\n3. **‡§∏‡§∞‡•ç‡§ö ‡§è‡§Ç‡§° ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n\n### ‡§®‡§à ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§®‡§æ / Creating New Dravya Entry\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ\n\n#### ‡§´‡•â‡§∞‡•ç‡§Æ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏:\n1. **User Selection**: ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§Ø‡•Ç‡§ú‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç\n2. **Dravya Type**: ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞\n3. **Quantity**: ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§Æ‡•á‡§Ç)\n4. **Description**: ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£\n5. **Date**: ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n\n#### ‡§∏‡•á‡§µ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:\n1. **‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§≠‡§∞‡•á‡§Ç**\n2. **\"Save Dravya Entry\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∏‡§´‡§≤ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ**\n\n---\n\n## Payment Management\n\n### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording Payment\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤‡§®‡§æ\n1. **‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"Add Payment\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ ‡§™‡•â‡§™‡§Ö‡§™/‡§™‡•á‡§ú ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡§∞‡§®‡§æ\n1. **Amount**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø\n   - ‡§™‡•Ç‡§∞‡•Ä ‡§∞‡§æ‡§∂‡§ø ‡§Ø‡§æ ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§∞‡§æ‡§∂‡§ø\n   - ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ë‡§ü‡•ã-‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü ‡§π‡•ã‡§ó‡•Ä\n2. **Payment Mode**: ‡§°‡•ç‡§∞‡•â‡§™‡§°‡§æ‡§â‡§® ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç\n   - Cash (‡§®‡§ï‡§¶)\n   - UPI\n   - Bank Transfer\n   - Cheque\n   - Other\n3. **Date**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n4. **Notes**: ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡§æ\n1. **\"Record Payment\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§ü ‡§π‡•ã‡§ó‡§æ**\n3. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ**\n4. **‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§æ ‡§ë‡§™‡•ç‡§∂‡§® ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ**\n\n### ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§®‡§æ / Viewing Payment History\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§ï‡•ç‡§∂‡§®\n\n#### ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤ ‡§ï‡•â‡§≤‡§Æ‡•ç‡§∏:\n- **Receipt No**: ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞\n- **Amount**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø\n- **Mode**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ\n- **Date**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n- **Actions**: ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∞‡§∏‡•Ä‡§¶ ‡§¨‡§ü‡§®\n\n---\n\n## Advance Payment System\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording Advance Payment\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§´‡•â‡§∞‡•ç‡§Æ\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ\n1. **\"Boli Entries\" ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **\"+ Advance Payment\" ‡§¨‡§ü‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç**\n3. **‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§®‡§æ\n1. **User**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n2. **Amount**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§∞‡§æ‡§∂‡§ø\n3. **Payment Mode**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§æ ‡§§‡§∞‡•Ä‡§ï‡§æ\n4. **Date**: ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n5. **Notes**: ‡§®‡•ã‡§ü‡•ç‡§∏ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ / Checking Advance Balance\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§°‡§ø‡§∏‡•ç‡§™‡•ç‡§≤‡•á\n\n#### ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡§§‡§æ ‡§π‡•à:\n1. **‡§Ø‡•Ç‡§ú‡§∞ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø**: ‡§´‡•â‡§∞‡•ç‡§Æ ‡§Æ‡•á‡§Ç ‡§ë‡§ü‡•ã-‡§∂‡•ã\n2. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç**: ‡§ü‡•ã‡§ü‡§≤ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§Ö‡§Æ‡§æ‡§â‡§Ç‡§ü\n3. **‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§Æ‡•á‡§Ç**: ‡§á‡§Ç‡§°‡§ø‡§µ‡§ø‡§ú‡•Å‡§Ö‡§≤ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§è‡§™‡•ç‡§≤‡§æ‡§à ‡§ï‡§∞‡§®‡§æ / Applying Advance Payment\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§è‡§™‡•ç‡§≤‡§æ‡§à ‡§°‡§æ‡§Ø‡§≤‡•â‡§ó\n\n#### ‡§ë‡§ü‡•ã-‡§è‡§™‡•ç‡§≤‡§æ‡§à ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:\n1. **‡§®‡§à ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§¨‡§®‡§æ‡§§‡•á ‡§∏‡§Æ‡§Ø**\n2. **‡§Ö‡§ó‡§∞ ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§π‡•à**\n3. **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ë‡§™‡•ç‡§∂‡§® ‡§¶‡•á‡§ó‡§æ ‡§è‡§™‡•ç‡§≤‡§æ‡§à ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ**\n\n#### ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§è‡§™‡•ç‡§≤‡§æ‡§à:\n1. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ \"Apply Advance\" ‡§¨‡§ü‡§®**\n2. **‡§∞‡§æ‡§∂‡§ø ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n3. **\"Apply\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n## Expense Tracking\n\n### ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§™‡•á‡§ú / Expense Entries Page\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§™‡•á‡§ú\n\n#### ‡§™‡•á‡§ú ‡§è‡§≤‡§ø‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏:\n1. **\"+ New Expense\" ‡§¨‡§ü‡§®**\n2. **‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§ü‡•á‡§¨‡§≤**: ‡§∏‡§≠‡•Ä ‡§ñ‡§∞‡•ç‡§ö ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡•ç‡§∏\n3. **‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ë‡§™‡•ç‡§∂‡§®‡•ç‡§∏**: ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§î‡§∞ ‡§°‡•á‡§ü ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞\n\n### ‡§®‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡§®‡§æ / Recording New Expense\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§ï‡•ç‡§∏‡§™‡•á‡§Ç‡§∏ ‡§´‡•â‡§∞‡•ç‡§Æ\n\n#### ‡§´‡•â‡§∞‡•ç‡§Æ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏:\n1. **Category**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä\n2. **Description**: ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£\n3. **Amount**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§∞‡§æ‡§∂‡§ø\n4. **Date**: ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n5. **Receipt Upload**: ‡§∞‡§∏‡•Ä‡§¶ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:\n1. **\"Upload Receipt\" ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§´‡§æ‡§á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç** (JPG, PNG, PDF)\n3. **‡§Ö‡§™‡§≤‡•ã‡§° ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n## User Management\n\n### ‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü ‡§™‡•á‡§ú / User Management Page\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°\n\n#### ‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏:\n- **‡§ï‡•á‡§µ‡§≤ Operator ‡§î‡§∞ Viewer ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**\n- **Admin ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á**\n\n#### ‡§™‡•á‡§ú ‡§∏‡•á‡§ï‡•ç‡§∂‡§®‡•ç‡§∏:\n1. **\"+ Add User\" ‡§¨‡§ü‡§®**\n2. **‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ü‡•á‡§¨‡§≤**\n3. **‡§¨‡§≤‡•ç‡§ï ‡§Ö‡§™‡§≤‡•ã‡§° ‡§∏‡•á‡§ï‡•ç‡§∂‡§®**\n\n### ‡§®‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞ ‡§¨‡§®‡§æ‡§®‡§æ / Creating New User\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§®‡•ç‡§Ø‡•Ç ‡§Ø‡•Ç‡§ú‡§∞ ‡§´‡•â‡§∞‡•ç‡§Æ\n\n#### ‡§´‡•â‡§∞‡•ç‡§Æ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏:\n1. **Username**: ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ (‡§Ø‡•Ç‡§®‡•Ä‡§ï ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è)\n2. **Password**: ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°\n3. **Name**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ\n4. **Role**: \n   - Operator\n   - Viewer\n\n#### ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Ç:\n- ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 8 ‡§ï‡•à‡§∞‡•á‡§ï‡•ç‡§ü‡§∞\n- ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡§æ ‡§Æ‡§ø‡§∂‡•ç‡§∞‡§£\n- ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§ï‡•à‡§∞‡•á‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂\n\n### ‡§¨‡§≤‡•ç‡§ï ‡§Ø‡•Ç‡§ú‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° / Bulk User Upload\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¨‡§≤‡•ç‡§ï ‡§Ö‡§™‡§≤‡•ã‡§° ‡§∏‡•á‡§ï‡•ç‡§∂‡§®\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 1: ‡§ü‡•á‡§Æ‡•ç‡§™‡§≤‡•á‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°\n1. **\"Download Template\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **Excel ‡§´‡§æ‡§á‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã‡§ó‡•Ä**\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 2: ‡§°‡•á‡§ü‡§æ ‡§≠‡§∞‡§®‡§æ\n1. **Excel ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§ï‡•â‡§≤‡§Æ ‡§≠‡§∞‡•á‡§Ç**:\n   - Name (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n   - Phone (‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï)\n   - Address (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)\n\n#### ‡§∏‡•ç‡§ü‡•á‡§™ 3: ‡§´‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ\n1. **\"Upload Users\" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§≠‡§∞‡•Ä ‡§π‡•Å‡§à Excel ‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§Ö‡§™‡§≤‡•ã‡§° ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n## Reports and Calendar\n\n### ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏ / Dashboard Reports\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•á‡§ï‡•ç‡§∂‡§®\n\n#### ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§°‡•ç‡§∏:\n1. **Total Amount**: ‚Çπ89,261 (‡§â‡§¶‡§æ‡§π‡§∞‡§£)\n2. **Received Amount**: ‚Çπ13,556\n3. **Pending Amount**: ‚Çπ75,705\n4. **Total Entries**: 69\n\n### ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§µ‡•ç‡§Ø‡•Ç / Calendar View\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§°‡•á‡§≤‡•Ä ‡§Ö‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞\n\n#### ‡§°‡•á‡§≤‡•Ä ‡§Ö‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞:\n- **‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§Ö‡§∞‡•ç‡§®‡§ø‡§Ç‡§ó**: ‡§∞‡§Ç‡§ó ‡§ï‡•ã‡§°‡•á‡§°\n- **‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø**: ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§°‡§ø‡§ü‡•á‡§≤ ‡§¶‡•á‡§ñ‡•á‡§Ç\n- **‡§Æ‡§Ç‡§•‡§≤‡•Ä ‡§µ‡•ç‡§Ø‡•Ç**: ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§°‡•á‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞\n\n#### ‡§°‡•á‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞:\n- **‡§π‡§∞ ‡§¶‡§ø‡§® ‡§ï‡•á ‡§≠‡•Å‡§ó‡§§‡§æ‡§®**: ‡§Ö‡§≤‡§ó ‡§ï‡§≤‡§∞ ‡§∏‡•ç‡§ï‡•Ä‡§Æ\n- **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏**: ‡§π‡•ã‡§µ‡§∞ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\n\n### ‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü / User Detail Report\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ü‡•á‡§¨‡§≤\n\n#### ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§è‡§ï‡•ç‡§∏‡•á‡§∏:\n1. **‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ \"View User Details\" ‡§¨‡§ü‡§®**\n2. **‡§Ø‡•Ç‡§ú‡§∞ ‡§µ‡§æ‡§á‡§ú‡§º ‡§∏‡§Æ‡§∞‡•Ä ‡§ü‡•á‡§¨‡§≤ ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä**\n\n#### ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•â‡§≤‡§Æ‡•ç‡§∏:\n- **User Name**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n- **Total Amount**: ‡§ï‡•Å‡§≤ ‡§¨‡•ã‡§≤‡•Ä ‡§∞‡§æ‡§∂‡§ø\n- **Paid Amount**: ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡•Ä ‡§ó‡§à ‡§∞‡§æ‡§∂‡§ø\n- **Pending Amount**: ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø\n- **Advance Balance**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏\n\n---\n\n## Receipt Generation\n\n### ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§∏‡•Ä‡§¶ / Boli Payment Receipt\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ë‡§™‡•ç‡§∂‡§®\n\n#### ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡•á‡§∞‡•á‡§∂‡§® ‡§∏‡•ç‡§ü‡•á‡§™‡•ç‡§∏:\n1. **‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç**\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§Æ‡•á‡§Ç \"Print Receipt\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§ñ‡•Å‡§≤‡•á‡§ó‡§æ**\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§∞‡§∏‡•Ä‡§¶ ‡§è‡§°‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®\n\n#### ‡§è‡§°‡§ø‡§ü‡•á‡§¨‡§≤ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏:\n1. **Referred By**: ‡§∞‡•á‡§´‡§∞‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n2. **Bedi Number**: ‡§¨‡•á‡§¶‡•Ä ‡§®‡§Ç‡§¨‡§∞\n3. **User Name**: ‡§Ø‡•Ç‡§ú‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ\n4. **Description**: ‡§¨‡•ã‡§≤‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£\n5. **Occasion**: ‡§Ö‡§µ‡§∏‡§∞\n\n#### ‡§è‡§°‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:\n1. **‡§´‡•Ä‡§≤‡•ç‡§° ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç**\n2. **\"Save Values\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç**\n3. **\"Print\" ‡§¨‡§ü‡§® ‡§∏‡•á ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§´‡§æ‡§á‡§®‡§≤ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶\n\n#### ‡§∞‡§∏‡•Ä‡§¶ ‡§ï‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≠‡§æ‡§ó:\n1. **‡§π‡•á‡§°‡§∞**: ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞\n2. **‡§Ø‡•Ç‡§ú‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏**: ‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä ‡§î‡§∞ ‡§™‡§§‡§æ\n3. **‡§∞‡§∏‡•Ä‡§¶ ‡§á‡§®‡•ç‡§´‡•â**: ‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡§î‡§∞ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï\n4. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏**: ‡§∞‡§æ‡§∂‡§ø ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø\n5. **‡§´‡•Å‡§ü‡§∞**: ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§æ‡§∞ ‡§∏‡•ç‡§•‡§æ‡§®\n\n### ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∞‡§∏‡•Ä‡§¶ / Dravya Receipt\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∞‡§∏‡•Ä‡§¶ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü\n\n#### ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∞‡§∏‡•Ä‡§¶ ‡§´‡•Ä‡§ö‡§∞‡•ç‡§∏:\n- **A4 ‡§∏‡§æ‡§á‡§ú‡§º**: ‡§¨‡§°‡§º‡§æ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü\n- **‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü**: ‡§™‡•Ç‡§∞‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç\n- **‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§∏‡•ç‡§™‡•á‡§∏‡§ø‡§´‡§ø‡§ï**: ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§ü‡§æ‡§á‡§™ ‡§î‡§∞ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ\n\n### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§∏‡•Ä‡§¶ / Advance Payment Receipt\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§∞‡§∏‡•Ä‡§¶ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü\n\n#### ‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§∞‡§∏‡•Ä‡§¶ ‡§ï‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Ç:\n- **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§≤‡•á‡§¨‡§≤**: ‡§∏‡§æ‡§´ ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§§‡§æ ‡§π‡•à\n- **‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§á‡§®‡•ç‡§´‡•â**: ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\n- **‡§Ø‡•Ç‡§®‡§ø‡§´‡§æ‡§á‡§° ‡§®‡§Ç‡§¨‡§∞‡§ø‡§Ç‡§ó**: SPDJMSJ-2025-00001 ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü\n\n---\n\n## Troubleshooting\n\n### ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç / Common Issues\n\n#### 1. ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ / Login Problems\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§≤‡•â‡§ó‡§ø‡§® ‡§è‡§∞‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú\n\n**‡§≤‡§ï‡•ç‡§∑‡§£**: \"Invalid credentials\" ‡§Ø‡§æ ‡§™‡•á‡§ú ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡•Å‡§≤ ‡§∞‡§π‡§æ\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n1. **‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **Caps Lock ‡§ë‡§´ ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ï‡•à‡§∂ ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n4. **‡§Ö‡§≤‡§ó ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ü‡•ç‡§∞‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç**\n\n#### 2. ‡§™‡•á‡§ú ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ / Page Loading Issues\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§è‡§∞‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®\n\n**‡§≤‡§ï‡•ç‡§∑‡§£**: ‡§™‡•á‡§ú ‡§Ö‡§ü‡§ï ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§Ø‡§æ ‡§è‡§∞‡§∞ ‡§¶‡§ø‡§ñ‡§§‡§æ ‡§π‡•à\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n1. **F5 ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§∞‡•Ä‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç**\n\n#### 3. ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ / Receipt Printing Issues\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®\n\n**‡§≤‡§ï‡•ç‡§∑‡§£**: ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡•Ä\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n1. **‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü‡§∞ ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§™‡•á‡§™‡§∞ ‡§∏‡§æ‡§á‡§ú‡§º ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç** (A5 ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è, A4 ‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è)\n3. **‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### 4. ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡§æ / Data Not Saving\n\n**üì∏ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§®‡•ã‡§ü**: ‡§∏‡•á‡§µ ‡§è‡§∞‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú\n\n**‡§≤‡§ï‡•ç‡§∑‡§£**: ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∞‡§π‡§æ\n**‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®**:\n1. **‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§ï‡•ç‡§µ‡§æ‡§Ø‡§∞‡•ç‡§° ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§≠‡§∞‡•á‡§Ç** (‡§≤‡§æ‡§≤ * ‡§µ‡§æ‡§≤‡•á)\n2. **‡§á‡§Ç‡§ü‡§∞‡§®‡•á‡§ü ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§∏‡•ç‡§ü‡•á‡§¨‡§≤ ‡§∞‡§ñ‡•á‡§Ç**\n3. **‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ü‡•ç‡§∞‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§™‡§∞‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§Ç‡§∏ ‡§ü‡§ø‡§™‡•ç‡§∏ / Performance Tips\n\n#### ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§ë‡§™‡•ç‡§ü‡§ø‡§Æ‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§®:\n1. **‡§ï‡•à‡§∂ ‡§∞‡•á‡§ó‡•Å‡§≤‡§∞‡§≤‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§ï‡§Æ ‡§ü‡•à‡§¨‡•ç‡§∏ ‡§ñ‡•ã‡§≤‡•á‡§Ç**\n3. **‡§Ö‡§™‡§°‡•á‡§ü‡•á‡§° ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞‡•á‡§Ç**\n\n### ‡§π‡•á‡§≤‡•ç‡§™ ‡§î‡§∞ ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü / Help and Support\n\n#### ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è:\n1. **‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç**\n2. **‡§è‡§∞‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ï‡•ã ‡§®‡•ã‡§ü ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n#### ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§î‡§∞ ‡§∏‡•Å‡§ù‡§æ‡§µ:\n- **‡§®‡§à ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§π‡•ã ‡§§‡•ã ‡§¨‡§§‡§æ‡§è‡§Ç**\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡•á ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§¶‡•á‡§Ç**\n\n---\n\n## ‡§∂‡•â‡§∞‡•ç‡§ü‡§ï‡§ü‡•ç‡§∏ ‡§î‡§∞ ‡§ü‡§ø‡§™‡•ç‡§∏ / Shortcuts and Tips\n\n### ‡§ï‡•Ä‡§¨‡•ã‡§∞‡•ç‡§° ‡§∂‡•â‡§∞‡•ç‡§ü‡§ï‡§ü‡•ç‡§∏:\n- **Ctrl + F**: ‡§™‡•á‡§ú ‡§Æ‡•á‡§Ç ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n- **F5**: ‡§™‡•á‡§ú ‡§∞‡§ø‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n- **Ctrl + P**: ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è\n- **Ctrl + S**: ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è (‡§ï‡•Å‡§õ ‡§´‡•â‡§∞‡•ç‡§Æ‡•ç‡§∏ ‡§Æ‡•á‡§Ç)\n\n### ‡§∏‡§Æ‡§Ø ‡§¨‡§ö‡§æ‡§®‡•á ‡§ï‡•á ‡§ü‡§ø‡§™‡•ç‡§∏:\n1. **‡§´‡•á‡§µ‡§∞‡•á‡§ü‡•ç‡§∏ ‡§Æ‡•á‡§Ç ‡§¨‡•Å‡§ï‡§Æ‡§æ‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§ë‡§ü‡•ã-‡§´‡§ø‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§≤‡•á‡§§‡•á ‡§∞‡§π‡•á‡§Ç**\n\n### ‡§¨‡•á‡§∏‡•ç‡§ü ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏‡•á‡§ú:\n1. **‡§°‡•á‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä‡§ú ‡§ü‡§æ‡§á‡§Æ ‡§™‡§∞ ‡§ï‡§∞‡•á‡§Ç**\n2. **‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡§∞‡•á‡§Ç**\n3. **‡§∞‡§∏‡•Ä‡§¶‡•á‡§Ç ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§ï‡•á ‡§¶‡•á‡§Ç**\n4. **‡§è‡§°‡§µ‡§æ‡§Ç‡§∏ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç**\n\n---\n\n**‡§Ø‡§π ‡§ó‡§æ‡§á‡§° ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü‡•ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§Æ‡•ç‡§™‡•ç‡§≤‡•Ä‡§ü ‡§π‡•ã‡§ó‡•Ä ‡§ú‡§¨ ‡§∏‡§≠‡•Ä ‡§™‡•á‡§ú‡•á‡§∏ ‡§ï‡•á ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü‡•ç‡§∏ ‡§ï‡•à‡§™‡•ç‡§ö‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§**\n\n**This guide will be complete with screenshots once all page screenshots are captured.**\n\n---\n\n## ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä / Contact Information\n\n### ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ / Technical Support\n- **‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§è‡§°‡§Æ‡§ø‡§®**: [‡§è‡§°‡§Æ‡§ø‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï]\n- **‡§à‡§Æ‡•á‡§≤**: [‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§à‡§Æ‡•á‡§≤]\n- **‡§´‡•ã‡§®**: [‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞]\n\n**‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü**: 6 ‡§Ö‡§ó‡§∏‡•ç‡§§ 2025\n**Last Updated**: August 6, 2025","size_bytes":32351},"local-deployment/client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"local-deployment/client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"local-deployment/client/src/components/entries-list-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesListMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isEntriesActive = location === '/entries' || location === '/dravya-entries' || location === '/expense-entries' || location === '/advance-payments';\n\n  const menuItems = [\n    {\n      path: '/entries',\n      icon: 'gavel',\n      label: 'Boli Entries',\n      description: user?.role === 'viewer' ? 'View your boli entries' : 'Manage boli-related entries'\n    },\n    {\n      path: '/dravya-entries',\n      icon: 'inventory_2',\n      label: 'Dravya Entries',\n      description: user?.role === 'viewer' ? 'View your dravya entries' : 'Manage dravya-related entries'\n    },\n    ...(user?.role === 'operator' ? [{\n      path: '/expense-entries',\n      icon: 'receipt_long',\n      label: 'Expense Entries',\n      description: 'Manage company expense records'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/advance-payments',\n      icon: 'account_balance_wallet',\n      label: 'Advance Payments',\n      description: 'Manage advance payment records'\n    }] : [])\n  ];\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isEntriesActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons\">list_alt</span>\n        <span className=\"text-xs\">Entries</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                View Entries\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":3640},"local-deployment/client/src/components/bottom-navigation.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport EntriesListMenu from \"./entries-list-menu\";\nimport EntriesFormMenu from \"./entries-form-menu\";\n\nexport default function BottomNavigation() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  \n  const isActive = (path: string) => {\n    if (path === '/dashboard' && (location === '/' || location === '/dashboard')) {\n      return true;\n    }\n    if (path === '/entries' && (location === '/entries' || location === '/dravya-entries')) {\n      return true;\n    }\n    return location === path || location.startsWith(path);\n  };\n  \n  const getItemClass = (path: string) => {\n    return `bottom-nav-item flex flex-col items-center py-2 px-4 ${\n      isActive(path) ? 'text-primary' : 'text-neutral-500'\n    }`;\n  };\n  \n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-neutral-200 pb-safe\">\n      <div className=\"flex items-center relative\">\n        {/* Admin Navigation */}\n        {user?.role === 'admin' ? (\n          <div className=\"flex-1 grid grid-cols-6 w-full\">\n            {/* First column: Dashboard */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/dashboard\">\n                <a className={getItemClass('/dashboard')}>\n                  <span className=\"material-icons\">dashboard</span>\n                  <span className=\"text-xs\">Dashboard</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: Entries List Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesListMenu />\n            </div>\n            \n            {/* Third column: Payments */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/payments\">\n                <a className={getItemClass('/payments')}>\n                  <span className=\"material-icons\">payments</span>\n                  <span className=\"text-xs\">Payments</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fourth column: Logs */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/logs\">\n                <a className={getItemClass('/logs')}>\n                  <span className=\"material-icons\">account_balance</span>\n                  <span className=\"text-xs\">Logs</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fifth column: Users */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/users\">\n                <a className={getItemClass('/users')}>\n                  <span className=\"material-icons\">people</span>\n                  <span className=\"text-xs\">Users</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Sixth column: Settings */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">Settings</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        ) : user?.role === 'operator' ? (\n          /* Operator Navigation - Has dashboard, entries list, add entry functionality, users, and payments */\n          <div className=\"flex-1 grid grid-cols-6 w-full\">\n            {/* First column: Dashboard */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/dashboard\">\n                <a className={getItemClass('/dashboard')}>\n                  <span className=\"material-icons\">dashboard</span>\n                  <span className=\"text-xs\">Dashboard</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: Entries List Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesListMenu />\n            </div>\n            \n            {/* Third column: Add Entry Form Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesFormMenu />\n            </div>\n            \n            {/* Fourth column: Payments */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/payments\">\n                <a className={getItemClass('/payments')}>\n                  <span className=\"material-icons\">payments</span>\n                  <span className=\"text-xs\">Payments</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fifth column: Users */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/users\">\n                <a className={getItemClass('/users')}>\n                  <span className=\"material-icons\">people</span>\n                  <span className=\"text-xs\">Users</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Sixth column: Settings */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">Settings</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        ) : (\n          /* Regular viewer - 2 columns with equal spacing */\n          <div className=\"flex-1 grid grid-cols-2 w-full\">\n            {/* First column: My Account */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/my-account\">\n                <a className={getItemClass('/my-account')}>\n                  <span className=\"material-icons\">person</span>\n                  <span className=\"text-xs\">My Account</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: My Profile (Settings for viewers) */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">My Profile</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6342},"local-deployment/client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4085},"local-deployment/client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"local-deployment/client/src/lib/constants.ts":{"content":"// Payment status\nexport const PAYMENT_STATUS = {\n  PENDING: \"pending\",\n  PARTIAL: \"partial\",\n  FULL: \"full\",\n};\n\n// User roles\nexport const USER_ROLE = {\n  ADMIN: \"admin\",\n  VIEWER: \"viewer\",\n};\n\n// Local storage keys\nexport const STORAGE_KEYS = {\n  AUTH_TOKEN: \"ledger_auth_token\",\n};\n","size_bytes":287},"local-deployment/client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1145},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { PaymentStatus, type Entry } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport DailyEarningsCalendar from \"@/components/daily-earnings-calendar\";\nimport DailyPaymentsCalendar from \"@/components/daily-payments-calendar\";\n\ntype DashboardData = {\n  summary: {\n    totalAmount: number;\n    receivedAmount: number;\n    pendingAmount: number;\n    pendingEntries: number;\n    partialEntries: number;\n    completedEntries: number;\n    totalAdvancePayments?: number;\n  };\n  overallSummary: {\n    corpusValue: number;\n    totalReceived: number;\n    totalAdvancePayments: number;\n    totalExpenses: number;\n    totalReceivedOutstanding: number;\n    cashInBank: number;\n  };\n  recentActivity: Entry[];\n};\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case 'pending': return 'bg-destructive';\n    case 'partial': return 'bg-orange-500';\n    case 'full': return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case 'pending': return 'Payment Pending';\n    case 'partial': return 'Partially Paid';\n    case 'full': return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nconst getActivityIcon = (status: string) => {\n  switch(status) {\n    case 'pending': return 'pending';\n    case 'partial': return 'sync';\n    case 'full': return 'check_circle';\n    default: return 'info';\n  }\n};\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  \n  // Block access for viewer role\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4 text-center\">\n        <h2 className=\"text-lg font-semibold mb-2\">Access Restricted</h2>\n        <p className=\"text-muted-foreground\">Dashboard is not available for your role.</p>\n      </div>\n    );\n  }\n  const [, setLocation] = useLocation();\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  const [startDate, setStartDate] = useState<Date | null>(new Date(new Date().getFullYear(), 0, 1)); // Start of current year\n  const [endDate, setEndDate] = useState<Date | null>(new Date()); // Today\n  \n  // Build query parameters for date range\n  const queryParams = new URLSearchParams();\n  if (startDate) queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  if (endDate) queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n\n  const { data, isLoading, error } = useQuery<DashboardData>({\n    queryKey: ['/api/dashboard', startDate?.toISOString(), endDate?.toISOString()],\n    queryFn: () => fetch(`/api/dashboard?${queryParams.toString()}`).then(res => res.json()),\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 30 * 1000 // Consider data stale after 30 seconds\n  });\n\n  // Dashboard only shows boli entries - dravya entries are completely separate\n  const { data: entries } = useQuery<Entry[]>({\n    queryKey: ['/api/entries'],\n  });\n\n  // Fetch expense entries for total expenses calculation (only for admin/operator)\n  const { data: expenseEntries } = useQuery<any[]>({\n    queryKey: ['/api/expense-entries', startDate?.toISOString(), endDate?.toISOString()],\n    queryFn: () => {\n      const expenseParams = new URLSearchParams();\n      if (startDate) expenseParams.append('startDate', startDate.toISOString().split('T')[0]);\n      if (endDate) expenseParams.append('endDate', endDate.toISOString().split('T')[0]);\n      return fetch(`/api/expense-entries?${expenseParams.toString()}`).then(res => res.json());\n    },\n    enabled: user?.role === 'admin' || user?.role === 'operator', // Only fetch for admin/operator\n    retry: false, // Don't retry on 403 errors\n  });\n\n  // Calculate total expenses from expense entries within date range (only for admin/operator)\n  const totalExpenses = (user?.role === 'admin' || user?.role === 'operator') \n    ? (Array.isArray(expenseEntries) ? expenseEntries.reduce((sum, expense) => {\n        const expenseDate = new Date(expense.expense_date);\n        const isInRange = (!startDate || expenseDate >= startDate) && (!endDate || expenseDate <= endDate);\n        return isInRange ? sum + expense.amount : sum;\n      }, 0) : 0)\n    : 0; // Viewers always get 0 for expenses\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading dashboard data...</div>;\n  }\n\n  if (error) {\n    return <div className=\"p-4 text-destructive\">Error loading dashboard: {error.message}</div>;\n  }\n\n  const { summary, overallSummary, recentActivity } = data || { \n    summary: { \n      totalAmount: 0, \n      receivedAmount: 0, \n      pendingAmount: 0,\n      pendingEntries: 0,\n      partialEntries: 0,\n      completedEntries: 0\n    }, \n    recentActivity: [] \n  };\n\n  return (\n    <div className=\"flex-grow p-4\">\n      <div className=\"mb-6\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h1 className=\"text-xl font-medium\">Dashboard</h1>\n          <div className=\"text-sm bg-primary text-white px-3 py-1 rounded-full hidden sm:block\">\n            {user?.role === 'admin' ? 'Admin View' : 'User View'}\n          </div>\n        </div>\n        \n        {/* Mobile-first date filters */}\n        <div className=\"flex flex-col sm:flex-row gap-2 sm:gap-4 sm:items-center\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">From:</span>\n            <DatePicker\n              selected={startDate}\n              onChange={(date) => setStartDate(date)}\n              dateFormat=\"yyyy-MM-dd\"\n              className=\"w-full sm:w-auto px-3 py-2 border border-neutral-300 rounded-md text-sm\"\n              placeholderText=\"Start date\"\n            />\n          </div>\n          <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">To:</span>\n            <DatePicker\n              selected={endDate}\n              onChange={(date) => setEndDate(date)}\n              dateFormat=\"yyyy-MM-dd\"\n              className=\"w-full sm:w-auto px-3 py-2 border border-neutral-300 rounded-md text-sm\"\n              placeholderText=\"End date\"\n            />\n          </div>\n          <Button \n            onClick={() => {\n              setStartDate(new Date(new Date().getFullYear(), 0, 1));\n              setEndDate(new Date());\n            }}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-full sm:w-auto\"\n          >\n            Reset\n          </Button>\n        </div>\n      </div>\n\n      {/* Overall Summary - Independent of filters */}\n      {overallSummary && (\n        <>\n          <h2 className=\"text-lg font-medium mb-3\">Overall Summary</h2>\n          <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 sm:p-6 mb-6\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-11 gap-4 lg:gap-2 items-center\">\n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Corpus as on 31st Jul'25</p>\n                <p className=\"text-xl font-semibold text-blue-600\">‚Çπ{overallSummary.corpusValue.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-green-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Received</p>\n                <p className=\"text-xl font-semibold text-green-600\">‚Çπ{overallSummary.totalReceived.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-orange-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Advance Payments</p>\n                <p className=\"text-xl font-semibold text-orange-600\">‚Çπ{overallSummary.totalAdvancePayments.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-purple-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Received Outstanding</p>\n                <p className=\"text-xl font-semibold text-purple-600\">‚Çπ{(overallSummary.totalReceivedOutstanding || 0).toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-red-600\">-</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Expenses</p>\n                <p className=\"text-xl font-semibold text-red-600\">‚Çπ{overallSummary.totalExpenses.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-blue-700\">=</p>\n              </div>\n              \n              <div className=\"text-center bg-white rounded-lg p-3 border-2 border-blue-300 min-w-[140px]\">\n                <p className=\"text-sm text-neutral-600\">Cash in Bank</p>\n                <p className=\"text-xl font-bold text-blue-700\">‚Çπ{overallSummary.cashInBank.toLocaleString()}</p>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n      \n      {/* Boli Entry Receivables Summary - Filtered by date range */}\n      <h2 className=\"text-lg font-medium mb-3\">Boli Entry Receivables Summary</h2>\n      <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-6\">\n        {/* Total Earnings */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Total Earnings</p>\n          <p className=\"text-base sm:text-lg font-medium\">‚Çπ{summary?.totalAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Received Amount */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Received</p>\n          <p className=\"text-base sm:text-lg font-medium text-green-500\">‚Çπ{summary?.receivedAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Pending Amount */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Pending</p>\n          <p className=\"text-base sm:text-lg font-medium text-destructive\">‚Çπ{summary?.pendingAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Total Expenses */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Total Expenses</p>\n          <p className=\"text-base sm:text-lg font-medium text-red-500\">‚Çπ{totalExpenses.toLocaleString()}</p>\n        </div>\n        \n        {/* Total Advance Payments - Only show for admin/operator */}\n        {(user?.role === 'admin' || user?.role === 'operator') && (\n          <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm col-span-2 sm:col-span-1\">\n            <p className=\"text-xs text-neutral-500\">Total Advance Payments</p>\n            <p className=\"text-base sm:text-lg font-medium text-orange-600\">‚Çπ{(summary.totalAdvancePayments || 0).toLocaleString()}</p>\n          </div>\n        )}\n      </div>\n      \n      {/* Status Summary */}\n      <h2 className=\"text-lg font-medium mb-3\">Payment Status</h2>\n      <div className=\"grid grid-cols-3 gap-2 sm:gap-3 mb-6\">\n        {/* Pending Entries */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-destructive text-lg sm:text-xl\">pending</span>\n            <span className=\"text-base sm:text-lg font-medium\">{summary.pendingEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Pending</p>\n        </div>\n        \n        {/* Partial Entries */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-orange-500 text-lg sm:text-xl\">sync</span>\n            <span className=\"text-base sm:text-lg font-medium\">{summary.partialEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Partial</p>\n        </div>\n        \n        {/* Completed Entries */}\n        <div className=\"bg-white p-3 sm:p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-green-500 text-lg sm:text-xl\">check_circle</span>\n            <span className=\"text-base sm:text-lg font-medium\">{summary.completedEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Completed</p>\n        </div>\n      </div>\n      \n      {/* Daily Earnings Calendar */}\n      <div className=\"mt-6\">\n        <DailyEarningsCalendar />\n      </div>\n      \n      {/* Daily Payments Calendar */}\n      <div className=\"mt-6\">\n        <DailyPaymentsCalendar />\n      </div>\n      \n      {/* Recent Activity */}\n      <div className=\"mt-6\">\n        <h2 className=\"text-lg font-medium mb-3\">Recent Activity</h2>\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\n          <div>\n            {recentActivity.length === 0 ? (\n              <div className=\"p-8 text-center text-neutral-500\">No recent activity</div>\n            ) : (\n              recentActivity.map(entry => (\n                <div key={entry.id} className=\"flex items-center p-3 border-b border-neutral-200\">\n                  <div className=\"w-10 h-10 rounded-full bg-neutral-200 flex items-center justify-center mr-3\">\n                    <span className=\"material-icons text-neutral-500\">{getActivityIcon(entry.status)}</span>\n                  </div>\n                  <div className=\"flex-grow\">\n                    <div className=\"font-medium\">{entry.description}</div>\n                    <div className=\"text-sm text-neutral-500\">\n                      {entry.userName} - {new Date(entry.auctionDate).toLocaleDateString()}\n                    </div>\n                  </div>\n                  <div>\n                    <span className={`px-2 py-1 rounded-full text-white text-xs font-medium ${getStatusClass(entry.status)}`}>\n                      {getStatusText(entry.status)}\n                    </span>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n          {recentActivity.length > 0 && (\n            <div className=\"p-3 text-center\">\n              <button onClick={() => setLocation('/entries')} className=\"text-primary font-medium text-sm\">View All Activities</button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15459},"local-deployment/client/src/components/payment-receipt.tsx":{"content":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { type Entry, type PaymentRecord } from '@shared/schema';\nimport { formatDate } from '@/lib/utils';\n\ninterface PaymentReceiptProps {\n  entry: Entry;\n  payment: PaymentRecord;\n  onClose: () => void;\n}\n\nexport function PaymentReceipt({ entry, payment, onClose }: PaymentReceiptProps) {\n  const printReceipt = () => {\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n    \n    // Helper functions for Hindi conversion\n    const getPaymentModeHindi = (mode: string): string => {\n      const modeMap: { [key: string]: string } = {\n        'cash': '‡§®‡§ó‡§¶',\n        'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à', \n        'cheque': '‡§ö‡•á‡§ï',\n        'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó',\n        'advance_payment': '‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®'\n      };\n      return modeMap[mode.toLowerCase()] || mode;\n    };\n\n    const formatHindiDate = (dateString: string): string => {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('hi-IN', {\n        day: '2-digit',\n        month: '2-digit', \n        year: '2-digit'\n      });\n    };\n\n    // Add cache breaker for images\n    const cacheBreaker = Date.now();\n\n    const html = `\n      <!DOCTYPE html>\n      <html lang=\"hi\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <title>‡§¨‡•ã‡§≤‡•Ä ‡§∞‡§∏‡•Ä‡§¶: ${payment.receiptNo || '‡§∞‡§∏‡•Ä‡§¶'}</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n            \n            body {\n              font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n              margin: 0;\n              padding: 20px;\n              background: white;\n              color: #000;\n              font-size: 14px;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 700px;\n              margin: 0 auto;\n              border: 2px solid #000;\n              padding: 0;\n            }\n            \n            .receipt-header {\n              display: flex;\n              align-items: center;\n              justify-content: space-between;\n              padding: 15px 20px;\n              border-bottom: 2px solid #000;\n              background: #f8f9fa;\n            }\n            \n            .left-logo {\n              width: 80px;\n              height: 120px;\n              object-fit: contain;\n            }\n            \n            .center-content {\n              flex-grow: 1;\n              text-align: center;\n              margin: 0 20px;\n            }\n            \n            .temple-name {\n              font-size: 22px;\n              font-weight: 700;\n              margin-bottom: 5px;\n              color: #d97706;\n            }\n            \n            .temple-subtitle {\n              font-size: 14px;\n              margin-bottom: 3px;\n              color: #666;\n            }\n            \n            .receipt-title {\n              font-size: 18px;\n              font-weight: 600;\n              margin-top: 8px;\n              color: #000;\n            }\n            \n            .right-logo {\n              width: 80px;\n              height: 80px;\n              object-fit: contain;\n              border-radius: 50%;\n            }\n            \n            .receipt-body {\n              padding: 20px;\n            }\n            \n            .info-section {\n              margin-bottom: 20px;\n            }\n            \n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-bottom: 10px;\n              padding: 5px 0;\n            }\n            \n            .left-info {\n              flex: 1;\n              font-weight: 600;\n            }\n            \n            .right-info {\n              flex: 1;\n              text-align: right;\n              font-weight: 600;\n            }\n            \n            .amount-section {\n              background: #f3f4f6;\n              padding: 15px;\n              border: 1px solid #d1d5db;\n              margin: 20px 0;\n              text-align: center;\n            }\n            \n            .amount-hindi {\n              font-size: 18px;\n              font-weight: 700;\n              color: #dc2626;\n            }\n            \n            .signature-area {\n              margin-top: 40px;\n              display: flex;\n              justify-content: space-between;\n              align-items: end;\n            }\n            \n            .signature-box {\n              width: 200px;\n              text-align: center;\n            }\n            \n            .signature-line {\n              border-top: 1px solid #000;\n              padding-top: 8px;\n              margin-top: 50px;\n              font-size: 12px;\n            }\n            \n            @media print {\n              .no-print { display: none; }\n              body { padding: 10px; }\n              .receipt-container { max-width: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt-container\">\n            <!-- Header with logos -->\n            <div class=\"receipt-header\">\n              <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" class=\"left-logo\">\n              \n              <div class=\"center-content\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§¨‡•ã‡§≤‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" class=\"right-logo\">\n            </div>\n            \n            <!-- Receipt body -->\n            <div class=\"receipt-body\">\n              <div class=\"info-section\">\n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${payment.receiptNo || 'N/A'}</div>\n                  <div class=\"right-info\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(payment.date)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä: ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä ${entry.userName}</div>\n                  <div class=\"right-info\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(entry.auctionDate)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§™‡§§‡§æ: ${entry.userAddress || '‡§™‡§§‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</div>\n                  <div class=\"right-info\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø: ${getPaymentModeHindi(payment.mode)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§¨‡§æ‡§¨‡§§: ${entry.description}</div>\n                  <div class=\"right-info\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: 1</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞: ${entry.occasion}</div>\n                  <div class=\"right-info\"></div>\n                </div>\n              </div>\n              \n              <!-- Amount section -->\n              <div class=\"amount-section\">\n                <div style=\"margin-bottom: 10px;\">\n                  <strong>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.amount.toLocaleString()}</strong>\n                </div>\n                <div style=\"font-size: 12px; color: #666;\">\n                  ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.totalAmount.toLocaleString()} | \n                  ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.pendingAmount.toLocaleString()}\n                </div>\n              </div>\n              \n              <!-- Signature area -->\n              <div class=\"signature-area\">\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n              </div>\n              \n              <div style=\"text-align: center; margin-top: 30px; font-size: 11px; color: #666;\">\n                <p>‡§Ø‡§π ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§ø‡§§ ‡§∞‡§∏‡•Ä‡§¶ ‡§π‡•à‡•§</p>\n                <p><strong>‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡§∞‡•ç‡§ú:</strong> ${payment.updatedBy || '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ'}</p>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"no-print\" style=\"text-align: center; margin-top: 20px;\">\n            <button onclick=\"window.print();\" style=\"padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Noto Sans Devanagari', Arial, sans-serif;\">\n              ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n            </button>\n          </div>\n        </body>\n      </html>\n    `;\n    \n    printWindow.document.open();\n    printWindow.document.write(html);\n    printWindow.document.close();\n  };\n\n  return (\n    <div className=\"p-4 bg-white rounded-lg shadow-md\">\n      <h2 className=\"text-xl font-bold mb-4\">Payment Receipt</h2>\n      <p className=\"text-sm text-gray-500 mb-4\">Receipt No: {payment.receiptNo || 'N/A'}</p>\n      \n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <div>\n          <p className=\"text-sm font-semibold\">Name:</p>\n          <p>{entry.userName}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Date:</p>\n          <p>{formatDate(payment.date)}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Amount:</p>\n          <p className=\"font-bold\">‚Çπ{payment.amount.toLocaleString()}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Payment Mode:</p>\n          <p>{payment.mode.toUpperCase()}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Description:</p>\n          <p>{entry.description}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Occasion:</p>\n          <p>{entry.occasion}</p>\n        </div>\n      </div>\n      \n      <div className=\"flex justify-end gap-2 mt-4\">\n        <Button variant=\"outline\" onClick={onClose}>Close</Button>\n        <Button onClick={printReceipt}>Print Receipt</Button>\n      </div>\n    </div>\n  );\n}\n\nexport default PaymentReceipt;","size_bytes":10849},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"local-deployment/client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/toggle-group.tsx":{"content":"import * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1739},"local-deployment/client/src/components/entries-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isEntriesActive = location === '/entries' || location === '/dravya-entries' || \n                          location === '/entry/new' || location === '/dravya-entry-form';\n\n  const menuItems = [\n    {\n      path: '/entries',\n      icon: 'gavel',\n      label: 'Boli Entries',\n      description: user?.role === 'viewer' ? 'View your boli entries' : 'Manage boli-related entries'\n    },\n    {\n      path: '/dravya-entries',\n      icon: 'inventory_2',\n      label: 'Dravya Entries',\n      description: user?.role === 'viewer' ? 'View your dravya entries' : 'Manage dravya-related entries'\n    }\n  ];\n\n  // Add entry creation options for operators\n  if (user?.role === 'operator') {\n    menuItems.push(\n      {\n        path: '/entry/new',\n        icon: 'add_circle',\n        label: 'New Boli Entry',\n        description: 'Create new boli entry'\n      },\n      {\n        path: '/dravya-entry-form',\n        icon: 'add_circle',\n        label: 'New Dravya Entry',\n        description: 'Create new dravya entry'\n      }\n    );\n  }\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isEntriesActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons\">folder_open</span>\n        <span className=\"text-xs\">Entries</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                Entry Management\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":3657},"local-deployment/client/src/components/ui/toggle-group.tsx":{"content":"import * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1739},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":845},"local-deployment/client/src/components/ui/collapsible.tsx":{"content":"import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":315},"local-deployment/client/src/lib/context/auth-context.tsx":{"content":"import { createContext, useEffect, useState, ReactNode } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { AuthUser } from \"@/lib/auth\";\n\ntype AuthContextType = {\n  user: AuthUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  refreshUser: () => void;\n};\n\nexport const AuthContext = createContext<AuthContextType>({\n  user: null,\n  isLoading: false,\n  error: null,\n  refreshUser: () => {}\n});\n\ntype AuthProviderProps = {\n  children: ReactNode;\n};\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const queryClient = useQueryClient();\n  \n  const { data, isLoading, error, refetch } = useQuery<AuthUser | null>({\n    queryKey: ['/api/auth/user'],\n    queryFn: async () => {\n      const res = await fetch('/api/auth/user', {\n        credentials: 'include',\n      });\n      \n      if (res.status === 401) {\n        return null; // Not authenticated\n      }\n      \n      if (!res.ok) {\n        throw new Error(`Failed to fetch user: ${res.status}`);\n      }\n      \n      return res.json();\n    },\n    retry: false,\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n    staleTime: 2 * 60 * 1000\n  });\n  \n  // Function to force refresh user data\n  const refreshUser = () => {\n    refetch();\n  };\n\n  return (\n    <AuthContext.Provider value={{ \n      user: data || null, \n      isLoading, \n      error: error as Error,\n      refreshUser\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n","size_bytes":1462},"local-deployment/client/src/components/sidebar-navigation.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { \n  Menu, \n  Home, \n  Users, \n  FileText, \n  Plus, \n  CreditCard, \n  BarChart3, \n  Settings,\n  UserCircle,\n  Receipt,\n  DollarSign,\n  BookOpen,\n  ChevronDown,\n  ChevronRight\n} from \"lucide-react\";\nimport mandirLogo from \"@assets/new logo mandir color_1754807711657.jpg\";\n\ninterface User {\n  role: string;\n  name?: string;\n  username: string;\n}\n\nexport function SidebarNavigation() {\n  const [location] = useLocation();\n  const [isOpen, setIsOpen] = useState(false);\n  const [openMenus, setOpenMenus] = useState<string[]>([]);\n  \n  const { data: user } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n    retry: false\n  });\n\n  const isViewer = user?.role === 'viewer';\n\n  const toggleMenu = (menuKey: string) => {\n    setOpenMenus(prev => \n      prev.includes(menuKey) \n        ? prev.filter(key => key !== menuKey)\n        : [...prev, menuKey]\n    );\n  };\n  \n  const menuGroups = [\n    {\n      key: \"dashboard\",\n      label: \"Dashboard\",\n      icon: Home,\n      href: \"/dashboard\",\n      show: user?.role === 'admin' || user?.role === 'operator',\n      isMainItem: true\n    },\n    {\n      key: \"account\",\n      label: \"My Account\", \n      icon: UserCircle,\n      show: true,\n      items: [\n        {\n          label: \"My Account\",\n          href: \"/my-account\",\n          show: true\n        }\n      ]\n    },\n    {\n      key: \"users\",\n      label: \"Users\",\n      icon: Users,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"All Users\",\n          href: \"/users\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"entries\",\n      label: \"Boli Entries\",\n      icon: FileText,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"View Boli Entries\",\n          href: \"/entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"Add New Boli Entry\",\n          href: \"/entry/new\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"dravya\",\n      label: \"Dravya\",\n      icon: BookOpen,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"Dravya Entries\",\n          href: \"/dravya-entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Dravya Entry\",\n          href: \"/dravya-entry-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"expenses\",\n      label: \"Expenses\",\n      icon: Receipt,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"Expense Entries\",\n          href: \"/expense-entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Expense\",\n          href: \"/expense-entry-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"payments\",\n      label: \"Payments\",\n      icon: DollarSign,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"All Boli Payments\",\n          href: \"/payments\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"All Advance Payments\",\n          href: \"/advance-payments\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Advance Payment\",\n          href: \"/advance-payment-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"Previous Outstanding\",\n          href: \"/previous-outstanding\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"logs\",\n      label: \"Logs\",\n      icon: BarChart3,\n      href: \"/logs\",\n      show: user?.role === 'admin',\n      isMainItem: true\n    },\n    {\n      key: \"settings\",\n      label: user?.role === 'viewer' ? \"My Profile\" : \"Settings\",\n      icon: Settings,\n      href: \"/settings\",\n      show: true,\n      isMainItem: true\n    }\n  ];\n\n  const filteredMenuGroups = menuGroups.filter(group => group.show);\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full\">\n      {/* Header */}\n      <div className=\"p-4 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <img \n            src={mandirLogo} \n            alt=\"Temple Logo\" \n            className=\"w-8 h-8 rounded-full\"\n          />\n          <div>\n            <h2 className=\"font-semibold text-sm\">‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£</h2>\n            <p className=\"text-xs text-muted-foreground\">\n              {user?.name || user?.username}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <div className=\"flex-1 overflow-auto p-4\">\n        <nav className=\"space-y-2\">\n          {filteredMenuGroups.map((group) => {\n            const Icon = group.icon;\n            const isMenuOpen = openMenus.includes(group.key);\n            \n            // For main items without sub-menus\n            if (group.isMainItem) {\n              const isActive = location === group.href;\n              return (\n                <Link key={group.key} href={group.href!}>\n                  <Button\n                    variant={isActive ? \"default\" : \"ghost\"}\n                    className=\"w-full justify-start gap-3\"\n                    onClick={() => setIsOpen(false)}\n                  >\n                    <Icon size={18} />\n                    {group.label}\n                  </Button>\n                </Link>\n              );\n            }\n\n            // For menu groups with sub-items\n            return (\n              <Collapsible key={group.key} open={isMenuOpen} onOpenChange={() => toggleMenu(group.key)}>\n                <CollapsibleTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-between gap-3\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Icon size={18} />\n                      {group.label}\n                    </div>\n                    {isMenuOpen ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\n                  </Button>\n                </CollapsibleTrigger>\n                <CollapsibleContent className=\"space-y-1 mt-1\">\n                  {group.items?.filter(item => item.show).map((item) => {\n                    const isActive = location === item.href || \n                      (item.href === \"/my-account\" && location.includes(\"/users/\"));\n                    \n                    return (\n                      <Link key={item.href} href={item.href}>\n                        <Button\n                          variant={isActive ? \"default\" : \"ghost\"}\n                          className=\"w-full justify-start gap-3 ml-6 text-sm\"\n                          onClick={() => setIsOpen(false)}\n                        >\n                          {item.label}\n                        </Button>\n                      </Link>\n                    );\n                  })}\n                </CollapsibleContent>\n              </Collapsible>\n            );\n          })}\n        </nav>\n      </div>\n    </div>\n  );\n\n  return (\n    <>\n      <Button \n        variant=\"outline\" \n        size=\"icon\"\n        className=\"fixed top-4 left-4 z-50 bg-white shadow-md\"\n        onClick={() => setIsOpen(true)}\n      >\n        <Menu size={20} />\n      </Button>\n      \n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 flex\">\n          <div className=\"fixed inset-0 bg-black/50\" onClick={() => setIsOpen(false)} />\n          <div className=\"relative bg-white w-72 h-full shadow-lg\">\n            <SidebarContent />\n          </div>\n        </div>\n      )}\n    </>\n  );\n}","size_bytes":8337},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className=\"h-4 w-4\" />,\n        IconRight: ({ ...props }) => <ChevronRight className=\"h-4 w-4\" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2609},"local-deployment/client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"local-deployment/client/src/components/ui/sheet.tsx":{"content":"import * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4267},"local-deployment/client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4879},"local-deployment/client/src/components/ui/resizable.tsx":{"content":"import { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1709},"local-deployment/server/routes.ts":{"content":"import express, { type Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport csv from \"csv-parser\";\nimport { storage } from \"./storage\";\nimport { ZodError } from \"zod\";\nimport { eq, desc } from \"drizzle-orm\";\nimport { db, pool } from \"./db\";\nimport { \n  insertUserSchema, \n  insertEntrySchema,\n  insertDravyaEntrySchema,\n  insertExpenseEntrySchema,\n  insertAdvancePaymentSchema,\n  insertPreviousOutstandingRecordSchema,\n  insertCorpusSettingsSchema,\n  recordPaymentSchema, \n  PaymentStatus,\n  PaymentStatusType,\n  PaymentMode,\n  TransactionType,\n  entries,\n  expenseEntries,\n  advancePayments,\n  previousOutstandingRecords,\n  corpusSettings\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport session from \"express-session\";\nimport MemoryStore from \"memorystore\";\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\n\n\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  const { TransactionType } = await import(\"@shared/schema\");\n  \n  // Serve uploaded files statically\n  app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\n  \n  // Set up session store\n  const MemoryStoreSession = MemoryStore(session);\n  \n  app.use(session({\n    secret: process.env.SESSION_SECRET || \"ledger-secret-key\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 },\n    store: new MemoryStoreSession({\n      checkPeriod: 86400000 // Prune expired entries every 24h\n    })\n  }));\n\n  // Set up authentication\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(new LocalStrategy(async (username, password, done) => {\n    try {\n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        return done(null, false, { message: \"Incorrect username\" });\n      }\n      if (user.password !== password) {\n        return done(null, false, { message: \"Incorrect password\" });\n      }\n      if (user.status !== \"active\") {\n        return done(null, false, { message: \"User account is inactive\" });\n      }\n      return done(null, user);\n    } catch (err) {\n      return done(err);\n    }\n  }));\n\n  passport.serializeUser((user: any, done) => {\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: number, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (err) {\n      done(err);\n    }\n  });\n\n  // Auth middleware\n  const isAuthenticated = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated()) {\n      return next();\n    }\n    res.status(401).json({ message: \"Unauthorized\" });\n  };\n\n  const isAdmin = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && (req.user as any).role === \"admin\") {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Admin access required\" });\n  };\n\n  const isAdminOrOperator = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && \n        ((req.user as any).role === \"admin\" || (req.user as any).role === \"operator\")) {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n  };\n  \n  const isOperator = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && (req.user as any).role === \"operator\") {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Operator access required\" });\n  };\n\n  // Auth routes\n  app.post(\"/api/auth/login\", (req, res, next) => {\n    passport.authenticate(\"local\", (err: Error, user: any, info: any) => {\n      if (err) return next(err);\n      if (!user) return res.status(401).json({ message: info.message || \"Authentication failed\" });\n      \n      req.logIn(user, (err) => {\n        if (err) return next(err);\n        return res.json({ \n          id: user.id,\n          username: user.username,\n          name: user.name,\n          email: user.email,\n          role: user.role,\n          status: user.status,\n          mobile: user.mobile,\n          address: user.address\n        });\n      });\n    })(req, res, next);\n  });\n\n  app.get(\"/api/auth/user\", (req, res) => {\n    if (!req.user) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    const user = req.user as any;\n    res.json({\n      id: user.id,\n      username: user.username,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n      status: user.status,\n      mobile: user.mobile,\n      address: user.address\n    });\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.logout(() => {\n      res.json({ success: true });\n    });\n  });\n\n  // Set up multer for file uploads\n  const uploadsDir = path.join(process.cwd(), 'uploads');\n  if (!fs.existsSync(uploadsDir)) {\n    fs.mkdirSync(uploadsDir, { recursive: true });\n  }\n\n  const storage_multer = multer.diskStorage({\n    destination: (req, file, cb) => {\n      cb(null, uploadsDir);\n    },\n    filename: (req, file, cb) => {\n      // Create unique filename with timestamp\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));\n    }\n  });\n\n  const upload = multer({ \n    storage: storage_multer,\n    limits: {\n      fileSize: 10 * 1024 * 1024, // 10MB limit\n    },\n    fileFilter: (req, file, cb) => {\n      const allowedTypes = [\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'application/pdf',\n        'text/csv',\n        'application/vnd.ms-excel',\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      ];\n      \n      if (file.fieldname === 'receiptFile' || file.fieldname === 'paymentScreenshot' || file.fieldname === 'attachmentFile') {\n        const imageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\n        if (imageTypes.includes(file.mimetype)) {\n          cb(null, true);\n        } else {\n          cb(new Error('Only JPG, JPEG, PNG and PDF files are allowed'));\n        }\n      } else if (file.fieldname === 'file') {\n        // For bulk upload files\n        const csvTypes = ['text/csv', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];\n        if (csvTypes.includes(file.mimetype) || file.originalname.endsWith('.csv')) {\n          cb(null, true);\n        } else {\n          cb(new Error('Only CSV and Excel files are allowed for bulk upload'));\n        }\n      } else {\n        cb(new Error('Unexpected field'));\n      }\n    }\n  });\n  \n  // Update current user's profile\n  app.patch(\"/api/auth/profile\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = currentUser.id;\n      \n      // Only allow certain fields to be updated\n      const allowedUpdates = [\"name\", \"email\", \"mobile\", \"address\"];\n      const updates: any = {};\n      \n      Object.keys(req.body).forEach(key => {\n        if (allowedUpdates.includes(key)) {\n          updates[key] = req.body[key];\n        }\n      });\n      \n      const updatedUser = await storage.updateUser(userId, updates);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Invalidate caches to ensure updated data is reflected everywhere\n      (req as any).sessionStore.all((err: any, sessions: any) => {\n        if (sessions) {\n          Object.values(sessions).forEach((session: any) => {\n            const wsClient = (req as any).app.get('wsClients')?.get(session.id);\n            if (wsClient) {\n              wsClient.send(JSON.stringify({\n                type: 'CACHE_INVALIDATION',\n                keys: [\n                  '/api/users',\n                  '/api/entries',\n                  '/api/dashboard',\n                  '/api/auth/user'\n                ]\n              }));\n            }\n          });\n        }\n      });\n      \n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // User management routes\n  app.get(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to access users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      const users = await storage.getUsers();\n      \n      // If operator, filter out admin users\n      if (currentUser.role === 'operator') {\n        const filteredUsers = users.filter(user => user.role !== 'admin');\n        return res.json(filteredUsers);\n      }\n      \n      // Admins can see all users\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Get specific user details with related data\n  app.get(\"/api/users/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = parseInt(req.params.id);\n\n      // Allow users to view their own profile, or admin/operator to view others\n      const canViewProfile = \n        currentUser.id === userId || // User viewing their own profile\n        currentUser.role === 'admin' || \n        currentUser.role === 'operator';\n\n      if (!canViewProfile) {\n        return res.status(403).json({ message: \"Forbidden: Can only view your own profile\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // If operator, don't allow viewing admin users (except their own profile)\n      if (currentUser.role === 'operator' && user.role === 'admin' && currentUser.id !== userId) {\n        return res.status(403).json({ message: \"Forbidden: Cannot view admin user\" });\n      }\n\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user details\" });\n    }\n  });\n\n  // Note: /api/entries route is defined elsewhere in the file, this just adds userId filtering\n\n  // Note: advance-payments and dravya-entries routes may be defined elsewhere\n\n  // Get user's advance balance\n  app.get(\"/api/users/:id/advance-balance\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      const balance = await storage.calculateRemainingAdvancePayment(userId);\n      res.json(balance);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch advance balance\" });\n    }\n  });\n\n  // Bulk user upload endpoint\n  app.post(\"/api/users/bulk-upload\", isAdminOrOperator, upload.single('file'), async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const filePath = req.file.path;\n      let errors = 0;\n      let created = 0;\n\n      // Read CSV file\n      const readCSV = () => {\n        return new Promise<any[]>((resolve, reject) => {\n          const results: any[] = [];\n          fs.createReadStream(filePath)\n            .pipe(csv())\n            .on('data', (data) => results.push(data))\n            .on('end', () => resolve(results))\n            .on('error', reject);\n        });\n      };\n\n      try {\n        const csvData = await readCSV();\n        \n        for (const row of csvData) {\n          try {\n            // Validate required fields\n            if (!row.username || !row.password || !row.name || !row.email) {\n              errors++;\n              continue;\n            }\n\n            // Role validation based on current user\n            const validRoles = currentUser.role === 'admin' \n              ? ['admin', 'operator', 'viewer'] \n              : ['operator', 'viewer'];\n            \n            if (!validRoles.includes(row.role)) {\n              errors++;\n              continue;\n            }\n\n            // Create user data\n            const userData = {\n              username: row.username.trim(),\n              password: row.password.trim(),\n              name: row.name.trim(),\n              email: row.email.trim(),\n              mobile: row.mobile ? row.mobile.trim() : \"\",\n              address: row.address ? row.address.trim() : \"\",\n              role: row.role.trim(),\n              status: row.status ? row.status.trim() : \"active\"\n            };\n\n            // Validate with schema\n            const validatedData = insertUserSchema.parse(userData);\n            \n            // Check if username already exists\n            const existingUser = await storage.getUserByUsername(validatedData.username);\n            if (existingUser) {\n              errors++;\n              continue;\n            }\n\n            // Create user\n            await storage.createUser(validatedData);\n            created++;\n            \n          } catch (error) {\n            console.error(\"Error creating user from CSV:\", error);\n            errors++;\n          }\n        }\n\n        // Clean up uploaded file\n        fs.unlinkSync(filePath);\n\n        res.json({\n          message: \"Bulk upload completed\",\n          created,\n          errors,\n          total: csvData.length\n        });\n\n      } catch (error) {\n        // Clean up uploaded file in case of error\n        if (fs.existsSync(filePath)) {\n          fs.unlinkSync(filePath);\n        }\n        throw error;\n      }\n\n    } catch (error) {\n      console.error(\"Bulk upload error:\", error);\n      res.status(500).json({ message: \"Failed to process bulk upload\" });\n    }\n  });\n\n  // Check for duplicate mobile number\n  app.post(\"/api/users/check-mobile\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to check mobile numbers\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n\n      const { mobile } = req.body;\n      \n      if (!mobile) {\n        return res.status(400).json({ message: \"Mobile number is required\" });\n      }\n\n      // Check if mobile number already exists\n      const existingUser = await storage.getUserByMobile(mobile);\n      \n      if (existingUser) {\n        return res.status(200).json({ \n          exists: true, \n          user: {\n            id: existingUser.id,\n            name: existingUser.name,\n            username: existingUser.username,\n            mobile: existingUser.mobile\n          }\n        });\n      } else {\n        return res.status(200).json({ exists: false });\n      }\n    } catch (error) {\n      console.error(\"Error checking mobile number:\", error);\n      res.status(500).json({ message: \"Failed to check mobile number\" });\n    }\n  });\n\n  app.post(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to create users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      const userData = insertUserSchema.parse(req.body);\n      \n      // Operators cannot create admin users\n      if (currentUser.role === 'operator' && userData.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot create admin users\" });\n      }\n\n      // Check for duplicate mobile number before creating user\n      if (userData.mobile) {\n        const existingUser = await storage.getUserByMobile(userData.mobile);\n        if (existingUser) {\n          return res.status(400).json({ \n            message: `Mobile number already exists for user: ${existingUser.name} (${existingUser.username})` \n          });\n        }\n      }\n      \n      const user = await storage.createUser(userData);\n      res.status(201).json(user);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = parseInt(req.params.id);\n      \n      // Only allow admin and operator to update users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      // Get the user being updated to check their role\n      const existingUser = await storage.getUser(userId);\n      if (!existingUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Operators cannot edit admin users\n      if (currentUser.role === 'operator' && existingUser.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot edit admin users\" });\n      }\n      \n      // Operators cannot change user role to admin\n      if (currentUser.role === 'operator' && req.body.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot assign admin role\" });\n      }\n      \n      const updatedUser = await storage.updateUser(userId, req.body);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Since we're updating a user, we need to clear all entry caches where this user is referenced\n      // This ensures entries will show the updated user name\n      (req as any).sessionStore.all((err: any, sessions: any) => {\n        if (sessions) {\n          Object.values(sessions).forEach((session: any) => {\n            const wsClient = (req as any).app.get('wsClients')?.get(session.id);\n            if (wsClient) {\n              wsClient.send(JSON.stringify({\n                type: 'CACHE_INVALIDATION',\n                keys: [\n                  '/api/users',\n                  '/api/entries',\n                  `/api/entries/${userId}`,\n                  '/api/dashboard'\n                ]\n              }));\n            }\n          });\n        }\n      });\n      \n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // Entry management routes - only for boli entries\n  app.get(\"/api/entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { userId } = req.query;\n      let entries;\n      \n      if (userId) {\n        // Specific user requested - only for admin/operator or current user\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          entries = await storage.getUserEntries(targetUserId);\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else {\n        // No specific user - use role-based logic\n        if (user.role === \"admin\" || user.role === \"operator\") {\n          entries = await storage.getEntries();\n        } else {\n          entries = await storage.getUserEntries(user.id);\n        }\n      }\n      \n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entries\" });\n    }\n  });\n\n  // Separate dravya entries routes - completely isolated\n  app.get(\"/api/dravya-entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { userId } = req.query;\n      const { pool } = await import(\"./db\");\n      \n      let sql: string, values: any[];\n      \n      if (userId) {\n        // Specific user requested - only for admin/operator or current user\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          sql = \"SELECT * FROM dravya_entries WHERE user_id = $1 ORDER BY id DESC\";\n          values = [targetUserId];\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else {\n        // No specific user - use role-based logic\n        if (user.role === \"admin\" || user.role === \"operator\") {\n          sql = \"SELECT * FROM dravya_entries ORDER BY id DESC\";\n          values = [];\n        } else {\n          sql = \"SELECT * FROM dravya_entries WHERE user_id = $1 ORDER BY id DESC\";\n          values = [user.id];\n        }\n      }\n      \n      const result = await pool.query(sql, values);\n      const dravyaEntries = result.rows.map(row => ({\n        ...row,\n        userId: row.user_id,\n        userName: row.user_name,\n        userMobile: row.user_mobile,\n        userAddress: row.user_address,\n        entryDate: row.entry_date,\n        createdBy: row.created_by,\n        updatedAt: row.updated_at\n      }));\n      \n      res.json(dravyaEntries);\n    } catch (error) {\n      console.error(\"Error fetching dravya entries:\", error);\n      res.status(500).json({ message: \"Failed to fetch dravya entries\" });\n    }\n  });\n\n  app.get(\"/api/entries/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const entry = await storage.getEntry(entryId);\n      \n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      const user = req.user as any;\n      if (user.role !== \"admin\" && user.role !== \"operator\" && entry.userId !== user.id) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      res.json(entry);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entry\" });\n    }\n  });\n\n  // Only operators can create entries\n  // Separate endpoint for creating dravya entries\n  app.post(\"/api/dravya-entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      console.log(\"Dravya entry creation data:\", req.body);\n      \n      // Parse and validate the data using Zod\n      const dravyaData = insertDravyaEntrySchema.parse(req.body);\n      console.log(\"Parsed dravya entry data:\", dravyaData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      const { pool } = await import(\"./db\");\n      \n      // Get the user data\n      const user = await storage.getUser(dravyaData.userId);\n      \n      // Create the dravya entry\n      const sql = `\n        INSERT INTO dravya_entries (\n          user_id, user_name, user_mobile, user_address,\n          description, occasion, entry_date, created_by, updated_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7, $8, $9\n        ) RETURNING *\n      `;\n      \n      const values = [\n        dravyaData.userId,\n        user?.name || dravyaData.userName || 'Unknown User',\n        user?.mobile || '',\n        user?.address || '',\n        dravyaData.description || '',\n        dravyaData.occasion || '',\n        dravyaData.entryDate || new Date().toISOString().split('T')[0],\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing dravya SQL with values:\", values);\n      \n      const result = await pool.query(sql, values);\n      console.log(\"Dravya entry creation result:\", result.rows[0]);\n      \n      // Map the raw DB object to our format\n      const rawEntry = result.rows[0];\n      const dravyaEntry = {\n        ...rawEntry,\n        userId: rawEntry.user_id,\n        userName: rawEntry.user_name,\n        userMobile: rawEntry.user_mobile,\n        userAddress: rawEntry.user_address,\n        entryDate: rawEntry.entry_date,\n        createdBy: rawEntry.created_by,\n        updatedAt: rawEntry.updated_at\n      };\n      \n      console.log(\"Dravya entry created successfully:\", dravyaEntry);\n      \n      // Send mobile notification for dravya entry\n      console.log(`[MOBILE NOTIFICATION] New dravya entry created for ${dravyaEntry.userName} (${dravyaEntry.userMobile})`);\n      console.log(`Dravya Entry: ${dravyaEntry.description}`);\n      \n      res.status(201).json(dravyaEntry);\n    } catch (error) {\n      console.error(\"Error creating dravya entry:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create dravya entry\" });\n    }\n  });\n\n  // GET expense entries (only for operators) with optional date filtering\n  app.get(\"/api/expense-entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      const { pool } = await import(\"./db\");\n      \n      let sql = 'SELECT * FROM expense_entries WHERE 1=1';\n      const params: any[] = [];\n      \n      // Add date range filtering if provided\n      if (startDate) {\n        sql += ` AND expense_date >= $${params.length + 1}`;\n        params.push(startDate);\n      }\n      \n      if (endDate) {\n        sql += ` AND expense_date <= $${params.length + 1}`;\n        params.push(endDate);\n      }\n      \n      sql += ' ORDER BY expense_date DESC, id DESC';\n      \n      const result = await pool.query(sql, params);\n      res.json(result.rows);\n    } catch (error) {\n      console.error(\"Error fetching expense entries:\", error);\n      res.status(500).json({ message: \"Failed to fetch expense entries\" });\n    }\n  });\n\n  // POST new expense entry (only for operators) with file uploads\n  app.post(\"/api/expense-entries\", isAdminOrOperator, upload.fields([\n    { name: 'receiptFile', maxCount: 1 },\n    { name: 'paymentScreenshot', maxCount: 1 }\n  ]), async (req, res) => {\n    try {\n      console.log(\"Expense entry creation data:\", req.body);\n      console.log(\"Uploaded files:\", req.files);\n      \n      const files = req.files as { [fieldname: string]: Express.Multer.File[] };\n      \n      // Parse form data from multipart request\n      const expenseData = {\n        firmName: req.body.firmName || null,\n        billNo: req.body.billNo || null,\n        billDate: req.body.billDate || null,\n        description: req.body.description,\n        amount: parseInt(req.body.amount),\n        quantity: req.body.quantity ? parseInt(req.body.quantity) : null,\n        reason: req.body.reason || null,\n        expenseDate: req.body.expenseDate,\n        paymentMode: req.body.paymentMode,\n        approvedBy: req.body.approvedBy,\n        paidBy: req.body.paidBy,\n        createdBy: req.body.createdBy\n      };\n      \n      // Validate the parsed data\n      const validatedData = insertExpenseEntrySchema.parse(expenseData);\n      console.log(\"Parsed expense entry data:\", validatedData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Handle file uploads\n      let receiptUrl = null;\n      let paymentScreenshotUrl = null;\n      \n      if (files.receiptFile && files.receiptFile[0]) {\n        receiptUrl = `/uploads/${files.receiptFile[0].filename}`;\n      }\n      \n      if (files.paymentScreenshot && files.paymentScreenshot[0]) {\n        paymentScreenshotUrl = `/uploads/${files.paymentScreenshot[0].filename}`;\n      }\n      \n      // Create expense entry with raw SQL\n      const { pool } = await import(\"./db\");\n      \n      const sql = `\n        INSERT INTO expense_entries (\n          firm_name, bill_no, bill_date, description, amount, quantity, reason,\n          expense_date, payment_mode, attachment_url, approved_by, paid_by,\n          created_by, updated_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7,\n          $8, $9, $10, $11, $12,\n          $13, $14\n        ) RETURNING *\n      `;\n      \n      // Combine receipt and payment screenshot URLs\n      const attachmentUrls = [receiptUrl, paymentScreenshotUrl].filter(Boolean).join(';');\n      \n      const values = [\n        validatedData.firmName,\n        validatedData.billNo,\n        validatedData.billDate,\n        validatedData.description,\n        validatedData.amount,\n        validatedData.quantity,\n        validatedData.reason,\n        validatedData.expenseDate,\n        validatedData.paymentMode,\n        attachmentUrls || null,\n        validatedData.approvedBy,\n        validatedData.paidBy,\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing expense SQL with values:\", values);\n      \n      const result = await pool.query(sql, values);\n      console.log(\"Expense entry creation result:\", result.rows[0]);\n      \n      const expenseEntry = result.rows[0];\n      \n      console.log(\"Expense entry created successfully:\", expenseEntry);\n      \n      // Send mobile notification for expense entry\n      console.log(`[MOBILE NOTIFICATION] New expense entry created: ${expenseEntry.description}`);\n      console.log(`Amount: ‚Çπ${(expenseEntry.amount / 100).toFixed(2)} | Approved by: ${expenseEntry.approved_by}`);\n      \n      res.status(201).json(expenseEntry);\n    } catch (error) {\n      console.error(\"Error creating expense entry:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create expense entry\" });\n    }\n  });\n\n  // Function to calculate remaining advance payments for a user\n  async function calculateRemainingAdvancePayment(userId: number): Promise<number> {\n    const { pool } = await import(\"./db\");\n    \n    // Get total advance payments for the user\n    const advanceResult = await pool.query(\n      'SELECT COALESCE(SUM(amount), 0) as total_advance FROM advance_payments WHERE user_id = $1',\n      [userId]\n    );\n    \n    // Get total used advance payments (payments made using advance)\n    const usedResult = await pool.query(\n      'SELECT COALESCE(SUM(amount), 0) as total_used FROM advance_payment_usage WHERE user_id = $1',\n      [userId]\n    );\n    \n    const totalAdvance = parseInt(advanceResult.rows[0]?.total_advance || '0');\n    const totalUsed = parseInt(usedResult.rows[0]?.total_used || '0');\n    \n    console.log(`[DEBUG] User ${userId} - Total Advance: ${totalAdvance}, Total Used: ${totalUsed}`);\n    \n    const remainingBalance = totalAdvance - totalUsed;\n    \n    console.log(`[DEBUG] User ${userId} - Calculated Balance: ${remainingBalance}`);\n    \n    // Return 0 if balance would be negative (user can't have negative advance balance)\n    const finalBalance = Math.max(0, remainingBalance);\n    console.log(`[DEBUG] User ${userId} - Final Balance: ${finalBalance}`);\n    \n    return finalBalance;\n  }\n\n  // Function to auto-process boli payment using advance payment\n  async function autoProcessBoliPayment(entryId: number, userId: number, boliAmount: number, boliDate: string, createdBy: string): Promise<void> {\n    const { pool } = await import(\"./db\");\n    \n    const remainingAdvance = await calculateRemainingAdvancePayment(userId);\n    \n    if (remainingAdvance > 0) {\n      const paymentAmount = Math.min(remainingAdvance, boliAmount);\n      \n      // Record the advance payment usage\n      await pool.query(\n        'INSERT INTO advance_payment_usage (user_id, entry_id, amount, date, created_by, created_at) VALUES ($1, $2, $3, $4, $5, $6)',\n        [userId, entryId, paymentAmount, boliDate, createdBy, new Date().toISOString()]\n      );\n      \n      // Create payment record\n      const paymentRecord = {\n        date: boliDate,\n        amount: paymentAmount,\n        mode: 'advance_payment' as any,\n        receiptNo: `ADV${new Date().getFullYear()}${String(Date.now()).slice(-6)}`,\n        updatedBy: createdBy\n      };\n      \n      // Update the entry with the payment\n      const entry = await storage.getEntry(entryId);\n      if (entry) {\n        const updatedPayments = [...entry.payments, paymentRecord];\n        const newReceivedAmount = entry.receivedAmount + paymentAmount;\n        const newPendingAmount = entry.totalAmount - newReceivedAmount;\n        \n        let newStatus: PaymentStatusType;\n        if (newPendingAmount <= 0) {\n          newStatus = PaymentStatus.FULL;\n        } else if (newReceivedAmount > 0) {\n          newStatus = PaymentStatus.PARTIAL;\n        } else {\n          newStatus = PaymentStatus.PENDING;\n        }\n        \n        await pool.query(\n          `UPDATE entries SET \n           payments = $1, received_amount = $2, pending_amount = $3, status = $4, updated_at = $5\n           WHERE id = $6`,\n          [JSON.stringify(updatedPayments), newReceivedAmount, newPendingAmount, newStatus, new Date().toISOString(), entryId]\n        );\n      }\n    }\n  }\n\n  // API endpoint to process advance payment for a boli entry\n  app.post(\"/api/entries/:id/advance-payment\", isAuthenticated, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const { amount, date } = req.body;\n      const user = req.user as any;\n      const userId = user?.id;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      if (!amount || amount <= 0) {\n        return res.status(400).json({ message: \"Invalid payment amount\" });\n      }\n\n      const { pool } = await import(\"./db\");\n\n      // Get the boli entry to find the user\n      const entryResult = await pool.query('SELECT * FROM entries WHERE id = $1', [entryId]);\n      if (entryResult.rows.length === 0) {\n        return res.status(404).json({ message: \"Boli entry not found\" });\n      }\n      \n      const entry = entryResult.rows[0];\n      const entryUserId = entry.user_id;\n\n      // Get user's advance payment balance\n      const remainingBalance = await calculateRemainingAdvancePayment(entryUserId);\n      \n      if (remainingBalance < amount) {\n        return res.status(400).json({ message: \"Insufficient advance payment balance\" });\n      }\n\n      // Record the advance payment usage\n      await pool.query(\n        'INSERT INTO advance_payment_usage (user_id, entry_id, amount, date, created_by, created_at) VALUES ($1, $2, $3, $4, $5, $6)',\n        [entryUserId, entryId, amount, date, user.username, new Date().toISOString()]\n      );\n\n      // Create payment record with advance payment mode\n      const receiptNo = `ADV-${new Date().getFullYear()}${String(Date.now()).slice(-6)}`;\n      \n      const paymentData = {\n        date,\n        amount,\n        mode: 'advance_payment',\n        receiptNo,\n        updatedBy: user.username\n      };\n\n      // Get current entry payments\n      const currentEntry = await pool.query('SELECT payments FROM entries WHERE id = $1', [entryId]);\n      const currentPayments = currentEntry.rows[0]?.payments || [];\n      \n      // Add new payment\n      const updatedPayments = [...currentPayments, paymentData];\n      \n      // Calculate new totals\n      const totalReceived = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const pendingAmount = entry.total_amount - totalReceived;\n      const status = pendingAmount <= 0 ? 'full' : totalReceived > 0 ? 'partial' : 'pending';\n\n      // Update the entry\n      await pool.query(\n        'UPDATE entries SET payments = $1, received_amount = $2, pending_amount = $3, status = $4, updated_at = $5 WHERE id = $6',\n        [JSON.stringify(updatedPayments), totalReceived, pendingAmount, status, new Date().toISOString(), entryId]\n      );\n\n      // Log the transaction\n      await pool.query(\n        'INSERT INTO transaction_logs (entry_id, user_id, username, transaction_type, amount, description, date, details, timestamp) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)',\n        [\n          entryId,\n          entryUserId,\n          user.username,\n          'advance_payment_applied',\n          amount,\n          `Applied ‚Çπ${amount} from advance payment balance`,\n          date,\n          JSON.stringify({ \n            receiptNo,\n            previousStatus: entry.status,\n            newStatus: status,\n            remainingBalance: remainingBalance - amount\n          }),\n          new Date().toISOString()\n        ]\n      );\n\n      res.json({ \n        success: true, \n        payment: paymentData, \n        entry: {\n          ...entry,\n          payments: updatedPayments,\n          received_amount: totalReceived,\n          pending_amount: pendingAmount,\n          status\n        }\n      });\n\n    } catch (error) {\n      console.error(\"Error processing advance payment:\", error);\n      res.status(500).json({ message: \"Failed to process advance payment\" });\n    }\n  });\n\n  // API endpoint to get remaining advance payment balance for a user\n  app.get(\"/api/users/:id/advance-balance\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      console.log(`Calculating advance balance for user ${userId}`);\n      const remainingBalance = await calculateRemainingAdvancePayment(userId);\n      console.log(`Advance balance result for user ${userId}: ${remainingBalance}`);\n      \n      // Set cache headers to prevent caching\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      res.json(remainingBalance); // Return just the number, not an object\n    } catch (error) {\n      console.error(\"Error fetching user advance balance:\", error);\n      res.status(500).json({ message: \"Failed to fetch advance balance\" });\n    }\n  });\n\n  // Advance payments routes (completely separate module)\n  app.get(\"/api/advance-payments\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { startDate, endDate, userId } = req.query;\n      const { pool } = await import(\"./db\");\n      \n      let sql = `SELECT ap.*, u.address as user_address \n                 FROM advance_payments ap \n                 LEFT JOIN users u ON ap.user_id = u.id \n                 WHERE 1=1`;\n      const params: any[] = [];\n      \n      // Add user filtering if specified\n      if (userId) {\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          sql += ` AND ap.user_id = $${params.length + 1}`;\n          params.push(targetUserId);\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else if (user.role !== \"admin\" && user.role !== \"operator\") {\n        // Non-admin/operator users can only see their own advance payments\n        sql += ` AND ap.user_id = $${params.length + 1}`;\n        params.push(user.id);\n      }\n      \n      // Add date range filtering if provided\n      if (startDate) {\n        sql += ` AND date >= $${params.length + 1}`;\n        params.push(startDate);\n      }\n      \n      if (endDate) {\n        sql += ` AND date <= $${params.length + 1}`;\n        params.push(endDate);\n      }\n      \n      sql += ' ORDER BY date DESC, id DESC';\n      \n      const result = await pool.query(sql, params);\n      const advancePayments = result.rows.map(row => ({\n        ...row,\n        userId: row.user_id,\n        userName: row.user_name,\n        userMobile: row.user_mobile,\n        userAddress: row.user_address,\n        paymentMode: row.payment_mode,\n        attachmentUrl: row.attachment_url,\n        receiptNo: row.receipt_no,\n        createdBy: row.created_by,\n        createdAt: row.created_at\n      }));\n      \n      res.json(advancePayments);\n    } catch (error) {\n      console.error(\"Error fetching advance payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch advance payments\" });\n    }\n  });\n\n  // Function to generate unified receipt number for all payment types\n  async function generateUnifiedReceiptNumber(paymentDate: string): Promise<string> {\n    const { pool } = await import(\"./db\");\n    const year = paymentDate.split('-')[0]; // Extract year from YYYY-MM-DD\n    \n    let highestSequence = 0;\n    \n    // Check transaction logs for payment receipts (SPDJMSJ-YYYY-XXXXX format)\n    const logs = await storage.getTransactionLogs();\n    for (const log of logs) {\n      if (!log.details) continue;\n      \n      const details = typeof log.details === 'string' ? JSON.parse(log.details) : log.details;\n      if (!details.receiptNo) continue;\n      \n      if (typeof details.receiptNo === 'string' && details.receiptNo.startsWith(`SPDJMSJ-${year}-`)) {\n        const match = details.receiptNo.match(/SPDJMSJ-\\d{4}-(\\d{5})/);\n        if (match && match[1]) {\n          const foundNumber = parseInt(match[1], 10);\n          if (!isNaN(foundNumber) && foundNumber > highestSequence) {\n            highestSequence = foundNumber;\n          }\n        }\n      }\n    }\n    \n    // Check advance payments table for ADV receipts (need to be in same sequence as SPDJMSJ)\n    const advanceResult = await pool.query(\n      `SELECT receipt_no FROM advance_payments \n       WHERE receipt_no LIKE $1 AND receipt_no IS NOT NULL`,\n      [`ADV-${year}-%`]\n    );\n    \n    for (const row of advanceResult.rows) {\n      const match = row.receipt_no.match(/ADV-\\d{4}-(\\d{5})/);\n      if (match && match[1]) {\n        const foundNumber = parseInt(match[1], 10);\n        if (!isNaN(foundNumber) && foundNumber > highestSequence) {\n          highestSequence = foundNumber;\n        }\n      }\n    }\n    \n    // Next sequence number\n    const sequenceNumber = highestSequence + 1;\n    const formattedNumber = sequenceNumber.toString().padStart(5, '0');\n    return `SPDJMSJ-${year}-${formattedNumber}`;\n  }\n\n  // Function to generate advance payment receipt number (uses same sequence as regular payments)\n  async function generateAdvancePaymentReceiptNumber(paymentDate: string): Promise<string> {\n    const receiptNo = await generateUnifiedReceiptNumber(paymentDate);\n    // Convert SPDJMSJ- to ADV- for advance payments while maintaining same sequence\n    return receiptNo.replace('SPDJMSJ-', 'ADV-');\n  }\n\n  // POST new advance payment with file upload\n  app.post(\"/api/advance-payments\", isAdminOrOperator, upload.single('paymentScreenshot'), async (req, res) => {\n    try {\n      console.log(\"Advance payment creation data:\", req.body);\n      console.log(\"Uploaded file:\", req.file);\n      \n      // Parse form data from multipart request\n      const advancePaymentData = {\n        userId: parseInt(req.body.userId),\n        userName: req.body.userName,\n        userMobile: req.body.userMobile || '',\n        date: req.body.date,\n        amount: parseInt(req.body.amount), // Amount already in correct format\n        paymentMode: req.body.paymentMode,\n        createdBy: req.body.createdBy\n      };\n      \n      // Validate the parsed data\n      const validatedData = insertAdvancePaymentSchema.parse(advancePaymentData);\n      console.log(\"Parsed advance payment data:\", validatedData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Handle file upload for payment screenshot\n      let attachmentUrl = null;\n      if (req.file) {\n        attachmentUrl = `/uploads/${req.file.filename}`;\n      }\n      \n      // Generate receipt number for advance payment\n      const receiptNo = await generateAdvancePaymentReceiptNumber(validatedData.date);\n      \n      // Create advance payment with raw SQL\n      const { pool } = await import(\"./db\");\n      \n      const sql = `\n        INSERT INTO advance_payments (\n          user_id, user_name, user_mobile, date,\n          amount, payment_mode, attachment_url, receipt_no, created_by, created_at\n        ) VALUES (\n          $1, $2, $3, $4,\n          $5, $6, $7, $8, $9, $10\n        ) RETURNING *\n      `;\n      \n      const values = [\n        validatedData.userId,\n        validatedData.userName,\n        validatedData.userMobile || '',\n        validatedData.date,\n        validatedData.amount,\n        validatedData.paymentMode,\n        attachmentUrl,\n        receiptNo,\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing advance payment SQL with values:\", values);\n      \n      const result = await pool.query(sql, values);\n      console.log(\"Advance payment creation result:\", result.rows[0]);\n      \n      const advancePayment = result.rows[0];\n      \n      console.log(\"Advance payment created successfully:\", advancePayment);\n      \n      res.status(201).json({\n        ...advancePayment,\n        userId: advancePayment.user_id,\n        userName: advancePayment.user_name,\n        userMobile: advancePayment.user_mobile,\n        paymentMode: advancePayment.payment_mode,\n        attachmentUrl: advancePayment.attachment_url,\n        receiptNo: advancePayment.receipt_no,\n        createdBy: advancePayment.created_by,\n        createdAt: advancePayment.created_at\n      });\n    } catch (error) {\n      console.error(\"Error creating advance payment:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create advance payment\" });\n    }\n  });\n\n  app.post(\"/api/entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      console.log(\"Entry creation data:\", req.body);\n      const entryData = insertEntrySchema.parse(req.body);\n      console.log(\"Parsed entry data:\", entryData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Validate that the boli date is not in the future\n      const boliDate = new Date(entryData.auctionDate);\n      const today = new Date();\n      today.setHours(23, 59, 59, 999); // Set to end of today\n      \n      if (boliDate > today) {\n        return res.status(400).json({ \n          message: \"Boli date cannot be in the future. Please select today's date or earlier.\" \n        });\n      }\n      \n      // Create entry and pass the current user's ID (who is creating the entry)\n      // Use direct SQL to create the entry with proper column names\n      const { pool } = await import(\"./db\");\n      \n      // Map the fields correctly for auction entries\n      const quantity = entryData.quantity || 1;\n      const totalAmount = entryData.amount * quantity;\n      \n      // Get the user data\n      const user = await storage.getUser(entryData.userId);\n      \n      // Create the entry with raw SQL to ensure column names match\n      const sql = `\n        INSERT INTO entries (\n          user_id, user_name, user_mobile, user_address,\n          description, amount, quantity, total_amount,\n          occasion, auction_date, pending_amount, received_amount,\n          status, payments, created_by\n        ) VALUES (\n          $1, $2, $3, $4,\n          $5, $6, $7, $8,\n          $9, $10, $11, $12,\n          $13, $14, $15\n        ) RETURNING *\n      `;\n      \n      const values = [\n        entryData.userId,\n        user?.name || entryData.userName || 'Unknown User',\n        user?.mobile || '',\n        user?.address || '',\n        entryData.description || '',\n        entryData.amount || 0,\n        quantity,\n        totalAmount,\n        entryData.occasion || '',\n        entryData.auctionDate || new Date().toISOString().split('T')[0],\n        totalAmount,\n        0,\n        'pending',\n        '[]',\n        currentUser ? currentUser.username : 'system'\n      ];\n      \n      console.log(\"Executing SQL with values:\", values);\n      \n      const result = await pool.query(sql, values);\n      console.log(\"Entry creation result:\", result.rows[0]);\n      \n      // Create a transaction log for this entry creation (CREDIT)\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        result.rows[0].id,\n        currentUser.id,\n        currentUser.username,\n        `Entry created for ${user?.name || entryData.userName || 'Unknown User'} by ${currentUser.username}`,\n        totalAmount,\n        'credit', // Explicitly setting transaction_type to 'credit'\n        JSON.stringify({\n          description: entryData.description,\n          occasion: entryData.occasion,\n          auctionDate: entryData.auctionDate\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await pool.query(logSql, logValues);\n      console.log(\"Transaction log created for entry creation\");\n      \n      // Map the raw DB object to our format\n      const rawEntry = result.rows[0];\n      const entry = {\n        ...rawEntry,\n        userId: rawEntry.user_id,\n        userName: rawEntry.user_name,\n        userMobile: rawEntry.user_mobile,\n        userAddress: rawEntry.user_address,\n        totalAmount: rawEntry.total_amount,\n        pendingAmount: rawEntry.pending_amount,\n        receivedAmount: rawEntry.received_amount,\n        auctionDate: rawEntry.auction_date,\n        updatedAt: rawEntry.updated_at,\n        createdBy: rawEntry.created_by,\n        entryType: rawEntry.entry_type,\n        unitOfMeasurement: rawEntry.unit_of_measurement\n      };\n      console.log(\"Entry created successfully:\", entry);\n      \n      // Auto-process boli payment using advance payment if available\n      try {\n        await autoProcessBoliPayment(\n          entry.id, \n          entry.userId, \n          entry.totalAmount, \n          entry.auctionDate, \n          currentUser.username\n        );\n        console.log(\"Auto-payment processing completed for entry:\", entry.id);\n      } catch (error) {\n        console.error(\"Error in auto-payment processing:\", error);\n        // Don't fail the entry creation if auto-payment fails\n      }\n      \n      // Get the user for whom the entry was created\n      const entryUser = await storage.getUser(entry.userId);\n      \n      // If entryUser exists, send notification\n      if (entryUser) {\n        // Import is done inside the handler to avoid circular dependencies\n        const { NotificationService } = await import(\"./notification\");\n        NotificationService.notifyEntryCreated(entryUser, entry);\n      }\n      \n      res.status(201).json(entry);\n    } catch (error) {\n      console.error(\"Error creating entry:\", error);\n      \n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create entry\" });\n    }\n  });\n\n  // Entry update endpoint (for operators and admins with role-based field restrictions)\n  app.put(\"/api/entries/:id\", isAdminOrOperator, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const currentUser = req.user as any;\n      \n      // Get the current entry to compare changes\n      const existingEntry = await storage.getEntry(entryId);\n      if (!existingEntry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Parse and validate the request body\n      const updateData = insertEntrySchema.omit({ \n        createdBy: true \n      }).parse({\n        ...req.body,\n        totalAmount: req.body.totalAmount, // Keep as number for validation\n        quantity: req.body.quantity\n      });\n      \n      // Role-based field restrictions\n      if (currentUser.role === 'operator') {\n        // Operators cannot edit the totalAmount field\n        if (updateData.totalAmount !== existingEntry.totalAmount) {\n          return res.status(403).json({ \n            message: \"Operators cannot modify the total amount. Only administrators can edit this field.\" \n          });\n        }\n        \n        // Operators cannot change the user selection\n        if (updateData.userId !== existingEntry.userId) {\n          return res.status(403).json({ \n            message: \"Operators cannot change the user selection. Only administrators can edit this field.\" \n          });\n        }\n      }\n      \n      // Validate that the boli date is not in the future\n      const boliDate = new Date(updateData.auctionDate);\n      const today = new Date();\n      today.setHours(23, 59, 59, 999); // Set to end of today\n      \n      if (boliDate > today) {\n        return res.status(400).json({ \n          message: \"Boli date cannot be in the future. Please select today's date or earlier.\" \n        });\n      }\n      \n      // Convert amounts to paisa for storage\n      const totalAmountPaisa = Math.round(updateData.totalAmount * 100);\n      const updatedEntryData = {\n        ...updateData,\n        totalAmount: totalAmountPaisa,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      // Update the entry\n      const updatedEntry = await storage.updateEntry(entryId, updatedEntryData, currentUser.id);\n      \n      if (!updatedEntry) {\n        return res.status(500).json({ message: \"Failed to update entry\" });\n      }\n      \n      // Log the transaction\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const changes = {\n        before: {\n          description: existingEntry.description,\n          totalAmount: existingEntry.totalAmount,\n          quantity: existingEntry.quantity,\n          occasion: existingEntry.occasion,\n          auctionDate: existingEntry.auctionDate\n        },\n        after: {\n          description: updateData.description,\n          totalAmount: updateData.totalAmount,\n          quantity: updateData.quantity,\n          occasion: updateData.occasion,\n          auctionDate: updateData.auctionDate\n        },\n        updatedBy: currentUser.username\n      };\n      \n      const logValues = [\n        entryId,\n        currentUser.id,\n        currentUser.username,\n        `Entry updated by ${currentUser.username} (${currentUser.role})`,\n        totalAmountPaisa,\n        'update_entry',\n        JSON.stringify(changes),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await pool.query(logSql, logValues);\n      console.log(\"Transaction log created for entry update\");\n      \n      res.json(updatedEntry);\n    } catch (error) {\n      console.error(\"Error updating entry:\", error);\n      \n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to update entry\" });\n    }\n  });\n\n  // Entry deletion endpoint (only for admins)\n  app.delete(\"/api/entries/:id\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const user = req.user as any;\n      \n      // Get the entry first to check if it exists\n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Prevent deleting entries with full payment status\n      if (entry.status === PaymentStatus.FULL) {\n        return res.status(403).json({ message: \"Cannot delete fully paid entries\" });\n      }\n      \n      // Delete the entry with transaction logging (who deleted it)\n      const result = await storage.deleteEntry(entryId, user.id);\n      \n      if (result) {\n        res.status(200).json({ message: \"Entry deleted successfully\" });\n      } else {\n        res.status(500).json({ message: \"Failed to delete entry\" });\n      }\n    } catch (error) {\n      console.error(\"Error deleting entry:\", error);\n      res.status(500).json({ message: \"Server error while deleting entry\" });\n    }\n  });\n  \n  // Transaction logs routes\n  app.get(\"/api/transaction-logs\", isAdmin, async (req, res) => {\n    try {\n      const logs = await storage.getTransactionLogs();\n      res.json(logs);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch transaction logs\" });\n    }\n  });\n\n  app.get(\"/api/entries/:id/transaction-logs\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const logs = await storage.getEntryTransactionLogs(entryId);\n      res.json(logs);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entry transaction logs\" });\n    }\n  });\n  \n  // Payment management routes\n  // Payment update functionality has been disabled\n  app.put(\"/api/entries/:id/payments/:index\", isAdmin, async (req, res) => {\n    return res.status(403).json({ message: \"Payment update functionality has been disabled\" });\n  });\n\n  // Endpoint to delete a payment\n  app.delete(\"/api/entries/:id/payments/:index\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const paymentIndex = parseInt(req.params.index);\n      const user = req.user as any;\n      \n      // Get the entry first to check if it exists\n      const entryToUpdate = await storage.getEntry(entryId);\n      if (!entryToUpdate) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Check if payment exists\n      if (!entryToUpdate.payments || paymentIndex >= entryToUpdate.payments.length) {\n        return res.status(404).json({ message: \"Payment record not found\" });\n      }\n      \n      // Store the payment to be deleted for logging\n      const deletedPayment = entryToUpdate.payments[paymentIndex];\n      \n      // Remove the payment from the array\n      const updatedPayments = [...entryToUpdate.payments];\n      updatedPayments.splice(paymentIndex, 1);\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entryToUpdate.totalAmount - newReceivedAmount;\n      \n      // Determine new payment status\n      let newStatus = entryToUpdate.status;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entryToUpdate.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with SQL to ensure proper column names\n      const { pool } = await import(\"./db\");\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            received_amount = $2, \n            pending_amount = $3,\n            status = $4\n        WHERE id = $5\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        newReceivedAmount,\n        newPendingAmount,\n        newStatus,\n        entryId\n      ];\n      \n      const updateResult = await pool.query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the deletion with CREDIT transaction type (since we're adding back to the account)\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Deleted payment record of ‚Çπ${deletedPayment.amount} from entry #${entryId}`,\n        deletedPayment.amount,\n        'credit', // Explicitly setting transaction_type to 'credit'\n        JSON.stringify({\n          date: deletedPayment.date,\n          mode: deletedPayment.mode,\n          amount: deletedPayment.amount,\n          fileUrl: deletedPayment.fileUrl,\n          receiptNo: deletedPayment.receiptNo\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await pool.query(logSql, logValues);\n      \n      // If status has changed, log that too\n      if (entryToUpdate.status !== newStatus) {\n        const statusLogSql = `\n          INSERT INTO transaction_logs (\n            entry_id, user_id, username, description, \n            amount, transaction_type, details, date, timestamp\n          ) VALUES (\n            $1, $2, $3, $4, \n            $5, $6, $7, $8, $9\n          )\n        `;\n        \n        const statusLogValues = [\n          entryId,\n          user.id,\n          user.username,\n          `Payment status changed from ${entryToUpdate.status} to ${newStatus} after deleting payment`,\n          0,\n          'update_payment', // Explicitly setting transaction_type\n          JSON.stringify({\n            oldStatus: entryToUpdate.status,\n            newStatus,\n            deletedPayment\n          }),\n          new Date().toISOString().split('T')[0],\n          new Date().toISOString()\n        ];\n        \n        await pool.query(statusLogSql, statusLogValues);\n      }\n      \n      // Map the raw DB object to our format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      res.json(mappedEntry);\n    } catch (error) {\n      console.error(\"Error deleting payment:\", error);\n      res.status(500).json({ message: \"Failed to delete payment record\" });\n    }\n  });\n  \n  // Endpoint to record a payment\n  app.post(\"/api/entries/:id/payments\", isAdminOrOperator, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const paymentData = recordPaymentSchema.omit({ entryId: true }).parse(req.body);\n      const user = req.user as any;\n      \n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      if (entry.status === PaymentStatus.FULL) {\n        return res.status(400).json({ message: \"Entry is already fully paid\" });\n      }\n      \n      if (paymentData.amount > entry.pendingAmount) {\n        return res.status(400).json({ message: \"Payment amount exceeds pending amount\" });\n      }\n      \n      // Generate unified sequential receipt number based on the year - AM-YYYY-XXXXX\n      const receiptNo = await generateUnifiedReceiptNumber(paymentData.date);\n      \n      // Import pool for database operations\n      const { pool } = await import(\"./db\");\n      \n      // Handle advance payment processing\n      if (paymentData.mode === PaymentMode.ADVANCE_PAYMENT) {\n        // Verify user has sufficient advance balance\n        const availableBalance = await calculateRemainingAdvancePayment(entry.userId);\n        if (availableBalance < paymentData.amount) {\n          return res.status(400).json({ \n            message: `Insufficient advance balance. Available: ‚Çπ${availableBalance.toLocaleString()}, Required: ‚Çπ${paymentData.amount.toLocaleString()}` \n          });\n        }\n        \n        // Create advance payment usage record\n        const usageSql = `\n          INSERT INTO advance_payment_usage (\n            user_id, entry_id, amount, date, created_by\n          ) VALUES ($1, $2, $3, $4, $5)\n        `;\n        \n        const usageValues = [\n          entry.userId,\n          entryId,\n          paymentData.amount,\n          paymentData.date,\n          user.username\n        ];\n        \n        await pool.query(usageSql, usageValues);\n        console.log(`Created advance payment usage record: User ${entry.userId}, Amount ${paymentData.amount}, Entry ${entryId}`);\n      }\n\n      const payment = {\n        date: paymentData.date,\n        amount: paymentData.amount,\n        mode: paymentData.mode || PaymentMode.CASH,\n        fileUrl: paymentData.fileUrl,\n        receiptNo: receiptNo, // Add unique receipt number\n        updatedBy: user.username // Add updatedBy field\n      };\n      \n      // Instead of using storage.recordPayment, we'll implement a direct approach to fix the transaction_type\n      // Get the current entry to modify\n      const entryToUpdate = await storage.getEntry(entryId);\n      if (!entryToUpdate) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Update the entry with the new payment\n      const currentPayments = entryToUpdate.payments || [];\n      const updatedPayments = [...currentPayments, payment];\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entryToUpdate.totalAmount - newReceivedAmount;\n      \n      // Determine payment status\n      let newStatus = entryToUpdate.status;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entryToUpdate.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with SQL to ensure proper column names\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            received_amount = $2, \n            pending_amount = $3,\n            status = $4\n        WHERE id = $5\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        newReceivedAmount,\n        newPendingAmount,\n        newStatus,\n        entryId\n      ];\n      \n      const updateResult = await pool.query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the payment with DEBIT transaction type\n      // Use direct SQL query to ensure transaction_type is correctly set\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Payment of ‚Çπ${payment.amount} recorded by ${user.username}`,\n        payment.amount,\n        'debit', // Explicitly setting transaction_type to 'debit'\n        JSON.stringify({\n          date: payment.date,\n          paymentMode: payment.mode,\n          receiptNo: payment.receiptNo\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await pool.query(logSql, logValues);\n      \n      // If status has changed, log that too\n      if (entryToUpdate.status !== newStatus) {\n        const statusLogSql = `\n          INSERT INTO transaction_logs (\n            entry_id, user_id, username, description, \n            amount, transaction_type, details, date, timestamp\n          ) VALUES (\n            $1, $2, $3, $4, \n            $5, $6, $7, $8, $9\n          )\n        `;\n        \n        const statusLogValues = [\n          entryId,\n          user.id,\n          user.username,\n          `Payment status changed from ${entryToUpdate.status} to ${newStatus}`,\n          0,\n          'update_payment', // Explicitly setting transaction_type\n          JSON.stringify({\n            payment,\n            oldStatus: entryToUpdate.status,\n            newStatus\n          }),\n          new Date().toISOString().split('T')[0],\n          new Date().toISOString()\n        ];\n        \n        await pool.query(statusLogSql, statusLogValues);\n      }\n      \n      // Convert the response to match our expected schema format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      // Get the user for whom the payment was recorded\n      const entryUser = await storage.getUser(entryToUpdate.userId);\n      \n      // If user exists, send notification\n      if (entryUser) {\n        // Import is done inside the handler to avoid circular dependencies\n        const { NotificationService } = await import(\"./notification\");\n        NotificationService.notifyPaymentRecorded(entryUser, mappedEntry, payment);\n        \n        // If payment status changed, notify that as well\n        if (entryToUpdate.status !== newStatus) {\n          NotificationService.notifyPaymentStatusChanged(\n            entryUser,\n            mappedEntry,\n            entryToUpdate.status,\n            newStatus\n          );\n        }\n      }\n      \n      res.json(mappedEntry);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  // Daily earnings calendar endpoint\n  app.get(\"/api/daily-earnings\", isAuthenticated, async (req, res) => {\n    try {\n      const { year } = req.query;\n      const selectedYear = year ? parseInt(year as string) : new Date().getFullYear();\n      \n      // Get entries from the selected year\n      const { pool } = await import(\"./db\");\n      \n      const sql = `\n        SELECT \n          auction_date as date,\n          SUM(total_amount) as daily_total\n        FROM entries \n        WHERE auction_date LIKE $1\n        GROUP BY auction_date\n        ORDER BY auction_date\n      `;\n      \n      const result = await pool.query(sql, [`${selectedYear}-%`]);\n      \n      // Transform data into a format easy to use in the frontend\n      const dailyEarnings: { [key: string]: number } = {};\n      result.rows.forEach(row => {\n        dailyEarnings[row.date] = parseInt(row.daily_total);\n      });\n      \n      console.log(`Daily earnings for ${selectedYear}:`, dailyEarnings);\n      \n      res.json(dailyEarnings);\n    } catch (error) {\n      console.error(\"Error fetching daily earnings:\", error);\n      res.status(500).json({ message: \"Failed to fetch daily earnings data\" });\n    }\n  });\n\n  // Daily payments calendar endpoint\n  app.get('/api/daily-payments', isAuthenticated, async (req, res) => {\n    try {\n      const { year } = req.query;\n      const selectedYear = year ? parseInt(year as string) : new Date().getFullYear();\n      \n      // Get all entries with payments for the selected year\n      const entries = await storage.getEntries();\n      \n      // Extract payment records and group by payment date\n      const dailyPayments: { [key: string]: number } = {};\n      \n      entries.forEach(entry => {\n        if (entry.payments && entry.payments.length > 0) {\n          entry.payments.forEach(payment => {\n            // Check if payment date is in the selected year\n            if (payment.date.startsWith(selectedYear.toString())) {\n              if (!dailyPayments[payment.date]) {\n                dailyPayments[payment.date] = 0;\n              }\n              dailyPayments[payment.date] += payment.amount;\n            }\n          });\n        }\n      });\n      \n      console.log(`Daily payments for ${selectedYear}:`, dailyPayments);\n      \n      res.json(dailyPayments);\n    } catch (error) {\n      console.error(\"Error fetching daily payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch daily payments data\" });\n    }\n  });\n\n  // Dashboard summary route with date range filtering - restricted to admin/operator only\n  app.get(\"/api/dashboard\", isAdminOrOperator, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { startDate, endDate } = req.query;\n      \n      // Only admin and operator can access dashboard data\n      const entries = await storage.getEntries();\n      \n      // Filter entries by date range if provided\n      let filteredEntries = entries;\n      if (startDate || endDate) {\n        filteredEntries = entries.filter(entry => {\n          const entryDate = new Date(entry.auctionDate);\n          const start = startDate ? new Date(startDate as string) : null;\n          const end = endDate ? new Date((endDate as string) + ' 23:59:59') : null;\n          \n          return (!start || entryDate >= start) && (!end || entryDate <= end);\n        });\n      }\n      \n      const totalAmount = filteredEntries.reduce((sum, entry) => sum + entry.totalAmount, 0);\n      const receivedAmount = filteredEntries.reduce((sum, entry) => sum + entry.receivedAmount, 0);\n      const pendingAmount = filteredEntries.reduce((sum, entry) => sum + entry.pendingAmount, 0);\n      \n      const pendingEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.PENDING).length;\n      const partialEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.PARTIAL).length;\n      const completedEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.FULL).length;\n      \n      // Get remaining advance payments (only for admin/operator, viewers get 0)\n      let totalAdvancePayments = 0;\n      if (user.role === \"admin\" || user.role === \"operator\") {\n        try {\n          const { pool } = await import(\"./db\");\n          \n          // Get all users with advance payments (don't filter by date - we want all users with any advance payments)\n          const usersWithAdvance = await pool.query(`\n            SELECT DISTINCT user_id FROM advance_payments\n          `);\n          \n          // Calculate remaining balance for each user\n          for (const userRow of usersWithAdvance.rows) {\n            const remainingBalance = await calculateRemainingAdvancePayment(userRow.user_id);\n            // Only add positive balances (users can't have negative advance balances)\n            if (remainingBalance > 0) {\n              totalAdvancePayments += remainingBalance;\n            }\n          }\n          \n          console.log(\"Dashboard advance payments calculation:\", {\n            usersChecked: usersWithAdvance.rows.length,\n            totalAdvancePayments\n          });\n        } catch (error) {\n          console.error(\"Error calculating advance payments for dashboard:\", error);\n          totalAdvancePayments = 0; // Set to 0 if there's an error\n        }\n      }\n      \n      // Sort entries by date (most recent first)\n      const recentActivity = [...entries]\n        .sort((a, b) => new Date(b.auctionDate).getTime() - new Date(a.auctionDate).getTime())\n        .slice(0, 5);\n      \n      // Get corpus settings for overall summary calculation\n      let corpusValue = 0;\n      try {\n        const corpusResult = await pool.query('SELECT corpus_value FROM corpus_settings LIMIT 1');\n        corpusValue = corpusResult.rows[0]?.corpus_value || 0;\n      } catch (error) {\n        console.log(\"No corpus settings found, using default value 0\");\n      }\n\n      // Get total expenses (unfiltered by date range)\n      let totalExpenses = 0;\n      try {\n        const expensesResult = await pool.query('SELECT SUM(amount) as total FROM expense_entries');\n        totalExpenses = parseInt(expensesResult.rows[0]?.total) || 0;\n      } catch (error) {\n        console.error(\"Error calculating total expenses:\", error);\n      }\n\n      // Get total received outstanding payments from all users\n      let totalReceivedOutstanding = 0;\n      try {\n        const { pool } = await import(\"./db\");\n        const result = await pool.query(`\n          SELECT COALESCE(SUM(received_amount), 0) as total_received_outstanding\n          FROM previous_outstanding_records\n        `);\n        totalReceivedOutstanding = parseInt(result.rows[0].total_received_outstanding) || 0;\n      } catch (error) {\n        console.error(\"Error calculating received outstanding:\", error);\n        totalReceivedOutstanding = 0;\n      }\n\n      // Calculate cash in bank: ‚Çπ139,084 + ‚Çπ4,831 + ‚Çπ43,231 - ‚Çπ7,284 + Total Received Outstanding Payment\n      // Expenses are stored in paisa, need to convert to rupees for calculation\n      const cashInBank = corpusValue + receivedAmount + totalAdvancePayments - Math.round(totalExpenses / 100) + totalReceivedOutstanding;\n\n      res.json({\n        summary: {\n          totalAmount,\n          receivedAmount,\n          pendingAmount,\n          pendingEntries,\n          partialEntries,\n          completedEntries,\n          totalAdvancePayments\n        },\n        overallSummary: {\n          corpusValue,\n          totalReceived: receivedAmount,\n          totalAdvancePayments,\n          totalExpenses,\n          totalReceivedOutstanding,\n          cashInBank\n        },\n        recentActivity\n      });\n    } catch (error) {\n      console.error(\"Dashboard error:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      res.status(500).json({ message: \"Failed to fetch dashboard data\", error: errorMessage });\n    }\n  });\n\n  // Database backup API - only for operators and admins\n  app.post(\"/api/database/backup\", isAdminOrOperator, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      console.log(`Database backup requested by ${currentUser.username} (${currentUser.role})`);\n      \n      const xlsx = await import(\"xlsx\");\n      const nodemailer = await import(\"nodemailer\");\n      const path = await import(\"path\");\n      const fs = await import(\"fs\");\n      const { pool } = await import(\"./db\");\n      \n      // Create workbook\n      const workbook = xlsx.utils.book_new();\n      \n      // Get all tables data with correct column names\n      const tables = [\n        { name: \"Users\", query: \"SELECT id, username, name, email, mobile, address, role, status FROM users ORDER BY id\" },\n        { name: \"Boli_Entries\", query: \"SELECT id, user_id, user_name, user_mobile, description, amount, quantity, total_amount, occasion, auction_date as boli_date, received_amount, pending_amount, status, created_by FROM entries ORDER BY id\" },\n        { name: \"Advance_Payments\", query: \"SELECT id, user_id, user_name, user_mobile, date, amount, payment_mode, receipt_no, created_by FROM advance_payments ORDER BY id\" },\n        { name: \"Dravya_Entries\", query: \"SELECT id, user_id, user_name, description, occasion, created_by FROM dravya_entries ORDER BY id\" },\n        { name: \"Expense_Entries\", query: \"SELECT id, description, amount, quantity, reason, expense_date, payment_mode, approved_by, created_by, updated_at FROM expense_entries ORDER BY id\" },\n        { name: \"Transaction_Logs\", query: \"SELECT id, entry_id, user_id, username, description, amount, transaction_type, date, timestamp FROM transaction_logs ORDER BY id\" }\n      ];\n      \n      // Export each table as a worksheet\n      for (const table of tables) {\n        try {\n          const result = await pool.query(table.query);\n          const worksheet = xlsx.utils.json_to_sheet(result.rows);\n          xlsx.utils.book_append_sheet(workbook, worksheet, table.name);\n          console.log(`Exported ${result.rows.length} rows from ${table.name}`);\n        } catch (tableError) {\n          console.error(`Error exporting ${table.name}:`, tableError);\n          // Create empty sheet for failed table\n          const emptySheet = xlsx.utils.json_to_sheet([{ error: `Failed to export ${table.name}` }]);\n          xlsx.utils.book_append_sheet(workbook, emptySheet, table.name);\n        }\n      }\n      \n      // Generate filename with timestamp\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];\n      const filename = `Database_Backup_${timestamp}.xlsx`;\n      const filepath = path.join(process.cwd(), 'uploads', filename);\n      \n      // Write Excel file\n      xlsx.writeFile(workbook, filepath);\n      console.log(`Backup file created: ${filename}`);\n      \n      // Get all operators for email distribution\n      const operatorResult = await pool.query(\n        \"SELECT email, name FROM users WHERE role IN ('operator', 'admin') AND email IS NOT NULL AND email != ''\"\n      );\n      \n      if (operatorResult.rows.length === 0) {\n        return res.status(400).json({ message: \"No operators with valid email addresses found\" });\n      }\n      \n      // Check if SendGrid API key is available\n      if (!process.env.SENDGRID_API_KEY) {\n        console.log(\"SendGrid API key not found, skipping email sending\");\n        return res.json({ \n          message: \"Database backup created successfully. Email functionality requires SendGrid API key.\",\n          filename,\n          operatorCount: operatorResult.rows.length,\n          downloadUrl: `/uploads/${filename}`\n        });\n      }\n      \n      // Configure nodemailer with SendGrid\n      const transporter = nodemailer.createTransport({\n        host: 'smtp.sendgrid.net',\n        port: 587,\n        secure: false,\n        auth: {\n          user: 'apikey',\n          pass: process.env.SENDGRID_API_KEY\n        }\n      });\n      \n      // Email configuration\n      const emailOptions = {\n        from: 'noreply@shivnagarjaintemple.org',\n        subject: `Database Backup - ${new Date().toLocaleDateString('en-IN')}`,\n        html: `\n          <h2>‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø - Database Backup</h2>\n          <p>Dear Temple Administrator,</p>\n          <p>A database backup has been automatically generated and is attached to this email.</p>\n          \n          <h3>Backup Details:</h3>\n          <ul>\n            <li><strong>Generated by:</strong> ${currentUser.name} (${currentUser.username})</li>\n            <li><strong>Date & Time:</strong> ${new Date().toLocaleString('en-IN')}</li>\n            <li><strong>File Size:</strong> ${Math.round(fs.statSync(filepath).size / 1024)} KB</li>\n          </ul>\n          \n          <h3>Included Data:</h3>\n          <ul>\n            <li>Users Management</li>\n            <li>Boli Entries & Payments</li>\n            <li>Advance Payments</li>\n            <li>Dravya Entries</li>\n            <li>Expense Entries</li>\n            <li>Transaction Logs</li>\n          </ul>\n          \n          <p><strong>Note:</strong> Please store this backup file securely and delete it from your email after downloading.</p>\n          <p>This is an automated email from the Temple Management System.</p>\n          \n          <hr>\n          <small>‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</small>\n        `,\n        attachments: [{\n          filename: filename,\n          path: filepath\n        }]\n      };\n      \n      // Send email to all operators\n      const emailPromises = operatorResult.rows.map(operator => \n        transporter.sendMail({\n          ...emailOptions,\n          to: operator.email,\n          html: emailOptions.html.replace('Dear Temple Administrator', `Dear ${operator.name}`)\n        })\n      );\n      \n      await Promise.all(emailPromises);\n      console.log(`Backup email sent to ${operatorResult.rows.length} operators`);\n      \n      // Clean up the file after sending\n      setTimeout(() => {\n        try {\n          fs.unlinkSync(filepath);\n          console.log(`Backup file ${filename} cleaned up`);\n        } catch (cleanupError) {\n          console.error(\"Error cleaning up backup file:\", cleanupError);\n        }\n      }, 300000); // Delete after 5 minutes\n      \n      res.json({\n        message: `Database backup created and emailed to ${operatorResult.rows.length} operators successfully`,\n        filename,\n        operatorCount: operatorResult.rows.length,\n        operatorEmails: operatorResult.rows.map(op => op.email),\n        downloadUrl: `/uploads/${filename}`\n      });\n      \n    } catch (error) {\n      console.error(\"Database backup error:\", error);\n      res.status(500).json({ \n        message: \"Failed to create database backup\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Previous Outstanding Records API routes\n  app.get(\"/api/previous-outstanding\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { userId } = req.query;\n      \n      let records;\n      if (userId) {\n        records = await db.select().from(previousOutstandingRecords)\n          .where(eq(previousOutstandingRecords.userId, parseInt(userId as string)));\n      } else {\n        records = await db.select().from(previousOutstandingRecords);\n      }\n      \n      // For each record, calculate payment totals\n      const recordsWithPayments = records.map((record) => {\n        const payments = record.payments || [];\n        const receivedAmount = payments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n        const pendingAmount = Math.max(0, record.outstandingAmount - receivedAmount);\n        \n        // Determine status\n        let status: 'pending' | 'partial' | 'full' = 'pending';\n        if (receivedAmount >= record.outstandingAmount) {\n          status = 'full';\n        } else if (receivedAmount > 0) {\n          status = 'partial';\n        }\n        \n        return {\n          ...record,\n          receivedAmount,\n          pendingAmount,\n          status\n        };\n      });\n      \n      res.json(recordsWithPayments);\n    } catch (error) {\n      console.error(\"Error fetching previous outstanding records:\", error);\n      res.status(500).json({ message: \"Failed to fetch previous outstanding records\" });\n    }\n  });\n\n  // Get single previous outstanding record\n  app.get(\"/api/previous-outstanding/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      \n      const [record] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, recordId));\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Previous outstanding record not found\" });\n      }\n      \n      // Calculate totals from existing payments array\n      const payments = record.payments || [];\n      const receivedAmount = payments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n      const pendingAmount = Math.max(0, record.outstandingAmount - receivedAmount);\n      \n      // Determine status\n      let status: 'pending' | 'partial' | 'full' = 'pending';\n      if (receivedAmount >= record.outstandingAmount) {\n        status = 'full';\n      } else if (receivedAmount > 0) {\n        status = 'partial';\n      }\n      \n      const result = {\n        ...record,\n        receivedAmount,\n        pendingAmount,\n        status,\n        payments: payments.sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime())\n      };\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Error fetching previous outstanding record:\", error);\n      res.status(500).json({ message: \"Failed to fetch previous outstanding record\" });\n    }\n  });\n\n  // Record payment for previous outstanding record\n  app.post(\"/api/previous-outstanding/:id/payment\", isAuthenticated, upload.single('paymentFile'), async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      const { amount, date, mode, receiptNo } = req.body;\n      const user = req.user as any;\n      \n      if (!amount || !date || !mode) {\n        return res.status(400).json({ message: \"Amount, date, and payment mode are required\" });\n      }\n      \n      // Verify record exists\n      const [record] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, recordId));\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Previous outstanding record not found\" });\n      }\n      \n      // Calculate current totals from existing payments array\n      const existingPayments = record.payments || [];\n      const totalReceived = existingPayments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n      const amountToAdd = parseInt(amount);\n      \n      if (totalReceived + amountToAdd > record.outstandingAmount) {\n        return res.status(400).json({ \n          message: `Payment amount exceeds remaining balance. Remaining: ‚Çπ${(record.outstandingAmount - totalReceived) / 100}` \n        });\n      }\n      \n      let fileUrl = null;\n      if (req.file) {\n        // Save file and get URL\n        fileUrl = `/uploads/${req.file.filename}`;\n      }\n      \n      // Create new payment record\n      const newPayment = {\n        date,\n        amount: amountToAdd,\n        mode,\n        receiptNo: receiptNo || undefined,\n        fileUrl: fileUrl || undefined,\n        updatedBy: user.name\n      };\n      \n      // Add payment to existing payments array\n      const updatedPayments = [...existingPayments, newPayment];\n      \n      // Calculate updated totals\n      const newTotalReceived = totalReceived + amountToAdd;\n      const newPendingAmount = record.outstandingAmount - newTotalReceived;\n      \n      // Determine status\n      let newStatus: 'pending' | 'partial' | 'full';\n      if (newPendingAmount <= 0) {\n        newStatus = 'full';\n      } else if (newTotalReceived > 0) {\n        newStatus = 'partial';\n      } else {\n        newStatus = 'pending';\n      }\n      \n      // Update the record with new payment and calculated values\n      await db.update(previousOutstandingRecords)\n        .set({ \n          payments: updatedPayments,\n          receivedAmount: newTotalReceived,\n          pendingAmount: Math.max(0, newPendingAmount),\n          status: newStatus,\n          updatedAt: new Date().toISOString() \n        })\n        .where(eq(previousOutstandingRecords.id, recordId));\n      \n      res.json({ message: \"Payment recorded successfully\", payment: newPayment });\n    } catch (error) {\n      console.error(\"Error recording payment:\", error);\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  app.post(\"/api/previous-outstanding\", isAdminOrOperator, upload.single('attachmentFile'), async (req: Request, res: Response) => {\n    try {\n      const { userId, userName, userMobile, userAddress, outstandingAmount, description, createdBy } = req.body;\n      \n      // Debug logging\n      console.log(\"Raw request body:\", req.body);\n      console.log(\"Parsed values:\", { userId, userName, userMobile, userAddress, outstandingAmount, description, createdBy });\n      \n      // Validate required fields\n      const validationData = {\n        userId: parseInt(userId) || 0,\n        userName: userName || '',\n        userMobile: userMobile || '',\n        userAddress: userAddress || '',\n        outstandingAmount: parseInt(outstandingAmount) || 0, // Already in paisa\n        description: description || 'Previous Outstanding Amount',\n        createdBy: createdBy || 'system'\n      };\n      \n      console.log(\"Validation data:\", validationData);\n\n      const validatedData = insertPreviousOutstandingRecordSchema.parse(validationData);\n\n      // Handle file upload\n      let attachmentUrl = null;\n      let attachmentName = null;\n      \n      if (req.file) {\n        const uploadDir = path.join(process.cwd(), 'uploads');\n        if (!fs.existsSync(uploadDir)) {\n          fs.mkdirSync(uploadDir, { recursive: true });\n        }\n        \n        const filename = `previous-outstanding-${Date.now()}-${req.file.originalname}`;\n        const filepath = path.join(uploadDir, filename);\n        \n        fs.renameSync(req.file.path, filepath);\n        attachmentUrl = `/uploads/${filename}`;\n        attachmentName = req.file.originalname;\n      }\n\n      // Create record\n      const [record] = await db.insert(previousOutstandingRecords).values({\n        ...validatedData,\n        attachmentUrl,\n        attachmentName\n      }).returning();\n\n      console.log(`Previous outstanding record created: ‚Çπ${validationData.outstandingAmount/100} for user ${validationData.userName} by ${validationData.createdBy}`);\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error creating previous outstanding record:\", error);\n      if (error instanceof ZodError) {\n        const validationError = fromZodError(error);\n        return res.status(400).json({ message: validationError.message });\n      }\n      res.status(500).json({ message: \"Failed to create previous outstanding record\" });\n    }\n  });\n\n  // Record payment for previous outstanding record\n  app.post(\"/api/previous-outstanding/:id/payment\", isAdminOrOperator, upload.single('paymentFile'), async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      const { amount, date, mode, receiptNo } = req.body;\n      const user = req.user as any;\n\n      // Validate payment data\n      const paymentData = {\n        entryId: recordId,\n        amount: parseInt(amount),\n        date,\n        mode,\n        receiptNo: receiptNo || undefined\n      };\n\n      const validatedPayment = recordPaymentSchema.parse(paymentData);\n\n      // Get the previous outstanding record\n      const [record] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, recordId));\n\n      if (!record) {\n        return res.status(404).json({ message: \"Previous outstanding record not found\" });\n      }\n\n      // Handle file upload\n      let fileUrl = null;\n      if (req.file) {\n        fileUrl = `/uploads/${req.file.filename}`;\n      }\n\n      // Create payment record\n      const newPayment = {\n        date: validatedPayment.date,\n        amount: validatedPayment.amount,\n        mode: validatedPayment.mode,\n        fileUrl: fileUrl || undefined,\n        receiptNo: validatedPayment.receiptNo,\n        updatedBy: user.username\n      };\n\n      // Update the record with new payment\n      const updatedPayments = [...(record.payments || []), newPayment];\n      const newReceivedAmount = record.receivedAmount + validatedPayment.amount;\n      const newPendingAmount = record.outstandingAmount - newReceivedAmount;\n      \n      // Determine payment status\n      let status: PaymentStatusType;\n      if (newPendingAmount <= 0) {\n        status = PaymentStatus.FULL;\n      } else if (newReceivedAmount > 0) {\n        status = PaymentStatus.PARTIAL;\n      } else {\n        status = PaymentStatus.PENDING;\n      }\n\n      // Update the record\n      await db.update(previousOutstandingRecords)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: Math.max(0, newPendingAmount),\n          status: status,\n          updatedAt: new Date().toISOString()\n        })\n        .where(eq(previousOutstandingRecords.id, recordId));\n\n      res.json({ \n        message: \"Payment recorded successfully\",\n        payment: newPayment,\n        updatedRecord: {\n          id: recordId,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: Math.max(0, newPendingAmount),\n          status: status\n        }\n      });\n    } catch (error) {\n      console.error(\"Error recording payment:\", error);\n      if (error instanceof ZodError) {\n        const validationError = fromZodError(error);\n        return res.status(400).json({ message: validationError.message });\n      }\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  // Download route for differential Excel files\n  app.get(\"/api/download/:filename\", (req, res) => {\n    try {\n      const filename = req.params.filename;\n      const filepath = path.join(process.cwd(), filename);\n      \n      // Security check - only allow specific files\n      const allowedFiles = [\n        'Address_Differential_Users.xlsx',\n        'Missing_Users_Differential.xlsx',\n        'Address_Mobile_Differential_Users.xlsx',\n        'Duplicate_Mobile_Users_2025-08-09.xlsx'\n      ];\n      \n      if (!allowedFiles.includes(filename)) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      \n      if (!fs.existsSync(filepath)) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      \n      // Set appropriate headers for Excel download\n      res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n      \n      // Stream the file\n      const fileStream = fs.createReadStream(filepath);\n      fileStream.pipe(res);\n      \n    } catch (error) {\n      console.error(\"Error serving download:\", error);\n      res.status(500).json({ message: \"Failed to download file\" });\n    }\n  });\n\n  // Corpus Settings API endpoints (Admin only)\n  app.get(\"/api/corpus-settings\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Only allow admin access\n      if (user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied. Admin role required.\" });\n      }\n      \n      const [settings] = await db.select().from(corpusSettings).limit(1);\n      \n      // Return default values if no settings exist\n      if (!settings) {\n        return res.json({\n          corpusValue: 0,\n          baseDate: \"2025-07-31\",\n          updatedAt: null,\n          updatedBy: null\n        });\n      }\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching corpus settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch corpus settings\" });\n    }\n  });\n\n  app.post(\"/api/corpus-settings\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Only allow admin access\n      if (user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied. Admin role required.\" });\n      }\n      \n      const validatedData = insertCorpusSettingsSchema.parse({\n        ...req.body,\n        corpusValue: req.body.corpusValue, // Keep as rupees\n        updatedBy: user.username\n      });\n      \n      // Check if settings already exist\n      const [existingSettings] = await db.select().from(corpusSettings).limit(1);\n      \n      let result;\n      if (existingSettings) {\n        // Update existing settings\n        [result] = await db.update(corpusSettings)\n          .set(validatedData)\n          .where(eq(corpusSettings.id, existingSettings.id))\n          .returning();\n      } else {\n        // Create new settings\n        [result] = await db.insert(corpusSettings).values(validatedData).returning();\n      }\n      \n      console.log(`Corpus settings updated by ${user.username}: ‚Çπ${req.body.corpusValue} as of ${validatedData.baseDate}`);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error updating corpus settings:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to update corpus settings\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":99325},"local-deployment/client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"local-deployment/vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\n\nexport default defineConfig({\n  plugins: [react()],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    port: 3000,\n  },\n});","size_bytes":602},"database-schema-export.md":{"content":"# Shivnagar Jain Temple Account Ledger Database Schema Export\n\n**Generated on:** July 27, 2025  \n**Database:** PostgreSQL  \n**ORM:** Drizzle ORM  \n\n## Overview\n\nThis database supports a mobile-first spiritual donation management platform with three user roles (admin, operator, viewer) and three main functional areas:\n\n1. **Auction Entries** - Main ledger entries with payment tracking\n2. **Dravya Entries** - Spiritual donations (completely isolated)\n3. **Expense Entries** - Operator expense management (completely isolated)\n\n## Database Tables\n\n### 1. users\n**Purpose:** User authentication and role management\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | integer | NO | AUTO_INCREMENT | Primary key |\n| username | text | NO | - | Unique username for login |\n| password | text | NO | - | Plain text password |\n| name | text | NO | - | Full display name |\n| email | text | NO | - | Email address |\n| mobile | text | NO | '' | Mobile number |\n| address | text | NO | '' | Physical address |\n| role | text | NO | 'viewer' | User role: admin, operator, viewer |\n| status | text | NO | 'active' | Account status: active, inactive |\n\n**Indexes:**\n- PRIMARY KEY (id)\n- UNIQUE (username)\n\n### 2. entries (Boli Entries)\n**Purpose:** Main boli ledger entries with payment tracking\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | integer | NO | AUTO_INCREMENT | Primary key |\n| user_id | integer | NO | - | Reference to users.id |\n| user_name | text | NO | - | Cached user name |\n| user_mobile | text | YES | - | Cached user mobile |\n| user_address | text | YES | - | Cached user address |\n| description | text | NO | - | Entry description |\n| amount | integer | NO | 0 | Base amount in paisa |\n| quantity | integer | NO | 1 | Quantity multiplier |\n| total_amount | integer | NO | - | Calculated total (amount √ó quantity) |\n| occasion | text | NO | - | Event/occasion name |\n| auction_date | text | NO | - | Date of boli (YYYY-MM-DD) - Column name kept for DB compatibility |\n| status | text | NO | 'pending' | Payment status: pending, partial, full |\n| pending_amount | integer | NO | - | Remaining amount to be paid |\n| received_amount | integer | NO | 0 | Total amount received |\n| payments | json | NO | '[]' | Array of PaymentRecord objects |\n| updated_at | text | NO | ISO timestamp | Last update timestamp |\n| created_by | text | NO | 'system' | Username who created entry |\n\n**Payment Record JSON Structure:**\n```json\n{\n  \"date\": \"YYYY-MM-DD\",\n  \"amount\": 123400,\n  \"mode\": \"cash|upi|cheque|netbanking\",\n  \"fileUrl\": \"/uploads/file.jpg\",\n  \"receiptNo\": \"RCP2025001\",\n  \"updatedBy\": \"username\"\n}\n```\n\n### 3. dravya_entries (Spiritual Donations)\n**Purpose:** Spiritual donations - completely isolated from main application\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | integer | NO | AUTO_INCREMENT | Primary key |\n| user_id | integer | NO | - | Reference to users.id |\n| user_name | text | NO | - | Cached user name |\n| user_mobile | text | YES | - | Cached user mobile |\n| user_address | text | YES | - | Cached user address |\n| description | text | NO | - | Donation description |\n| occasion | text | NO | '' | Event/occasion name |\n| entry_date | text | NO | - | Date of donation (YYYY-MM-DD) |\n| created_by | text | NO | 'system' | Username who created entry |\n| updated_at | text | NO | ISO timestamp | Last update timestamp |\n\n**Note:** No payment tracking or amount fields - purely spiritual donations\n\n### 4. expense_entries (Operator Expenses)\n**Purpose:** Expense management for operators - completely isolated\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | integer | NO | AUTO_INCREMENT | Primary key |\n| description | text | NO | - | Line item description |\n| amount | integer | NO | - | Amount in paisa |\n| quantity | integer | NO | - | Quantity |\n| reason | text | NO | - | Reason for expense |\n| expense_date | text | NO | - | Date of expense (YYYY-MM-DD) |\n| payment_mode | text | NO | - | cash, upi, cheque, netbanking |\n| attachment_url | text | YES | - | Receipt/proof file path |\n| approved_by | text | NO | - | Approver name |\n| created_by | text | NO | - | Operator who created |\n| updated_at | text | NO | ISO timestamp | Last update timestamp |\n\n### 5. transaction_logs (Audit Trail)\n**Purpose:** Comprehensive audit trail for all boli entry operations\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | integer | NO | AUTO_INCREMENT | Primary key |\n| entry_id | integer | NO | - | Reference to entries.id |\n| user_id | integer | NO | - | User who performed action |\n| username | text | NO | - | Username for display |\n| transaction_type | text | NO | - | credit, debit, update_payment, update_entry |\n| amount | integer | NO | - | Amount involved in transaction |\n| description | text | NO | - | Human readable description |\n| date | text | NO | Current date | Transaction date (YYYY-MM-DD) |\n| details | json | NO | - | Additional metadata |\n| timestamp | text | NO | ISO timestamp | When log was created |\n\n## Enums and Constants\n\n### User Roles\n- `admin` - Full access, can manage users, view all data, delete entries\n- `operator` - Can add entries, manage payments, limited user management\n- `viewer` - Read-only access to personal data\n\n### Payment Status\n- `pending` - No payments made\n- `partial` - Some payments made, amount remaining\n- `full` - Fully paid\n\n### Payment Modes\n- `cash` - Cash payment\n- `upi` - UPI payment\n- `cheque` - Cheque payment\n- `netbanking` - Net banking payment\n\n### Transaction Types\n- `credit` - Adding new entry or deleting payment (increases balance)\n- `debit` - Recording payment or deleting entry (decreases balance)\n- `update_payment` - Updating existing payment\n- `update_entry` - Updating existing entry\n\n## Key Relationships\n\n1. **users ‚Üí entries** (1:N) - One user can have multiple boli entries\n2. **users ‚Üí dravya_entries** (1:N) - One user can have multiple dravya donations\n3. **entries ‚Üí transaction_logs** (1:N) - Each entry can have multiple audit logs\n4. **expense_entries** - Standalone, no foreign key relationships\n\n## Data Isolation Strategy\n\nThe system uses complete data isolation for secondary modules:\n\n1. **Dravya Entries**: Separate table, separate APIs (`/api/dravya-entries`), no payment tracking\n2. **Expense Entries**: Separate table, separate APIs (`/api/expense-entries`), operator-only access\n3. **Main Entries**: Only boli entries appear in dashboards and reports\n\n## Technical Notes\n\n### Amount Storage\n- All monetary amounts stored as integers in paisa (‚Çπ1 = 100 paisa)\n- Frontend displays amounts in rupees with proper formatting\n- Calculations done in paisa to avoid floating point precision issues\n\n### Date Format\n- All dates stored as text in YYYY-MM-DD format\n- Timestamps stored as ISO 8601 strings\n- Frontend handles locale-specific display formatting\n\n### File Uploads\n- Files stored in `/uploads` directory\n- Paths stored as relative URLs in database\n- Support for JPG, PNG, PDF formats\n- 10MB file size limit\n\n### Session Management\n- Express sessions with memory store\n- Session-based authentication using Passport.js\n- 24-hour session timeout\n\n## API Endpoints Summary\n\n### Authentication\n- `POST /api/auth/login` - User login\n- `GET /api/auth/user` - Get current user\n- `POST /api/auth/logout` - User logout\n\n### User Management\n- `GET /api/users` - List users (admin/operator only)\n- `POST /api/users` - Create user (admin/operator only)\n- `POST /api/users/bulk-upload` - Bulk user creation via CSV\n- `PATCH /api/users/:id` - Update user\n\n### Auction Entries\n- `GET /api/entries` - List entries\n- `POST /api/entries` - Create entry (operator only)\n- `PATCH /api/entries/:id` - Update entry (admin only)\n- `DELETE /api/entries/:id` - Delete entry (admin only)\n- `POST /api/entries/:id/payments` - Record payment\n- `DELETE /api/entries/:entryId/payments/:paymentIndex` - Delete payment\n\n### Dravya Entries (Isolated)\n- `GET /api/dravya-entries` - List dravya entries\n- `POST /api/dravya-entries` - Create dravya entry\n\n### Expense Entries (Isolated)\n- `GET /api/expense-entries` - List expense entries (operator only)\n- `POST /api/expense-entries` - Create expense entry (operator only)\n\n### Dashboard & Reports\n- `GET /api/dashboard` - Dashboard summary\n- `GET /api/daily-earnings` - Daily earnings calendar\n- `GET /api/daily-payments` - Daily payments calendar\n- `GET /api/transaction-logs` - Audit trail\n\n## Security Features\n\n1. **Role-based Access Control**: Strict permission checking on all endpoints\n2. **Session-based Authentication**: Secure session management\n3. **Data Isolation**: Complete separation of auction, dravya, and expense data\n4. **Audit Trail**: Comprehensive logging of all operations\n5. **File Upload Validation**: Strict file type and size restrictions\n\n## Schema Version\n**Current Version:** 1.0  \n**Last Updated:** July 26, 2025  \n**Compatibility:** PostgreSQL 12+, Drizzle ORM\n\n---\n\n*This schema supports the Shivnagar Jain Temple account ledger management system with mobile-first design and comprehensive financial tracking capabilities.*","size_bytes":9323},"local-deployment/shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, json } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Define role type\nexport const UserRole = {\n  ADMIN: \"admin\",\n  OPERATOR: \"operator\",\n  VIEWER: \"viewer\",\n} as const;\n\nexport type UserRoleType = typeof UserRole[keyof typeof UserRole];\n\n// Define payment status type\nexport const PaymentStatus = {\n  PENDING: \"pending\",\n  PARTIAL: \"partial\",\n  FULL: \"full\",\n} as const;\n\nexport type PaymentStatusType = typeof PaymentStatus[keyof typeof PaymentStatus];\n\n// Define payment mode type\nexport const PaymentMode = {\n  CASH: \"cash\",\n  UPI: \"upi\",\n  CHEQUE: \"cheque\",\n  NETBANKING: \"netbanking\",\n  ADVANCE_PAYMENT: \"advance_payment\",\n} as const;\n\nexport type PaymentModeType = typeof PaymentMode[keyof typeof PaymentMode];\n\n// Define transaction type for logging\nexport const TransactionType = {\n  CREDIT: \"credit\", // Adding new entry or deleting payment\n  DEBIT: \"debit\",   // Recording payment or deleting entry\n  UPDATE_PAYMENT: \"update_payment\", // Updating an existing payment\n  UPDATE_ENTRY: \"update_entry\",     // Updating an existing entry\n} as const;\n\nexport type TransactionTypeValue = typeof TransactionType[keyof typeof TransactionType];\n\n// Define entry types\nexport const EntryType = {\n  AUCTION: \"auction\",\n  DRAVYA: \"dravya\",\n} as const;\n\nexport type EntryTypeValue = typeof EntryType[keyof typeof EntryType];\n\n// Define UOM (Unit of Measurement) types for Dravya entries\nexport const UnitOfMeasurement = {\n  GRAM: \"gram\",\n  KG: \"kg\",\n  NO_UNIT: \"no_unit\",\n} as const;\n\nexport type UnitOfMeasurementType = typeof UnitOfMeasurement[keyof typeof UnitOfMeasurement];\n\n// Define payment record type\nexport type PaymentRecord = {\n  date: string;\n  amount: number;\n  mode: PaymentModeType;\n  fileUrl?: string; // For storing the path to uploaded files\n  receiptNo?: string; // Receipt number for tracking payments\n  updatedBy?: string; // Username of the person who recorded this payment\n};\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  serialNumber: integer(\"serial_number\").notNull().default(1),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  mobile: text(\"mobile\").notNull().default(\"\"),\n  address: text(\"address\").notNull().default(\"\"),\n  role: text(\"role\").$type<UserRoleType>().notNull().default(UserRole.VIEWER),\n  status: text(\"status\").notNull().default(\"active\"),\n});\n\n// Account entries table - only for boli entries\nexport const entries = pgTable(\"entries\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  description: text(\"description\").notNull(),\n  amount: integer(\"amount\").notNull().default(0),\n  quantity: integer(\"quantity\").notNull().default(1),\n  totalAmount: integer(\"total_amount\").notNull(),\n  occasion: text(\"occasion\").notNull(),\n  auctionDate: text(\"auction_date\").notNull(), // Note: Column name stays same for DB compatibility\n  status: text(\"status\").$type<PaymentStatusType>().notNull().default(PaymentStatus.PENDING),\n  pendingAmount: integer(\"pending_amount\").notNull(),\n  receivedAmount: integer(\"received_amount\").notNull().default(0),\n  payments: json(\"payments\").$type<PaymentRecord[]>().notNull().default([]),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n});\n\n// Separate table for dravya entries - completely isolated\nexport const dravyaEntries = pgTable(\"dravya_entries\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  description: text(\"description\").notNull(),\n  occasion: text(\"occasion\").notNull().default(\"\"),\n  entryDate: text(\"entry_date\").notNull(),\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Expense entries table (completely separate from main entries and dravya entries)\nexport const expenseEntries = pgTable(\"expense_entries\", {\n  id: serial(\"id\").primaryKey(),\n  firmName: text(\"firm_name\"), // Firm Name (optional)\n  billNo: text(\"bill_no\"), // Bill No (optional)\n  billDate: text(\"bill_date\"), // Bill Date (optional)\n  description: text(\"description\").notNull(), // Line Item Description\n  amount: integer(\"amount\").notNull(), // Amount in paisa (‚Çπ)\n  quantity: integer(\"quantity\"), // Quantity (optional)\n  reason: text(\"reason\"), // Reason for expense (optional)\n  expenseDate: text(\"expense_date\").notNull(), // Date of Expense\n  paymentMode: text(\"payment_mode\").notNull(), // Mode of Payment\n  attachmentUrl: text(\"attachment_url\"), // Attachment for expense receipt\n  approvedBy: text(\"approved_by\").notNull(), // Approved By\n  paidBy: text(\"paid_by\"), // Paid By (temporarily optional for migration)\n  createdBy: text(\"created_by\").notNull(), // Created by (operator)\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Advance payments table (completely separate module)\nexport const advancePayments = pgTable(\"advance_payments\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  date: text(\"date\").notNull(), // Date of advance payment\n  amount: integer(\"amount\").notNull(), // Amount in paisa (‚Çπ)\n  paymentMode: text(\"payment_mode\").notNull(), // cash, upi, cheque, netbanking\n  attachmentUrl: text(\"attachment_url\"), // Payment screenshot for non-cash\n  receiptNo: text(\"receipt_no\"), // Advance payment receipt number - AP-YYYY-XXXXX format\n  createdBy: text(\"created_by\").notNull(), // Created by\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()),\n});\n\n// Transaction logs table for tracking all credit and debit activities\nexport const transactionLogs = pgTable(\"transaction_logs\", {\n  id: serial(\"id\").primaryKey(),\n  entryId: integer(\"entry_id\").notNull(), // Reference to the entry\n  userId: integer(\"user_id\").notNull(), // User who performed the action\n  username: text(\"username\").notNull(), // Username for display\n  transactionType: text(\"transaction_type\").$type<TransactionTypeValue>().notNull(), // CREDIT or DEBIT\n  amount: integer(\"amount\").notNull(), // Amount involved\n  description: text(\"description\").notNull(), // Description of the transaction\n  date: text(\"date\").notNull().default(new Date().toISOString().split('T')[0]), // Date of transaction\n  details: json(\"details\").notNull(), // Additional details like payment method, etc.\n  timestamp: text(\"timestamp\").notNull().default(new Date().toISOString()), // When this log was created\n});\n\n// Advance payment usage tracking table\nexport const advancePaymentUsage = pgTable(\"advance_payment_usage\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(), // User whose advance payment was used\n  entryId: integer(\"entry_id\").notNull(), // Entry against which advance payment was applied\n  amount: integer(\"amount\").notNull(), // Amount of advance payment used\n  date: text(\"date\").notNull(), // Date when advance payment was applied\n  createdBy: text(\"created_by\").notNull(), // Who processed this usage\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()), // When this usage was recorded\n});\n\n// Previous outstanding records table - for migrating past account balances\nexport const previousOutstandingRecords = pgTable(\"previous_outstanding_records\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  outstandingAmount: integer(\"outstanding_amount\").notNull(), // Amount in paisa\n  receivedAmount: integer(\"received_amount\").notNull().default(0), // Amount received in paisa\n  pendingAmount: integer(\"pending_amount\").notNull().default(0), // Calculated pending amount in paisa\n  status: text(\"status\").$type<PaymentStatusType>().notNull().default(PaymentStatus.PENDING),\n  payments: json(\"payments\").$type<PaymentRecord[]>().notNull().default([]),\n  description: text(\"description\").notNull().default(\"Previous Outstanding Amount\"),\n  attachmentUrl: text(\"attachment_url\"), // Path to the uploaded proof file\n  attachmentName: text(\"attachment_name\"), // Original filename\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Zod schemas for validation\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  serialNumber: true,\n});\n\nexport const insertEntrySchema = createInsertSchema(entries).omit({\n  id: true,\n  status: true,\n  pendingAmount: true,\n  receivedAmount: true,\n  payments: true,\n}).extend({\n  // Make amount optional for entries\n  amount: z.number().nonnegative().optional().default(0),\n  // Make quantity optional with default 1\n  quantity: z.number().positive().optional().default(1),\n  // Occasion is optional\n  occasion: z.string().optional().default(\"\"),\n});\n\nexport const insertDravyaEntrySchema = createInsertSchema(dravyaEntries).omit({\n  id: true,\n}).extend({\n  // Occasion is optional for dravya entries\n  occasion: z.string().optional().default(\"\"),\n});\n\nexport const insertExpenseEntrySchema = createInsertSchema(expenseEntries).omit({\n  id: true,\n  updatedAt: true,\n}).extend({\n  // All fields are mandatory for expense entries\n  description: z.string().min(1, \"Description is required\"),\n  amount: z.number().positive(\"Amount must be positive\"),\n  quantity: z.number().positive(\"Quantity must be positive\"),\n  reason: z.string().min(1, \"Reason is required\"),\n  expenseDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  paymentMode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  attachmentUrl: z.string().optional(),\n  approvedBy: z.string().min(1, \"Approved by is required\"),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertEntry = z.infer<typeof insertEntrySchema>;\nexport type Entry = typeof entries.$inferSelect;\nexport type InsertDravyaEntry = z.infer<typeof insertDravyaEntrySchema>;\nexport type DravyaEntry = typeof dravyaEntries.$inferSelect;\nexport type InsertExpenseEntry = z.infer<typeof insertExpenseEntrySchema>;\nexport type ExpenseEntry = typeof expenseEntries.$inferSelect;\n\nexport const insertAdvancePaymentSchema = createInsertSchema(advancePayments).omit({\n  id: true,\n  createdAt: true,\n  receiptNo: true, // Receipt number is auto-generated\n}).extend({\n  userId: z.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  amount: z.number().positive(\"Amount must be positive\"),\n  paymentMode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  attachmentUrl: z.string().optional(),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertAdvancePayment = z.infer<typeof insertAdvancePaymentSchema>;\nexport type AdvancePayment = typeof advancePayments.$inferSelect;\n\n// Previous outstanding record schema\nexport const insertPreviousOutstandingRecordSchema = createInsertSchema(previousOutstandingRecords).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  receivedAmount: true,\n  pendingAmount: true,\n  status: true,\n  payments: true,\n}).extend({\n  userId: z.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  outstandingAmount: z.number().positive(\"Outstanding amount must be positive\"),\n  description: z.string().optional().default(\"Previous Outstanding Amount\"),\n  attachmentUrl: z.string().optional(),\n  attachmentName: z.string().optional(),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertPreviousOutstandingRecord = z.infer<typeof insertPreviousOutstandingRecordSchema>;\nexport type PreviousOutstandingRecord = typeof previousOutstandingRecords.$inferSelect;\n\nexport const recordPaymentSchema = z.object({\n  entryId: z.number(),\n  amount: z.number().positive(),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, { message: \"Date must be in YYYY-MM-DD format\" }),\n  mode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING, PaymentMode.ADVANCE_PAYMENT]),\n  fileUrl: z.string().optional(),\n  receiptNo: z.string().optional(),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Transaction log schema\nexport const insertTransactionLogSchema = createInsertSchema(transactionLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport type InsertTransactionLog = z.infer<typeof insertTransactionLogSchema>;\nexport type TransactionLog = typeof transactionLogs.$inferSelect;\nexport type RecordPayment = z.infer<typeof recordPaymentSchema>;\n\n// Corpus settings table (for admin configuration)\nexport const corpusSettings = pgTable(\"corpus_settings\", {\n  id: serial(\"id\").primaryKey(),\n  corpusValue: integer(\"corpus_value\").notNull().default(0), // Corpus value as of 31st July 2025 (in rupees)\n  baseDate: text(\"base_date\").notNull().default(\"2025-07-31\"), // Base date for corpus calculation\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  updatedBy: text(\"updated_by\").notNull(), // Username of admin who updated\n});\n\n// Corpus settings schema\nexport const insertCorpusSettingsSchema = createInsertSchema(corpusSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertCorpusSettings = z.infer<typeof insertCorpusSettingsSchema>;\nexport type CorpusSettings = typeof corpusSettings.$inferSelect;\n","size_bytes":14096},"local-deployment/client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7246},"local-deployment/server/storage.ts":{"content":"import {\n  users, entries, transactionLogs,\n  type User, type InsertUser,\n  type Entry, type InsertEntry,\n  type PaymentRecord, type UserRoleType, type PaymentStatusType,\n  PaymentStatus, UserRole, TransactionType, type TransactionTypeValue,\n  type TransactionLog, type InsertTransactionLog\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, SQL, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User management\n  getUsers(): Promise<User[]>;\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByMobile(mobile: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, updates: Partial<User>): Promise<User | undefined>;\n  \n  // Entry management\n  getEntries(): Promise<Entry[]>;\n  getEntry(id: number): Promise<Entry | undefined>;\n  getUserEntries(userId: number): Promise<Entry[]>;\n  getEntriesByUserId(userId: number): Promise<Entry[]>;\n  createEntry(entry: InsertEntry, createdByUserId: number): Promise<Entry>;\n  updateEntry(id: number, updates: Partial<Entry>, updatedByUserId: number): Promise<Entry | undefined>;\n  deleteEntry(id: number, deletedByUserId: number): Promise<boolean>;\n  \n  // Advance payment management\n  getAdvancePayments(): Promise<any[]>;\n  getAdvancePaymentsByUserId(userId: number): Promise<any[]>;\n  calculateRemainingAdvancePayment(userId: number): Promise<number>;\n  \n  // Dravya entry management\n  getDravyaEntries(): Promise<any[]>;\n  getDravyaEntriesByUserId(userId: number): Promise<any[]>;\n  \n  // Payment management\n  recordPayment(entryId: number, payment: PaymentRecord, recordedByUserId: number): Promise<Entry | undefined>;\n  deletePayment(entryId: number, paymentIndex: number, deletedByUserId: number): Promise<Entry | undefined>;\n  \n  // Transaction logging\n  getTransactionLogs(): Promise<TransactionLog[]>;\n  getEntryTransactionLogs(entryId: number): Promise<TransactionLog[]>;\n  createTransactionLog(log: InsertTransactionLog): Promise<TransactionLog>;\n}\n\n// Function to generate sequential receipt numbers based on year\nexport async function generateReceiptNumber(paymentDate: string): Promise<string> {\n  try {\n    const year = paymentDate.split('-')[0]; // Extract year from YYYY-MM-DD\n    \n    // Find all logs for this year that have receipt numbers\n    const logs = await db.select()\n      .from(transactionLogs)\n      .where(and(\n        // SQL string contains operation - checking for receipt numbers with this year\n        // e.g., \"details\" containing \"AM-2025-\"\n        eq(transactionLogs.transactionType, TransactionType.DEBIT)\n      ))\n      .orderBy(desc(transactionLogs.id))\n      .limit(100);\n    \n    let sequenceNumber = 1; // Default starting number\n    \n    // Loop through logs to find the latest receipt number for this year\n    for (const log of logs) {\n      if (!log.details) continue;\n      \n      const details = typeof log.details === 'string' \n        ? JSON.parse(log.details) \n        : log.details;\n      \n      // Skip if no receipt number in details\n      if (!details.receiptNo) continue;\n      \n      // Check if this receipt number matches our format and year\n      if (typeof details.receiptNo === 'string' && \n          details.receiptNo.startsWith(`AM-${year}-`)) {\n        \n        // Extract sequence number\n        const match = details.receiptNo.match(/AM-\\d{4}-(\\d{5})/);\n        if (match && match[1]) {\n          const foundNumber = parseInt(match[1], 10);\n          // Take the highest number we find\n          if (!isNaN(foundNumber) && foundNumber >= sequenceNumber) {\n            sequenceNumber = foundNumber + 1;\n          }\n        }\n      }\n    }\n    \n    // Format with 5 digits (00001, 00002, etc.)\n    const formattedNumber = sequenceNumber.toString().padStart(5, '0');\n    return `AM-${year}-${formattedNumber}`;\n  } catch (error) {\n    console.error(\"Error generating receipt number:\", error);\n    // Fallback to a timestamp-based format if there's an error\n    const timestamp = new Date().getTime();\n    return `AM-${paymentDate.split('-')[0]}-${timestamp.toString().slice(-5)}`;\n  }\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getTransactionLogs(): Promise<TransactionLog[]> {\n    try {\n      return await db.select().from(transactionLogs).orderBy(desc(transactionLogs.id));\n    } catch (error) {\n      console.error(\"Error fetching transaction logs:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getEntryTransactionLogs(entryId: number): Promise<TransactionLog[]> {\n    try {\n      return await db\n        .select()\n        .from(transactionLogs)\n        .where(eq(transactionLogs.entryId, entryId))\n        .orderBy(desc(transactionLogs.id));\n    } catch (error) {\n      console.error(`Error fetching transaction logs for entry ${entryId}:`, error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async createTransactionLog(log: InsertTransactionLog): Promise<TransactionLog> {\n    try {\n      // Ensure we have a valid transaction type\n      const transactionType = log.transactionType || TransactionType.UPDATE_ENTRY;\n      \n      const [result] = await db.insert(transactionLogs).values({\n        entryId: log.entryId || 0,\n        userId: log.userId || 0,\n        username: log.username || 'system',\n        description: log.description || 'Transaction record',\n        amount: log.amount || 0,\n        transactionType: transactionType,\n        details: JSON.stringify(log.details || {}),\n        date: new Date().toISOString().split('T')[0],\n        timestamp: new Date().toISOString()\n      }).returning();\n      \n      return result;\n    } catch (error) {\n      console.error(\"Error creating transaction log:\", error);\n      throw error;\n    }\n  }\n\n  async getUsers(): Promise<User[]> {\n    try {\n      return await db.select().from(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getUser(id: number): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.id, id));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserByUsername(username: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.username, username));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user by username ${username}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserByMobile(mobile: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.mobile, mobile));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user by mobile ${mobile}:`, error);\n      return undefined;\n    }\n  }\n  \n  async createUser(insertUser: InsertUser): Promise<User> {\n    try {\n      // Ensure default values\n      const userRole: UserRoleType = insertUser.role as UserRoleType || UserRole.VIEWER;\n      \n      // Get the next serial number based on existing users\n      const allUsers = await db.select().from(users);\n      const nextSerialNumber = allUsers.length + 1;\n      \n      const [newUser] = await db.insert(users).values({\n        ...insertUser,\n        role: userRole,\n        serialNumber: nextSerialNumber\n      }).returning();\n      \n      return newUser;\n    } catch (error) {\n      console.error(\"Error creating user:\", error);\n      throw error;\n    }\n  }\n  \n  async updateUser(id: number, updates: Partial<User>): Promise<User | undefined> {\n    try {\n      const [updatedUser] = await db\n        .update(users)\n        .set(updates)\n        .where(eq(users.id, id))\n        .returning();\n      \n      return updatedUser;\n    } catch (error) {\n      console.error(`Error updating user ${id}:`, error);\n      return undefined;\n    }\n  }\n\n  async getEntries(): Promise<Entry[]> {\n    try {\n      const entriesData = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .orderBy(entries.id); // Add explicit ordering by ID\n      \n      // Merge user information from users table to entries\n      return entriesData.map(item => ({\n        ...item.entry,\n        userName: item.user?.name || item.entry.userName,\n        userMobile: item.user?.mobile || item.entry.userMobile,\n        userAddress: item.user?.address || item.entry.userAddress\n      }));\n    } catch (error) {\n      console.error(\"Error fetching entries:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getEntry(id: number): Promise<Entry | undefined> {\n    try {\n      const entryData = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, id));\n      \n      if (entryData.length === 0) return undefined;\n      \n      // Merge user information from users table to entry\n      return {\n        ...entryData[0].entry,\n        userName: entryData[0].user?.name || entryData[0].entry.userName,\n        userMobile: entryData[0].user?.mobile || entryData[0].entry.userMobile,\n        userAddress: entryData[0].user?.address || entryData[0].entry.userAddress\n      };\n    } catch (error) {\n      console.error(`Error fetching entry ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserEntries(userId: number): Promise<Entry[]> {\n    try {\n      const entriesData = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.userId, userId));\n      \n      // Merge user information from users table to entries\n      return entriesData.map(item => ({\n        ...item.entry,\n        userName: item.user?.name || item.entry.userName,\n        userMobile: item.user?.mobile || item.entry.userMobile,\n        userAddress: item.user?.address || item.entry.userAddress\n      }));\n    } catch (error) {\n      console.error(`Error fetching entries for user ${userId}:`, error);\n      return []; // Return empty array instead of failing\n    }\n  }\n\n  async createEntry(insertEntry: InsertEntry, createdByUserId?: number): Promise<Entry> {\n    try {\n      console.log(\"Creating entry with data:\", insertEntry);\n      \n      const quantity = insertEntry.quantity || 1;\n      const totalAmount = insertEntry.amount * quantity;\n      \n      // Get the current user data to ensure we have the latest information\n      const userResult = await db.select().from(users).where(eq(users.id, insertEntry.userId));\n      const user = userResult.length > 0 ? userResult[0] : null;\n      \n      console.log(\"User found for entry:\", user);\n      \n      // Execute raw SQL query with exact column names to match the database\n      const sql = `\n        INSERT INTO entries (\n          user_id, user_name, user_mobile, user_address, \n          description, amount, quantity, total_amount, \n          occasion, auction_date, pending_amount, received_amount, \n          status, payments, created_by\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, \n          $9, $10, $11, $12, \n          $13, $14, $15\n        ) RETURNING *\n      `;\n      \n      const values = [\n        insertEntry.userId,\n        user?.name || insertEntry.userName || 'Unknown User',\n        user?.mobile || '',\n        user?.address || '',\n        insertEntry.description || '',\n        insertEntry.amount,\n        quantity,\n        totalAmount,\n        insertEntry.occasion || '',\n        insertEntry.auctionDate || new Date().toISOString().split('T')[0],\n        totalAmount,\n        0,\n        PaymentStatus.PENDING,\n        '[]',\n        createdByUserId ? 'operator' : 'system'\n      ];\n      \n      console.log(\"Executing SQL with values:\", values);\n      \n      const { pool } = await import(\"./db\");\n      const result = await pool.query(sql, values);\n      console.log(\"Entry creation result:\", result.rows[0]);\n      \n      const newEntry = result.rows[0];\n      \n      // Log this entry creation as a CREDIT transaction if we have the creator's ID\n      if (createdByUserId && newEntry) {\n        // Get the user who created the entry\n        const creatorResult = await db.select().from(users).where(eq(users.id, createdByUserId));\n        const creator = creatorResult.length > 0 ? creatorResult[0] : null;\n        \n        if (creator) {\n          try {\n            await this.createTransactionLog({\n              entryId: newEntry.id,\n              userId: createdByUserId,\n              username: creator.username,\n              description: `Created new entry: \"${newEntry.description}\"`,\n              amount: newEntry.totalAmount,\n              transactionType: TransactionType.CREDIT,\n              details: newEntry\n            });\n          } catch (logError) {\n            console.error(\"Error logging transaction:\", logError);\n            // Continue anyway so entry creation succeeds\n          }\n        }\n      }\n      \n      // Convert the response to match our expected schema format\n      return {\n        ...newEntry,\n        userId: newEntry.user_id,\n        userName: newEntry.user_name,\n        userMobile: newEntry.user_mobile,\n        userAddress: newEntry.user_address,\n        totalAmount: newEntry.totalAmount,\n        pendingAmount: newEntry.pending_amount,\n        receivedAmount: newEntry.received_amount,\n        auctionDate: newEntry.auction_date,\n        updatedAt: newEntry.updated_at,\n        createdBy: newEntry.created_by\n      };\n    } catch (error) {\n      console.error(\"Error in createEntry:\", error);\n      throw error;\n    }\n  }\n\n  async updateEntry(id: number, updates: Partial<Entry>, updatedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the original entry first\n      const [originalEntry] = await db.select().from(entries).where(eq(entries.id, id));\n      if (!originalEntry) return undefined;\n      \n      // Get the user who is updating this entry\n      const [updater] = await db.select().from(users).where(eq(users.id, updatedByUserId));\n      if (!updater) return undefined;\n      \n      // Calculate new values\n      const newAmount = updates.amount !== undefined ? updates.amount : originalEntry.amount;\n      const newQuantity = updates.quantity !== undefined ? updates.quantity : originalEntry.quantity;\n      const newTotal = newAmount * newQuantity;\n      const newPendingAmount = newTotal - originalEntry.receivedAmount;\n      \n      // Update the entry with snake_case field names to match DB\n      const [updatedEntry] = await db\n        .update(entries)\n        .set({\n          description: updates.description || originalEntry.description,\n          amount: newAmount,\n          quantity: newQuantity,\n          total_amount: newTotal,\n          pending_amount: newPendingAmount,\n          occasion: updates.occasion || originalEntry.occasion,\n          auction_date: updates.auctionDate || originalEntry.auctionDate,\n          updated_at: new Date().toISOString()\n        })\n        .where(eq(entries.id, id))\n        .returning();\n        \n      if (!updatedEntry) return undefined;\n      \n      // Removed transaction logging for entry updates to prevent errors\n      \n      return updatedEntry;\n    } catch (error) {\n      console.error(`Error updating entry ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async deleteEntry(id: number, deletedByUserId: number): Promise<boolean> {\n    try {\n      // Get the entry first to log the deletion\n      const [entry] = await db.select().from(entries).where(eq(entries.id, id));\n      if (!entry) return false;\n      \n      // Get the user who is deleting this entry\n      const [deleter] = await db.select().from(users).where(eq(users.id, deletedByUserId));\n      if (!deleter) return false;\n      \n      // Log this as a DEBIT transaction (canceling the original CREDIT)\n      await this.createTransactionLog({\n        entryId: entry.id,\n        userId: deletedByUserId,\n        username: deleter.username,\n        description: `Deleted entry #${entry.id}`,\n        amount: entry.totalAmount,\n        transactionType: TransactionType.DEBIT,\n        details: entry\n      });\n      \n      // Delete the entry\n      await db\n        .delete(entries)\n        .where(eq(entries.id, id));\n      \n      return true;\n    } catch (error) {\n      console.error(`Error deleting entry ${id}:`, error);\n      return false;\n    }\n  }\n  \n  async deletePayment(entryId: number, paymentIndex: number, deletedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the entry to modify its payments\n      const entryResult = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, entryId));\n      \n      if (entryResult.length === 0) return undefined;\n      \n      const entry = entryResult[0].entry;\n      const user = entryResult[0].user;\n      \n      if (!entry.payments || paymentIndex >= entry.payments.length) {\n        return undefined;\n      }\n      \n      // Get payment to be deleted\n      const paymentToDelete = entry.payments[paymentIndex];\n      \n      // Delete the payment by removing it from the array\n      const updatedPayments = [...entry.payments];\n      updatedPayments.splice(paymentIndex, 1);\n      \n      // Recalculate received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entry.totalAmount - newReceivedAmount;\n      \n      // Determine new payment status\n      let newStatus: PaymentStatusType;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entry.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      const oldStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      \n      // Update the entry with new payments and amounts\n      const [updateResult] = await db\n        .update(entries)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: newPendingAmount,\n          status: newStatus\n        })\n        .where(eq(entries.id, entryId))\n        .returning();\n      \n      if (!updateResult) return undefined;\n      \n      // Log deletion as a CREDIT transaction (canceling the original DEBIT)\n      await this.createTransactionLog({\n        entryId: entryId,\n        userId: deletedByUserId,\n        username: user?.username || \"system\",\n        description: `Deleted payment record of ‚Çπ${paymentToDelete.amount} from entry #${entryId}`,\n        amount: paymentToDelete.amount,\n        transactionType: TransactionType.CREDIT,\n        details: paymentToDelete\n      });\n      \n      // Also log status change if it happened\n      if (oldStatus !== newStatus) {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: deletedByUserId,\n          username: user?.username || \"system\",\n          description: `Payment status changed from ${oldStatus} to ${newStatus}`,\n          amount: 0,\n          transactionType: TransactionType.UPDATE_PAYMENT,\n          details: {\n            oldStatus,\n            newStatus\n          }\n        });\n      }\n      \n      return updateResult;\n    } catch (error) {\n      console.error(`Error deleting payment for entry ${entryId}:`, error);\n      return undefined;\n    }\n  }\n  \n  async recordPayment(entryId: number, payment: PaymentRecord, recordedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the entry to modify\n      const entryResult = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, entryId));\n      \n      if (entryResult.length === 0) return undefined;\n      \n      const entry = entryResult[0].entry;\n      const user = entryResult[0].user;\n      \n      // Ensure payments array exists\n      const currentPayments = entry.payments || [];\n      \n      // Add the new payment\n      const updatedPayments = [...currentPayments, payment];\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entry.totalAmount - newReceivedAmount;\n      \n      // Determine payment status\n      const oldStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      let newStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      \n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entry.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with the new payment and amounts\n      const [updateResult] = await db\n        .update(entries)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: newPendingAmount,\n          status: newStatus\n        })\n        .where(eq(entries.id, entryId))\n        .returning();\n      \n      if (!updateResult) return undefined;\n      \n      // Get user who recorded the payment\n      const recordingUser = await this.getUser(recordedByUserId);\n      \n      // Log the payment as a DEBIT transaction - Ensuring TransactionType is specified\n      try {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: recordedByUserId,\n          username: recordingUser?.username || \"system\",\n          description: `Payment of ‚Çπ${payment.amount} recorded by ${recordingUser?.username || \"system\"}`,\n          amount: payment.amount,\n          transactionType: TransactionType.DEBIT, // Explicitly setting the transaction type\n          details: {\n            date: payment.date,\n            paymentMode: payment.mode,\n            receiptNo: payment.receiptNo\n          }\n        });\n      } catch (logError) {\n        console.error(\"Error creating transaction log:\", logError);\n        // Continue execution even if logging fails\n      }\n      \n      // Log status change if status has changed\n      if (oldStatus !== newStatus) {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: recordedByUserId,\n          username: user?.username || \"system\",\n          description: `Payment status changed from ${oldStatus} to ${newStatus}`,\n          amount: 0,\n          transactionType: TransactionType.UPDATE_PAYMENT,\n          details: {\n            oldStatus,\n            newStatus,\n            payment\n          }\n        });\n      }\n      \n      return updateResult;\n    } catch (error) {\n      console.error(`Error recording payment for entry ${entryId}:`, error);\n      return undefined;\n    }\n  }\n\n  // New methods for user detail functionality\n  async getEntriesByUserId(userId: number): Promise<Entry[]> {\n    return this.getUserEntries(userId);\n  }\n\n  async getAdvancePayments(): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your advance payments schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(\"Error fetching advance payments:\", error);\n      return [];\n    }\n  }\n\n  async getAdvancePaymentsByUserId(userId: number): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your advance payments schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(`Error fetching advance payments for user ${userId}:`, error);\n      return [];\n    }\n  }\n\n  async getDravyaEntries(): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your dravya entries schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(\"Error fetching dravya entries:\", error);\n      return [];\n    }\n  }\n\n  async getDravyaEntriesByUserId(userId: number): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your dravya entries schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(`Error fetching dravya entries for user ${userId}:`, error);\n      return [];\n    }\n  }\n\n  async calculateRemainingAdvancePayment(userId: number): Promise<number> {\n    try {\n      const { pool } = await import(\"./db\");\n      \n      // Get total advance payments for the user\n      const advanceResult = await pool.query(\n        'SELECT COALESCE(SUM(amount), 0) as total_advance FROM advance_payments WHERE user_id = $1',\n        [userId]\n      );\n      \n      // Get total used advance payments (payments made using advance)\n      const usedResult = await pool.query(\n        'SELECT COALESCE(SUM(amount), 0) as total_used FROM advance_payment_usage WHERE user_id = $1',\n        [userId]\n      );\n      \n      const totalAdvance = parseInt(advanceResult.rows[0]?.total_advance || '0');\n      const totalUsed = parseInt(usedResult.rows[0]?.total_used || '0');\n      \n      console.log(`[DEBUG] User ${userId} - Total Advance: ${totalAdvance}, Total Used: ${totalUsed}`);\n      \n      const remainingBalance = totalAdvance - totalUsed;\n      \n      console.log(`[DEBUG] User ${userId} - Calculated Balance: ${remainingBalance}`);\n      \n      // Return 0 if balance would be negative (user can't have negative advance balance)\n      const finalBalance = Math.max(0, remainingBalance);\n      console.log(`[DEBUG] User ${userId} - Final Balance: ${finalBalance}`);\n      \n      return finalBalance;\n    } catch (error) {\n      console.error(`Error calculating advance payment for user ${userId}:`, error);\n      return 0;\n    }\n  }\n}\n\n// Initialize the database and storage\nasync function initializeDatabase() {\n  // Database initialization can happen here if needed\n  console.log(\"Database initialized\");\n}\n\nexport const storage = new DatabaseStorage();","size_bytes":26348},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"local-deployment/client/src/pages/user-detail.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { ArrowLeft, User, Wallet, Receipt, DollarSign, TrendingUp, TrendingDown, FileText } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { PreviousOutstandingSection } from \"@/components/previous-outstanding-section\";\nimport type { User as UserType, Entry, AdvancePayment, DravyaEntry, PaymentRecord } from \"@shared/schema\";\n\nexport default function UserDetail() {\n  const [, params] = useRoute(\"/users/:id\");\n  const [, myAccountParams] = useRoute(\"/my-account\");\n  const { user: currentUser } = useAuth();\n  \n  // If accessing /my-account, use current user's ID\n  const userId = myAccountParams ? currentUser?.id : (params?.id ? parseInt(params.id) : null);\n  \n  // State for receipt dialog\n  const [selectedReceiptData, setSelectedReceiptData] = useState<{\n    entry: Entry;\n    payment: PaymentRecord;\n    paymentIndex: number;\n  } | null>(null);\n\n\n\n  // Fetch user details\n  const { data: user, isLoading: userLoading } = useQuery<UserType>({\n    queryKey: [`/api/users/${userId}`],\n    enabled: !!userId,\n  });\n\n  // Fetch user's boli entries\n  const { data: entries = [], isLoading: entriesLoading } = useQuery<Entry[]>({\n    queryKey: [`/api/entries?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  // Fetch user's advance payments\n  const { data: advancePayments = [], isLoading: advanceLoading } = useQuery<AdvancePayment[]>({\n    queryKey: [`/api/advance-payments?userId=${userId}`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch to show latest data\n    gcTime: 0, // Don't cache\n  });\n\n  // Fetch user's dravya entries\n  const { data: dravyaEntries = [], isLoading: dravyaLoading } = useQuery<DravyaEntry[]>({\n    queryKey: [`/api/dravya-entries?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  // Get advance payment balance from server calculation\n  const { data: serverAdvanceBalance = 0 } = useQuery<number>({\n    queryKey: [`/api/users/${userId}/advance-balance`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch\n    gcTime: 0, // Don't cache\n  });\n\n  // Use server-calculated balance as the source of truth\n  const totalAdvancePayments = serverAdvanceBalance;\n\n  // Fetch user's previous outstanding records\n  const { data: previousOutstandingRecords = [] } = useQuery<any[]>({\n    queryKey: [`/api/previous-outstanding?userId=${userId}`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch to show latest data\n    gcTime: 0, // Don't cache\n  });\n\n  // Calculate totals for previous outstanding records\n  const totalPreviousOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.outstandingAmount || 0),\n    0\n  );\n  \n  const totalReceivedOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.receivedAmount || 0),\n    0\n  );\n  \n  const totalPendingOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.pendingAmount || record.outstandingAmount || 0),\n    0\n  );\n\n\n\n  if (!userId) {\n    return <div>Invalid user ID</div>;\n  }\n\n  if (userLoading) {\n    return <div className=\"p-4\">Loading user details...</div>;\n  }\n\n  if (!user) {\n    return <div className=\"p-4\">User not found</div>;\n  }\n\n  // Calculate summary statistics\n  const totalBoliAmount = entries.reduce((sum, entry) => sum + entry.totalAmount, 0);\n  const totalReceived = entries.reduce((sum, entry) => sum + entry.receivedAmount, 0);\n  const totalPending = entries.reduce((sum, entry) => sum + entry.pendingAmount, 0);\n  const totalDravyaEntries = dravyaEntries.length;\n\n  // Get all payments from entries\n  const allPayments = entries.flatMap(entry => {\n    if (entry.payments && Array.isArray(entry.payments)) {\n      return entry.payments.map(payment => ({\n        ...payment,\n        entryId: entry.id,\n        entryDescription: entry.description,\n        entryOccasion: entry.occasion,\n        entryBoliDate: entry.auctionDate,\n        userName: entry.userName,\n      }));\n    }\n    return [];\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'full': return 'bg-green-100 text-green-800';\n      case 'partial': return 'bg-yellow-100 text-yellow-800';\n      case 'pending': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'full': return 'Fully Paid';\n      case 'partial': return 'Partially Paid';\n      case 'pending': return 'Pending';\n      default: return status;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-7xl\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Link href=\"/users\">\n          <Button variant=\"outline\" size=\"sm\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Users\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-2xl font-bold\">{user.name}</h1>\n          <p className=\"text-muted-foreground\">@{user.username}</p>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Boli Daan</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">‚Çπ{totalBoliAmount.toLocaleString()}</div>\n            <p className=\"text-xs text-muted-foreground\">{entries.length} entries</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Received Amount</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">‚Çπ{totalReceived.toLocaleString()}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {totalBoliAmount > 0 ? Math.round((totalReceived / totalBoliAmount) * 100) : 0}% collected\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Received Outstanding</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-green-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">‚Çπ{totalReceivedOutstanding.toLocaleString()}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {totalPreviousOutstanding > 0 ? Math.round((totalReceivedOutstanding / totalPreviousOutstanding) * 100) : 0}% collected\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Pending Outstanding</CardTitle>\n            <TrendingDown className=\"h-4 w-4 text-red-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">‚Çπ{totalPendingOutstanding.toLocaleString()}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {totalPreviousOutstanding > 0 ? Math.round((totalPendingOutstanding / totalPreviousOutstanding) * 100) : 0}% remaining\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Advance Payment Remaining</CardTitle>\n            <Wallet className=\"h-4 w-4 text-blue-600\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">‚Çπ{totalAdvancePayments.toLocaleString()}</div>\n            <p className=\"text-xs text-muted-foreground\">\n              {totalAdvancePayments > 0 ? \"remaining balance\" : \"no balance remaining\"}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Sections */}\n      <Tabs defaultValue=\"boli-entries\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"boli-entries\">Boli Entries Status</TabsTrigger>\n          <TabsTrigger value=\"payments\">Payments & Receipts</TabsTrigger>\n          <TabsTrigger value=\"dravya\">Dravya Daan</TabsTrigger>\n          <TabsTrigger value=\"previous-outstanding\">Previous Outstanding</TabsTrigger>\n        </TabsList>\n\n        {/* Boli Entries Tab */}\n        <TabsContent value=\"boli-entries\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Boli Entries</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {entriesLoading ? (\n                <div>Loading entries...</div>\n              ) : entries.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No boli entries found for this user.\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Description</TableHead>\n                        <TableHead>Amount</TableHead>\n                        <TableHead>Quantity</TableHead>\n                        <TableHead>Total</TableHead>\n                        <TableHead>Status</TableHead>\n                        <TableHead>Occasion</TableHead>\n                        <TableHead>Boli Date</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {entries.map((entry) => (\n                        <TableRow key={entry.id}>\n                          <TableCell className=\"font-medium\">{entry.description}</TableCell>\n                          <TableCell>‚Çπ{entry.amount.toLocaleString()}</TableCell>\n                          <TableCell>{entry.quantity}</TableCell>\n                          <TableCell>‚Çπ{entry.totalAmount.toLocaleString()}</TableCell>\n                          <TableCell>\n                            <Badge className={getStatusColor(entry.status)}>\n                              {getStatusText(entry.status)}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>{entry.occasion}</TableCell>\n                          <TableCell>{formatDate(entry.auctionDate)}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Payments & Receipts Tab */}\n        <TabsContent value=\"payments\">\n          <div className=\"space-y-6\">\n            {/* Boli Payments */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Boli Entry Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {allPayments.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No payments found for this user.\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Receipt No.</TableHead>\n                          <TableHead>Entry Description</TableHead>\n                          <TableHead>Amount</TableHead>\n                          <TableHead>Mode</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {allPayments.map((payment, index) => (\n                          <TableRow key={`${payment.entryId}-${index}`}>\n                            <TableCell className=\"font-medium\">{payment.receiptNo}</TableCell>\n                            <TableCell>{payment.entryDescription}</TableCell>\n                            <TableCell>‚Çπ{payment.amount.toLocaleString()}</TableCell>\n                            <TableCell>{payment.mode}</TableCell>\n                            <TableCell>{formatDate(payment.date)}</TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  // Find the entry that contains this payment\n                                  const entry = entries.find(e => e.id === payment.entryId);\n                                  if (entry) {\n                                    setSelectedReceiptData({\n                                      entry,\n                                      payment,\n                                      paymentIndex: index\n                                    });\n                                  }\n                                }}\n                              >\n                                <Receipt className=\"h-4 w-4 mr-2\" />\n                                Receipt\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Advance Payments */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Advance Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {advanceLoading ? (\n                  <div>Loading advance payments...</div>\n                ) : advancePayments.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No advance payments found for this user.\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Receipt No.</TableHead>\n                          <TableHead>Amount</TableHead>\n                          <TableHead>Payment Mode</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {advancePayments.map((payment) => (\n                          <TableRow key={payment.id}>\n                            <TableCell className=\"font-medium\">{payment.receiptNo}</TableCell>\n                            <TableCell>‚Çπ{payment.amount.toLocaleString()}</TableCell>\n                            <TableCell>{payment.paymentMode}</TableCell>\n                            <TableCell>{formatDate(payment.date)}</TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                disabled\n                                title=\"Receipt functionality coming soon\"\n                              >\n                                <Receipt className=\"h-4 w-4 mr-2\" />\n                                Receipt\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Dravya Daan Tab */}\n        <TabsContent value=\"dravya\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Dravya Daan Transactions</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {dravyaLoading ? (\n                <div>Loading dravya entries...</div>\n              ) : dravyaEntries.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No dravya daan entries found for this user.\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Description</TableHead>\n                        <TableHead>Occasion</TableHead>\n                        <TableHead>Date</TableHead>\n                        <TableHead>Created By</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {dravyaEntries.map((entry) => (\n                        <TableRow key={entry.id}>\n                          <TableCell className=\"font-medium\">{entry.description}</TableCell>\n                          <TableCell>{entry.occasion}</TableCell>\n                          <TableCell>{formatDate(entry.entryDate)}</TableCell>\n                          <TableCell>{entry.createdBy}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Previous Outstanding Tab */}\n        <TabsContent value=\"previous-outstanding\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Previous Outstanding Records</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Historical outstanding amounts from old system\n              </p>\n            </CardHeader>\n            <CardContent>\n              <PreviousOutstandingSection userId={userId!} />\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Receipt Dialog */}\n      {selectedReceiptData && (\n        <HindiReceipt\n          entry={selectedReceiptData.entry}\n          payment={selectedReceiptData.payment}\n          paymentIndex={selectedReceiptData.paymentIndex}\n          isOpen={!!selectedReceiptData}\n          onClose={() => setSelectedReceiptData(null)}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":19355},"client/src/components/entries-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isEntriesActive = location === '/entries' || location === '/dravya-entries' || \n                          location === '/entry/new' || location === '/dravya-entry-form';\n\n  const menuItems = [\n    {\n      path: '/entries',\n      icon: 'gavel',\n      label: 'Boli Entries',\n      description: user?.role === 'viewer' ? 'View your boli entries' : 'Manage boli-related entries'\n    },\n    {\n      path: '/dravya-entries',\n      icon: 'inventory_2',\n      label: 'Dravya Entries',\n      description: user?.role === 'viewer' ? 'View your dravya entries' : 'Manage dravya-related entries'\n    }\n  ];\n\n  // Add entry creation options for operators\n  if (user?.role === 'operator') {\n    menuItems.push(\n      {\n        path: '/entry/new',\n        icon: 'add_circle',\n        label: 'New Boli Entry',\n        description: 'Create new boli entry'\n      },\n      {\n        path: '/dravya-entry-form',\n        icon: 'add_circle',\n        label: 'New Dravya Entry',\n        description: 'Create new dravya entry'\n      }\n    );\n  }\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isEntriesActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons\">folder_open</span>\n        <span className=\"text-xs\">Entries</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                Entry Management\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":3657},"client/src/lib/auth.ts":{"content":"import { queryClient } from \"./queryClient\";\n\nexport type AuthUser = {\n  id: number;\n  username: string;\n  name: string;\n  email: string;\n  role: string;\n  status?: string;\n  mobile?: string;\n  address?: string;\n};\n\nexport async function logout() {\n  try {\n    await fetch(\"/api/auth/logout\", {\n      method: \"POST\",\n      credentials: \"include\",\n    });\n    queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    \n    // Force reload the page to clear any state and redirect to login\n    window.location.href = \"/\";\n    return true;\n  } catch (error) {\n    console.error(\"Logout failed:\", error);\n    return false;\n  }\n}\n","size_bytes":636},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"deploy/README.md":{"content":"# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ (Daan-Darpan) - Deployment Guide\n\n## üöÄ Complete Installation Package for Local/Server Deployment\n\nThis package contains everything needed to run the Daan Darpan Temple Management System on your local machine or server.\n\n## üìã System Requirements\n\n### Prerequisites\n- **Node.js**: Version 18.0.0 or higher\n- **PostgreSQL**: Version 12.0 or higher\n- **Operating System**: Ubuntu 18+, CentOS 7+, macOS 10.15+, Windows 10+\n- **RAM**: Minimum 2GB, Recommended 4GB\n- **Storage**: Minimum 1GB free space\n\n### Hardware Recommendations\n- **Local Use**: 2GB RAM, 10GB storage\n- **Small Organization (1-50 users)**: 4GB RAM, 50GB storage\n- **Medium Organization (50-200 users)**: 8GB RAM, 100GB storage\n\n## üõ†Ô∏è Installation Instructions\n\n### Step 1: Download and Extract\n1. Download the `daan-darpan-deployment.zip` file\n2. Extract to your desired location:\n   ```bash\n   unzip daan-darpan-deployment.zip\n   cd daan-darpan\n   ```\n\n### Step 2: Run Installation Script\n```bash\n# Make scripts executable\nchmod +x deploy/*.sh\n\n# Run installation\n./deploy/install.sh\n```\n\nThe installation script will:\n- ‚úÖ Check Node.js version (installs if needed)\n- ‚úÖ Install PostgreSQL (if not present)\n- ‚úÖ Install npm dependencies\n- ‚úÖ Create environment configuration\n- ‚úÖ Set up directory structure\n\n### Step 3: Configure Environment\nEdit the `.env` file with your settings:\n```bash\nnano .env\n```\n\n**Required Settings:**\n```env\n# Database Configuration\nDATABASE_URL=postgresql://daan_darpan_user:your_password@localhost:5432/daan_darpan\n\n# Server Configuration\nPORT=8484\nHOST=0.0.0.0\n\n# Security\nSESSION_SECRET=your-unique-session-secret-key\n\n# Email (Optional - for backups)\nEMAIL_HOST=smtp.gmail.com\nEMAIL_USER=your-email@gmail.com\nEMAIL_PASS=your-app-password\n```\n\n### Step 4: Setup Database\n```bash\n./deploy/setup-database.sh\n```\n\nThis will:\n- ‚úÖ Create PostgreSQL user and database\n- ‚úÖ Apply database schema\n- ‚úÖ Set up initial tables\n\n### Step 5: Start Application\n```bash\n./deploy/start.sh\n```\n\n## üåê Server Configuration\n\n### For Local Access Only\nIn `.env` file:\n```env\nHOST=127.0.0.1\nPORT=8484\n```\n**Access URL**: `http://localhost:8484`\n\n### For Network/Server Access\nIn `.env` file:\n```env\nHOST=0.0.0.0\nPORT=8484\n```\n**Access URL**: `http://YOUR_SERVER_IP:8484`\n\n### Custom Server IP Configuration\n1. **Edit `.env` file**:\n   ```env\n   HOST=192.168.1.100  # Your specific server IP\n   PORT=8484\n   ```\n\n2. **Configure Firewall** (if needed):\n   ```bash\n   # Ubuntu/Debian\n   sudo ufw allow 8484\n\n   # CentOS/RHEL\n   sudo firewall-cmd --permanent --add-port=8484/tcp\n   sudo firewall-cmd --reload\n   ```\n\n## üîß Manual Commands\n\n### Start Application\n```bash\nnpm run start\n```\n\n### Development Mode\n```bash\nnpm run dev\n```\n\n### Build Application\n```bash\nnpm run build\n```\n\n### Database Operations\n```bash\n# Push schema changes\nnpm run db:push\n\n# Force push (if conflicts)\nnpm run db:push --force\n```\n\n## üìÅ Directory Structure\n```\ndaan-darpan/\n‚îú‚îÄ‚îÄ client/           # Frontend React application\n‚îú‚îÄ‚îÄ server/           # Backend Express server\n‚îú‚îÄ‚îÄ shared/           # Shared TypeScript types\n‚îú‚îÄ‚îÄ uploads/          # File storage directory\n‚îú‚îÄ‚îÄ deploy/           # Deployment scripts\n‚îú‚îÄ‚îÄ .env              # Environment configuration\n‚îú‚îÄ‚îÄ package.json      # Dependencies and scripts\n‚îî‚îÄ‚îÄ README.md         # This file\n```\n\n## üéØ Default Login Credentials\n\n**Admin Account:**\n- Username: `admin`\n- Password: `admin123`\n\n**‚ö†Ô∏è IMPORTANT**: Change default password immediately after first login!\n\n## üîÑ Maintenance\n\n### Backup Database\n```bash\npg_dump daan_darpan > backup_$(date +%Y%m%d).sql\n```\n\n### Restore Database\n```bash\npsql daan_darpan < backup_20240920.sql\n```\n\n### Update Application\n1. Replace application files (keep `.env` and `uploads/`)\n2. Run: `npm install`\n3. Run: `npm run db:push`\n4. Restart: `./deploy/start.sh`\n\n## üåê Network Access Setup\n\n### For LAN Access (Same Network)\n1. Set `HOST=0.0.0.0` in `.env`\n2. Find server IP: `ip addr show` (Linux) or `ipconfig` (Windows)\n3. Access from other computers: `http://SERVER_IP:8484`\n\n### For Internet Access (Public Server)\n1. Set `HOST=0.0.0.0` in `.env`\n2. Configure router port forwarding (port 8484)\n3. Access via public IP: `http://PUBLIC_IP:8484`\n4. **Recommended**: Use SSL certificate and domain name\n\n## ‚ùó Troubleshooting\n\n### Application Won't Start\n```bash\n# Check logs\nnpm run dev\n\n# Check port usage\nnetstat -tulpn | grep 8484\n\n# Kill existing process\npkill -f \"node.*8484\"\n```\n\n### Database Connection Issues\n```bash\n# Check PostgreSQL status\nsudo systemctl status postgresql\n\n# Start PostgreSQL\nsudo systemctl start postgresql\n\n# Test connection\npsql -h localhost -U daan_darpan_user -d daan_darpan\n```\n\n### Permission Issues\n```bash\n# Fix uploads directory\nchmod 755 uploads\nchown -R $USER:$USER uploads\n\n# Fix script permissions\nchmod +x deploy/*.sh\n```\n\n## üìû Support\n\nFor technical support or issues:\n1. Check logs in the terminal\n2. Verify database connectivity\n3. Ensure all dependencies are installed\n4. Check firewall settings for network access\n\n## üîí Security Recommendations\n\n1. **Change default credentials** immediately\n2. **Use strong SESSION_SECRET** (minimum 32 characters)\n3. **Enable firewall** for server deployments\n4. **Regular backups** of database and uploads\n5. **Use HTTPS** for production deployments\n6. **Keep system updated** with security patches\n\n---\n\n**üåü ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Temple Management System**  \nVersion: 1.0.0  \nDeveloped for ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø","size_bytes":5656},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":7974},"client/src/components/ui/collapsible.tsx":{"content":"import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":315},"client/src/pages/advance-payments.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Plus, Search, Calendar, FileText, Eye, Receipt } from \"lucide-react\";\nimport { AdvancePaymentReceipt } from \"@/components/advance-payment-receipt\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { exportAdvancePayments } from \"@/lib/excel-export\";\n\ninterface AdvancePayment {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile?: string;\n  userAddress?: string;\n  date: string;\n  amount: number;\n  paymentMode: string;\n  attachmentUrl?: string;\n  receiptNo?: string;\n  createdBy: string;\n  createdAt: string;\n}\n\nexport default function AdvancePayments() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [paymentModeFilter, setPaymentModeFilter] = useState(\"all-modes\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n  \n  // Receipt modal state\n  const [selectedAdvancePayment, setSelectedAdvancePayment] = useState<AdvancePayment | null>(null);\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\n\n  // Fetch advance payments with date range query params\n  const queryParams = new URLSearchParams();\n  if (startDate) {\n    queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  }\n  if (endDate) {\n    queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n  }\n\n  const { data: advancePayments, isLoading } = useQuery<AdvancePayment[]>({\n    queryKey: ['/api/advance-payments', queryParams.toString()],\n  });\n\n  // Apply filters\n  const filteredPayments = useMemo(() => {\n    return (advancePayments || []).filter(payment => {\n      const matchesSearch = !searchTerm || \n        payment.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        payment.userMobile?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        payment.createdBy.toLowerCase().includes(searchTerm.toLowerCase());\n      \n      const matchesPaymentMode = !paymentModeFilter || paymentModeFilter === \"all-modes\" || \n        payment.paymentMode?.toLowerCase() === paymentModeFilter.toLowerCase();\n      \n      const paymentDate = new Date(payment.date);\n      const matchesDateRange = (!startDate || paymentDate >= startDate) && \n                              (!endDate || paymentDate <= endDate);\n      \n      return matchesSearch && matchesPaymentMode && matchesDateRange;\n    });\n  }, [advancePayments, searchTerm, paymentModeFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setPaymentModeFilter(\"all-modes\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatAmount = (amountInRupees: number) => {\n    return amountInRupees.toLocaleString();\n  };\n\n  const getPaymentModeColor = (mode: string) => {\n    switch (mode?.toLowerCase()) {\n      case 'cash': return 'bg-green-100 text-green-800';\n      case 'upi': return 'bg-blue-100 text-blue-800';\n      case 'cheque': return 'bg-yellow-100 text-yellow-800';\n      case 'netbanking': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  // Calculate totals for filtered data\n  const totalAmount = filteredPayments.reduce((sum, payment) => sum + payment.amount, 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center py-8\">Loading advance payments...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">All Advance Payments</h1>\n          <p className=\"text-gray-600\">\n            Total: ‚Çπ{formatAmount(totalAmount)} ({filteredPayments.length} payments)\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => exportAdvancePayments(filteredPayments)}\n            variant=\"outline\"\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n          >\n            üìä Export\n          </Button>\n          {(user?.role === 'admin' || user?.role === 'operator') && (\n            <Button onClick={() => setLocation('/advance-payment-form')}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Advance Payment\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Filters</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Search by user, mobile, or creator\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-8\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Payment Mode</label>\n              <Select value={paymentModeFilter} onValueChange={setPaymentModeFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-modes\">All Modes</SelectItem>\n                  <SelectItem value=\"cash\">Cash</SelectItem>\n                  <SelectItem value=\"upi\">UPI</SelectItem>\n                  <SelectItem value=\"cheque\">Cheque</SelectItem>\n                  <SelectItem value=\"netbanking\">Net Banking</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">From Date</label>\n              <div className=\"relative\">\n                <Calendar className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400 pointer-events-none z-10\" />\n                <DatePicker\n                  selected={startDate}\n                  onChange={setStartDate}\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"Select start date\"\n                  className=\"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  isClearable\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">To Date</label>\n              <div className=\"relative\">\n                <Calendar className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400 pointer-events-none z-10\" />\n                <DatePicker\n                  selected={endDate}\n                  onChange={setEndDate}\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"Select end date\"\n                  className=\"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  isClearable\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex gap-2 mt-4\">\n            <Button variant=\"outline\" size=\"sm\" onClick={clearFilters}>\n              Clear Filters\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Desktop Table View */}\n      <div className=\"hidden md:block\">\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">User</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Date</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Amount</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Payment Mode</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Receipt No</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Created By</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-gray-200\">\n                  {filteredPayments.map((payment) => (\n                    <tr key={payment.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-4 py-3\">\n                        <div>\n                          <div className=\"font-medium text-gray-900\">{payment.userName}</div>\n                          {payment.userMobile && (\n                            <div className=\"text-sm text-gray-500\">{payment.userMobile}</div>\n                          )}\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {formatDate(payment.date)}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm font-semibold text-gray-900\">\n                        ‚Çπ{formatAmount(payment.amount)}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge className={getPaymentModeColor(payment.paymentMode)}>\n                          {payment.paymentMode?.toUpperCase() || 'UNKNOWN'}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {payment.receiptNo || 'N/A'}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {payment.createdBy}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"flex gap-2\">\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedAdvancePayment(payment);\n                              setIsReceiptOpen(true);\n                            }}\n                          >\n                            <Receipt className=\"h-4 w-4 mr-1\" />\n                            Receipt\n                          </Button>\n                          {payment.attachmentUrl && (\n                            <Dialog>\n                              <DialogTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\">\n                                  <Eye className=\"h-4 w-4 mr-1\" />\n                                  View\n                                </Button>\n                              </DialogTrigger>\n                              <DialogContent className=\"max-w-4xl\">\n                                <DialogHeader>\n                                  <DialogTitle>Payment Screenshot - {payment.userName}</DialogTitle>\n                                </DialogHeader>\n                                <div className=\"mt-4\">\n                                  {payment.attachmentUrl.toLowerCase().endsWith('.pdf') ? (\n                                    <div className=\"text-center\">\n                                      <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n                                      <p className=\"text-gray-600 mb-4\">PDF Document</p>\n                                      <Button asChild>\n                                        <a href={payment.attachmentUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                                          Open PDF\n                                        </a>\n                                      </Button>\n                                    </div>\n                                  ) : (\n                                    <img \n                                      src={payment.attachmentUrl} \n                                      alt=\"Payment Screenshot\"\n                                      className=\"w-full h-auto max-h-96 object-contain mx-auto\"\n                                    />\n                                  )}\n                                </div>\n                              </DialogContent>\n                            </Dialog>\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Mobile Card View */}\n      <div className=\"md:hidden space-y-4\">\n        {filteredPayments.map((payment) => (\n          <Card key={payment.id}>\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900\">{payment.userName}</h3>\n                    {payment.userMobile && (\n                      <p className=\"text-sm text-gray-500\">{payment.userMobile}</p>\n                    )}\n                  </div>\n                  <Badge className={getPaymentModeColor(payment.paymentMode)}>\n                    {payment.paymentMode?.toUpperCase() || 'UNKNOWN'}\n                  </Badge>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-gray-500\">Date:</span>\n                    <br />\n                    <span className=\"font-medium\">{formatDate(payment.date)}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-500\">Amount:</span>\n                    <br />\n                    <span className=\"font-semibold text-lg\">‚Çπ{formatAmount(payment.amount)}</span>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"text-sm\">\n                    <span className=\"text-gray-500\">Receipt No:</span>\n                    <br />\n                    <span className=\"font-medium\">{payment.receiptNo || 'N/A'}</span>\n                  </div>\n                  <div className=\"text-sm\">\n                    <span className=\"text-gray-500\">Created by:</span>\n                    <br />\n                    <span className=\"font-medium\">{payment.createdBy}</span>\n                  </div>\n                </div>\n                \n                <div className=\"flex gap-2 mt-3\">\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedAdvancePayment(payment);\n                      setIsReceiptOpen(true);\n                    }}\n                  >\n                    <Receipt className=\"h-4 w-4 mr-1\" />\n                    Receipt\n                  </Button>\n                  {payment.attachmentUrl && (\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Eye className=\"h-4 w-4 mr-1\" />\n                          View\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"max-w-4xl\">\n                        <DialogHeader>\n                          <DialogTitle>Payment Screenshot - {payment.userName}</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"mt-4\">\n                          {payment.attachmentUrl.toLowerCase().endsWith('.pdf') ? (\n                            <div className=\"text-center\">\n                              <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n                              <p className=\"text-gray-600 mb-4\">PDF Document</p>\n                              <Button asChild>\n                                <a href={payment.attachmentUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                                  Open PDF\n                                </a>\n                              </Button>\n                            </div>\n                          ) : (\n                            <img \n                              src={payment.attachmentUrl} \n                              alt=\"Payment Screenshot\"\n                              className=\"w-full h-auto max-h-96 object-contain mx-auto\"\n                            />\n                          )}\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {filteredPayments.length === 0 && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-gray-500\">No advance payments found.</p>\n        </div>\n      )}\n      \n      {/* Receipt Modal */}\n      {selectedAdvancePayment && (\n        <AdvancePaymentReceipt\n          advancePayment={selectedAdvancePayment}\n          isOpen={isReceiptOpen}\n          onClose={() => {\n            setIsReceiptOpen(false);\n            setSelectedAdvancePayment(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":18404},"local-deployment/client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"local-deployment/client/src/components/daily-payments-calendar.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ntype DailyPaymentsData = {\n  [date: string]: number;\n};\n\nconst MONTHS = [\n  \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n  \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n];\n\nconst DAYS_IN_MONTH = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n\nconst isLeapYear = (year: number) => {\n  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n};\n\nconst getDaysInMonth = (month: number, year: number) => {\n  if (month === 1 && isLeapYear(year)) return 29; // February in leap year\n  return DAYS_IN_MONTH[month];\n};\n\nconst formatAmount = (amount: number) => {\n  // Amount is already in rupees, no need to divide by 100\n  if (amount >= 100000) {\n    return `${(amount / 100000).toFixed(1)}L`;\n  } else if (amount >= 1000) {\n    return `${(amount / 1000).toFixed(1)}K`;\n  } else {\n    return amount.toString();\n  }\n};\n\nexport default function DailyPaymentsCalendar() {\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  \n  // Generate year options (current year and 5 years back/forward)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = [];\n  for (let year = currentYear - 5; year <= currentYear + 5; year++) {\n    yearOptions.push(year);\n  }\n  \n  // Fetch daily payments data\n  const { data: dailyPayments, isLoading } = useQuery<DailyPaymentsData>({\n    queryKey: ['/api/daily-payments', selectedYear],\n    queryFn: () => fetch(`/api/daily-payments?year=${selectedYear}`).then(res => res.json()),\n  });\n  \n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Daily Payments Calendar</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex justify-center p-8\">Loading payments data...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n  \n  // Calculate monthly totals\n  const monthlyTotals = Array(12).fill(0);\n  if (dailyPayments) {\n    Object.entries(dailyPayments).forEach(([dateStr, amount]) => {\n      const date = new Date(dateStr);\n      const month = date.getMonth();\n      monthlyTotals[month] += amount;\n    });\n  }\n  \n  // Generate calendar grid\n  const generateCalendar = () => {\n    const calendar = [];\n    \n    for (let month = 0; month < 12; month++) {\n      const row = [];\n      const daysInMonth = getDaysInMonth(month, selectedYear);\n      \n      // Month name\n      row.push(\n        <div key={`month-${month}`} className=\"font-medium text-sm bg-blue-600 text-white p-2 text-center\">\n          {MONTHS[month]}\n        </div>\n      );\n      \n      // Days in month\n      for (let day = 1; day <= 31; day++) {\n        if (day <= daysInMonth) {\n          const dateKey = `${selectedYear}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n          const amount = dailyPayments?.[dateKey] || 0;\n          \n          row.push(\n            <div \n              key={`${month}-${day}`} \n              className={`p-1 text-xs text-center border border-neutral-200 min-h-[24px] flex items-center justify-center ${\n                amount > 0 \n                  ? 'bg-blue-100 text-blue-800 font-medium' \n                  : 'bg-neutral-50 text-neutral-400'\n              }`}\n              title={amount > 0 ? `‚Çπ${amount.toLocaleString()}` : 'No payments'}\n            >\n              {amount > 0 ? formatAmount(amount) : ''}\n            </div>\n          );\n        } else {\n          // Empty cell for days that don't exist in this month\n          row.push(\n            <div key={`${month}-${day}-empty`} className=\"p-1 text-xs bg-neutral-100 border border-neutral-200 min-h-[24px]\">\n            </div>\n          );\n        }\n      }\n      \n      // Monthly total\n      row.push(\n        <div key={`total-${month}`} className=\"font-medium text-sm bg-orange-100 text-orange-800 p-1 text-center min-h-[24px] flex items-center justify-center\">\n          ‚Çπ{monthlyTotals[month].toLocaleString()}\n        </div>\n      );\n      \n      calendar.push(\n        <div key={month} className=\"grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          {row}\n        </div>\n      );\n    }\n    \n    return calendar;\n  };\n  \n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle>Daily Payments Calendar</CardTitle>\n          <Select value={selectedYear.toString()} onValueChange={(value) => setSelectedYear(parseInt(value))}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {yearOptions.map(year => (\n                <SelectItem key={year} value={year.toString()}>\n                  {year}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Header row with day numbers */}\n        <div className=\"mb-2 grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Month</div>\n          {Array.from({ length: 31 }, (_, i) => (\n            <div key={i + 1} className=\"font-medium text-xs p-1 text-center bg-neutral-100 border border-neutral-200\">\n              {i + 1}\n            </div>\n          ))}\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Total</div>\n        </div>\n        \n        {/* Calendar grid */}\n        <div className=\"space-y-0\">\n          {generateCalendar()}\n        </div>\n        \n        {/* Legend */}\n        <div className=\"mt-4 flex items-center gap-4 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-blue-100 border border-blue-200\"></div>\n            <span>Payments received</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-neutral-50 border border-neutral-200\"></div>\n            <span>No payments</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6261},"local-deployment/client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1877},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/dravya-entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { DravyaHindiReceipt } from \"@/components/dravya-hindi-receipt\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { exportDravyaEntries } from \"@/lib/excel-export\";\n\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nexport default function DravyaEntries() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [occasionFilter, setOccasionFilter] = useState(\"all-occasions\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n\n  const { data: dravyaEntries, isLoading, error } = useQuery<any[]>({\n    queryKey: ['/api/dravya-entries'],\n  });\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-500\">\n          <p>Error loading dravya entries: {error.message}</p>\n          <Button onClick={() => window.location.reload()} className=\"mt-4\">\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Get unique occasions from dravya entries\n  const uniqueOccasions = Array.from(new Set((dravyaEntries || []).map(entry => entry.occasion).filter(Boolean)));\n\n  // Apply filters\n  const filteredEntries = useMemo(() => {\n    return (dravyaEntries || []).filter(entry => {\n      const matchesSearch = !searchTerm || \n        entry.user_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        entry.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        entry.user_mobile?.includes(searchTerm);\n      \n      const matchesOccasion = !occasionFilter || occasionFilter === \"all-occasions\" || \n        entry.occasion?.toLowerCase().includes(occasionFilter.toLowerCase());\n      \n      const entryDate = new Date(entry.entry_date);\n      const matchesDateRange = (!startDate || entryDate >= startDate) && \n                              (!endDate || entryDate <= endDate);\n      \n      return matchesSearch && matchesOccasion && matchesDateRange;\n    });\n  }, [dravyaEntries, searchTerm, occasionFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setOccasionFilter(\"all-occasions\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-10\" />\n            ))}\n          </div>\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n        <h1 className=\"text-2xl font-bold\">Dravya Entries</h1>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => exportDravyaEntries(filteredEntries)}\n            variant=\"outline\"\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100\"\n          >\n            üìä Export\n          </Button>\n          {(user?.role === 'operator' || user?.role === 'admin') && (\n            <Button onClick={() => setLocation('/dravya-entry-form')}>\n              Add Dravya Entry\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Filters */}\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Search</label>\n              <Input\n                placeholder=\"Search by name, description, or mobile\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Occasion</label>\n              <Select value={occasionFilter || undefined} onValueChange={setOccasionFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All occasions\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-occasions\">All occasions</SelectItem>\n                  {uniqueOccasions.map((occasion) => (\n                    <SelectItem key={occasion} value={occasion}>\n                      {occasion}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Actions</label>\n              <Button variant=\"outline\" onClick={clearFilters} className=\"w-full\">\n                Clear Filters\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n              <DatePicker\n                selected={startDate}\n                onChange={(date) => setStartDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select start date\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n              <DatePicker\n                selected={endDate}\n                onChange={(date) => setEndDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select end date\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results Summary */}\n      <div className=\"mb-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Showing {filteredEntries.length} of {(dravyaEntries || []).length} dravya entries\n        </p>\n      </div>\n\n      {/* Entries Table/Cards */}\n      {isMobile ? (\n        <div className=\"space-y-4\">\n          {filteredEntries.map((entry) => (\n            <Card key={entry.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n              <CardContent className=\"pt-4\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg\">{entry.user_name}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{entry.user_mobile}</p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2 text-sm\">\n                  <div><strong>Description:</strong> {entry.description || 'N/A'}</div>\n                  {entry.occasion && <div><strong>Occasion:</strong> {entry.occasion}</div>}\n                  <div><strong>Date:</strong> {entry.entry_date ? new Date(entry.entry_date).toLocaleDateString() : 'N/A'}</div>\n                  <div><strong>Created by:</strong> {entry.created_by || 'system'}</div>\n                </div>\n                <div className=\"mt-3 pt-3 border-t\">\n                  <DravyaHindiReceipt \n                    entry={{\n                      id: entry.id,\n                      userId: entry.user_id,\n                      userName: entry.user_name,\n                      description: entry.description,\n                      quantity: entry.quantity || 1,\n                      createdAt: entry.entry_date,\n                      userAddress: entry.user_address,\n                      userMobile: entry.user_mobile\n                    }}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>User Name</TableHead>\n                  <TableHead>Mobile</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Occasion</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Created By</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredEntries.map((entry) => (\n                  <TableRow key={entry.id}>\n                    <TableCell className=\"font-medium\">{entry.user_name}</TableCell>\n                    <TableCell>{entry.user_mobile || 'N/A'}</TableCell>\n                    <TableCell>{entry.description || 'N/A'}</TableCell>\n                    <TableCell>{entry.occasion || 'N/A'}</TableCell>\n                    <TableCell>{entry.entry_date ? new Date(entry.entry_date).toLocaleDateString() : 'N/A'}</TableCell>\n                    <TableCell>{entry.created_by || 'system'}</TableCell>\n                    <TableCell>\n                      <DravyaHindiReceipt \n                        entry={{\n                          id: entry.id,\n                          userId: entry.user_id,\n                          userName: entry.user_name,\n                          description: entry.description,\n                          quantity: entry.quantity || 1,\n                          createdAt: entry.entry_date,\n                          userAddress: entry.user_address,\n                          userMobile: entry.user_mobile\n                        }}\n                      />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      )}\n\n      {filteredEntries.length === 0 && !isLoading && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-lg text-muted-foreground\">No dravya entries found.</p>\n          {(user?.role === 'operator' || user?.role === 'admin') && (\n            <Button onClick={() => setLocation('/dravya-entry-form')} className=\"mt-4\">\n              Add First Dravya Entry\n            </Button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":11323},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4085},"local-deployment/tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;","size_bytes":2786},"client/src/pages/previous-outstanding-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\nimport { UserRole } from \"@shared/schema\";\n\n// Form validation schema\nconst previousOutstandingSchema = z.object({\n  userId: z.number().positive(\"Please select a user\"),\n  userName: z.string().min(1, \"User name is required\"),\n  userMobile: z.string().optional(),\n  userAddress: z.string().optional(),\n  outstandingAmount: z.number().positive(\"Outstanding amount must be positive\"),\n  description: z.string().min(1, \"Description is required\").default(\"31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø\"),\n});\n\ntype FormValues = z.infer<typeof previousOutstandingSchema>;\n\nexport default function PreviousOutstandingForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [attachmentFile, setAttachmentFile] = useState<File | null>(null);\n\n  // Redirect viewers away from this page\n  if (user && user.role === UserRole.VIEWER) {\n    setLocation('/dashboard');\n    return null;\n  }\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: isLoadingUsers } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n\n  // Initialize form\n  const form = useForm<FormValues>({\n    resolver: zodResolver(previousOutstandingSchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      userMobile: \"\",\n      userAddress: \"\",\n      outstandingAmount: 0,\n      description: \"31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø\",\n    }\n  });\n\n  // Watch values for automatic updates\n  const watchUserId = form.watch(\"userId\");\n\n  // Update user details when userId changes\n  const selectedUser = users?.find(user => user.id === watchUserId);\n  useEffect(() => {\n    if (selectedUser) {\n      console.log(\"Selected user:\", selectedUser);\n      form.setValue(\"userName\", selectedUser.name);\n      form.setValue(\"userMobile\", selectedUser.mobile || \"\");\n      form.setValue(\"userAddress\", selectedUser.address || \"\");\n      console.log(\"Form values after user selection:\", form.getValues());\n    } else if (watchUserId === 0) {\n      // Reset user fields when no user is selected\n      form.setValue(\"userName\", \"\");\n      form.setValue(\"userMobile\", \"\");\n      form.setValue(\"userAddress\", \"\");\n    }\n  }, [selectedUser, form, watchUserId]);\n\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: FormValues) => {\n      const formData = new FormData();\n      formData.append('userId', data.userId.toString());\n      formData.append('userName', data.userName);\n      formData.append('userMobile', data.userMobile || '');\n      formData.append('userAddress', data.userAddress || '');\n      formData.append('outstandingAmount', data.outstandingAmount.toString()); // Keep in rupees\n      formData.append('description', data.description);\n      formData.append('createdBy', user?.username || 'system');\n      \n      // Add attachment file if selected\n      if (attachmentFile) {\n        formData.append('attachmentFile', attachmentFile);\n      }\n\n      // Use direct fetch instead of apiRequest for FormData\n      const response = await fetch('/api/previous-outstanding', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create previous outstanding record');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Previous outstanding record created successfully\",\n      });\n      \n      // Invalidate related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/previous-outstanding'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      setLocation('/previous-outstanding');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create record: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const onSubmit = (data: FormValues) => {\n    console.log(\"Form data being submitted:\", data);\n    \n    // Validate required fields on client side\n    if (!data.userId || data.userId === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!data.userName) {\n      toast({\n        title: \"Validation Error\", \n        description: \"User name is required\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!data.outstandingAmount || data.outstandingAmount <= 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Outstanding amount must be greater than 0\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    createMutation.mutate(data);\n  };\n\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and administrators can create previous outstanding records.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/previous-outstanding')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Outstanding Records\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Add Previous Outstanding Record</CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Record previous outstanding amounts for users migrating from old system\n          </p>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              {/* User Selection */}\n              <FormField\n                control={form.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Select User *</FormLabel>\n                    <FormControl>\n                      <UserSelect\n                        value={field.value}\n                        onValueChange={(value) => {\n                          console.log(\"User selected with ID:\", value);\n                          field.onChange(value);\n                        }}\n                        placeholder=\"Search and select user\"\n                        className=\"w-full\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Display selected user info */}\n              {selectedUser && (\n                <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                  <p className=\"text-sm font-medium text-blue-800\">Selected User:</p>\n                  <p className=\"text-sm text-blue-700\">{selectedUser.name}</p>\n                  {selectedUser.mobile && <p className=\"text-xs text-blue-600\">Mobile: {selectedUser.mobile}</p>}\n                  {selectedUser.address && <p className=\"text-xs text-blue-600\">Address: {selectedUser.address}</p>}\n                </div>\n              )}\n\n              {/* Hidden fields for user details */}\n              <input type=\"hidden\" {...form.register(\"userName\")} />\n              <input type=\"hidden\" {...form.register(\"userMobile\")} />\n              <input type=\"hidden\" {...form.register(\"userAddress\")} />\n\n              {/* Outstanding Amount */}\n              <FormField\n                control={form.control}\n                name=\"outstandingAmount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Previous Outstanding Amount (‚Çπ) *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"text\"\n                        placeholder=\"Enter amount in rupees\"\n                        {...field}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/[^0-9]/g, ''); // Only allow digits\n                          field.onChange(parseInt(value) || 0);\n                        }}\n                        value={field.value === 0 ? '' : field.value.toString()}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Description */}\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Attachment Upload */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"attachment\">Upload Attachment (Optional)</Label>\n                <Input\n                  id=\"attachment\"\n                  type=\"file\"\n                  accept=\"image/*,application/pdf\"\n                  onChange={(e) => setAttachmentFile(e.target.files?.[0] || null)}\n                  className=\"cursor-pointer\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Upload proof documents, receipts, or related files (Images or PDF)\n                </p>\n                {attachmentFile && (\n                  <p className=\"text-xs text-green-600\">\n                    Selected: {attachmentFile.name}\n                  </p>\n                )}\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex gap-4 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation('/entries')}\n                  className=\"flex-1\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  className=\"flex-1\"\n                >\n                  {createMutation.isPending ? \"Creating...\" : \"Create Record\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11683},"local-deployment/client/src/components/copyright-footer.tsx":{"content":"import mandirLogo from \"@assets/new logo mandir color_1754807711657.jpg\";\n\nexport default function CopyrightFooter() {\n  return (\n    <footer className=\"bg-white border-t p-3 mt-8\">\n      <div className=\"flex items-center justify-center gap-2 text-xs text-gray-600\">\n        <img \n          src={mandirLogo} \n          alt=\"‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞\" \n          className=\"w-4 h-4 rounded-full\"\n        />\n        <span className=\"text-center\">\n          ¬© ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞\n        </span>\n      </div>\n    </footer>\n  );\n}","size_bytes":755},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/hindi-receipt.tsx":{"content":"import React, { useState, useRef, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Separator } from '@/components/ui/separator';\nimport { Entry, PaymentRecord } from '@shared/schema';\n\ninterface HindiReceiptProps {\n  entry: Entry;\n  payment: PaymentRecord;\n  paymentIndex: number;\n  isOpen: boolean;\n  onClose: () => void;\n  userRole?: string;\n}\n\n// Function to convert numbers to Hindi words\nconst numberToHindiWords = (num: number): string => {\n  const ones = ['', '‡§è‡§ï', '‡§¶‡•ã', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Å‡§ö', '‡§õ‡§π', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];\n  const teens = ['‡§¶‡§∏', '‡§ó‡•ç‡§Ø‡§æ‡§∞‡§π', '‡§¨‡§æ‡§∞‡§π', '‡§§‡•á‡§∞‡§π', '‡§ö‡•å‡§¶‡§π', '‡§™‡§Ç‡§¶‡•ç‡§∞‡§π', '‡§∏‡•ã‡§≤‡§π', '‡§∏‡§§‡•ç‡§∞‡§π', '‡§Ö‡§†‡§æ‡§∞‡§π', '‡§â‡§®‡•ç‡§®‡•Ä‡§∏'];\n  const tens = ['', '', '‡§¨‡•Ä‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†', '‡§∏‡§§‡•ç‡§§‡§∞', '‡§Ö‡§∏‡•ç‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];\n  const hundreds = ['', '‡§è‡§ï ‡§∏‡•å', '‡§¶‡•ã ‡§∏‡•å', '‡§§‡•Ä‡§® ‡§∏‡•å', '‡§ö‡§æ‡§∞ ‡§∏‡•å', '‡§™‡§æ‡§Å‡§ö ‡§∏‡•å', '‡§õ‡§π ‡§∏‡•å', '‡§∏‡§æ‡§§ ‡§∏‡•å', '‡§Ü‡§† ‡§∏‡•å', '‡§®‡•å ‡§∏‡•å'];\n\n  if (num === 0) return '‡§∂‡•Ç‡§®‡•ç‡§Ø';\n  if (num < 10) return ones[num];\n  if (num < 20) return teens[num - 10];\n  if (num < 100) {\n    const tensDigit = Math.floor(num / 10);\n    const onesDigit = num % 10;\n    return tens[tensDigit] + (onesDigit > 0 ? ' ' + ones[onesDigit] : '');\n  }\n  if (num < 1000) {\n    const hundredsDigit = Math.floor(num / 100);\n    const remainder = num % 100;\n    return hundreds[hundredsDigit] + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  if (num < 100000) {\n    const thousands = Math.floor(num / 1000);\n    const remainder = num % 1000;\n    return numberToHindiWords(thousands) + ' ‡§π‡§ú‡§æ‡§∞' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  if (num < 10000000) {\n    const lakhs = Math.floor(num / 100000);\n    const remainder = num % 100000;\n    return numberToHindiWords(lakhs) + ' ‡§≤‡§æ‡§ñ' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  \n  const crores = Math.floor(num / 10000000);\n  const remainder = num % 10000000;\n  return numberToHindiWords(crores) + ' ‡§ï‡§∞‡•ã‡§°‡§º' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n};\n\n// Note: Payment modes are kept in English as requested\n\n// Function to format date in DD/MM/YY format\nconst formatDateDDMMYY = (dateString: string): string => {\n  const date = new Date(dateString);\n  const day = date.getDate().toString().padStart(2, '0');\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const year = date.getFullYear().toString().slice(-2);\n  return `${day}/${month}/${year}`;\n};\n\n// Enhanced Hindi translation function\nconst convertToHindi = (englishText: string): string => {\n  if (!englishText || englishText.trim() === '') return englishText;\n  \n  // If already contains Hindi characters, return as is\n  if (/[\\u0900-\\u097F]/.test(englishText)) {\n    return englishText;\n  }\n\n  // Proper Hindi transliteration using standard rules\n  const properHindiTransliteration = (text: string): string => {\n    // Standard transliteration patterns for common English to Hindi\n    const transliterationMap: { [key: string]: string } = {\n      // Common name patterns\n      'anand': '‡§Ü‡§®‡§Ç‡§¶',\n      'jain': '‡§ú‡•à‡§®',\n      'kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n      'singh': '‡§∏‡§ø‡§Ç‡§π',\n      'sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n      'gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n      'agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n      'choudhary': '‡§ö‡•å‡§ß‡§∞‡•Ä',\n      'chaudhary': '‡§ö‡•å‡§ß‡§∞‡•Ä',\n      'modi': '‡§Æ‡•ã‡§¶‡•Ä',\n      'shah': '‡§∂‡§æ‡§π',\n      'patel': '‡§™‡§ü‡•á‡§≤',\n      'verma': '‡§µ‡§∞‡•ç‡§Æ‡§æ',\n      'yadav': '‡§Ø‡§æ‡§¶‡§µ',\n      'mishra': '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§æ',\n      'tiwari': '‡§§‡§ø‡§µ‡§æ‡§∞‡•Ä',\n      'pandey': '‡§™‡§æ‡§Ç‡§°‡•á',\n      'shukla': '‡§∂‡•Å‡§ï‡•ç‡§≤‡§æ',\n      // Common first names with correct spellings\n      'raj': '‡§∞‡§æ‡§ú',\n      'ravi': '‡§∞‡§µ‡§ø',\n      'amit': '‡§Ö‡§Æ‡§ø‡§§',\n      'rohit': '‡§∞‡•ã‡§π‡§ø‡§§',\n      'rahul': '‡§∞‡§æ‡§π‡•Å‡§≤',\n      'arjun': '‡§Ö‡§∞‡•ç‡§ú‡•Å‡§®',\n      'vikash': '‡§µ‡§ø‡§ï‡§æ‡§∂',\n      'vikas': '‡§µ‡§ø‡§ï‡§æ‡§∏',\n      'akash': '‡§Ü‡§ï‡§æ‡§∂',\n      'aakash': '‡§Ü‡§ï‡§æ‡§∂',\n      'prakash': '‡§™‡•ç‡§∞‡§ï‡§æ‡§∂',\n      'dev': '‡§¶‡•á‡§µ',\n      'devi': '‡§¶‡•á‡§µ‡•Ä',\n      'mata': '‡§Æ‡§æ‡§§‡§æ',\n      'bai': '‡§¨‡§æ‡§à',\n      'ben': '‡§¨‡•á‡§®',\n      'ji': '‡§ú‡•Ä',\n      // Place names\n      'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',\n      'mumbai': '‡§Æ‡•Å‡§Ç‡§¨‡§à',\n      'delhi': '‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä',\n      'kolkata': '‡§ï‡•ã‡§≤‡§ï‡§æ‡§§‡§æ',\n      'chennai': '‡§ö‡•á‡§®‡•ç‡§®‡§à',\n      'bangalore': '‡§¨‡§Ç‡§ó‡§≤‡•Å‡§∞‡•Å',\n      'hyderabad': '‡§π‡•à‡§¶‡§∞‡§æ‡§¨‡§æ‡§¶',\n      'pune': '‡§™‡•Å‡§£‡•á',\n      'ahmedabad': '‡§Ö‡§π‡§Æ‡§¶‡§æ‡§¨‡§æ‡§¶',\n      'surat': '‡§∏‡•Ç‡§∞‡§§',\n      'kanpur': '‡§ï‡§æ‡§®‡§™‡•Å‡§∞',\n      'lucknow': '‡§≤‡§ñ‡§®‡§ä',\n      'nagpur': '‡§®‡§æ‡§ó‡§™‡•Å‡§∞',\n      'indore': '‡§á‡§Ç‡§¶‡•å‡§∞',\n      'bhopal': '‡§≠‡•ã‡§™‡§æ‡§≤',\n      'shivnagar': '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞'\n    };\n\n    const lowerText = text.toLowerCase().trim();\n    \n    // Check for exact matches first\n    if (transliterationMap[lowerText]) {\n      return transliterationMap[lowerText];\n    }\n    \n    // For unknown words, apply basic phonetic conversion for common patterns\n    const basicPhoneticConversion = (word: string): string => {\n      let result = word.toLowerCase();\n      \n      // Basic consonant-vowel patterns\n      const patterns: { [key: string]: string } = {\n        'a': '‡§Ö', 'e': '‡§è', 'i': '‡§á', 'o': '‡§ì', 'u': '‡§â',\n        'ka': '‡§ï‡§æ', 'ki': '‡§ï‡•Ä', 'ku': '‡§ï‡•Å', 'ko': '‡§ï‡•ã',\n        'ga': '‡§ó‡§æ', 'gi': '‡§ó‡•Ä', 'gu': '‡§ó‡•Å', 'go': '‡§ó‡•ã',\n        'ja': '‡§ú‡§æ', 'ji': '‡§ú‡•Ä', 'ju': '‡§ú‡•Å', 'jo': '‡§ú‡•ã',\n        'ta': '‡§§‡§æ', 'ti': '‡§§‡•Ä', 'tu': '‡§§‡•Å', 'to': '‡§§‡•ã',\n        'da': '‡§¶‡§æ', 'di': '‡§¶‡•Ä', 'du': '‡§¶‡•Å', 'do': '‡§¶‡•ã',\n        'na': '‡§®‡§æ', 'ni': '‡§®‡•Ä', 'nu': '‡§®‡•Å', 'no': '‡§®‡•ã',\n        'pa': '‡§™‡§æ', 'pi': '‡§™‡•Ä', 'pu': '‡§™‡•Å', 'po': '‡§™‡•ã',\n        'ba': '‡§¨‡§æ', 'bi': '‡§¨‡•Ä', 'bu': '‡§¨‡•Å', 'bo': '‡§¨‡•ã',\n        'ma': '‡§Æ‡§æ', 'mi': '‡§Æ‡•Ä', 'mu': '‡§Æ‡•Å', 'mo': '‡§Æ‡•ã',\n        'ya': '‡§Ø‡§æ', 'yi': '‡§Ø‡•Ä', 'yu': '‡§Ø‡•Å', 'yo': '‡§Ø‡•ã',\n        'ra': '‡§∞‡§æ', 'ri': '‡§∞‡•Ä', 'ru': '‡§∞‡•Å', 'ro': '‡§∞‡•ã',\n        'la': '‡§≤‡§æ', 'li': '‡§≤‡•Ä', 'lu': '‡§≤‡•Å', 'lo': '‡§≤‡•ã',\n        'va': '‡§µ‡§æ', 'vi': '‡§µ‡•Ä', 'vu': '‡§µ‡•Å', 'vo': '‡§µ‡•ã',\n        'sa': '‡§∏‡§æ', 'si': '‡§∏‡•Ä', 'su': '‡§∏‡•Å', 'so': '‡§∏‡•ã',\n        'ha': '‡§π‡§æ', 'hi': '‡§π‡•Ä', 'hu': '‡§π‡•Å', 'ho': '‡§π‡•ã',\n        'sha': '‡§∂‡§æ', 'shi': '‡§∂‡•Ä', 'shu': '‡§∂‡•Å', 'sho': '‡§∂‡•ã',\n        // Ending patterns\n        'ya$': '‡§Ø‡§æ', 'ia$': '‡§ø‡§Ø‡§æ', 'iya$': '‡§ø‡§Ø‡§æ',\n        // Simple consonants at end\n        'k$': '‡§ï‡•ç', 'g$': '‡§ó‡•ç', 'n$': '‡§®‡•ç', 't$': '‡§§‡•ç', 'd$': '‡§¶‡•ç',\n        'p$': '‡§™‡•ç', 'b$': '‡§¨‡•ç', 'm$': '‡§Æ‡•ç', 'r$': '‡§∞‡•ç', 'l$': '‡§≤‡•ç',\n        'v$': '‡§µ‡•ç', 's$': '‡§∏‡•ç', 'h$': '‡§π‡•ç'\n      };\n      \n      // Try to convert basic patterns\n      for (const [pattern, hindi] of Object.entries(patterns)) {\n        if (pattern.endsWith('$')) {\n          const regex = new RegExp(pattern);\n          result = result.replace(regex, hindi);\n        } else {\n          result = result.replace(new RegExp(pattern, 'g'), hindi);\n        }\n      }\n      \n      // If result still contains English letters, return original\n      if (/[a-zA-Z]/.test(result)) {\n        return text;\n      }\n      \n      return result;\n    };\n    \n    return basicPhoneticConversion(text);\n  };\n  \n  // Comprehensive mapping for names, places, and terms\n  const englishToHindi: { [key: string]: string } = {\n    // Common names - Male\n    'sanskar': '‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shailesh': '‡§∂‡•à‡§≤‡•á‡§∂', \n    'anand': '‡§Ü‡§®‡§Ç‡§¶',\n    'sunil': '‡§∏‡•Å‡§®‡•Ä‡§≤',\n    'manish': '‡§Æ‡§®‡•Ä‡§∑',\n    'prasann': '‡§™‡•ç‡§∞‡§∏‡§®‡•ç‡§®',\n    'rajesh': '‡§∞‡§æ‡§ú‡•á‡§∂',\n    'suresh': '‡§∏‡•Å‡§∞‡•á‡§∂',\n    'ramesh': '‡§∞‡§Æ‡•á‡§∂',\n    'mukesh': '‡§Æ‡•Å‡§ï‡•á‡§∂',\n    'dinesh': '‡§¶‡§ø‡§®‡•á‡§∂',\n    'mahesh': '‡§Æ‡§π‡•á‡§∂',\n    'naresh': '‡§®‡§∞‡•á‡§∂',\n    'rakesh': '‡§∞‡§æ‡§ï‡•á‡§∂',\n    'umesh': '‡§â‡§Æ‡•á‡§∂',\n    'yogesh': '‡§Ø‡•ã‡§ó‡•á‡§∂',\n    'ritesh': '‡§∞‡§ø‡§§‡•á‡§∂',\n    'hitesh': '‡§π‡§ø‡§§‡•á‡§∂',\n    'nilesh': '‡§®‡•Ä‡§≤‡•á‡§∂',\n    'pradip': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'pradeep': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'deepak': '‡§¶‡•Ä‡§™‡§ï',\n    'ashish': '‡§Ü‡§∂‡•Ä‡§∑',\n    'sanjay': '‡§∏‡§Ç‡§ú‡§Ø',\n    'ajay': '‡§Ö‡§ú‡§Ø',\n    'vijay': '‡§µ‡§ø‡§ú‡§Ø',\n    'ravi': '‡§∞‡§µ‡§ø',\n    'aman': '‡§Ö‡§Æ‡§®',\n    'arun': '‡§Ö‡§∞‡•Å‡§£',\n    'raj': '‡§∞‡§æ‡§ú',\n    'amit': '‡§Ö‡§Æ‡§ø‡§§',\n    'rohit': '‡§∞‡•ã‡§π‡§ø‡§§',\n    'rahul': '‡§∞‡§æ‡§π‡•Å‡§≤',\n    'arjun': '‡§Ö‡§∞‡•ç‡§ú‡•Å‡§®',\n    'vikas': '‡§µ‡§ø‡§ï‡§æ‡§∏',\n    'vikash': '‡§µ‡§ø‡§ï‡§æ‡§∂',\n    'akash': '‡§Ü‡§ï‡§æ‡§∂',\n    'prakash': '‡§™‡•ç‡§∞‡§ï‡§æ‡§∂',\n    'dev': '‡§¶‡•á‡§µ',\n    'manoj': '‡§Æ‡§®‡•ã‡§ú',\n    'anil': '‡§Ö‡§®‡§ø‡§≤',\n    'kapil': '‡§ï‡§™‡§ø‡§≤',\n    'kunal': '‡§ï‡•Å‡§£‡§æ‡§≤',\n    'vishal': '‡§µ‡§ø‡§∂‡§æ‡§≤',\n    'shubham': '‡§∂‡•Å‡§≠‡§Æ',\n    'sachin': '‡§∏‡§ö‡§ø‡§®',\n    'gaurav': '‡§ó‡•å‡§∞‡§µ',\n    'harsh': '‡§π‡§∞‡•ç‡§∑',\n    'karan': '‡§ï‡§∞‡§£',\n    'varun': '‡§µ‡§∞‡•Å‡§£',\n    'tarun': '‡§§‡§∞‡•Å‡§£',\n    'pawan': '‡§™‡§µ‡§®',\n    'mohan': '‡§Æ‡•ã‡§π‡§®',\n    'sohan': '‡§∏‡•ã‡§π‡§®',\n    'rohan': '‡§∞‡•ã‡§π‡§®',\n    'nitin': '‡§®‡§ø‡§§‡§ø‡§®',\n    'lalit': '‡§≤‡§≤‡§ø‡§§',\n    'sumit': '‡§∏‡•Å‡§Æ‡§ø‡§§',\n    'hemant': '‡§π‡•á‡§Æ‡§Ç‡§§',\n    'pankaj': '‡§™‡§Ç‡§ï‡§ú',\n    'neeraj': '‡§®‡•Ä‡§∞‡§ú',\n    'dheeraj': '‡§ß‡•Ä‡§∞‡§ú',\n    'dileep': '‡§¶‡§ø‡§≤‡•Ä‡§™',\n    'dilip': '‡§¶‡§ø‡§≤‡•Ä‡§™',\n    'sandheliya': '‡§∏‡§Ç‡§ß‡•á‡§≤‡§ø‡§Ø‡§æ',\n    'sandhilya': '‡§∏‡§Ç‡§ß‡§ø‡§≤‡•ç‡§Ø‡§æ',\n    // Common names - Female\n    'aashi': '‡§Ü‡§∂‡•Ä',\n    'deepika': '‡§¶‡•Ä‡§™‡§ø‡§ï‡§æ',\n    'priya': '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ',\n    'pooja': '‡§™‡•Ç‡§ú‡§æ',\n    'anita': '‡§Ö‡§®‡•Ä‡§§‡§æ',\n    'sunita': '‡§∏‡•Å‡§®‡•Ä‡§§‡§æ',\n    'rekha': '‡§∞‡•á‡§ñ‡§æ',\n    'meera': '‡§Æ‡•Ä‡§∞‡§æ',\n    'seeta': '‡§∏‡•Ä‡§§‡§æ',\n    'geeta': '‡§ó‡•Ä‡§§‡§æ',\n    'rita': '‡§∞‡•Ä‡§§‡§æ',\n    'kavita': '‡§ï‡§µ‡§ø‡§§‡§æ',\n    'savita': '‡§∏‡§µ‡§ø‡§§‡§æ',\n    'mamta': '‡§Æ‡§Æ‡§§‡§æ',\n    'sushma': '‡§∏‡•Å‡§∑‡•ç‡§Æ‡§æ',\n    'krishna': '‡§ï‡•É‡§∑‡•ç‡§£‡§æ',\n    'radha': '‡§∞‡§æ‡§ß‡§æ',\n    'shanti': '‡§∂‡§æ‡§Ç‡§§‡§ø',\n    'bharti': '‡§≠‡§æ‡§∞‡§§‡•Ä',\n    'kiran': '‡§ï‡§ø‡§∞‡§£',\n    'devi': '‡§¶‡•á‡§µ‡•Ä',\n    'mata': '‡§Æ‡§æ‡§§‡§æ',\n    'bai': '‡§¨‡§æ‡§à',\n    'ben': '‡§¨‡•á‡§®',\n    'asha': '‡§Ü‡§∂‡§æ',\n    'usha': '‡§â‡§∑‡§æ',\n    'nisha': '‡§®‡§ø‡§∂‡§æ',\n    'ritu': '‡§∞‡§ø‡§§‡•Å',\n    'mitu': '‡§Æ‡§ø‡§§‡•Å',\n    'sita': '‡§∏‡•Ä‡§§‡§æ',\n    'gita': '‡§ó‡•Ä‡§§‡§æ',\n    'lata': '‡§≤‡§§‡§æ',\n    'maya': '‡§Æ‡§æ‡§Ø‡§æ',\n    'jaya': '‡§ú‡§Ø‡§æ',\n    'vijaya': '‡§µ‡§ø‡§ú‡§Ø‡§æ',\n    'sujata': '‡§∏‡•Å‡§ú‡§æ‡§§‡§æ',\n    'sangita': '‡§∏‡§Ç‡§ó‡•Ä‡§§‡§æ',\n    'sarita': '‡§∏‡§∞‡§ø‡§§‡§æ',\n    'namita': '‡§®‡§Æ‡§ø‡§§‡§æ',\n    'lalita': '‡§≤‡§≤‡§ø‡§§‡§æ',\n    'malti': '‡§Æ‡§æ‡§≤‡§§‡•Ä',\n    'shilpa': '‡§∂‡§ø‡§≤‡•ç‡§™‡§æ',\n    'rashmi': '‡§∞‡§∂‡•ç‡§Æ‡§ø',\n    'swati': '‡§∏‡•ç‡§µ‡§æ‡§§‡•Ä',\n    'shruti': '‡§∂‡•ç‡§∞‡•Å‡§§‡§ø',\n    'sneha': '‡§∏‡•ç‡§®‡•á‡§π‡§æ',\n    'neha': '‡§®‡•á‡§π‡§æ',\n    'reha': '‡§∞‡•á‡§π‡§æ',\n    'komal': '‡§ï‡•ã‡§Æ‡§≤',\n    'payal': '‡§™‡§æ‡§Ø‡§≤',\n    'simran': '‡§∏‡§ø‡§Æ‡§∞‡§®',\n    'gunjan': '‡§ó‡•Å‡§Ç‡§ú‡§®',\n    'shweta': '‡§∂‡•ç‡§µ‡•á‡§§‡§æ',\n    // Surnames/Last names\n    'jain': '‡§ú‡•à‡§®',\n    'choudhary': '‡§ö‡•å‡§ß‡§∞‡•Ä',\n    'chaudhary': '‡§ö‡•å‡§ß‡§∞‡•Ä',\n    'kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n    'singh': '‡§∏‡§ø‡§Ç‡§π',\n    'sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n    'gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n    'agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'aggarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'modi': '‡§Æ‡•ã‡§¶‡•Ä',\n    'shah': '‡§∂‡§æ‡§π',\n    'patel': '‡§™‡§ü‡•á‡§≤',\n    'verma': '‡§µ‡§∞‡•ç‡§Æ‡§æ',\n    'yadav': '‡§Ø‡§æ‡§¶‡§µ',\n    'mishra': '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§æ',\n    'tiwari': '‡§§‡§ø‡§µ‡§æ‡§∞‡•Ä',\n    'pandey': '‡§™‡§æ‡§Ç‡§°‡•á',\n    'shukla': '‡§∂‡•Å‡§ï‡•ç‡§≤‡§æ',\n    'dubey': '‡§¶‡•Å‡§¨‡•á',\n    'tripathi': '‡§§‡•ç‡§∞‡§ø‡§™‡§æ‡§†‡•Ä',\n    'srivastava': '‡§∂‡•ç‡§∞‡•Ä‡§µ‡§æ‡§∏‡•ç‡§§‡§µ',\n    'rastogi': '‡§∞‡§∏‡•ç‡§§‡•ã‡§ó‡•Ä',\n    'saxena': '‡§∏‡§ï‡•ç‡§∏‡•á‡§®‡§æ',\n    'malhotra': '‡§Æ‡§≤‡•ç‡§π‡•ã‡§§‡•ç‡§∞‡§æ',\n    'chopra': '‡§ö‡•ã‡§™‡§°‡§º‡§æ',\n    'kapoor': '‡§ï‡§™‡•Ç‡§∞',\n    'mehra': '‡§Æ‡•á‡§π‡§∞‡§æ',\n    'sethi': '‡§∏‡•á‡§†‡•Ä',\n    'bansal': '‡§¨‡§Ç‡§∏‡§≤',\n    'goel': '‡§ó‡•ã‡§Ø‡§≤',\n    'goyal': '‡§ó‡•ã‡§Ø‡§≤',\n    'mittal': '‡§Æ‡§ø‡§§‡•ç‡§§‡§≤',\n    'jindal': '‡§ú‡§ø‡§Ç‡§¶‡§≤',\n    'singhal': '‡§∏‡§ø‡§Ç‡§ò‡§≤',\n    'agrawal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'maheshwari': '‡§Æ‡§æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞‡•Ä',\n    'porwal': '‡§™‡•ã‡§∞‡§µ‡§æ‡§≤',\n    'khandelwal': '‡§ñ‡§Ç‡§°‡•á‡§≤‡§µ‡§æ‡§≤',\n    'oswaal': '‡§ì‡§∏‡§µ‡§æ‡§≤',\n    'oswal': '‡§ì‡§∏‡§µ‡§æ‡§≤',\n    'pareek': '‡§™‡§æ‡§∞‡•Ä‡§ï',\n    'kothari': '‡§ï‡•ã‡§†‡§æ‡§∞‡•Ä',\n    'bhansali': '‡§≠‡§Ç‡§∏‡§æ‡§≤‡•Ä',\n    'somani': '‡§∏‡•ã‡§Æ‡§æ‡§®‡•Ä',\n    'bohra': '‡§¨‡•ã‡§π‡§∞‡§æ',\n    'daga': '‡§°‡§æ‡§ó‡§æ',\n    'saraf': '‡§∏‡§∞‡§æ‡§´',\n    'bafna': '‡§¨‡§æ‡§´‡§®‡§æ',\n    'bothra': '‡§¨‡•ã‡§•‡§∞‡§æ',\n    'chordia': '‡§ö‡•ã‡§∞‡§°‡§ø‡§Ø‡§æ',\n    'sanghvi': '‡§∏‡§Ç‡§ò‡§µ‡•Ä',\n    'mehta': '‡§Æ‡•á‡§π‡§§‡§æ',\n    'doshi': '‡§¶‡•ã‡§∂‡•Ä',\n    'thakkar': '‡§†‡§ï‡•ç‡§ï‡§∞',\n    'vaishnav': '‡§µ‡•à‡§∑‡•ç‡§£‡§µ',\n    'bhandari': '‡§≠‡§Ç‡§°‡§æ‡§∞‡•Ä',\n    'mundra': '‡§Æ‡•Å‡§Ç‡§¶‡•ç‡§∞‡§æ',\n    'lohia': '‡§≤‡•ã‡§π‡§ø‡§Ø‡§æ',\n    'garg': '‡§ó‡§∞‡•ç‡§ó',\n    'tayal': '‡§§‡§Ø‡§æ‡§≤',\n    'bhargava': '‡§≠‡§æ‡§∞‡•ç‡§ó‡§µ',\n    'mathur': '‡§Æ‡§æ‡§•‡•Å‡§∞',\n    'tandon': '‡§ü‡§Ç‡§°‡§®',\n    'khanna': '‡§ñ‡§®‡•ç‡§®‡§æ',\n    'arora': '‡§Ö‡§∞‡•ã‡§°‡§º‡§æ',\n    'sood': '‡§∏‡•Ç‡§¶',\n    'bhatia': '‡§≠‡§æ‡§ü‡§ø‡§Ø‡§æ',\n    'bajaj': '‡§¨‡§ú‡§æ‡§ú',\n    'dhawan': '‡§ß‡§µ‡§®',\n    'nair': '‡§®‡§æ‡§Ø‡§∞',\n    'menon': '‡§Æ‡•á‡§®‡§®',\n    'iyer': '‡§Ö‡§Ø‡•ç‡§Ø‡§∞',\n    'reddy': '‡§∞‡•á‡§°‡•ç‡§°‡•Ä',\n    'rao': '‡§∞‡§æ‡§µ',\n    'das': '‡§¶‡§æ‡§∏',\n    'sen': '‡§∏‡•á‡§®',\n    'bose': '‡§¨‡•ã‡§∏',\n    'ghosh': '‡§ò‡•ã‡§∑',\n    'mukherji': '‡§Æ‡•Å‡§ñ‡§∞‡•ç‡§ú‡•Ä',\n    'mukherjee': '‡§Æ‡•Å‡§ñ‡§∞‡•ç‡§ú‡•Ä',\n    'chatterjee': '‡§ö‡§ü‡§∞‡•ç‡§ú‡•Ä',\n    'banerjee': '‡§¨‡§®‡§∞‡•ç‡§ú‡•Ä',\n    'bhattacharya': '‡§≠‡§ü‡•ç‡§ü‡§æ‡§ö‡§æ‡§∞‡•ç‡§Ø',\n    // Common titles and honorifics  \n    'ji': '‡§ú‡•Ä',\n    'saheb': '‡§∏‡§æ‡§π‡§¨',\n    'sahib': '‡§∏‡§æ‡§π‡§ø‡§¨',\n    'bhai': '‡§≠‡§æ‡§à',\n    'sister': '‡§¨‡§π‡§®',\n    'uncle': '‡§Ö‡§Ç‡§ï‡§≤',\n    'aunty': '‡§Ü‡§Ç‡§ü‡•Ä',\n    'dada': '‡§¶‡§æ‡§¶‡§æ',\n    'dadi': '‡§¶‡§æ‡§¶‡•Ä',\n    'nana': '‡§®‡§æ‡§®‡§æ',\n    'nani': '‡§®‡§æ‡§®‡•Ä',\n    // System terms\n    'system': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ',\n    'admin': '‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï',\n    'operator': '‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ï',\n    'sanad': '‡§∏‡§®‡§¶',\n    // Places\n    'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',\n    'shivnagar': '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞',\n    'damoh': '‡§¶‡§Æ‡•ã‡§π',\n    'road': '‡§∞‡•ã‡§°',\n    'mp': '‡§Æ.‡§™‡•ç‡§∞.',\n    'madhya': '‡§Æ‡§ß‡•ç‡§Ø',\n    'pradesh': '‡§™‡•ç‡§∞‡§¶‡•á‡§∂',\n    'colony': '‡§ï‡•â‡§≤‡•ã‡§®‡•Ä',\n    'nagar': '‡§®‡§ó‡§∞',\n    'gali': '‡§ó‡§≤‡•Ä',\n    'mohalla': '‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ',\n    'ward': '‡§µ‡§æ‡§∞‡•ç‡§°',\n    'near': '‡§ï‡•á ‡§™‡§æ‡§∏',\n    'behind': '‡§ï‡•á ‡§™‡•Ä‡§õ‡•á',\n    'front': '‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á',\n    'street': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü',\n    'sector': '‡§∏‡•á‡§ï‡•ç‡§ü‡§∞',\n    'block': '‡§¨‡•ç‡§≤‡•â‡§ï',\n    'house': '‡§Æ‡§ï‡§æ‡§®',\n    'no': '‡§®‡§Ç',\n    'number': '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',\n    'plot': '‡§™‡•ç‡§≤‡•â‡§ü',\n    'area': '‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',\n    'circle': '‡§∏‡§∞‡•ç‡§ï‡§≤',\n    'phase': '‡§´‡•á‡§ú',\n    'extension': '‡§è‡§ï‡•ç‡§∏‡§ü‡•á‡§Ç‡§∂‡§®',\n    'main': '‡§Æ‡•Å‡§ñ‡•ç‡§Ø',\n    'chowk': '‡§ö‡•å‡§ï',\n    'park': '‡§™‡§æ‡§∞‡•ç‡§ï',\n    'market': '‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü',\n    'complex': '‡§ï‡•â‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ï‡•ç‡§∏',\n    'apartment': '‡§Ö‡§™‡§æ‡§∞‡•ç‡§ü‡§Æ‡•á‡§Ç‡§ü',\n    'society': '‡§∏‡•ã‡§∏‡§æ‡§á‡§ü‡•Ä',\n    'layout': '‡§≤‡•á‡§Ü‡§â‡§ü',\n    'township': '‡§ü‡§æ‡§â‡§®‡§∂‡§ø‡§™',\n    'residency': '‡§∞‡•á‡§∏‡§ø‡§°‡•á‡§Ç‡§∏‡•Ä',\n    'enclave': '‡§è‡§®‡•ç‡§ï‡•ç‡§≤‡•á‡§µ',\n    'heights': '‡§π‡§æ‡§á‡§ü‡•ç‡§∏',\n    'gardens': '‡§ó‡§æ‡§∞‡•ç‡§°‡§®‡•ç‡§∏',\n    'vihar': '‡§µ‡§ø‡§π‡§æ‡§∞',\n    'puram': '‡§™‡•Å‡§∞‡§Æ',\n    'nagri': '‡§®‡§ó‡§∞‡•Ä',\n    'marg': '‡§Æ‡§æ‡§∞‡•ç‡§ó',\n    'path': '‡§™‡§•',\n    'lane': '‡§≤‡•á‡§®',\n    // Common words\n    'shantidhara': '‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ',\n    'puja': '‡§™‡•Ç‡§ú‡§æ',\n    'donation': '‡§¶‡§æ‡§®',\n    'temple': '‡§Æ‡§Ç‡§¶‡§ø‡§∞',\n    'festival': '‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞',\n    'ceremony': '‡§∏‡§Æ‡§æ‡§∞‡•ã‡§π',\n    'abhishek': '‡§Ö‡§≠‡§ø‡§∑‡•á‡§ï',\n    'aarti': '‡§Ü‡§∞‡§§‡•Ä',\n    'prasad': '‡§™‡•ç‡§∞‡§∏‡§æ‡§¶',\n    'darshan': '‡§¶‡§∞‡•ç‡§∂‡§®',\n    'birthday': '‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®',\n    'anniversary': '‡§µ‡§∞‡•ç‡§∑‡§ó‡§æ‡§Ç‡§†',\n    'marriage': '‡§µ‡§ø‡§µ‡§æ‡§π',\n    'navratri': '‡§®‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø',\n    'diwali': '‡§¶‡§ø‡§µ‡§æ‡§≤‡•Ä',\n    'holi': '‡§π‡•ã‡§≤‡•Ä',\n    'mahavir': '‡§Æ‡§π‡§æ‡§µ‡•Ä‡§∞',\n    'jayanti': '‡§ú‡§Ø‡§Ç‡§§‡•Ä',\n    'paryushan': '‡§™‡§∞‡•ç‡§Ø‡•Å‡§∑‡§£',\n    'special': '‡§µ‡§ø‡§∂‡•á‡§∑',\n    'occasion': '‡§Ö‡§µ‡§∏‡§∞',\n    'general': '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø',\n    'regular': '‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§',\n    'monthly': '‡§Æ‡§æ‡§∏‡§ø‡§ï',\n    // Key boli description translations\n    'shanti dhara sanskar': '‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ß‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shantidhara sanskar': '‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shanti dhara': '‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ß‡§æ‡§∞‡§æ',\n    'dhara': '‡§ß‡§æ‡§∞‡§æ',\n    'food': '‡§≠‡•ã‡§ú‡§®',\n    'decoration': '‡§∏‡§ú‡§æ‡§µ‡§ü',\n    'flowers': '‡§´‡•Ç‡§≤',\n    'offering': '‡§Ö‡§∞‡•ç‡§™‡§£',\n    'daily': '‡§¶‡•à‡§®‡§ø‡§ï',\n    // Common address patterns\n    'p-207': '‡§™‡•Ä-207',\n    'shiv': '‡§∂‡§ø‡§µ'\n  };\n\n  // Convert the entire text as a phrase first, then word by word\n  const lowerText = englishText.toLowerCase();\n  \n  // Check for complete phrase matches first\n  for (const [eng, hindi] of Object.entries(englishToHindi)) {\n    if (lowerText === eng) {\n      return hindi;\n    }\n  }\n  \n  // Split the text into words and convert each word\n  const words = englishText.toLowerCase().split(' ');\n  const hindiWords = words.map(word => {\n    // Remove extra characters and check if word exists in mapping\n    const cleanWord = word.replace(/[^a-zA-Z]/g, '');\n    if (englishToHindi[cleanWord]) {\n      return englishToHindi[cleanWord];\n    }\n    \n    // If no direct mapping found, use proper Hindi transliteration\n    return properHindiTransliteration(cleanWord);\n  });\n\n  return hindiWords.join(' ');\n};\n\n// Function to get payment mode in Hindi\nconst getPaymentModeHindi = (mode: string): string => {\n  const modeMap: { [key: string]: string } = {\n    'cash': '‡§®‡§ó‡§¶',\n    'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à',\n    'cheque': '‡§ö‡•á‡§ï',\n    'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó',\n    'online': '‡§ë‡§®‡§≤‡§æ‡§á‡§®',\n    'card': '‡§ï‡§æ‡§∞‡•ç‡§°',\n    'bank_transfer': '‡§¨‡•à‡§Ç‡§ï ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§£',\n    'advance_payment': '‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®'\n  };\n  return modeMap[mode.toLowerCase()] || convertToHindi(mode);\n};\n\n// Local storage key for saved values\nconst SAVED_VALUES_KEY = 'hindi_receipt_saved_values';\n\n// Interface for saved values\ninterface SavedValues {\n  referredBy: string;\n  bediNumber: string;\n  customBediOptions: string[];\n}\n\nexport const HindiReceipt: React.FC<HindiReceiptProps> = ({\n  entry,\n  payment,\n  paymentIndex,\n  isOpen,\n  onClose,\n  userRole\n}) => {\n  const printRef = useRef<HTMLDivElement>(null);\n  \n  // Saved values state\n  const [savedValues, setSavedValues] = useState<SavedValues>({\n    referredBy: '',\n    bediNumber: '1',\n    customBediOptions: []\n  });\n  \n  // Only keep referredBy as editable field for receipt notes\n  const [referredBy, setReferredBy] = useState('');\n  \n  // Editable fields for receipt\n  const [editableFields, setEditableFields] = useState({\n    referredBy: '',\n    otherDetails: ''\n  });\n  \n  // Combined bedi options (default + custom) - kept for legacy data\n  const allBediOptions = ['1', '2', '3', ...savedValues.customBediOptions];\n\n  // Load saved values on component mount\n  useEffect(() => {\n    const stored = localStorage.getItem(SAVED_VALUES_KEY);\n    if (stored) {\n      const parsedValues = JSON.parse(stored);\n      // Handle backward compatibility - add customBediOptions if missing\n      // Filter out any unwanted default values that might have been saved as custom\n      const cleanCustomOptions = (parsedValues.customBediOptions || []).filter(\n        (option: string) => !['1', '2', '3', 'Pandal', '9'].includes(option)\n      );\n      \n      const fullSavedValues = {\n        referredBy: parsedValues.referredBy || '',\n        bediNumber: parsedValues.bediNumber || '1',\n        customBediOptions: cleanCustomOptions\n      };\n      setSavedValues(fullSavedValues);\n      \n      // Save the cleaned values back to localStorage\n      localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(fullSavedValues));\n      \n      // Auto-fill with saved referredBy value\n      setReferredBy(fullSavedValues.referredBy);\n    }\n  }, [isOpen]);\n\n  // Function removed as fields are no longer editable\n\n  // Function to add custom bedi option permanently\n  const addCustomBediOption = (newOption: string) => {\n    const trimmedOption = newOption.trim();\n    if (trimmedOption && !allBediOptions.includes(trimmedOption)) {\n      const updatedCustomOptions = [...savedValues.customBediOptions, trimmedOption];\n      const updatedSavedValues = {\n        ...savedValues,\n        customBediOptions: updatedCustomOptions,\n        bediNumber: trimmedOption\n      };\n      \n      localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(updatedSavedValues));\n      setSavedValues(updatedSavedValues);\n      \n      // Note: Custom bedi options are no longer editable in receipt\n    }\n  };\n\n  // Save editable values function\n  const handleSaveValues = () => {\n    const valuesToSave: SavedValues = {\n      referredBy: referredBy,\n      bediNumber: entry.bediNumber || '1',\n      customBediOptions: savedValues.customBediOptions\n    };\n    \n    localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(valuesToSave));\n    setSavedValues(valuesToSave);\n    alert('Values saved successfully!');\n  };\n\n  const handlePrint = () => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      const currentDate = new Date().toLocaleDateString('hi-IN');\n      const amountInWords = numberToHindiWords(amountInRupees);\n      const paymentModeHindi = getPaymentModeHindi(payment.mode);\n      \n      // Add ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä prefix to user name and convert to Hindi\n      const hindiUserName = convertToHindi(entry.userName);\n      const formattedUserName = hindiUserName.startsWith('‡§∂‡•ç‡§∞‡•Ä') || hindiUserName.startsWith('‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä') || hindiUserName.startsWith('‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä')\n        ? hindiUserName \n        : `‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä   ${hindiUserName}`;\n      \n      // Convert all text fields to Hindi\n      const hindiDescription = convertToHindi(entry.description);\n      const hindiOccasion = convertToHindi(entry.occasion);\n      const hindiAddress = convertToHindi(entry.userAddress || '');\n      \n      // Add cache breaker for images\n      const cacheBreaker = Date.now();\n      \n      const html = `\n        <!DOCTYPE html>\n        <html lang=\"hi\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <title>‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${payment.receiptNo}</title>\n            <style>\n              @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n              \n              body {\n                font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n                margin: 0;\n                padding: 20px;\n                background: white;\n                color: #000;\n                font-size: 14px;\n                line-height: 1.6;\n              }\n              \n              .receipt-container {\n                width: 210mm;\n                height: 148mm;\n                margin: 0 auto;\n                border: 2px solid #000;\n                padding: 0;\n                display: flex;\n                flex-direction: column;\n                box-sizing: border-box;\n              }\n              \n              .receipt-header {\n                text-align: center;\n                padding: 12px;\n                background: #f8f9fa;\n                position: relative;\n                min-height: 70px;\n              }\n              \n              .temple-name {\n                font-size: 22px;\n                font-weight: 700;\n                margin-bottom: 3px;\n                color: #d97706;\n                line-height: 1.1;\n              }\n              \n              .temple-subtitle {\n                font-size: 13px;\n                margin-bottom: 1px;\n                color: #666;\n              }\n              \n              .receipt-title {\n                font-size: 19px;\n                font-weight: 600;\n                margin-top: 4px;\n                color: #000;\n              }\n              \n              .receipt-body {\n                padding: 12px;\n                padding-top: 25px;\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n                font-size: 16px;\n              }\n              \n              .receipt-section {\n                margin-bottom: 1px;\n              }\n              \n              .section-title {\n                font-size: 18px;\n                font-weight: 600;\n                margin-bottom: 10px;\n                color: #374151;\n                border-bottom: 1px solid #e5e7eb;\n                padding-bottom: 5px;\n              }\n              \n              .receipt-row {\n                display: flex;\n                justify-content: flex-start;\n                align-items: center;\n                margin-bottom: 1px;\n                padding: 0;\n                width: 100%;\n                position: relative;\n              }\n              \n              .receipt-label {\n                font-weight: 600;\n                color: #374151;\n                font-size: 16px;\n              }\n              \n              .receipt-value {\n                color: #000;\n                margin-left: 3px;\n                font-size: 16px;\n              }\n              \n              .left-item {\n                display: flex;\n                align-items: center;\n                flex: 0 0 360px; /* Fixed width to prevent wrapping */\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n              }\n              \n              .right-item {\n                display: flex;\n                align-items: center;\n                flex: 0 0 auto;\n                justify-content: flex-start;\n                position: absolute;\n                left: 500px; /* Align with first letter '‡§∏' of '‡§∏‡§Æ‡§ø‡§§‡§ø' */\n                white-space: nowrap;\n              }\n              \n              .amount-section {\n                background: #fef3c7;\n                padding: 6px;\n                border: 1px solid #f59e0b;\n                margin: 6px 0;\n                border-radius: 3px;\n              }\n              \n              .amount-large {\n                font-size: 24px;\n                font-weight: 700;\n                color: #d97706;\n              }\n              \n              .amount-words {\n                font-size: 15px;\n                font-style: italic;\n                margin-top: 2px;\n                color: #92400e;\n              }\n              \n              .signature-section {\n                display: flex;\n                justify-content: space-between;\n                margin-top: 20px;\n                padding-top: 10px;\n                border-top: 1px solid #e5e7eb;\n              }\n              \n              .signature-box {\n                text-align: center;\n                flex: 1;\n                margin: 0 5px;\n              }\n              \n              .signature-line {\n                border-top: 1px solid #000;\n                margin-top: 45px;\n                padding-top: 2px;\n                font-size: 14px;\n                color: #666;\n              }\n              \n              .footer-notes {\n                margin-top: 12px;\n                padding: 8px;\n                background: #f9fafb;\n                border-radius: 3px;\n                text-align: center;\n                font-size: 11px;\n                color: #6b7280;\n              }\n              \n              .user-address {\n                font-size: 14px;\n                color: #6b7280;\n                margin-top: 5px;\n              }\n              \n              .two-column {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                gap: 20px;\n              }\n              \n              .left-column {\n                flex: 1;\n                min-width: 0;\n              }\n              \n              .right-column {\n                flex: 1;\n                text-align: right;\n                min-width: 0;\n              }\n              \n              .single-line {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n              }\n              \n              @media print {\n                body { \n                  margin: 0; \n                  padding: 5px; \n                }\n                .receipt-container {\n                  border: 1px solid #000;\n                  page-break-inside: avoid;\n                  box-shadow: none;\n                }\n                @page {\n                  size: A5 landscape;\n                  margin: 10mm;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"receipt-container\">\n              <!-- Header -->\n              <div class=\"receipt-header\" style=\"position: relative;\">\n                <!-- Left Logo - Jain Stambh (reduced by 10%: 74px - 10% = 67px) -->\n                <div style=\"position: absolute; left: 50px; top: 8px;\">\n                  <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" \n                       alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" style=\"width: 67px; height: 100px; object-fit: contain;\">\n                </div>\n                \n                <!-- Right Logo - New Mandir Color (reduced by 10% from 104px to 94px) -->\n                <div style=\"position: absolute; right: 50px; top: 8px;\">\n                  <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" \n                       alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" style=\"width: 94px; height: 94px; object-fit: contain; border-radius: 50%;\">\n                </div>\n                \n                <!-- Center Text -->\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <!-- Body -->\n              <div class=\"receipt-body\">\n                <!-- Row 1: Receipt Number and Date -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${payment.receiptNo}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${formatDateDDMMYY(payment.date)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 2: User Name and Boli Date -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä:</span>\n                      <span class=\"receipt-value\">${formattedUserName}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${formatDateDDMMYY(entry.auctionDate)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 3: Address and Payment Method -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§™‡§§‡§æ:</span>\n                      <span class=\"receipt-value\">${hindiAddress ? `${hindiAddress}, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)` : '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)'}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø:</span>\n                      <span class=\"receipt-value\">${paymentModeHindi}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 4: Description and Bedi Number -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§¨‡§æ‡§¨‡§§:</span>\n                      <span class=\"receipt-value\">${hindiDescription}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${entry.bediNumber || '1'}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 5: Occasion -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞:</span>\n                      <span class=\"receipt-value\">${hindiOccasion}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <!-- Empty right item for spacing -->\n                    </div>\n                  </div>\n                </div>\n                \n                ${editableFields.referredBy || editableFields.otherDetails ? `\n                <!-- Row 6: Editable Fields -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§:</span>\n                      <span class=\"receipt-value\">${convertToHindi(editableFields.referredBy)}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§Ö‡§®‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£:</span>\n                      <span class=\"receipt-value\">${convertToHindi(editableFields.otherDetails)}</span>\n                    </div>\n                  </div>\n                </div>` : ''}\n                \n                <!-- Amount Section -->\n                <div class=\"amount-section\">\n                  <div class=\"receipt-row\">\n                    <span class=\"receipt-label\">‡§∞‡§æ‡§∂‡§ø (‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç):</span>\n                    <span class=\"receipt-value amount-large\">‚Çπ${amountInRupees.toLocaleString('hi-IN')}</span>\n                  </div>\n                  <div class=\"amount-words\">\n                    ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç: ${amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                  </div>\n                </div>\n                \n                <!-- Signature Section -->\n                <div class=\"signature-section\">\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ï‡§∞‡•ç‡§§‡§æ</div>\n                  </div>\n                </div>\n                \n                <!-- Footer -->\n                <div class=\"footer-notes\">\n                  <div>‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</div>\n                </div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;\n      \n      printWindow.document.write(html);\n      printWindow.document.close();\n      printWindow.focus();\n      \n      // Show print preview instead of immediate print\n      // User can then manually click print from the preview page\n      setTimeout(() => {\n        printWindow.print();\n      }, 1000);\n    }\n  };\n\n  const handleSaveAndPrint = () => {\n    // Simply print the receipt with the data from entry\n    handlePrint();\n  };\n\n  const amountInRupees = payment.amount; // Amount is already in rupees\n  const amountInWords = numberToHindiWords(amountInRupees);\n  const currentDate = formatDateDDMMYY(new Date().toISOString());\n  const boliDate = formatDateDDMMYY(entry.auctionDate);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-auto\">\n        <DialogHeader>\n          <DialogTitle>‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - Edit & Print</DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          {/* Save Values Section */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-lg font-semibold\">Save Common Values</h3>\n                <Button onClick={handleSaveValues} variant=\"outline\" size=\"sm\">\n                  Save Values\n                </Button>\n              </div>\n              <div className=\"text-sm text-gray-600 mb-2\">\n                Save common values (‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§) for auto-fill in future receipts\n              </div>\n              {savedValues.referredBy && (\n                <div className=\"text-sm text-green-600\">\n                  ‚úì Saved values: ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§: {savedValues.referredBy}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Separator />\n\n          {/* Editable Fields Section */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <h3 className=\"text-lg font-semibold mb-4\">Receipt Fields (Editable)</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {/* ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ (Referred By) */}\n                <div>\n                  <Label htmlFor=\"referredBy\">‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§</Label>\n                  <Input\n                    id=\"referredBy\"\n                    value={editableFields.referredBy}\n                    onChange={(e) => setEditableFields(prev => ({ ...prev, referredBy: e.target.value }))}\n                    placeholder=\"‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø ‡§ï‡§æ ‡§®‡§æ‡§Æ\"\n                  />\n                </div>\n\n                {/* ‡§Ö‡§®‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ (Other Details) */}\n                <div>\n                  <Label htmlFor=\"otherDetails\">‡§Ö‡§®‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£</Label>\n                  <Input\n                    id=\"otherDetails\"\n                    value={editableFields.otherDetails}\n                    onChange={(e) => setEditableFields(prev => ({ ...prev, otherDetails: e.target.value }))}\n                    placeholder=\"‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Receipt Information - Non-editable */}\n          <div className=\"p-4 bg-gray-50 border border-gray-200 rounded text-center\">\n            <p className=\"text-gray-700\">\n              üìÑ ‡§¨‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (‡§¨‡§æ‡§µ‡§§, ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞, ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï) ‡§Æ‡•Ç‡§≤ ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á ‡§≤‡•Ä ‡§ó‡§à ‡§π‡•à\n            </p>\n            <p className=\"text-sm text-gray-600 mt-1\">\n              ‡§á‡§® ‡§µ‡§ø‡§µ‡§∞‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡•Ç‡§≤ ‡§¨‡•ã‡§≤‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç\n            </p>\n          </div>\n\n          {/* Receipt Preview - Colorful Format */}\n          <div \n            ref={printRef}\n            className=\"bg-white border-2 border-gray-800 rounded-lg shadow-lg print:shadow-none print:border-2 max-w-2xl mx-auto\"\n          >\n            {/* Header */}\n            <div className=\"bg-gray-100 py-4 px-6 border-b-2 border-gray-800 rounded-t-lg relative\">\n              {/* Left Logo - Jain Symbol */}\n              <div className=\"absolute left-4 top-4\">\n                <img \n                  src=\"/jain-symbol.png\" \n                  alt=\"Jain Symbol\"\n                  className=\"w-16 h-16 object-contain\"\n                />\n              </div>\n              \n              {/* Right Logo - Temple Building */}\n              <div className=\"absolute right-4 top-4\">\n                <img \n                  src=\"/temple-logo.png\" \n                  alt=\"Temple Logo\"\n                  className=\"w-16 h-16 object-contain rounded-full\"\n                />\n              </div>\n              \n              {/* Center Text */}\n              <div className=\"text-center\">\n                <h1 className=\"text-2xl font-bold text-orange-600 mb-2\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</h1>\n                <p className=\"text-gray-600 mb-1\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§¶‡§Æ‡•ã‡§π ‡§∞‡•ã‡§°, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</p>\n                <h2 className=\"text-lg font-semibold text-black mt-2\">‡§¨‡•ã‡§≤‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</h2>\n              </div>\n            </div>\n\n            {/* Body */}\n            <div className=\"p-5 space-y-3\">\n              {/* Row 1: User Name and Address */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä:</span>\n                  <span className=\"text-black\">{entry.userName.startsWith('‡§∂‡•ç‡§∞‡•Ä') || entry.userName.startsWith('‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä') ? entry.userName : `‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä ${entry.userName}`}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§™‡§§‡§æ:</span>\n                  <span className=\"text-black\">{entry.userAddress ? `${entry.userAddress}, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)` : '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)'}</span>\n                </div>\n              </div>\n\n              {/* Row 2: Receipt Number and Date */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{payment.receiptNo}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{formatDateDDMMYY(payment.date)}</span>\n                </div>\n              </div>\n\n              {/* Row 3: Description and Bedi Number */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡§æ‡§¨‡§§:</span>\n                  <span className=\"text-black\">{convertToHindi(entry.description)}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{entry.bediNumber || '1'}</span>\n                </div>\n              </div>\n\n              {/* Row 4: Payment Method */}\n              <div className=\"flex items-center space-x-1\">\n                <span className=\"font-semibold text-gray-700\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø:</span>\n                <span className=\"text-black\">{getPaymentModeHindi(payment.mode)}</span>\n              </div>\n\n              {/* Row 5: Boli Date and Occasion */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{boliDate}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞:</span>\n                  <span className=\"text-black\">{convertToHindi(entry.occasion)}</span>\n                </div>\n              </div>\n\n              {/* Row 6: Editable Fields */}\n              {(editableFields.referredBy || editableFields.otherDetails) && (\n                <div className=\"flex justify-between items-center\">\n                  <div className=\"flex items-center space-x-1\">\n                    <span className=\"font-semibold text-gray-700\">‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§:</span>\n                    <span className=\"text-black\">{convertToHindi(editableFields.referredBy)}</span>\n                  </div>\n                  <div className=\"flex items-center space-x-1\">\n                    <span className=\"font-semibold text-gray-700\">‡§Ö‡§®‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£:</span>\n                    <span className=\"text-black\">{convertToHindi(editableFields.otherDetails)}</span>\n                  </div>\n                </div>\n              )}\n\n              {/* Amount Section - Highlighted */}\n              <div className=\"bg-yellow-100 border border-yellow-400 rounded p-4 my-4\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"font-semibold text-gray-700\">‡§∞‡§æ‡§∂‡§ø (‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç):</span>\n                  <span className=\"text-2xl font-bold text-orange-600\">‚Çπ{amountInRupees.toLocaleString('hi-IN')}</span>\n                </div>\n                <div className=\"text-sm italic text-yellow-800\">\n                  ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç: {amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                </div>\n              </div>\n\n              {/* Signature Section */}\n              <div className=\"flex justify-between items-center mt-8 pt-6 border-t border-gray-300\">\n                <div className=\"text-center flex-1\">\n                  <div className=\"border-t border-black mt-10 pt-1 text-xs text-gray-600\">\n                    ‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞\n                  </div>\n                </div>\n                <div className=\"text-center flex-1 mx-4\">\n                  <div className=\"border-t border-black mt-10 pt-1 text-xs text-gray-600\">\n                    ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ï‡§∞‡•ç‡§§‡§æ\n                  </div>\n                </div>\n              </div>\n\n              {/* Footer */}\n              <div className=\"bg-gray-50 rounded p-3 text-center mt-6\">\n                <div className=\"text-sm text-gray-600\">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-4 justify-end\">\n            <Button variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            {userRole !== 'viewer' ? (\n              <Button onClick={handleSaveAndPrint} className=\"bg-blue-600 hover:bg-blue-700\">\n                Save & Print Receipt\n              </Button>\n            ) : (\n              <Button onClick={handlePrint} className=\"bg-green-600 hover:bg-green-700\">\n                Print Receipt Only\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};","size_bytes":49603},"local-deployment/client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport themePlugin from \"@replit/vite-plugin-shadcn-theme-json\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    themePlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","size_bytes":978},"local-deployment/client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"local-deployment/client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1435},"client/src/components/ui/avatar.tsx":{"content":"import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1405},"local-deployment/client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className=\"h-4 w-4\" />,\n        IconRight: ({ ...props }) => <ChevronRight className=\"h-4 w-4\" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2609},"local-deployment/client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1230},"client/src/pages/payment-details.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Form, FormField, FormItem, FormControl } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { type Entry, PaymentStatus, PaymentMode, type PaymentRecord, type AdvancePayment } from \"@shared/schema\";\nimport PaymentReceipt from \"@/components/payment-receipt\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { Wallet, Loader2 } from \"lucide-react\";\n\n// Schema for partial payment\nconst partialPaymentSchema = z.object({\n  amount: z.coerce.number()\n    .positive(\"Amount must be positive\")\n    .refine(val => val > 0, \"Amount must be greater than 0\"),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  mode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  fileUrl: z.string().optional()\n});\n\ntype PartialPaymentValues = z.infer<typeof partialPaymentSchema>;\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'bg-destructive';\n    case PaymentStatus.PARTIAL: return 'bg-orange-500';\n    case PaymentStatus.FULL: return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'Payment Pending';\n    case PaymentStatus.PARTIAL: return 'Partially Paid';\n    case PaymentStatus.FULL: return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nexport default function PaymentDetails() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [match, params] = useRoute(\"/entries/:id\");\n  const entryId = match ? parseInt(params.id) : 0;\n  \n  // Hindi receipt state\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: PaymentRecord | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  const todayDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n  const [selectedPayment, setSelectedPayment] = useState<PaymentRecord | null>(null);\n  const [receiptDialogOpen, setReceiptDialogOpen] = useState(false);\n  // Edit mode permanently disabled\n  const isEditMode = false;\n  const editPaymentIndex = null;\n  \n  // Fetch entry details\n  const { data: entry, isLoading } = useQuery<Entry>({\n    queryKey: [`/api/entries/${entryId}`],\n    enabled: entryId > 0,\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 30 * 1000 // Consider data stale after 30 seconds\n  });\n\n  // Get user's advance payments to calculate balance\n  const { data: userAdvancePayments = [] } = useQuery<AdvancePayment[]>({\n    queryKey: [`/api/advance-payments?userId=${entry?.userId}`],\n    enabled: !!entry?.userId && (user?.role === 'admin' || user?.role === 'operator'),\n    staleTime: 0, // Always refetch to get current data\n    gcTime: 0, // Don't cache\n  });\n\n  // Get advance payment balance from server calculation\n  const { data: serverAdvanceBalance = 0 } = useQuery<number>({\n    queryKey: [`/api/users/${entry?.userId}/advance-balance`],\n    enabled: !!entry?.userId && (user?.role === 'admin' || user?.role === 'operator'),\n    staleTime: 0, // Always refetch\n    gcTime: 0, // Don't cache\n  });\n\n  // Use server-calculated balance as the source of truth\n  const advanceBalance = serverAdvanceBalance;\n  \n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [paymentMode, setPaymentMode] = useState<string>(PaymentMode.CASH);\n  \n  const form = useForm<PartialPaymentValues>({\n    resolver: zodResolver(partialPaymentSchema),\n    defaultValues: {\n      amount: 0,\n      date: todayDate,\n      mode: PaymentMode.CASH,\n      fileUrl: ''\n    }\n  });\n  \n  // Full payment mutation\n  const recordFullPaymentMutation = useMutation({\n    mutationFn: async () => {\n      if (!entry) return null;\n      \n      // For full payment, we always use CASH mode as default\n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/payments`, {\n        amount: entry.pendingAmount,\n        date: todayDate,\n        mode: PaymentMode.CASH\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Full payment recorded successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to record payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Delete payment mutation\n  const deletePaymentMutation = useMutation({\n    mutationFn: async (paymentIndex: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/entries/${entryId}/payments/${paymentIndex}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Payment record deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to delete payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Update payment mutation - disabled\n  const updatePaymentMutation = useMutation({\n    mutationFn: async ({ data, paymentIndex }: { data: PartialPaymentValues, paymentIndex: number }) => {\n      // Return error response since update functionality is disabled\n      return Promise.reject(new Error(\"Payment update functionality has been disabled\"));\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Payment update functionality has been disabled`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Partial payment mutation\n  const recordPartialPaymentMutation = useMutation({\n    mutationFn: async (data: PartialPaymentValues) => {\n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/payments`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Partial payment recorded successfully\",\n      });\n      form.reset({ amount: 0, date: todayDate });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to record payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Function to check if file upload is required based on payment mode\n  const isFileUploadRequired = (mode: string): boolean => {\n    return mode === PaymentMode.UPI || mode === PaymentMode.NETBANKING || mode === PaymentMode.CHEQUE;\n  };\n  \n  // Handle file selection\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setSelectedFile(e.target.files[0]);\n    }\n  };\n  \n  // Handle payment mode change\n  const handlePaymentModeChange = (value: string) => {\n    setPaymentMode(value);\n    form.setValue('mode', value as any);\n  };\n  \n  const onSubmitPartialPayment = (data: PartialPaymentValues) => {\n    if (!entry) return;\n    \n    if (data.amount > entry.pendingAmount) {\n      toast({\n        title: \"Error\",\n        description: \"Payment amount cannot exceed pending amount\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Check if file is required but not provided\n    if (isFileUploadRequired(data.mode) && !selectedFile) {\n      toast({\n        title: \"Error\",\n        description: `File upload is required for ${data.mode} payments`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Convert the file to a data URL for immediate viewing\n    if (selectedFile) {\n      // Create a FileReader to convert the file to a data URL\n      const reader = new FileReader();\n      reader.readAsDataURL(selectedFile);\n      \n      reader.onload = () => {\n        // Add the data URL to the form data\n        const fileDataUrl = reader.result as string;\n        const paymentData = {\n          ...data,\n          fileUrl: fileDataUrl\n        };\n        \n        // Now submit the form with the data URL\n        recordPartialPaymentMutation.mutate(paymentData);\n      };\n      \n      reader.onerror = () => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to process the uploaded file\",\n          variant: \"destructive\"\n        });\n      };\n      \n      // Return early since we're handling the submission in the onload callback\n      return;\n    }\n    \n    // Edit mode has been disabled\n    // No condition to enter edit mode anymore\n    \n    // Otherwise, record a new payment\n    recordPartialPaymentMutation.mutate(data);\n  };\n  \n  // Cancel edit function - disabled since editing is no longer available\n  const cancelEdit = () => {\n    form.reset({ amount: 0, date: todayDate, mode: PaymentMode.CASH });\n  };\n  \n  const handleFullPayment = () => {\n    recordFullPaymentMutation.mutate();\n  };\n\n  // Advance payment mutation\n  const recordAdvancePaymentMutation = useMutation({\n    mutationFn: async () => {\n      if (!entry || advanceBalance <= 0) return null;\n      \n      const paymentAmount = Math.min(advanceBalance, entry.pendingAmount);\n      \n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/advance-payment`, {\n        amount: paymentAmount,\n        date: todayDate,\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      const paymentAmount = Math.min(advanceBalance, entry?.pendingAmount || 0);\n      toast({\n        title: \"Success\",\n        description: `‚Çπ${paymentAmount.toLocaleString()} applied from advance payment`,\n      });\n      // Invalidate all related queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/advance-payments?userId=${entry?.userId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/advance-payments`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${entry?.userId}/advance-balance`] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to apply advance payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Handle advance payment function\n  const handleAdvancePayment = () => {\n    if (!entry || advanceBalance <= 0) return;\n    \n    const paymentAmount = Math.min(advanceBalance, entry.pendingAmount);\n    const isFullPayment = paymentAmount >= entry.pendingAmount;\n    \n    const confirmMessage = isFullPayment \n      ? `This will fully pay the remaining ‚Çπ${entry.pendingAmount.toLocaleString()} using advance payment. Continue?`\n      : `This will apply ‚Çπ${paymentAmount.toLocaleString()} from advance payment, leaving ‚Çπ${(entry.pendingAmount - paymentAmount).toLocaleString()} pending. Continue?`;\n    \n    if (confirm(confirmMessage)) {\n      recordAdvancePaymentMutation.mutate();\n    }\n  };\n\n\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading entry details...</div>;\n  }\n\n  if (!entry) {\n    return (\n      <div className=\"flex-grow p-4\">\n        <div className=\"flex justify-center items-center h-64\">\n          <div className=\"text-center\">\n            <h2 className=\"text-xl font-medium mb-2\">Entry Not Found</h2>\n            <p className=\"text-neutral-500\">The requested entry could not be found.</p>\n            <Button \n              variant=\"link\" \n              className=\"mt-4\"\n              onClick={() => setLocation('/entries')}\n            >\n              Back to Entries\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow flex flex-col\">\n      {/* Header */}\n      <div className=\"bg-primary text-white p-4\">\n        <div className=\"flex justify-between items-center\">\n          <Button \n            variant=\"link\" \n            className=\"mb-2 flex items-center text-white p-0\"\n            onClick={() => setLocation('/entries')}\n          >\n            <span className=\"material-icons mr-1\">arrow_back</span>\n            <span>Back to Entries</span>\n          </Button>\n          \n          {/* Admin Controls */}\n          {user?.role === 'admin' && (\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"bg-white/10 text-white border-white/20 hover:bg-white/20\"\n                onClick={() => {\n                  if (confirm(\"Are you sure you want to delete this entry? This action cannot be undone.\")) {\n                    // Here you would call the API to delete the entry\n                    toast({\n                      title: \"Entry Deleted\",\n                      description: \"The entry has been deleted successfully.\"\n                    });\n                    setLocation('/entries');\n                  }\n                }}\n              >\n                <span className=\"material-icons text-sm mr-1\">delete</span>\n                Delete\n              </Button>\n            </div>\n          )}\n        </div>\n        <h1 className=\"text-xl font-medium\">{entry.description}</h1>\n        <p className=\"text-sm opacity-80\">{entry.userName} - {entry.occasion}</p>\n      </div>\n      \n      {/* Enhanced Details Card - All Table Information */}\n      <div className=\"bg-white m-4 rounded-lg shadow-md p-4\">\n        <div className=\"flex justify-between items-start mb-6\">\n          <h2 className=\"text-lg font-semibold text-neutral-700\">Entry Details</h2>\n          <span className={`px-3 py-1 rounded-full text-white text-sm font-medium ${getStatusClass(entry.status)}`}>\n            {getStatusText(entry.status)}\n          </span>\n        </div>\n        \n        {/* User Information */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-neutral-600\">User Information</p>\n            <div className=\"bg-neutral-50 p-3 rounded-lg\">\n              <p className=\"font-medium text-neutral-800\">{entry.userName}</p>\n              {entry.userMobile && (\n                <p className=\"text-sm text-neutral-600\">üì± {entry.userMobile}</p>\n              )}\n              {entry.userAddress && (\n                <p className=\"text-sm text-neutral-600\">üìç {entry.userAddress}</p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-neutral-600\">Entry Information</p>\n            <div className=\"bg-neutral-50 p-3 rounded-lg\">\n              <p className=\"text-sm text-neutral-600\">Quantity: <span className=\"font-medium\">{entry.quantity}</span></p>\n              <p className=\"text-sm text-neutral-600\">Boli Date: <span className=\"font-medium\">{new Date(entry.auctionDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span></p>\n              {entry.updatedAt && (\n                <p className=\"text-sm text-neutral-600\">Last Updated: <span className=\"font-medium\">{new Date(entry.updatedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span></p>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        {/* Financial Summary */}\n        <div className=\"border-t pt-4\">\n          <p className=\"text-sm font-medium text-neutral-600 mb-3\">Financial Summary</p>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"bg-blue-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-blue-600\">Total Amount</p>\n              <p className=\"text-2xl font-bold text-blue-700\">‚Çπ{entry.totalAmount.toLocaleString()}</p>\n            </div>\n            <div className=\"bg-green-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-green-600\">Received Amount</p>\n              <p className=\"text-2xl font-bold text-green-700\">‚Çπ{entry.receivedAmount.toLocaleString()}</p>\n            </div>\n            <div className=\"bg-red-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-red-600\">Pending Amount</p>\n              <p className=\"text-2xl font-bold text-red-700\">‚Çπ{entry.pendingAmount.toLocaleString()}</p>\n            </div>\n          </div>\n        </div>\n        \n        {/* Advance Payment Balance - Only show for admin/operator */}\n        {(user?.role === 'admin' || user?.role === 'operator') && advanceBalance > 0 && (\n          <div className=\"mt-4 p-3 bg-orange-50 rounded-lg border border-orange-200\">\n            <div className=\"flex justify-between items-center\">\n              <div>\n                <p className=\"text-sm text-orange-700 font-medium\">Advance Payment Balance</p>\n                <p className=\"text-lg font-medium text-orange-600\">‚Çπ{advanceBalance.toLocaleString()}</p>\n              </div>\n              <Wallet className=\"h-5 w-5 text-orange-500\" />\n            </div>\n            {entry.pendingAmount > 0 && (\n              <div className=\"mt-3 flex flex-col gap-2\">\n                {advanceBalance > 0 ? (\n                  <>\n                    <p className=\"text-xs text-orange-600\">Available for payment processing</p>\n                    <Button\n                      onClick={handleAdvancePayment}\n                      disabled={recordAdvancePaymentMutation.isPending}\n                      size=\"sm\"\n                      className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n                    >\n                      {recordAdvancePaymentMutation.isPending ? (\n                        <span className=\"flex items-center gap-2\">\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          Processing...\n                        </span>\n                      ) : (\n                        <span className=\"flex items-center gap-2\">\n                          <Wallet className=\"h-4 w-4\" />\n                          Use Advance Payment (‚Çπ{Math.min(advanceBalance, entry.pendingAmount).toLocaleString()})\n                        </span>\n                      )}\n                    </Button>\n                  </>\n                ) : (\n                  <p className=\"text-xs text-orange-500\">No advance balance available</p>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {/* Payment History */}\n      <div className=\"bg-white mx-4 rounded-lg shadow-md overflow-hidden\">\n        <div className=\"p-4 border-b border-neutral-200\">\n          <h2 className=\"font-medium\">Payment History</h2>\n        </div>\n        <div className=\"p-4\">\n          {entry.payments.length === 0 ? (\n            <div className=\"text-center py-4 text-neutral-500\">No payment records yet</div>\n          ) : (\n            entry.payments.map((payment, index) => (\n              <div key={index} className=\"flex justify-between items-center py-3 border-b border-neutral-200\">\n                <div className=\"flex-1\">\n                  <div className=\"font-medium\">{new Date(payment.date).toLocaleDateString()}</div>\n                  <div className=\"text-sm text-neutral-500\">\n                    {payment.mode ? `Via ${payment.mode}` : \"Payment received\"}\n                    {payment.receiptNo && (\n                      <span className=\"ml-2 text-xs bg-neutral-100 px-2 py-1 rounded\">\n                        Receipt: {payment.receiptNo}\n                      </span>\n                    )}\n                    {payment.fileUrl && (\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button \n                            variant=\"link\" \n                            className=\"ml-2 p-0 h-auto text-blue-500 underline\"\n                          >\n                            View Upload\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent className=\"max-w-3xl\">\n                          <DialogHeader>\n                            <DialogTitle>Payment Upload</DialogTitle>\n                          </DialogHeader>\n                          <div className=\"flex justify-center p-2\">\n                            <img \n                              src={payment.fileUrl}\n                              alt=\"Payment upload\" \n                              className=\"max-h-[70vh] object-contain\"\n                            />\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                    )}\n                    \n                    <Button \n                      variant=\"link\" \n                      className=\"ml-2 p-0 h-auto text-blue-500 underline\"\n                      onClick={() => {\n                        setSelectedPayment(payment);\n                        setReceiptDialogOpen(true);\n                      }}\n                    >\n                      View Receipt\n                    </Button>\n                    \n                    <Button \n                      variant=\"link\" \n                      className=\"ml-2 p-0 h-auto text-green-600 underline\"\n                      onClick={() => {\n                        setHindiReceiptState({\n                          isOpen: true,\n                          entry: entry,\n                          payment: payment,\n                          paymentIndex: index\n                        });\n                      }}\n                    >\n                      Hindi Receipt\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"flex items-center\">\n                  <div className=\"font-medium text-green-500\">‚Çπ{payment.amount.toLocaleString()}</div>\n                  \n                  {/* Admin Payment Controls */}\n                  {user?.role === 'admin' && (\n                    <div className=\"flex ml-3\">\n                      {/* Edit payment functionality has been disabled */}\n                      \n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\"\n                        className=\"h-8 w-8 p-0 text-red-600\"\n                        onClick={() => {\n                          if (confirm(\"Are you sure you want to delete this payment record? This action cannot be undone.\")) {\n                            deletePaymentMutation.mutate(index);\n                          }\n                        }}\n                      >\n                        <span className=\"material-icons text-sm\">delete</span>\n                        <span className=\"sr-only\">Delete</span>\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n      \n      {/* Receipt Dialog */}\n      <Dialog open={receiptDialogOpen} onOpenChange={setReceiptDialogOpen}>\n        <DialogContent className=\"max-w-3xl\">\n          <DialogHeader>\n            <DialogTitle>Payment Receipt</DialogTitle>\n          </DialogHeader>\n          {selectedPayment && entry && (\n            <PaymentReceipt \n              entry={entry} \n              payment={selectedPayment} \n              onClose={() => setReceiptDialogOpen(false)} \n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Payment Section (only for operators if payment is not complete) */}\n      {user?.role === 'operator' && entry.status !== PaymentStatus.FULL && (\n        <div className=\"bg-white mx-4 my-4 rounded-lg shadow-md overflow-hidden\">\n          <div className=\"p-4 border-b border-neutral-200\">\n            <h2 className=\"font-medium\">Record Payment</h2>\n          </div>\n          <div className=\"p-4\">\n            <Button \n              variant=\"default\" \n              className=\"w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-md font-medium mb-3\"\n              onClick={handleFullPayment}\n              disabled={recordFullPaymentMutation.isPending}\n            >\n              {recordFullPaymentMutation.isPending \n                ? \"Processing...\" \n                : `Full payment (‚Çπ${entry.pendingAmount.toLocaleString()})`}\n            </Button>\n            \n            <div>\n              <p className=\"text-sm text-neutral-500 mb-2\">Or record partial payment:</p>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmitPartialPayment)}>\n                  {/* Amount Field */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"amount\">Amount</Label>\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              id=\"amount\"\n                              type=\"number\" \n                              placeholder=\"Enter amount\" \n                              {...field}\n                              onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Payment Date */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"paymentDate\">Payment Date</Label>\n                    <FormField\n                      control={form.control}\n                      name=\"date\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              id=\"paymentDate\"\n                              type=\"date\" \n                              {...field}\n                              max={new Date().toISOString().split('T')[0]}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Payment Mode Selector */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"paymentMode\">Payment Mode</Label>\n                    <Select \n                      value={paymentMode} \n                      onValueChange={handlePaymentModeChange}\n                    >\n                      <SelectTrigger id=\"paymentMode\">\n                        <SelectValue placeholder=\"Select payment mode\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                        <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                        <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                        <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    \n                    <FormField\n                      control={form.control}\n                      name=\"mode\"\n                      render={({ field }) => (\n                        <FormItem className=\"hidden\">\n                          <FormControl>\n                            <Input type=\"hidden\" {...field} />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* File Upload */}\n                  {isFileUploadRequired(paymentMode) && (\n                    <div className=\"mb-4\">\n                      <Label htmlFor=\"fileUpload\">\n                        {paymentMode === PaymentMode.CHEQUE \n                          ? \"Upload Cheque Image\" \n                          : \"Upload Payment Screenshot\"}\n                      </Label>\n                      <Input \n                        id=\"fileUpload\"\n                        type=\"file\" \n                        accept=\"image/*\"\n                        onChange={handleFileChange}\n                        className=\"mt-1\"\n                      />\n                      <p className=\"text-xs text-neutral-500 mt-1\">\n                        {paymentMode === PaymentMode.CHEQUE \n                          ? \"Upload a clear image of the cheque\" \n                          : \"Upload a screenshot of the payment confirmation\"}\n                      </p>\n                    </div>\n                  )}\n                  \n                  {/* Hidden Date Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"date\"\n                    render={({ field }) => (\n                      <FormItem className=\"hidden\">\n                        <FormControl>\n                          <Input type=\"hidden\" {...field} />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Hidden FileUrl Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"fileUrl\"\n                    render={({ field }) => (\n                      <FormItem className=\"hidden\">\n                        <FormControl>\n                          <Input type=\"hidden\" {...field} />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Submit Button - Edit mode disabled */}\n                  {false ? (\n                    <div className=\"hidden\">\n                      {/* Edit payment functionality has been disabled */}\n                    </div>\n                  ) : (\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-primary text-white\"\n                      disabled={recordPartialPaymentMutation.isPending}\n                    >\n                      {recordPartialPaymentMutation.isPending ? \"Recording payment...\" : \"Record Payment\"}\n                    </Button>\n                  )}\n                </form>\n              </Form>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Hindi Receipt Component */}\n      {hindiReceiptState.isOpen && hindiReceiptState.entry && hindiReceiptState.payment && (\n        <HindiReceipt\n          entry={hindiReceiptState.entry}\n          payment={hindiReceiptState.payment}\n          paymentIndex={hindiReceiptState.paymentIndex}\n          isOpen={hindiReceiptState.isOpen}\n          userRole={user?.role}\n          onClose={() => setHindiReceiptState({\n            isOpen: false,\n            entry: null,\n            payment: null,\n            paymentIndex: -1\n          })}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":32615},"server/find-duplicate-mobiles.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\n\nasync function findDuplicateMobiles() {\n  try {\n    console.log('Fetching all users from database...');\n    \n    // Get all users from database\n    const allUsers = await db.select().from(users).orderBy(users.serialNumber);\n    console.log(`Total users in database: ${allUsers.length}`);\n\n    // Group users by mobile number\n    const mobileGroups: { [mobile: string]: typeof allUsers } = {};\n    \n    allUsers.forEach(user => {\n      const mobile = user.mobile.trim();\n      if (mobile) {\n        if (!mobileGroups[mobile]) {\n          mobileGroups[mobile] = [];\n        }\n        mobileGroups[mobile].push(user);\n      }\n    });\n\n    // Find mobile numbers with duplicates\n    const duplicateMobiles = Object.entries(mobileGroups)\n      .filter(([mobile, userList]) => userList.length > 1)\n      .sort(([a], [b]) => a.localeCompare(b));\n\n    console.log(`Found ${duplicateMobiles.length} mobile numbers with duplicates`);\n\n    // Create data for Excel export\n    const duplicateUsersData: any[] = [];\n    let totalDuplicateUsers = 0;\n\n    duplicateMobiles.forEach(([mobile, userList]) => {\n      console.log(`Mobile ${mobile}: ${userList.length} users`);\n      \n      userList.forEach((user, index) => {\n        duplicateUsersData.push({\n          'username': user.username,\n          'password': 'password123', // Default password for all users\n          'name': user.name,\n          'email': user.email,\n          'mobile': mobile,\n          'address': user.address,\n          'role': user.role,\n          'status': user.status,\n          'serial_number': user.serialNumber,\n          'duplicate_count': userList.length,\n          'duplicate_position': index + 1\n        });\n        totalDuplicateUsers++;\n      });\n    });\n\n    console.log(`Total users with duplicate mobile numbers: ${totalDuplicateUsers}`);\n\n    // Create Excel workbook\n    const workbook = XLSX.utils.book_new();\n    \n    // Summary sheet\n    const summaryData = [\n      ['Total Users in Database', allUsers.length],\n      ['Unique Mobile Numbers', Object.keys(mobileGroups).length],\n      ['Mobile Numbers with Duplicates', duplicateMobiles.length],\n      ['Total Users with Duplicate Mobiles', totalDuplicateUsers],\n      [''],\n      ['Mobile Number', 'Duplicate Count'],\n      ...duplicateMobiles.map(([mobile, userList]) => [mobile, userList.length])\n    ];\n    \n    const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);\n    XLSX.utils.book_append_sheet(workbook, summarySheet, 'Summary');\n\n    // Detailed users sheet\n    const detailedSheet = XLSX.utils.json_to_sheet(duplicateUsersData);\n    XLSX.utils.book_append_sheet(workbook, detailedSheet, 'Duplicate Mobile Users');\n\n    // Write the file\n    const fileName = `Duplicate_Mobile_Users_${new Date().toISOString().split('T')[0]}.xlsx`;\n    const filePath = path.join(process.cwd(), '..', fileName);\n    \n    XLSX.writeFile(workbook, filePath);\n    console.log(`\\nExcel file created: ${fileName}`);\n    console.log(`File path: ${filePath}`);\n\n    // Create summary report\n    console.log('\\n=== DUPLICATE MOBILE NUMBERS SUMMARY ===');\n    console.log(`Total users in database: ${allUsers.length}`);\n    console.log(`Users with duplicate mobile numbers: ${totalDuplicateUsers}`);\n    console.log(`Mobile numbers with duplicates: ${duplicateMobiles.length}`);\n    console.log(`Percentage of users with duplicate mobiles: ${((totalDuplicateUsers / allUsers.length) * 100).toFixed(2)}%`);\n\n    console.log('\\n=== TOP 10 MOST DUPLICATED MOBILE NUMBERS ===');\n    const topDuplicates = duplicateMobiles\n      .sort(([, a], [, b]) => b.length - a.length)\n      .slice(0, 10);\n    \n    topDuplicates.forEach(([mobile, userList]) => {\n      console.log(`${mobile}: ${userList.length} users`);\n    });\n\n    return {\n      totalUsers: allUsers.length,\n      duplicateUsers: totalDuplicateUsers,\n      duplicateMobiles: duplicateMobiles.length,\n      fileName: fileName\n    };\n\n  } catch (error) {\n    console.error('Error finding duplicate mobiles:', error);\n    throw error;\n  }\n}\n\n// Run the analysis\nfindDuplicateMobiles()\n  .then(result => {\n    console.log('\\n=== ANALYSIS COMPLETE ===');\n    console.log(`Excel file ready for download: ${result.fileName}`);\n    console.log(`Found ${result.duplicateUsers} users with duplicate mobile numbers`);\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Analysis failed:', error);\n    process.exit(1);\n  });","size_bytes":4522},"local-deployment/client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([_, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10466},"local-deployment/server/db.ts":{"content":"import { Pool } from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to set up the database?\",\n  );\n}\n\nexport const pool = new Pool({ \n  connectionString: process.env.DATABASE_URL,\n  ssl: false // Disable SSL for local PostgreSQL\n});\n\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":440},"local-deployment/server/temp-fix.ts":{"content":"// This file contains all the necessary fixes for the routes\n// Operator should have access to all data like admin, no Users page visibility\n// Admin should have edit/delete capabilities for payment records and entries\n\n// Fix for /api/entries endpoint\nexport const entriesGetFix = `\n  app.get(\"/api/entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      let entries;\n      \n      if (user.role === \"admin\" || user.role === \"operator\") {\n        entries = await storage.getEntries();\n      } else {\n        entries = await storage.getUserEntries(user.id);\n      }\n      \n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entries\" });\n    }\n  });\n`;\n\n// Fix for the dashboard endpoint\nexport const dashboardGetFix = `\n  app.get(\"/api/dashboard\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Dashboard should be accessible to admins and operators\n      if (user.role === \"admin\" || user.role === \"operator\") {\n        // Get all entries for stats\n        const entries = await storage.getEntries();\n        \n        // Calculate summary stats\n        const summary = {\n          totalAmount: 0,\n          receivedAmount: 0,\n          pendingAmount: 0,\n          pendingEntries: 0,\n          partialEntries: 0,\n          completedEntries: 0\n        };\n        \n        const recentActivity = [];\n        \n        // Only keep 5 most recent entries for the recent activity feed\n        entries.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n        \n        for (const entry of entries) {\n          // Update summary stats\n          summary.totalAmount += entry.totalAmount;\n          \n          const receivedAmount = entry.payments.reduce((total, payment) => total + payment.amount, 0);\n          summary.receivedAmount += receivedAmount;\n          \n          const pendingAmount = entry.totalAmount - receivedAmount;\n          summary.pendingAmount += pendingAmount;\n          \n          // Count entries by status\n          if (entry.status === \"pending\") {\n            summary.pendingEntries++;\n          } else if (entry.status === \"partial\") {\n            summary.partialEntries++;\n          } else if (entry.status === \"full\") {\n            summary.completedEntries++;\n          }\n          \n          // Add to recent activity if we have less than 5 entries\n          if (recentActivity.length < 5) {\n            recentActivity.push(entry);\n          }\n        }\n        \n        res.json({\n          summary,\n          recentActivity\n        });\n      } else {\n        // For regular users, only show their own entries\n        const entries = await storage.getUserEntries(user.id);\n        \n        // Calculate summary stats for just this user\n        const summary = {\n          totalAmount: 0,\n          receivedAmount: 0,\n          pendingAmount: 0,\n          pendingEntries: 0,\n          partialEntries: 0,\n          completedEntries: 0\n        };\n        \n        // Sort by updated date descending\n        entries.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n        \n        for (const entry of entries) {\n          // Update summary stats\n          summary.totalAmount += entry.totalAmount;\n          \n          const receivedAmount = entry.payments.reduce((total, payment) => total + payment.amount, 0);\n          summary.receivedAmount += receivedAmount;\n          \n          const pendingAmount = entry.totalAmount - receivedAmount;\n          summary.pendingAmount += pendingAmount;\n          \n          // Count entries by status\n          if (entry.status === \"pending\") {\n            summary.pendingEntries++;\n          } else if (entry.status === \"partial\") {\n            summary.partialEntries++;\n          } else if (entry.status === \"full\") {\n            summary.completedEntries++;\n          }\n        }\n        \n        // Only send back up to 5 entries for recent activity\n        const recentActivity = entries.slice(0, 5);\n        \n        res.json({\n          summary,\n          recentActivity\n        });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch dashboard data\" });\n    }\n  });\n`;","size_bytes":4284},"deploy/configure-server.sh":{"content":"#!/bin/bash\n\necho \"üîß Configuring Daan Darpan for Server Deployment...\"\n\n# Color codes for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\nprint_status() {\n    echo -e \"${BLUE}[INFO]${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\nprint_header() {\n    echo -e \"${BLUE}==================================${NC}\"\n    echo -e \"${BLUE}$1${NC}\"\n    echo -e \"${BLUE}==================================${NC}\"\n}\n\nprint_header \"DAAN DARPAN SERVER CONFIGURATION\"\n\n# Check if running as root\nif [ \"$EUID\" -eq 0 ]; then\n    print_warning \"Running as root. Consider creating a dedicated user for the application.\"\nfi\n\n# Get server IP\nSERVER_IP=$(hostname -I | awk '{print $1}')\nPUBLIC_IP=$(curl -s ifconfig.me 2>/dev/null || echo \"Not available\")\n\nprint_status \"Current server details:\"\nprint_status \"Local IP: $SERVER_IP\"\nprint_status \"Public IP: $PUBLIC_IP\"\n\n# Configuration options\necho \"\"\nprint_header \"CONFIGURATION OPTIONS\"\necho \"1. Localhost only (127.0.0.1) - Access from this machine only\"\necho \"2. Local network (0.0.0.0) - Access from local network\"\necho \"3. Specific IP ($SERVER_IP) - Access from specific IP\"\necho \"4. Custom IP - Enter your own IP\"\necho \"\"\n\nread -p \"Select configuration option (1-4): \" choice\n\ncase $choice in\n    1)\n        HOST=\"127.0.0.1\"\n        print_status \"Configured for localhost access only\"\n        ACCESS_URL=\"http://localhost:8484\"\n        ;;\n    2)\n        HOST=\"0.0.0.0\"\n        print_status \"Configured for local network access\"\n        ACCESS_URL=\"http://$SERVER_IP:8484\"\n        ;;\n    3)\n        HOST=\"$SERVER_IP\"\n        print_status \"Configured for specific IP access\"\n        ACCESS_URL=\"http://$SERVER_IP:8484\"\n        ;;\n    4)\n        read -p \"Enter custom IP address: \" CUSTOM_IP\n        HOST=\"$CUSTOM_IP\"\n        print_status \"Configured for custom IP access\"\n        ACCESS_URL=\"http://$CUSTOM_IP:8484\"\n        ;;\n    *)\n        print_error \"Invalid option. Using default (0.0.0.0)\"\n        HOST=\"0.0.0.0\"\n        ACCESS_URL=\"http://$SERVER_IP:8484\"\n        ;;\nesac\n\n# Port configuration\nread -p \"Enter port number (default 8484): \" PORT_INPUT\nPORT=${PORT_INPUT:-8484}\n\n# Update .env file\nif [ -f .env ]; then\n    # Update existing .env\n    sed -i \"s/^HOST=.*/HOST=$HOST/\" .env\n    sed -i \"s/^PORT=.*/PORT=$PORT/\" .env\n    print_success \"Updated existing .env file\"\nelse\n    # Create new .env from template\n    cp deploy/production.env .env\n    sed -i \"s/^HOST=.*/HOST=$HOST/\" .env\n    sed -i \"s/^PORT=.*/PORT=$PORT/\" .env\n    print_success \"Created new .env file from template\"\nfi\n\n# Security recommendations\necho \"\"\nprint_header \"SECURITY CONFIGURATION\"\n\n# Check if default session secret is being used\nif grep -q \"CHANGE_THIS_TO_A_STRONG_RANDOM_STRING\" .env; then\n    print_warning \"Default session secret detected. Generating secure session secret...\"\n    \n    # Generate random session secret\n    SESSION_SECRET=$(openssl rand -base64 32 2>/dev/null || date +%s | sha256sum | base64 | head -c 32)\n    sed -i \"s/CHANGE_THIS_TO_A_STRONG_RANDOM_STRING_32_CHARS_MINIMUM/$SESSION_SECRET/\" .env\n    print_success \"Generated secure session secret\"\nfi\n\n# Firewall configuration\necho \"\"\nprint_header \"FIREWALL CONFIGURATION\"\n\nif [ \"$HOST\" != \"127.0.0.1\" ]; then\n    print_status \"Network access enabled. Checking firewall...\"\n    \n    # Ubuntu/Debian UFW\n    if command -v ufw &> /dev/null; then\n        print_status \"UFW detected. Would you like to open port $PORT? (y/n)\"\n        read -p \"> \" open_port\n        if [ \"$open_port\" = \"y\" ] || [ \"$open_port\" = \"Y\" ]; then\n            sudo ufw allow $PORT\n            print_success \"Port $PORT opened in UFW firewall\"\n        fi\n    \n    # CentOS/RHEL firewalld\n    elif command -v firewall-cmd &> /dev/null; then\n        print_status \"Firewalld detected. Would you like to open port $PORT? (y/n)\"\n        read -p \"> \" open_port\n        if [ \"$open_port\" = \"y\" ] || [ \"$open_port\" = \"Y\" ]; then\n            sudo firewall-cmd --permanent --add-port=$PORT/tcp\n            sudo firewall-cmd --reload\n            print_success \"Port $PORT opened in firewalld\"\n        fi\n    \n    else\n        print_warning \"No firewall detected or manual configuration required\"\n        print_status \"Please ensure port $PORT is open for incoming connections\"\n    fi\nfi\n\n# Process management recommendation\necho \"\"\nprint_header \"PROCESS MANAGEMENT\"\nprint_status \"For production deployment, consider using PM2 for process management:\"\nprint_status \"1. Install PM2: npm install -g pm2\"\nprint_status \"2. Start app: pm2 start 'npm start' --name daan-darpan\"\nprint_status \"3. Save config: pm2 save && pm2 startup\"\n\n# Final summary\necho \"\"\nprint_header \"CONFIGURATION COMPLETE\"\nprint_success \"Server configuration completed successfully!\"\nprint_status \"\"\nprint_status \"Configuration Summary:\"\nprint_status \"‚Ä¢ Host: $HOST\"\nprint_status \"‚Ä¢ Port: $PORT\"\nprint_status \"‚Ä¢ Access URL: $ACCESS_URL\"\nprint_status \"\"\nprint_status \"Next Steps:\"\nprint_status \"1. Run database setup: ./deploy/setup-database.sh\"\nprint_status \"2. Start application: ./deploy/start.sh\"\nprint_status \"3. Access application: $ACCESS_URL\"\nprint_status \"\"\nprint_warning \"Important: Change the default admin password after first login!\"\nprint_status \"Default credentials: admin / admin123\"\nprint_status \"\"","size_bytes":5438},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"local-deployment/client/src/pages/previous-outstanding-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\nimport { UserRole } from \"@shared/schema\";\n\n// Form validation schema\nconst previousOutstandingSchema = z.object({\n  userId: z.number().positive(\"Please select a user\"),\n  userName: z.string().min(1, \"User name is required\"),\n  userMobile: z.string().optional(),\n  userAddress: z.string().optional(),\n  outstandingAmount: z.number().positive(\"Outstanding amount must be positive\"),\n  description: z.string().min(1, \"Description is required\").default(\"Previous Outstanding Amount\"),\n  attachmentFile: z.any().optional(),\n});\n\ntype FormValues = z.infer<typeof previousOutstandingSchema>;\n\nexport default function PreviousOutstandingForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [attachmentFile, setAttachmentFile] = useState<File | null>(null);\n\n  // Redirect viewers away from this page\n  if (user && user.role === UserRole.VIEWER) {\n    setLocation('/dashboard');\n    return null;\n  }\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: isLoadingUsers } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n\n  // Initialize form\n  const form = useForm<FormValues>({\n    resolver: zodResolver(previousOutstandingSchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      userMobile: \"\",\n      userAddress: \"\",\n      outstandingAmount: 0,\n      description: \"Previous Outstanding Amount\",\n    }\n  });\n\n  // Watch values for automatic updates\n  const watchUserId = form.watch(\"userId\");\n\n  // Update user details when userId changes\n  const selectedUser = users?.find(user => user.id === watchUserId);\n  useEffect(() => {\n    if (selectedUser) {\n      console.log(\"Selected user:\", selectedUser);\n      form.setValue(\"userName\", selectedUser.name);\n      form.setValue(\"userMobile\", selectedUser.mobile || \"\");\n      form.setValue(\"userAddress\", selectedUser.address || \"\");\n      console.log(\"Form values after user selection:\", form.getValues());\n    } else if (watchUserId === 0) {\n      // Reset user fields when no user is selected\n      form.setValue(\"userName\", \"\");\n      form.setValue(\"userMobile\", \"\");\n      form.setValue(\"userAddress\", \"\");\n    }\n  }, [selectedUser, form, watchUserId]);\n\n  // Handle file selection\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Validate file type\n      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];\n      if (!allowedTypes.includes(file.type)) {\n        toast({\n          title: \"Invalid File Type\",\n          description: \"Please upload a PDF, JPG, JPEG, or PNG file\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n      \n      // Validate file size (5MB max)\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"File Too Large\",\n          description: \"File size must be less than 5MB\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n      \n      setAttachmentFile(file);\n    }\n  };\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: FormValues) => {\n      const formData = new FormData();\n      formData.append('userId', data.userId.toString());\n      formData.append('userName', data.userName);\n      formData.append('userMobile', data.userMobile || '');\n      formData.append('userAddress', data.userAddress || '');\n      formData.append('outstandingAmount', data.outstandingAmount.toString()); // Keep in rupees\n      formData.append('description', data.description);\n      formData.append('createdBy', user?.username || 'system');\n      \n      if (attachmentFile) {\n        formData.append('attachmentFile', attachmentFile);\n      }\n\n      // Use direct fetch instead of apiRequest for FormData\n      const response = await fetch('/api/previous-outstanding', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create previous outstanding record');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Previous outstanding record created successfully\",\n      });\n      \n      // Invalidate related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/previous-outstanding'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      setLocation('/entries');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create record: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const onSubmit = (data: FormValues) => {\n    console.log(\"Form data being submitted:\", data);\n    \n    // Validate required fields on client side\n    if (!data.userId || data.userId === 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!data.userName) {\n      toast({\n        title: \"Validation Error\", \n        description: \"User name is required\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!data.outstandingAmount || data.outstandingAmount <= 0) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Outstanding amount must be greater than 0\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    createMutation.mutate(data);\n  };\n\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and administrators can create previous outstanding records.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/entries')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Entries\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Add Previous Outstanding Record</CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Record previous outstanding amounts for users migrating from old system\n          </p>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              {/* User Selection */}\n              <FormField\n                control={form.control}\n                name=\"userId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Select User *</FormLabel>\n                    <FormControl>\n                      <UserSelect\n                        value={field.value}\n                        onValueChange={(value) => {\n                          console.log(\"User selected with ID:\", value);\n                          field.onChange(value);\n                        }}\n                        placeholder=\"Search and select user\"\n                        className=\"w-full\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Display selected user info */}\n              {selectedUser && (\n                <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                  <p className=\"text-sm font-medium text-blue-800\">Selected User:</p>\n                  <p className=\"text-sm text-blue-700\">{selectedUser.name}</p>\n                  {selectedUser.mobile && <p className=\"text-xs text-blue-600\">Mobile: {selectedUser.mobile}</p>}\n                  {selectedUser.address && <p className=\"text-xs text-blue-600\">Address: {selectedUser.address}</p>}\n                </div>\n              )}\n\n              {/* Hidden fields for user details */}\n              <input type=\"hidden\" {...form.register(\"userName\")} />\n              <input type=\"hidden\" {...form.register(\"userMobile\")} />\n              <input type=\"hidden\" {...form.register(\"userAddress\")} />\n\n              {/* Outstanding Amount */}\n              <FormField\n                control={form.control}\n                name=\"outstandingAmount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Previous Outstanding Amount (‚Çπ) *</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        placeholder=\"Enter amount in rupees\"\n                        {...field}\n                        onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Description */}\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Description</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Description of the outstanding amount\"\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* File Upload */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"attachment\">Proof of Outstanding (PDF, JPG, JPEG, PNG)</Label>\n                <Input\n                  id=\"attachment\"\n                  type=\"file\"\n                  accept=\".pdf,.jpg,.jpeg,.png\"\n                  onChange={handleFileChange}\n                  className=\"cursor-pointer\"\n                />\n                {attachmentFile && (\n                  <p className=\"text-sm text-green-600\">\n                    Selected: {attachmentFile.name} ({(attachmentFile.size / 1024 / 1024).toFixed(2)} MB)\n                  </p>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  Upload proof of previous outstanding amount (Max 5MB)\n                </p>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex gap-4 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation('/entries')}\n                  className=\"flex-1\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  className=\"flex-1\"\n                >\n                  {createMutation.isPending ? \"Creating...\" : \"Create Record\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":12261},"local-deployment/client/src/pages/expense-entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { FileText, ExternalLink, Eye, Image } from \"lucide-react\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nexport default function ExpenseEntries() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [paymentModeFilter, setPaymentModeFilter] = useState(\"all-modes\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n\n  const { data: expenseEntries, isLoading, error } = useQuery<any[]>({\n    queryKey: ['/api/expense-entries'],\n  });\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-500\">\n          <p>Error loading expense entries: {error.message}</p>\n          <Button onClick={() => window.location.reload()} className=\"mt-4\">\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Get unique payment modes from expense entries\n  const uniquePaymentModes = Array.from(new Set((expenseEntries || []).map(entry => entry.payment_mode).filter(Boolean)));\n\n  // Apply filters\n  const filteredEntries = useMemo(() => {\n    return (expenseEntries || []).filter(entry => {\n      const matchesSearch = !searchTerm || \n        entry.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (entry.reason && entry.reason.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        entry.approved_by.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (entry.firm_name && entry.firm_name.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        (entry.bill_no && entry.bill_no.toLowerCase().includes(searchTerm.toLowerCase())) ||\n        (entry.paid_by && entry.paid_by.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      const matchesPaymentMode = !paymentModeFilter || paymentModeFilter === \"all-modes\" || \n        entry.payment_mode?.toLowerCase() === paymentModeFilter.toLowerCase();\n      \n      const entryDate = new Date(entry.expense_date);\n      const matchesDateRange = (!startDate || entryDate >= startDate) && \n                              (!endDate || entryDate <= endDate);\n      \n      return matchesSearch && matchesPaymentMode && matchesDateRange;\n    });\n  }, [expenseEntries, searchTerm, paymentModeFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setPaymentModeFilter(\"all-modes\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatAmount = (amountInPaisa: number) => {\n    return (amountInPaisa / 100).toFixed(2);\n  };\n\n  const getPaymentModeColor = (mode: string) => {\n    switch (mode.toLowerCase()) {\n      case 'cash': return 'bg-green-100 text-green-800';\n      case 'upi': return 'bg-blue-100 text-blue-800';\n      case 'cheque': return 'bg-yellow-100 text-yellow-800';\n      case 'netbanking': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  // Parse attachment URLs\n  const parseAttachments = (attachmentUrl: string | null) => {\n    if (!attachmentUrl) return { receipt: null, paymentScreenshot: null };\n    \n    const urls = attachmentUrl.split(';').filter(Boolean);\n    const receipt = urls.find(url => url.includes('receiptFile')) || null;\n    const paymentScreenshot = urls.find(url => url.includes('paymentScreenshot')) || null;\n    \n    return { receipt, paymentScreenshot };\n  };\n\n  // File preview component\n  const FilePreview = ({ url, title }: { url: string; title: string }) => {\n    const isPDF = url.toLowerCase().endsWith('.pdf');\n    \n    return (\n      <div className=\"space-y-2\">\n        <h4 className=\"font-medium\">{title}</h4>\n        {isPDF ? (\n          <div className=\"border rounded-lg p-4 text-center\">\n            <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n            <p className=\"text-sm text-muted-foreground mb-2\">PDF Document</p>\n            <a \n              href={url} \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n              className=\"text-blue-600 hover:underline flex items-center justify-center gap-1\"\n            >\n              View PDF <ExternalLink className=\"h-3 w-3\" />\n            </a>\n          </div>\n        ) : (\n          <div className=\"border rounded-lg overflow-hidden\">\n            <img \n              src={url} \n              alt={title}\n              className=\"w-full h-auto max-h-96 object-contain\"\n              onError={(e) => {\n                const target = e.currentTarget as HTMLImageElement;\n                const nextElement = target.nextElementSibling as HTMLElement;\n                target.style.display = 'none';\n                if (nextElement) nextElement.style.display = 'block';\n              }}\n            />\n            <div className=\"hidden p-4 text-center\">\n              <Image className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n              <p className=\"text-sm text-muted-foreground\">Could not load image</p>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can view expense entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-10\" />\n            ))}\n          </div>\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n        <h1 className=\"text-2xl font-bold\">Expense Entries</h1>\n        <Button onClick={() => setLocation('/expense-entry-form')}>\n          Add Expense Entry\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Search</label>\n              <Input\n                placeholder=\"Search by description, reason, or approver\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Payment Mode</label>\n              <Select value={paymentModeFilter} onValueChange={setPaymentModeFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All payment modes\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-modes\">All payment modes</SelectItem>\n                  {uniquePaymentModes.map((mode) => (\n                    <SelectItem key={mode} value={mode}>\n                      {mode.charAt(0).toUpperCase() + mode.slice(1)}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Actions</label>\n              <Button variant=\"outline\" onClick={clearFilters} className=\"w-full\">\n                Clear Filters\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n              <DatePicker\n                selected={startDate}\n                onChange={(date) => setStartDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select start date\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n              <DatePicker\n                selected={endDate}\n                onChange={(date) => setEndDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select end date\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results Summary */}\n      <div className=\"mb-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Showing {filteredEntries.length} of {(expenseEntries || []).length} expense entries\n        </p>\n      </div>\n\n      {/* Entries Table/Cards */}\n      {isMobile ? (\n        <div className=\"space-y-4\">\n          {filteredEntries.map((entry) => (\n            <Card key={entry.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n              <CardContent className=\"pt-4\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg\">{entry.description}</h3>\n                    <p className=\"text-lg font-bold text-green-600\">‚Çπ{formatAmount(entry.amount)}</p>\n                  </div>\n                  <Badge className={getPaymentModeColor(entry.payment_mode)}>\n                    {entry.payment_mode}\n                  </Badge>\n                </div>\n                \n                <div className=\"space-y-2 text-sm\">\n                  {entry.firm_name && <div><strong>Firm:</strong> {entry.firm_name}</div>}\n                  {entry.bill_no && <div><strong>Bill No:</strong> {entry.bill_no}</div>}\n                  {entry.quantity && <div><strong>Quantity:</strong> {entry.quantity}</div>}\n                  {entry.reason && <div><strong>Reason:</strong> {entry.reason}</div>}\n                  <div><strong>Date:</strong> {entry.expense_date ? new Date(entry.expense_date).toLocaleDateString() : 'N/A'}</div>\n                  <div><strong>Approved by:</strong> {entry.approved_by}</div>\n                  {entry.paid_by && <div><strong>Paid by:</strong> {entry.paid_by}</div>}\n                  <div><strong>Created by:</strong> {entry.created_by}</div>\n                  \n                  {/* Attachments */}\n                  {entry.attachment_url && (\n                    <div className=\"space-y-2\">\n                      {(() => {\n                        const { receipt, paymentScreenshot } = parseAttachments(entry.attachment_url);\n                        return (\n                          <div className=\"flex flex-wrap gap-2\">\n                            {receipt && (\n                              <Dialog>\n                                <DialogTrigger asChild>\n                                  <button className=\"flex items-center gap-1 text-blue-600 hover:underline text-sm\">\n                                    <FileText className=\"h-4 w-4\" />\n                                    View Receipt\n                                  </button>\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-2xl\">\n                                  <DialogHeader>\n                                    <DialogTitle>Expense Receipt</DialogTitle>\n                                  </DialogHeader>\n                                  <FilePreview url={receipt} title=\"Expense Receipt\" />\n                                </DialogContent>\n                              </Dialog>\n                            )}\n                            \n                            {paymentScreenshot && entry.payment_mode !== 'cash' && (\n                              <Dialog>\n                                <DialogTrigger asChild>\n                                  <button className=\"flex items-center gap-1 text-green-600 hover:underline text-sm\">\n                                    <Image className=\"h-4 w-4\" />\n                                    Payment Proof\n                                  </button>\n                                </DialogTrigger>\n                                <DialogContent className=\"max-w-2xl\">\n                                  <DialogHeader>\n                                    <DialogTitle>Payment Screenshot</DialogTitle>\n                                  </DialogHeader>\n                                  <FilePreview url={paymentScreenshot} title=\"Payment Screenshot\" />\n                                </DialogContent>\n                              </Dialog>\n                            )}\n                          </div>\n                        );\n                      })()}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Firm/Bill</TableHead>\n                  <TableHead>Amount</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Payment Mode</TableHead>\n                  <TableHead>Approved By</TableHead>\n                  <TableHead>Paid By</TableHead>\n                  <TableHead>Receipt</TableHead>\n                  <TableHead>Payment Proof</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredEntries.map((entry) => (\n                  <TableRow key={entry.id}>\n                    <TableCell className=\"font-medium\">\n                      <div>{entry.description}</div>\n                      {entry.reason && <div className=\"text-xs text-muted-foreground\">{entry.reason}</div>}\n                    </TableCell>\n                    <TableCell>\n                      {entry.firm_name && <div className=\"font-medium\">{entry.firm_name}</div>}\n                      {entry.bill_no && <div className=\"text-xs text-muted-foreground\">Bill: {entry.bill_no}</div>}\n                      {entry.bill_date && <div className=\"text-xs text-muted-foreground\">{new Date(entry.bill_date).toLocaleDateString()}</div>}\n                      {!entry.firm_name && !entry.bill_no && !entry.bill_date && <span className=\"text-muted-foreground\">-</span>}\n                    </TableCell>\n                    <TableCell className=\"font-bold text-green-600\">\n                      ‚Çπ{formatAmount(entry.amount)}\n                      {entry.quantity && <div className=\"text-xs text-muted-foreground\">Qty: {entry.quantity}</div>}\n                    </TableCell>\n                    <TableCell>{entry.expense_date ? new Date(entry.expense_date).toLocaleDateString() : 'N/A'}</TableCell>\n                    <TableCell>\n                      <Badge className={getPaymentModeColor(entry.payment_mode)}>\n                        {entry.payment_mode}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{entry.approved_by}</TableCell>\n                    <TableCell>{entry.paid_by || entry.approved_by}</TableCell>\n                    \n                    {/* Receipt Column */}\n                    <TableCell>\n                      {(() => {\n                        const { receipt } = parseAttachments(entry.attachment_url);\n                        return receipt ? (\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <button className=\"flex items-center gap-1 text-blue-600 hover:underline\">\n                                <Eye className=\"h-4 w-4\" />\n                                View\n                              </button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-2xl\">\n                              <DialogHeader>\n                                <DialogTitle>Expense Receipt</DialogTitle>\n                              </DialogHeader>\n                              <FilePreview url={receipt} title=\"Expense Receipt\" />\n                            </DialogContent>\n                          </Dialog>\n                        ) : (\n                          <span className=\"text-muted-foreground\">No receipt</span>\n                        );\n                      })()}\n                    </TableCell>\n                    \n                    {/* Payment Proof Column */}\n                    <TableCell>\n                      {(() => {\n                        const { paymentScreenshot } = parseAttachments(entry.attachment_url);\n                        if (entry.payment_mode === 'cash') {\n                          return <span className=\"text-muted-foreground\">Not required</span>;\n                        }\n                        \n                        return paymentScreenshot ? (\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <button className=\"flex items-center gap-1 text-green-600 hover:underline\">\n                                <Eye className=\"h-4 w-4\" />\n                                View\n                              </button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-2xl\">\n                              <DialogHeader>\n                                <DialogTitle>Payment Screenshot</DialogTitle>\n                              </DialogHeader>\n                              <FilePreview url={paymentScreenshot} title=\"Payment Screenshot\" />\n                            </DialogContent>\n                          </Dialog>\n                        ) : (\n                          <span className=\"text-red-500\">Missing</span>\n                        );\n                      })()}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      )}\n\n      {filteredEntries.length === 0 && !isLoading && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-lg text-muted-foreground\">No expense entries found.</p>\n          <Button onClick={() => setLocation('/expense-entry-form')} className=\"mt-4\">\n            Add First Expense Entry\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":19895},"server/investigate-duplicates.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\n\nasync function investigateDuplicates() {\n  try {\n    console.log('Reading differential Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'Address_Mobile_Differential_Users.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} users in differential file`);\n\n    // Get all database users\n    const dbUsers = await db.select().from(users);\n    console.log(`Found ${dbUsers.length} users in database`);\n\n    // Check first 5 users for detailed comparison\n    console.log('\\n=== DETAILED COMPARISON OF FIRST 5 USERS ===');\n    \n    for (let i = 0; i < Math.min(5, excelData.length); i++) {\n      const excelRow = excelData[i];\n      const excelUser = {\n        name: String(excelRow.name || '').trim(),\n        username: String(excelRow.username || '').trim(),\n        email: String(excelRow.email || '').trim().toLowerCase(),\n        mobile: String(excelRow.mobile || '').trim(),\n        address: String(excelRow.address || '').trim()\n      };\n\n      console.log(`\\n--- Excel User ${i + 1} ---`);\n      console.log(`Name: ${excelUser.name}`);\n      console.log(`Username: ${excelUser.username}`);\n      console.log(`Email: ${excelUser.email}`);\n      console.log(`Mobile: ${excelUser.mobile}`);\n      console.log(`Address: ${excelUser.address}`);\n\n      // Find matching database users by different criteria\n      const usernameMatch = dbUsers.find(u => u.username.toLowerCase() === excelUser.username.toLowerCase());\n      const emailMatch = dbUsers.find(u => u.email.toLowerCase() === excelUser.email.toLowerCase());\n      const mobileMatch = dbUsers.find(u => u.mobile.trim() === excelUser.mobile.trim());\n      const addressMatch = dbUsers.find(u => u.address.toLowerCase().trim() === excelUser.address.toLowerCase());\n\n      console.log(`Database matches:`);\n      if (usernameMatch) {\n        console.log(`  Username match: ${usernameMatch.name} (${usernameMatch.username}) - Mobile: ${usernameMatch.mobile}, Address: ${usernameMatch.address}`);\n      } else {\n        console.log(`  Username match: NONE`);\n      }\n      \n      if (emailMatch) {\n        console.log(`  Email match: ${emailMatch.name} (${emailMatch.username})`);\n      } else {\n        console.log(`  Email match: NONE`);\n      }\n      \n      if (mobileMatch) {\n        console.log(`  Mobile match: ${mobileMatch.name} (${mobileMatch.username})`);\n      } else {\n        console.log(`  Mobile match: NONE`);\n      }\n      \n      if (addressMatch) {\n        console.log(`  Address match: ${addressMatch.name} (${addressMatch.username})`);\n      } else {\n        console.log(`  Address match: NONE`);\n      }\n    }\n\n    // Count unique vs duplicate usernames in Excel\n    const excelUsernames = excelData.map(row => String(row.username || '').trim().toLowerCase());\n    const uniqueUsernames = new Set(excelUsernames);\n    console.log(`\\n=== USERNAME ANALYSIS ===`);\n    console.log(`Total users in Excel: ${excelData.length}`);\n    console.log(`Unique usernames in Excel: ${uniqueUsernames.size}`);\n    console.log(`Duplicate usernames in Excel: ${excelData.length - uniqueUsernames.size}`);\n\n    // Check how many Excel usernames already exist in database\n    const dbUsernames = new Set(dbUsers.map(u => u.username.toLowerCase()));\n    const existingCount = excelUsernames.filter(username => dbUsernames.has(username)).length;\n    console.log(`Excel usernames that exist in database: ${existingCount}`);\n    console.log(`Excel usernames that don't exist in database: ${excelUsernames.length - existingCount}`);\n\n  } catch (error) {\n    console.error('Error investigating:', error);\n  }\n}\n\ninvestigateDuplicates();","size_bytes":3959},"client/src/pages/payments.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { PaymentMode, type Entry } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport DatePicker from \"react-datepicker\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { exportBoliPayments } from \"@/lib/excel-export\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Edit } from \"lucide-react\";\n\n// Helper function to format dates from ISO string to DD/MM/YYYY format\nconst formatDate = (isoString: string) => {\n  if (!isoString) return \"N/A\";\n  const date = new Date(isoString);\n  return date.toLocaleDateString('en-IN');\n};\n\n// WhatsApp notification function for payments\nconst sendWhatsAppPaymentNotification = (payment: any) => {\n  // Clean phone number (remove spaces, dashes, parentheses)\n  const cleanNumber = payment.userMobile?.replace(/[\\s\\-\\(\\)]/g, '');\n  \n  if (!cleanNumber) {\n    alert('No phone number available for this user');\n    return;\n  }\n  \n  // Format phone number for WhatsApp (ensure it starts with country code)\n  let formattedNumber = cleanNumber;\n  if (!formattedNumber.startsWith('91') && formattedNumber.length === 10) {\n    formattedNumber = '91' + formattedNumber; // Add India country code\n  }\n  \n  // Calculate payment amounts breakdown\n  const paymentAmounts = payment.entry?.payments?.map((p: any) => `‚Çπ${p.amount}`) || [];\n  const paymentAmountsText = paymentAmounts.join(' + ');\n  \n  // Calculate receipt numbers breakdown\n  const receiptNumbers = payment.entry?.payments?.map((p: any) => p.receiptNo).filter((r: any) => r) || [];\n  const receiptNumbersText = receiptNumbers.join(' + ');\n\n  // Create payment confirmation message with simple text markers\n  const message = \n    `‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§Ü ‡§π‡•à:\\n\\n` +\n    `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: ${payment.entryDescription}\\n` +\n    `üóìÔ∏è ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(payment.date)}\\n` +\n    `üìÖ ‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(payment.entry?.auctionDate) || 'N/A'}\\n` +\n    `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.entry?.totalAmount?.toLocaleString() || 'N/A'}\\n` +\n    `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ${paymentAmountsText}\\n` +\n    `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${payment.entry?.pendingAmount?.toLocaleString() || 'N/A'}\\n` +\n    `üí≥ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ: ${payment.mode}\\n` +\n    `üßæ ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞: ${receiptNumbersText || 'N/A'}\\n\\n` +\n    `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n  \n  // Create WhatsApp URL using different encoding approach\n  const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedNumber}&text=${encodeURIComponent(message)}`;\n  \n  // Open WhatsApp in new tab/window\n  window.open(whatsappUrl, '_blank');\n};\n\nexport default function Payments() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateRange, setDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [filterByMode, setFilterByMode] = useState(\"\");\n  \n  // Edit upload state\n  const [editUploadState, setEditUploadState] = useState<{\n    isOpen: boolean;\n    entryId: number | null;\n    paymentIndex: number | null;\n  }>({\n    isOpen: false,\n    entryId: null,\n    paymentIndex: null\n  });\n  \n  const [uploadFile, setUploadFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  \n  // Edit payment state\n  const [editPaymentState, setEditPaymentState] = useState<{\n    isOpen: boolean;\n    payment: any | null;\n    entryId: number | null;\n    paymentIndex: number | null;\n  }>({\n    isOpen: false,\n    payment: null,\n    entryId: null,\n    paymentIndex: null\n  });\n  \n  const [editFormData, setEditFormData] = useState({\n    date: '',\n    amount: '',\n    mode: '',\n    file: null as File | null\n  });\n  const [isEditingPayment, setIsEditingPayment] = useState(false);\n\n// Handle file upload for editing payment screenshot\nconst handleUploadFile = async (entryId: number, paymentIndex: number, file: File) => {\n  if (!file) return;\n  \n  setIsUploading(true);\n  \n  try {\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('entryId', entryId.toString());\n    formData.append('paymentIndex', paymentIndex.toString());\n    \n    const response = await fetch('/api/payments/update-attachment', {\n      method: 'POST',\n      body: formData,\n    });\n    \n    if (!response.ok) {\n      throw new Error('Failed to update attachment');\n    }\n    \n    // Refresh the data\n    await queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n    await queryClient.refetchQueries({ queryKey: ['/api/entries'] });\n    \n    toast({\n      title: \"Success\",\n      description: \"Payment attachment updated successfully\",\n    });\n    \n    // Close dialog and reset state\n    setEditUploadState({ isOpen: false, entryId: null, paymentIndex: null });\n    setUploadFile(null);\n  } catch (error: any) {\n    toast({\n      title: \"Error\",\n      description: error.message || \"Failed to update attachment\",\n      variant: \"destructive\",\n    });\n  } finally {\n    setIsUploading(false);\n  }\n};\n\n  // Hindi Receipt state\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: any | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  \n  // Fetch all entries to extract payments\n  const { data: entries, isLoading } = useQuery<Entry[]>({\n    queryKey: ['/api/entries']\n  });\n  \n  // Flatten all payments from all entries\n  const allPayments = entries?.flatMap(entry => entry.payments.map((payment, paymentIndex) => ({\n    ...payment,\n    entryId: entry.id,\n    paymentIndex,\n    entryDescription: entry.description,\n    userName: entry.userName,\n    userMobile: entry.userMobile,\n    entry: entry // Add entry reference for Hindi receipt\n  }))) || [];\n  \n  // Sort all payments by receipt number in descending order\n  const sortedPayments = [...allPayments].sort((a, b) => {\n    // Extract receipt numbers (format: SPDJMSJ-2025-00001)\n    const getReceiptNumber = (receiptNo: string) => {\n      if (!receiptNo) return 0;\n      const match = receiptNo.match(/SPDJMSJ-\\d{4}-(\\d{5})/);\n      return match ? parseInt(match[1], 10) : 0;\n    };\n    \n    const aNum = getReceiptNumber(a.receiptNo || '');\n    const bNum = getReceiptNumber(b.receiptNo || '');\n    \n    // If both have valid receipt numbers, sort by them\n    if (aNum > 0 && bNum > 0) {\n      return bNum - aNum; // Descending order\n    }\n    \n    // If only one has a receipt number, prioritize it\n    if (aNum > 0) return -1;\n    if (bNum > 0) return 1;\n    \n    // If neither has receipt numbers, sort by date (fallback)\n    return new Date(b.date).getTime() - new Date(a.date).getTime();\n  });\n  \n  // Apply filters\n  const filteredPayments = sortedPayments.filter(payment => {\n    // Search filter (case insensitive)\n    const searchMatches = !searchQuery || \n      payment.entryDescription?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      payment.userName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      payment.userMobile?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    // Date range filter\n    let dateMatches = true;\n    if (dateRange[0] || dateRange[1]) {\n      const paymentDate = new Date(payment.date);\n      \n      if (dateRange[0]) {\n        // Start date is set, check if payment date is on or after it\n        const startDate = new Date(dateRange[0]);\n        startDate.setHours(0, 0, 0, 0);\n        if (paymentDate < startDate) {\n          dateMatches = false;\n        }\n      }\n      \n      if (dateRange[1]) {\n        // End date is set, check if payment date is on or before it\n        const endDate = new Date(dateRange[1]);\n        // Set to end of day to include the full day\n        endDate.setHours(23, 59, 59, 999);\n        if (paymentDate > endDate) {\n          dateMatches = false;\n        }\n      }\n    }\n    \n    // Mode filter\n    const modeMatches = !filterByMode || filterByMode === 'all' || payment.mode === filterByMode;\n    \n    return searchMatches && dateMatches && modeMatches;\n  });\n\n  // Function to delete a payment\n  const handleDeletePayment = async (entryId: number, paymentIndex: number) => {\n    if (confirm(\"Are you sure you want to delete this payment record? This will be logged as a credit entry.\")) {\n      try {\n        // Make API call to delete the payment\n        const response = await fetch(`/api/entries/${entryId}/payments/${paymentIndex}`, { \n          method: 'DELETE' \n        });\n        \n        if (!response.ok) {\n          throw new Error('Failed to delete payment');\n        }\n        \n        toast({\n          title: \"Payment Deleted\",\n          description: \"The payment record has been deleted and logged as a credit.\"\n        });\n        \n        // Refresh all relevant data\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n      } catch (error) {\n        console.error('Error deleting payment:', error);\n        toast({\n          title: \"Error\",\n          description: \"Failed to delete payment record\",\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n  \n  // Function to open edit payment dialog\n  const openEditPaymentDialog = (payment: any, entryId: number, paymentIndex: number) => {\n    setEditPaymentState({\n      isOpen: true,\n      payment,\n      entryId,\n      paymentIndex\n    });\n    \n    // Pre-fill form data\n    setEditFormData({\n      date: payment.date ? new Date(payment.date).toISOString().split('T')[0] : '',\n      amount: payment.amount.toString(),\n      mode: payment.mode,\n      file: null\n    });\n  };\n  \n  // Function to handle payment edit submission\n  const handleEditPayment = async () => {\n    if (!editPaymentState.entryId || editPaymentState.paymentIndex === null) return;\n    \n    setIsEditingPayment(true);\n    \n    try {\n      const formData = new FormData();\n      \n      // Add fields based on user role\n      if (user?.role === 'admin') {\n        formData.append('date', editFormData.date);\n        formData.append('amount', editFormData.amount);\n        formData.append('mode', editFormData.mode);\n      } else {\n        // Operators can only edit mode\n        formData.append('mode', editFormData.mode);\n      }\n      \n      // Add file if present\n      if (editFormData.file) {\n        formData.append('file', editFormData.file);\n      }\n      \n      const response = await fetch(\n        `/api/entries/${editPaymentState.entryId}/payments/${editPaymentState.paymentIndex}`, \n        { \n          method: 'PATCH',\n          body: formData\n        }\n      );\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to edit payment');\n      }\n      \n      toast({\n        title: \"Payment Updated\",\n        description: \"The payment record has been updated successfully.\"\n      });\n      \n      // Close dialog and reset state\n      setEditPaymentState({ isOpen: false, payment: null, entryId: null, paymentIndex: null });\n      setEditFormData({ date: '', amount: '', mode: '', file: null });\n      \n      // Refresh all relevant data\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n    } catch (error: any) {\n      console.error('Error editing payment:', error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to edit payment record\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsEditingPayment(false);\n    }\n  };\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading payments...</div>;\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-xl font-medium\">All Boli Payments</h1>\n          <p className=\"text-sm text-neutral-500\">View all recorded boli payments</p>\n        </div>\n        <Button \n          onClick={() => exportBoliPayments(filteredPayments)}\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100 rounded-full shadow-sm flex gap-2 items-center\"\n        >\n          <span className=\"text-sm\">üìä</span>\n          <span>Export</span>\n        </Button>\n      </div>\n      \n      {/* Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow-md mb-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Search */}\n          <div>\n            <Label htmlFor=\"search\" className=\"mb-1 block\">Search</Label>\n            <div className=\"relative\">\n              <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n                <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n              </span>\n              <Input \n                id=\"search\"\n                placeholder=\"Search by description or user\" \n                className=\"pl-10 pr-4 py-2\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n              />\n            </div>\n          </div>\n          \n          {/* Date Range Filter */}\n          <div>\n            <Label htmlFor=\"dateFilter\" className=\"mb-1 block\">Date Range</Label>\n            <div className=\"datepicker-container w-full\">\n              <DatePicker\n                selectsRange={true}\n                startDate={dateRange[0]}\n                endDate={dateRange[1]}\n                onChange={(update) => {\n                  setDateRange(update);\n                }}\n                isClearable={true}\n                placeholderText=\"Select date range\"\n                className=\"w-full border rounded-md p-2 text-sm\"\n                dateFormat=\"MMM d, yyyy\"\n                monthsShown={2}\n                showMonthYearPicker={false}\n                calendarStartDay={1}\n                fixedHeight\n                renderMonthContent={(month, shortMonth) => <div>{shortMonth}</div>}\n                renderCustomHeader={({\n                  date,\n                  decreaseMonth,\n                  increaseMonth,\n                  prevMonthButtonDisabled,\n                  nextMonthButtonDisabled,\n                }) => (\n                  <div className=\"flex items-center justify-between px-2 py-2\">\n                    <button\n                      onClick={decreaseMonth}\n                      disabled={prevMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_left</span>\n                    </button>\n                    <div className=\"text-lg font-medium\">\n                      {date.toLocaleDateString('en-US', {\n                        month: 'long',\n                        year: 'numeric',\n                      })}\n                    </div>\n                    <button\n                      onClick={increaseMonth}\n                      disabled={nextMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_right</span>\n                    </button>\n                  </div>\n                )}\n              />\n            </div>\n          </div>\n          \n          {/* Payment Mode Filter */}\n          <div>\n            <Label htmlFor=\"modeFilter\" className=\"mb-1 block\">Payment Mode</Label>\n            <Select\n              value={filterByMode}\n              onValueChange={setFilterByMode}\n            >\n              <SelectTrigger id=\"modeFilter\">\n                <SelectValue placeholder=\"All payment modes\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All payment modes</SelectItem>\n                <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </div>\n      \n      {/* Payment list - desktop view */}\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden hidden md:block\">\n        <table className=\"w-full\">\n          <thead className=\"bg-neutral-100 text-left\">\n            <tr>\n              <th className=\"px-4 py-3 font-medium\">Date</th>\n              <th className=\"px-4 py-3 font-medium\">Receipt No.</th>\n              <th className=\"px-4 py-3 font-medium\">Description</th>\n              <th className=\"px-4 py-3 font-medium\">User</th>\n              <th className=\"px-4 py-3 font-medium\">Amount</th>\n              <th className=\"px-4 py-3 font-medium\">Mode</th>\n              <th className=\"px-4 py-3 font-medium\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filteredPayments.length === 0 ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-4 text-center text-neutral-500\">\n                  No payment records found\n                </td>\n              </tr>\n            ) : (\n              filteredPayments.map((payment, index) => (\n                <tr key={`${payment.entryId}-${index}`} className=\"border-t border-neutral-200\">\n                  <td className=\"px-4 py-3\">{formatDate(payment.date)}</td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"text-sm font-medium\">\n                      {payment.receiptNo || 'N/A'}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <Button \n                      variant=\"link\" \n                      className=\"p-0 h-auto text-blue-600 font-medium\"\n                      onClick={() => setLocation(`/entries/${payment.entryId}`)}\n                    >\n                      {payment.entryDescription}\n                    </Button>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div>\n                      <div>{payment.userName}</div>\n                      {payment.userMobile && (\n                        <div className=\"text-xs text-neutral-500\">üì± {payment.userMobile}</div>\n                      )}\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 font-medium text-green-500\">\n                    ‚Çπ{payment.amount.toLocaleString()}\n                  </td>\n                  <td className=\"px-4 py-3\">{payment.mode}</td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center gap-2\">\n                      {/* Hindi Receipt Button */}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-blue-600\"\n                        onClick={() => {\n                          setHindiReceiptState({\n                            isOpen: true,\n                            entry: payment.entry,\n                            payment: payment,\n                            paymentIndex: payment.paymentIndex\n                          });\n                        }}\n                      >\n                        Hindi Receipt\n                      </Button>\n                      \n                      {/* WhatsApp Button */}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-green-600\"\n                        onClick={() => sendWhatsAppPaymentNotification(payment)}\n                      >\n                        WhatsApp\n                      </Button>\n                      \n                      {/* View Payment Screenshot Button (if available) */}\n                      {payment.fileUrl && (\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              className=\"text-blue-600\"\n                            >\n                              View Upload\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-3xl\">\n                            <DialogHeader>\n                              <DialogTitle>Payment Upload</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"flex justify-center p-2\">\n                              <img \n                                src={payment.fileUrl}\n                                alt=\"Payment upload\" \n                                className=\"max-h-[70vh] object-contain\"\n                              />\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      )}\n                      \n                      {/* Edit Upload Button (Admin Only) */}\n                      {user?.role === 'admin' && payment.fileUrl && (\n                        <Dialog \n                          open={editUploadState.isOpen && editUploadState.entryId === payment.entryId && editUploadState.paymentIndex === payment.paymentIndex}\n                          onOpenChange={(open) => {\n                            if (open) {\n                              setEditUploadState({\n                                isOpen: true,\n                                entryId: payment.entryId,\n                                paymentIndex: payment.paymentIndex\n                              });\n                            } else {\n                              setEditUploadState({ isOpen: false, entryId: null, paymentIndex: null });\n                              setUploadFile(null);\n                            }\n                          }}\n                        >\n                          <DialogTrigger asChild>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              className=\"text-orange-600\"\n                            >\n                              <Edit className=\"h-4 w-4 mr-1\" />\n                              Edit Upload\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent>\n                            <DialogHeader>\n                              <DialogTitle>Update Payment Screenshot</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"space-y-4\">\n                              <div>\n                                <Label htmlFor=\"payment-file\">Select New Screenshot</Label>\n                                <Input\n                                  id=\"payment-file\"\n                                  type=\"file\"\n                                  accept=\"image/*,.pdf\"\n                                  onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n                                  className=\"mt-2\"\n                                />\n                              </div>\n                              \n                              {uploadFile && (\n                                <div className=\"text-sm text-gray-600\">\n                                  Selected: {uploadFile.name}\n                                </div>\n                              )}\n                              \n                              <div className=\"flex justify-end gap-2\">\n                                <Button \n                                  variant=\"outline\"\n                                  onClick={() => {\n                                    setEditUploadState({ isOpen: false, entryId: null, paymentIndex: null });\n                                    setUploadFile(null);\n                                  }}\n                                >\n                                  Cancel\n                                </Button>\n                                <Button\n                                  onClick={() => handleUploadFile(payment.entryId, payment.paymentIndex, uploadFile!)}\n                                  disabled={!uploadFile || isUploading}\n                                >\n                                  {isUploading ? 'Uploading...' : 'Update Screenshot'}\n                                </Button>\n                              </div>\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      )}\n                      \n                      {/* Edit and Delete Controls - Admin and Operator */}\n                      {(user?.role === 'admin' || user?.role === 'operator') && (\n                        <>\n                          {/* Edit Payment Button */}\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"text-blue-600\"\n                            onClick={() => openEditPaymentDialog(payment, payment.entryId, payment.paymentIndex)}\n                            data-testid={`button-edit-payment-${payment.entryId}-${payment.paymentIndex}`}\n                          >\n                            <Edit className=\"h-4 w-4 mr-1\" />\n                            Edit\n                          </Button>\n                        </>\n                      )}\n                      \n                      {/* Delete Control - Admin Only */}\n                      {user?.role === 'admin' && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-red-600\"\n                          onClick={() => handleDeletePayment(payment.entryId, payment.paymentIndex)}\n                          data-testid={`button-delete-payment-${payment.entryId}-${payment.paymentIndex}`}\n                        >\n                          <span className=\"material-icons text-sm\">delete</span>\n                          <span className=\"sr-only\">Delete</span>\n                        </Button>\n                      )}\n                    </div>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n      \n      {/* Payment list - mobile view */}\n      <div className=\"md:hidden space-y-4\">\n        {filteredPayments.length === 0 ? (\n          <div className=\"bg-white p-4 rounded-lg shadow text-center text-neutral-500\">\n            No payment records found\n          </div>\n        ) : (\n          filteredPayments.map((payment, index) => (\n            <Card key={`${payment.entryId}-${index}`} className=\"overflow-hidden\">\n              <CardContent className=\"p-0\">\n                <div className=\"bg-primary text-white p-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <div>\n                      <h3 className=\"font-medium\">{payment.entryDescription}</h3>\n                      <p className=\"text-sm opacity-90\">{payment.userName}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-bold\">‚Çπ{payment.amount.toLocaleString()}</div>\n                      <div className=\"text-xs\">{formatDate(payment.date)}</div>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"p-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <div>\n                      <p className=\"text-sm text-neutral-500\">Receipt No:</p>\n                      <p className=\"font-medium\">{payment.receiptNo || 'N/A'}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-neutral-500\">Mode:</p>\n                      <p className=\"font-medium\">{payment.mode}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-3 pt-3 border-t flex justify-between\">\n                    <Button \n                      variant=\"link\" \n                      className=\"p-0 h-auto text-blue-600 text-sm\"\n                      onClick={() => setLocation(`/entries/${payment.entryId}`)}\n                    >\n                      View Entry\n                    </Button>\n                    \n                    <div className=\"flex space-x-2\">\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-blue-600 text-xs\"\n                        onClick={() => {\n                          setHindiReceiptState({\n                            isOpen: true,\n                            entry: payment.entry,\n                            payment: payment,\n                            paymentIndex: payment.paymentIndex\n                          });\n                        }}\n                      >\n                        Hindi Receipt\n                      </Button>\n                      \n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-green-600 text-xs\"\n                        onClick={() => sendWhatsAppPaymentNotification(payment)}\n                      >\n                        WhatsApp\n                      </Button>\n                      \n                      {payment.fileUrl && (\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              className=\"text-blue-600 text-xs\"\n                            >\n                              View Upload\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-3xl\">\n                            <DialogHeader>\n                              <DialogTitle>Payment Upload</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"flex justify-center p-2\">\n                              <img \n                                src={payment.fileUrl}\n                                alt=\"Payment upload\" \n                                className=\"max-h-[70vh] object-contain\"\n                              />\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      )}\n                      \n                      {/* Edit Upload Button for Mobile (Admin Only) */}\n                      {user?.role === 'admin' && payment.fileUrl && (\n                        <Dialog \n                          open={editUploadState.isOpen && editUploadState.entryId === payment.entryId && editUploadState.paymentIndex === payment.paymentIndex}\n                          onOpenChange={(open) => {\n                            if (open) {\n                              setEditUploadState({\n                                isOpen: true,\n                                entryId: payment.entryId,\n                                paymentIndex: payment.paymentIndex\n                              });\n                            } else {\n                              setEditUploadState({ isOpen: false, entryId: null, paymentIndex: null });\n                              setUploadFile(null);\n                            }\n                          }}\n                        >\n                          <DialogTrigger asChild>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              className=\"text-orange-600 text-xs\"\n                            >\n                              <Edit className=\"h-3 w-3 mr-1\" />\n                              Edit\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent>\n                            <DialogHeader>\n                              <DialogTitle>Update Payment Screenshot</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"space-y-4\">\n                              <div>\n                                <Label htmlFor=\"payment-file-mobile\">Select New Screenshot</Label>\n                                <Input\n                                  id=\"payment-file-mobile\"\n                                  type=\"file\"\n                                  accept=\"image/*,.pdf\"\n                                  onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n                                  className=\"mt-2\"\n                                />\n                              </div>\n                              \n                              {uploadFile && (\n                                <div className=\"text-sm text-gray-600\">\n                                  Selected: {uploadFile.name}\n                                </div>\n                              )}\n                              \n                              <div className=\"flex justify-end gap-2\">\n                                <Button \n                                  variant=\"outline\"\n                                  onClick={() => {\n                                    setEditUploadState({ isOpen: false, entryId: null, paymentIndex: null });\n                                    setUploadFile(null);\n                                  }}\n                                >\n                                  Cancel\n                                </Button>\n                                <Button\n                                  onClick={() => handleUploadFile(payment.entryId, payment.paymentIndex, uploadFile!)}\n                                  disabled={!uploadFile || isUploading}\n                                >\n                                  {isUploading ? 'Updating...' : 'Update Screenshot'}\n                                </Button>\n                              </div>\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      )}\n                      \n                      {/* Edit Payment Button for Mobile (Admin and Operator) */}\n                      {(user?.role === 'admin' || user?.role === 'operator') && (\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          className=\"text-blue-600 text-xs\"\n                          onClick={() => openEditPaymentDialog(payment, payment.entryId, payment.paymentIndex)}\n                          data-testid={`button-edit-payment-mobile-${payment.entryId}-${payment.paymentIndex}`}\n                        >\n                          <Edit className=\"h-3 w-3 mr-1\" />\n                          Edit Payment\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n      \n      {/* Edit Payment Dialog */}\n      <Dialog \n        open={editPaymentState.isOpen}\n        onOpenChange={(open) => {\n          if (!open) {\n            setEditPaymentState({ isOpen: false, payment: null, entryId: null, paymentIndex: null });\n            setEditFormData({ date: '', amount: '', mode: '', file: null });\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Payment</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {user?.role === 'admin' ? (\n              <>\n                {/* Admin can edit all fields */}\n                <div>\n                  <Label htmlFor=\"edit-payment-date\">Payment Date</Label>\n                  <Input\n                    id=\"edit-payment-date\"\n                    type=\"date\"\n                    value={editFormData.date}\n                    onChange={(e) => setEditFormData(prev => ({ ...prev, date: e.target.value }))}\n                    className=\"mt-2\"\n                    data-testid=\"input-edit-payment-date\"\n                  />\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"edit-payment-amount\">Amount</Label>\n                  <Input\n                    id=\"edit-payment-amount\"\n                    type=\"number\"\n                    value={editFormData.amount}\n                    onChange={(e) => setEditFormData(prev => ({ ...prev, amount: e.target.value }))}\n                    className=\"mt-2\"\n                    data-testid=\"input-edit-payment-amount\"\n                  />\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"edit-payment-mode\">Payment Mode</Label>\n                  <Select\n                    value={editFormData.mode}\n                    onValueChange={(value) => setEditFormData(prev => ({ ...prev, mode: value }))}\n                  >\n                    <SelectTrigger id=\"edit-payment-mode\" className=\"mt-2\" data-testid=\"select-edit-payment-mode\">\n                      <SelectValue placeholder=\"Select payment mode\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                      <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                      <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                      <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"edit-payment-file\">\n                    Payment Screenshot {editPaymentState.payment?.mode === PaymentMode.CASH && editFormData.mode !== PaymentMode.CASH && editFormData.mode !== '' ? (\n                      <span className=\"text-red-500\">*</span>\n                    ) : (\n                      <span className=\"text-gray-500\">(Optional)</span>\n                    )}\n                  </Label>\n                  {editPaymentState.payment?.mode === PaymentMode.CASH && editFormData.mode !== PaymentMode.CASH && editFormData.mode !== '' && (\n                    <p className=\"text-sm text-amber-600 mb-2\">\n                      Required when changing from cash to UPI/other modes\n                    </p>\n                  )}\n                  <Input\n                    id=\"edit-payment-file\"\n                    type=\"file\"\n                    accept=\"image/*,.pdf\"\n                    onChange={(e) => setEditFormData(prev => ({ ...prev, file: e.target.files?.[0] || null }))}\n                    className=\"mt-2\"\n                    data-testid=\"input-edit-payment-file\"\n                  />\n                  {editFormData.file && (\n                    <p className=\"text-sm text-gray-600 mt-1\">Selected: {editFormData.file.name}</p>\n                  )}\n                </div>\n              </>\n            ) : (\n              <>\n                {/* Operators can only edit mode */}\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4\">\n                  <p className=\"text-sm text-yellow-800\">\n                    <strong>Note:</strong> As an operator, you can only edit the payment mode. \n                    Date and amount changes require admin access.\n                  </p>\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"edit-payment-mode-operator\">Payment Mode</Label>\n                  <Select\n                    value={editFormData.mode}\n                    onValueChange={(value) => setEditFormData(prev => ({ ...prev, mode: value }))}\n                  >\n                    <SelectTrigger id=\"edit-payment-mode-operator\" className=\"mt-2\" data-testid=\"select-edit-payment-mode-operator\">\n                      <SelectValue placeholder=\"Select payment mode\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                      <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                      <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                      <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                {/* Show file input if changing from cash to non-cash */}\n                {editPaymentState.payment?.mode === PaymentMode.CASH && \n                 editFormData.mode !== PaymentMode.CASH && (\n                  <div>\n                    <Label htmlFor=\"edit-payment-file-operator\">\n                      Payment Screenshot <span className=\"text-red-500\">*</span>\n                    </Label>\n                    <p className=\"text-sm text-gray-600 mb-2\">\n                      Required when changing from cash to UPI/other modes\n                    </p>\n                    <Input\n                      id=\"edit-payment-file-operator\"\n                      type=\"file\"\n                      accept=\"image/*,.pdf\"\n                      onChange={(e) => setEditFormData(prev => ({ ...prev, file: e.target.files?.[0] || null }))}\n                      className=\"mt-2\"\n                      data-testid=\"input-edit-payment-file-operator\"\n                    />\n                    {editFormData.file && (\n                      <p className=\"text-sm text-gray-600 mt-1\">Selected: {editFormData.file.name}</p>\n                    )}\n                  </div>\n                )}\n              </>\n            )}\n            \n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button \n                variant=\"outline\"\n                onClick={() => {\n                  setEditPaymentState({ isOpen: false, payment: null, entryId: null, paymentIndex: null });\n                  setEditFormData({ date: '', amount: '', mode: '', file: null });\n                }}\n                disabled={isEditingPayment}\n                data-testid=\"button-cancel-edit-payment\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={handleEditPayment}\n                disabled={isEditingPayment}\n                data-testid=\"button-save-edit-payment\"\n              >\n                {isEditingPayment ? 'Saving...' : 'Save Changes'}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n      \n      {/* Hindi Receipt Component */}\n      {hindiReceiptState.isOpen && hindiReceiptState.entry && hindiReceiptState.payment && (\n        <HindiReceipt\n          entry={hindiReceiptState.entry}\n          payment={hindiReceiptState.payment}\n          paymentIndex={hindiReceiptState.paymentIndex}\n          isOpen={hindiReceiptState.isOpen}\n          onClose={() => setHindiReceiptState({\n            isOpen: false,\n            entry: null,\n            payment: null,\n            paymentIndex: -1\n          })}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":44798},"client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5615},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7361},"local-deployment/client/src/pages/dravya-entry-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Plus } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { EntryType, UnitOfMeasurement, PaymentStatus, type User } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\nexport default function DravyaEntryForm() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  // Form state\n  const [selectedUserId, setSelectedUserId] = useState<number>(0);\n  const [userName, setUserName] = useState(\"\");\n  const [userMobile, setUserMobile] = useState(\"\");\n  const [userAddress, setUserAddress] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  // Removed amount, quantity, and unitOfMeasurement - not needed for dravya entries\n  const [occasion, setOccasion] = useState(\"\");\n  const [boliDate, setBoliDate] = useState(new Date().toISOString().split('T')[0]);\n\n  // Fetch users for selection\n  const { data: users, error: usersError } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  // No need for quantity/UOM logic in dravya entries\n\n  const createEntryMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch('/api/dravya-entries', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create dravya entry');\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (createdEntry) => {\n      // Dravya entries are spiritual donations - successfully created\n      toast({\n        title: \"Success\",\n        description: `Dravya entry created successfully for ${createdEntry.user_name || 'the selected user'}.`,\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/dravya-entries'] });\n      \n      // Clear form\n      setSelectedUserId(0);\n      setUserName(\"\");\n      setUserMobile(\"\");\n      setUserAddress(\"\");\n      setDescription(\"\");\n      setOccasion(\"\");\n      setBoliDate(new Date().toISOString().split('T')[0]);\n      \n      // Navigate to list\n      setTimeout(() => setLocation('/dravya-entries'), 1000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create dravya entry\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleUserChange = (userId: string) => {\n    const selectedUser = users?.find(u => u.id === parseInt(userId));\n    if (selectedUser) {\n      setSelectedUserId(selectedUser.id);\n      setUserName(selectedUser.name);\n      setUserMobile(selectedUser.mobile || \"\");\n      setUserAddress(selectedUser.address || \"\");\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Basic validation\n    if (selectedUserId <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!description.trim()) {\n      toast({\n        title: \"Error\", \n        description: \"Please provide a description\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Simplified payload for dravya entries - only essential fields\n    const payload = {\n      userId: selectedUserId,\n      userName,\n      userMobile,\n      userAddress,\n      description: description.trim(),\n      occasion: occasion.trim(),\n      entryDate: boliDate,\n      createdBy: user?.username || \"system\",\n    };\n\n    createEntryMutation.mutate(payload);\n  };\n\n  if (usersError) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center text-red-500\">\n              <p>Error loading users. Please refresh the page and try again.</p>\n              <Button onClick={() => window.location.reload()} className=\"mt-4\">\n                Refresh Page\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can create Dravya entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/dravya-entries')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Dravya Entries\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Plus className=\"h-5 w-5\" />\n            Create New Dravya Entry\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Dravya entries are spiritual donations that don't require quantity or amount tracking.\n          </p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"user\">Name of User *</Label>\n              <UserSelect\n                value={selectedUserId > 0 ? selectedUserId : undefined}\n                onValueChange={(userId) => {\n                  if (userId) {\n                    const selectedUser = users?.find(u => u.id === userId);\n                    if (selectedUser) {\n                      setSelectedUserId(selectedUser.id);\n                      setUserName(selectedUser.name);\n                      setUserMobile(selectedUser.mobile || \"\");\n                      setUserAddress(selectedUser.address || \"\");\n                    }\n                  } else {\n                    setSelectedUserId(0);\n                    setUserName(\"\");\n                    setUserMobile(\"\");\n                    setUserAddress(\"\");\n                  }\n                }}\n                placeholder=\"Search and select user\"\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Line Item Description */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Line Item Description *</Label>\n              <Input \n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"Enter item description\"\n              />\n            </div>\n\n            {/* Quantity and UOM removed - not needed for dravya entries */}\n\n            {/* Occasion */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"occasion\">Occasion</Label>\n              <Input \n                id=\"occasion\"\n                value={occasion}\n                onChange={(e) => setOccasion(e.target.value)}\n                placeholder=\"Enter occasion (optional)\"\n              />\n            </div>\n\n            {/* Date of Entry */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"date\">Date of Entry *</Label>\n              <Input \n                id=\"date\"\n                type=\"date\" \n                value={boliDate}\n                onChange={(e) => setBoliDate(e.target.value)}\n              />\n            </div>\n\n            {/* Amount removed - not needed for dravya entries */}\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setLocation('/dravya-entries')}\n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createEntryMutation.isPending}\n                className=\"flex-1\"\n              >\n                {createEntryMutation.isPending ? \"Creating...\" : \"Create Dravya Entry\"}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8911},"local-deployment/server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"client/src/components/previous-outstanding-section.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Eye, Edit, FileText } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\ninterface PreviousOutstandingRecord {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  attachmentUrl?: string;\n  attachmentName?: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PreviousOutstandingSectionProps {\n  userId: number;\n}\n\nexport function PreviousOutstandingSection({ userId }: PreviousOutstandingSectionProps) {\n  const [, setLocation] = useLocation();\n  const { user, isLoading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [editingRecord, setEditingRecord] = useState<PreviousOutstandingRecord | null>(null);\n  const [editAmount, setEditAmount] = useState<string>(\"\");\n  const [editUserId, setEditUserId] = useState<string>(\"\");\n  const [editDescription, setEditDescription] = useState<string>(\"\");\n  const [editFile, setEditFile] = useState<File | null>(null);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  \n  // Fetch previous outstanding records for this user\n  const { data: previousOutstandingRecords = [], isLoading } = useQuery<PreviousOutstandingRecord[]>({\n    queryKey: [`/api/previous-outstanding?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  // Fetch users list for admin edit functionality\n  const { data: users = [] } = useQuery<Array<{id: number, name: string, username: string}>>({\n    queryKey: ['/api/users'],\n    enabled: user?.role === 'admin',\n  });\n\n  // State for handling form submission\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const formatAmount = (amountInRupees: number) => {\n    return amountInRupees.toLocaleString('en-IN');\n  };\n\n\n  const getStatusBadge = (status: string, pendingAmount: number) => {\n    if (status === 'full' || pendingAmount <= 0) {\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\">Payment Completed</Badge>;\n    } else if (status === 'partial' && pendingAmount > 0) {\n      return <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\">Partially Paid</Badge>;\n    } else {\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\">Payment Pending</Badge>;\n    }\n  };\n\n  const handleEditClick = (record: PreviousOutstandingRecord) => {\n    setEditingRecord(record);\n    setEditAmount(record.outstandingAmount.toString()); // Amount already in rupees\n    setEditUserId(record.userId.toString());\n    setEditDescription(record.description);\n    setEditFile(null); // Reset file selection\n    setIsEditDialogOpen(true);\n  };\n\n  const handleEditSubmit = async () => {\n    if (!editingRecord || isSubmitting) return;\n    \n    setIsSubmitting(true);\n    \n    const amount = parseFloat(editAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid amount\",\n        variant: \"destructive\"\n      });\n      setIsSubmitting(false);\n      return;\n    }\n\n    const minAmount = editingRecord.receivedAmount; // Amount already in rupees\n    if (amount < minAmount) {\n      toast({\n        title: \"Error\",\n        description: `Amount cannot be less than already received amount of ‚Çπ${minAmount.toLocaleString()}`,\n        variant: \"destructive\"\n      });\n      setIsSubmitting(false);\n      return;\n    }\n\n    try {\n      const originalUserId = editingRecord.userId;\n      const newUserId = parseInt(editUserId);\n      \n      // Create FormData for file upload if file is selected\n      const formData = new FormData();\n      formData.append('recordId', editingRecord.id.toString());\n      formData.append('amount', amount.toString());\n      \n      // Only include fields that admin can edit\n      if (user && user.role === 'admin') {\n        if (originalUserId !== newUserId) {\n          formData.append('userId', newUserId.toString());\n        }\n        if (editDescription !== editingRecord.description) {\n          formData.append('description', editDescription);\n        }\n      }\n      \n      // Both admin and operator can upload files\n      if (editFile) {\n        formData.append('file', editFile);\n      }\n\n      // Use fetch for file upload instead of apiRequest\n      const response = await fetch('/api/previous-outstanding/edit', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to update record');\n      }\n\n      const result = await response.json();\n      \n      toast({\n        title: \"Success\",\n        description: \"Outstanding record updated successfully\",\n      });\n\n      // Refresh the data\n      queryClient.invalidateQueries({ queryKey: [`/api/previous-outstanding?userId=${userId}`] });\n      setIsEditDialogOpen(false);\n      setEditFile(null);\n      \n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update record\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isLoading) {\n    return <div>Loading previous outstanding records...</div>;\n  }\n\n  if (previousOutstandingRecords.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-muted-foreground\">\n        No previous outstanding records found for this user.\n      </div>\n    );\n  }\n\n  const totalOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + record.outstandingAmount, \n    0\n  );\n\n  const totalReceived = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.receivedAmount || 0), \n    0\n  );\n\n  const totalPending = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.pendingAmount ?? 0), \n    0\n  );\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Enhanced Summary */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"p-4 bg-amber-50 rounded-lg border border-amber-200\">\n          <div>\n            <h3 className=\"font-medium text-amber-800\">Total Outstanding</h3>\n            <p className=\"text-xs text-amber-600\">Original amounts</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-amber-800\">‚Çπ{formatAmount(totalOutstanding)}</p>\n            <p className=\"text-xs text-amber-600\">{previousOutstandingRecords.length} records</p>\n          </div>\n        </div>\n\n        <div className=\"p-4 bg-green-50 rounded-lg border border-green-200\">\n          <div>\n            <h3 className=\"font-medium text-green-800\">Total Received</h3>\n            <p className=\"text-xs text-green-600\">Payments made</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-green-800\">‚Çπ{formatAmount(totalReceived)}</p>\n            <p className=\"text-xs text-green-600\">\n              {totalOutstanding > 0 ? Math.round((totalReceived / totalOutstanding) * 100) : 0}% paid\n            </p>\n          </div>\n        </div>\n\n        <div className=\"p-4 bg-red-50 rounded-lg border border-red-200\">\n          <div>\n            <h3 className=\"font-medium text-red-800\">Total Pending</h3>\n            <p className=\"text-xs text-red-600\">Remaining balance</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-2xl font-bold text-red-800\">‚Çπ{formatAmount(totalPending)}</p>\n            <p className=\"text-xs text-red-600\">\n              {totalOutstanding > 0 ? Math.round((totalPending / totalOutstanding) * 100) : 0}% remaining\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Records Table */}\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Description</TableHead>\n              <TableHead>Amount</TableHead>\n              <TableHead>Payment Status</TableHead>\n              <TableHead>Date Added</TableHead>\n              <TableHead>Added By</TableHead>\n              <TableHead>Actions</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {previousOutstandingRecords.map((record) => {\n              // Check if attachment exists and is not empty\n              const hasAttachmentUrl = record.attachmentUrl && record.attachmentUrl.trim() !== '';\n              \n              return (\n                <TableRow key={record.id}>\n                <TableCell className=\"font-medium\">{record.description}</TableCell>\n                <TableCell>\n                  <div className=\"font-medium\">‚Çπ{formatAmount(record.outstandingAmount)}</div>\n                  {(record.receivedAmount || 0) > 0 && (\n                    <div className=\"text-sm text-green-600\">Received: ‚Çπ{formatAmount(record.receivedAmount || 0)}</div>\n                  )}\n                  {(record.pendingAmount ?? 0) > 0 && (\n                    <div className=\"text-sm text-red-600\">Pending: ‚Çπ{formatAmount(record.pendingAmount ?? 0)}</div>\n                  )}\n                </TableCell>\n                <TableCell>\n                  {getStatusBadge(record.status || 'pending', record.pendingAmount ?? 0)}\n                </TableCell>\n                <TableCell>{formatDate(record.createdAt)}</TableCell>\n                <TableCell>{record.createdBy}</TableCell>\n                <TableCell>\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setLocation(`/previous-outstanding/${record.id}/details`)}\n                    >\n                      <Eye className=\"h-4 w-4 mr-1\" />\n                      Details\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleEditClick(record)}\n                    >\n                      <Edit className=\"h-4 w-4 mr-1\" />\n                      Edit\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      disabled={!hasAttachmentUrl}\n                      className={hasAttachmentUrl ? \"text-blue-600 border-blue-600 hover:bg-blue-50\" : \"\"}\n                      onClick={async () => {\n                        if (!hasAttachmentUrl) return;\n                        \n                        try {\n                          // Check if file exists by making a HEAD request first\n                          const response = await fetch(record.attachmentUrl!, { method: 'HEAD' });\n                          if (response.ok) {\n                            window.open(record.attachmentUrl, '_blank');\n                          } else {\n                            toast({\n                              title: \"File Not Found\",\n                              description: \"The attachment file could not be found. It may have been moved or deleted. Please contact administrator to update the record.\",\n                              variant: \"destructive\"\n                            });\n                          }\n                        } catch (error) {\n                          toast({\n                            title: \"Error\",\n                            description: \"Could not access the attachment file. Please check your connection.\",\n                            variant: \"destructive\"\n                          });\n                        }\n                      }}\n                    >\n                      <FileText className=\"h-4 w-4 mr-1\" />\n                      View File\n                    </Button>\n                  </div>\n                </TableCell>\n              </TableRow>\n              );\n            })}\n          </TableBody>\n        </Table>\n      </div>\n\n      {/* Edit Dialog - Complete Rewrite */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Edit Outstanding Amount</DialogTitle>\n          </DialogHeader>\n          \n          {editingRecord && (\n            <div className=\"space-y-4\">\n              {/* User Field - Show dropdown for admin, readonly for others */}\n              {user?.role === 'admin' ? (\n                <div>\n                  <Label htmlFor=\"user-select\">User</Label>\n                  <Select value={editUserId} onValueChange={setEditUserId}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select user\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {users.map((u) => (\n                        <SelectItem key={u.id} value={u.id.toString()}>\n                          {u.name} ({u.username})\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              ) : (\n                <div>\n                  <Label>User</Label>\n                  <Input\n                    value={editingRecord.userName}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n              \n              {/* Description Field - Editable for admin, readonly for operators */}\n              {user?.role === 'admin' ? (\n                <div>\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Input\n                    id=\"description\"\n                    value={editDescription}\n                    onChange={(e) => setEditDescription(e.target.value)}\n                    placeholder=\"Enter description\"\n                  />\n                </div>\n              ) : (\n                <div>\n                  <Label>Description</Label>\n                  <Input\n                    value={editingRecord.description}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n\n              {/* Already Received - Always Read-only */}\n              <div>\n                <Label>Already Received</Label>\n                <Input\n                  value={`‚Çπ${editingRecord.receivedAmount.toLocaleString()}`}\n                  disabled\n                  className=\"bg-gray-50 text-green-700 font-medium\"\n                />\n              </div>\n\n              {/* Outstanding Amount - Editable for both Admin and Operator */}\n              <div>\n                <Label htmlFor=\"amount\">Outstanding Amount (‚Çπ)</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={editAmount}\n                  onChange={(e) => setEditAmount(e.target.value)}\n                  min={editingRecord.receivedAmount}\n                  step=\"0.01\"\n                  placeholder=\"Enter amount in rupees\"\n                />\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Minimum: ‚Çπ{editingRecord.receivedAmount.toLocaleString()} (already received)\n                </p>\n              </div>\n\n              {/* File Attachment - Editable for both Admin and Operator */}\n              <div>\n                <Label htmlFor=\"file\">Replace Attachment (Optional)</Label>\n                <input\n                  id=\"file\"\n                  type=\"file\"\n                  accept=\".pdf,.jpg,.jpeg,.png,.doc,.docx\"\n                  onChange={(e) => setEditFile(e.target.files?.[0] || null)}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                />\n                {editingRecord.payments && editingRecord.payments.length > 0 && editingRecord.payments[0]?.fileUrl && (\n                  <p className=\"text-sm text-blue-600 mt-1\">\n                    Current: <a href={editingRecord.payments[0].fileUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline\">File attached</a>\n                  </p>\n                )}\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsEditDialogOpen(false);\n                    setEditFile(null);\n                  }}\n                  disabled={isSubmitting}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"button\"\n                  onClick={handleEditSubmit}\n                  disabled={isSubmitting}\n                >\n                  {isSubmitting ? \"Updating...\" : \"Update\"}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":18385},"local-deployment/client/src/pages/payments.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { PaymentMode, type Entry } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport DatePicker from \"react-datepicker\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\n// Helper function to format dates from ISO string to readable format\nconst formatDate = (isoString: string) => {\n  if (!isoString) return \"N/A\";\n  const date = new Date(isoString);\n  return date.toLocaleDateString();\n};\n\n// WhatsApp notification function for payments\nconst sendWhatsAppPaymentNotification = (payment: any) => {\n  // Clean phone number (remove spaces, dashes, parentheses)\n  const cleanNumber = payment.userMobile?.replace(/[\\s\\-\\(\\)]/g, '');\n  \n  if (!cleanNumber) {\n    alert('No phone number available for this user');\n    return;\n  }\n  \n  // Format phone number for WhatsApp (ensure it starts with country code)\n  let formattedNumber = cleanNumber;\n  if (!formattedNumber.startsWith('91') && formattedNumber.length === 10) {\n    formattedNumber = '91' + formattedNumber; // Add India country code\n  }\n  \n  // Calculate payment amounts breakdown\n  const paymentAmounts = payment.entry?.payments?.map((p: any) => `‚Çπ${p.amount}`) || [];\n  const paymentAmountsText = paymentAmounts.join(' + ');\n  \n  // Calculate receipt numbers breakdown\n  const receiptNumbers = payment.entry?.payments?.map((p: any) => p.receiptNo).filter((r: any) => r) || [];\n  const receiptNumbersText = receiptNumbers.join(' + ');\n\n  // Create payment confirmation message with simple text markers\n  const message = \n    `‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•Å‡§Ü ‡§π‡•à:\\n\\n` +\n    `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: ${payment.entryDescription}\\n` +\n    `üóìÔ∏è ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(payment.date)}\\n` +\n    `üìÖ ‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(payment.entryBoliDate) || 'N/A'}\\n` +\n    `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.entry?.totalAmount?.toLocaleString() || 'N/A'}\\n` +\n    `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ${paymentAmountsText}\\n` +\n    `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${payment.entry?.pendingAmount?.toLocaleString() || 'N/A'}\\n` +\n    `üí≥ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ: ${payment.mode}\\n` +\n    `üßæ ‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞: ${receiptNumbersText || 'N/A'}\\n\\n` +\n    `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n  \n  // Create WhatsApp URL using different encoding approach\n  const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedNumber}&text=${encodeURIComponent(message)}`;\n  \n  // Open WhatsApp in new tab/window\n  window.open(whatsappUrl, '_blank');\n};\n\nexport default function Payments() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateRange, setDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [filterByMode, setFilterByMode] = useState(\"\");\n  \n  // Hindi Receipt state\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: any | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  \n  // Fetch all entries to extract payments\n  const { data: entries, isLoading } = useQuery<Entry[]>({\n    queryKey: ['/api/entries']\n  });\n  \n  // Flatten all payments from all entries\n  const allPayments = entries?.flatMap(entry => entry.payments.map((payment, paymentIndex) => ({\n    ...payment,\n    entryId: entry.id,\n    paymentIndex,\n    entryDescription: entry.description,\n    userName: entry.userName,\n    userMobile: entry.userMobile,\n    entry: entry // Add entry reference for Hindi receipt\n  }))) || [];\n  \n  // Sort all payments by date (most recent first)\n  const sortedPayments = [...allPayments].sort((a, b) => \n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n  \n  // Apply filters\n  const filteredPayments = sortedPayments.filter(payment => {\n    // Search filter (case insensitive)\n    const searchMatches = !searchQuery || \n      payment.entryDescription?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      payment.userName?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      payment.userMobile?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    // Date range filter\n    let dateMatches = true;\n    if (dateRange[0] || dateRange[1]) {\n      const paymentDate = new Date(payment.date);\n      \n      if (dateRange[0]) {\n        // Start date is set, check if payment date is on or after it\n        const startDate = new Date(dateRange[0]);\n        startDate.setHours(0, 0, 0, 0);\n        if (paymentDate < startDate) {\n          dateMatches = false;\n        }\n      }\n      \n      if (dateRange[1]) {\n        // End date is set, check if payment date is on or before it\n        const endDate = new Date(dateRange[1]);\n        // Set to end of day to include the full day\n        endDate.setHours(23, 59, 59, 999);\n        if (paymentDate > endDate) {\n          dateMatches = false;\n        }\n      }\n    }\n    \n    // Mode filter\n    const modeMatches = !filterByMode || filterByMode === 'all' || payment.mode === filterByMode;\n    \n    return searchMatches && dateMatches && modeMatches;\n  });\n\n  // Function to delete a payment\n  const handleDeletePayment = async (entryId: number, paymentIndex: number) => {\n    if (confirm(\"Are you sure you want to delete this payment record? This will be logged as a credit entry.\")) {\n      try {\n        // Make API call to delete the payment\n        const response = await fetch(`/api/entries/${entryId}/payments/${paymentIndex}`, { \n          method: 'DELETE' \n        });\n        \n        if (!response.ok) {\n          throw new Error('Failed to delete payment');\n        }\n        \n        toast({\n          title: \"Payment Deleted\",\n          description: \"The payment record has been deleted and logged as a credit.\"\n        });\n        \n        // Refresh all relevant data\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n      } catch (error) {\n        console.error('Error deleting payment:', error);\n        toast({\n          title: \"Error\",\n          description: \"Failed to delete payment record\",\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading payments...</div>;\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-xl font-medium\">All Boli Payments</h1>\n        <p className=\"text-sm text-neutral-500\">View all recorded boli payments</p>\n      </div>\n      \n      {/* Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow-md mb-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Search */}\n          <div>\n            <Label htmlFor=\"search\" className=\"mb-1 block\">Search</Label>\n            <div className=\"relative\">\n              <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n                <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n              </span>\n              <Input \n                id=\"search\"\n                placeholder=\"Search by description or user\" \n                className=\"pl-10 pr-4 py-2\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n              />\n            </div>\n          </div>\n          \n          {/* Date Range Filter */}\n          <div>\n            <Label htmlFor=\"dateFilter\" className=\"mb-1 block\">Date Range</Label>\n            <div className=\"datepicker-container w-full\">\n              <DatePicker\n                selectsRange={true}\n                startDate={dateRange[0]}\n                endDate={dateRange[1]}\n                onChange={(update) => {\n                  setDateRange(update);\n                }}\n                isClearable={true}\n                placeholderText=\"Select date range\"\n                className=\"w-full border rounded-md p-2 text-sm\"\n                dateFormat=\"MMM d, yyyy\"\n                monthsShown={2}\n                showMonthYearPicker={false}\n                calendarStartDay={1}\n                fixedHeight\n                renderMonthContent={(month, shortMonth) => <div>{shortMonth}</div>}\n                renderCustomHeader={({\n                  date,\n                  decreaseMonth,\n                  increaseMonth,\n                  prevMonthButtonDisabled,\n                  nextMonthButtonDisabled,\n                }) => (\n                  <div className=\"flex items-center justify-between px-2 py-2\">\n                    <button\n                      onClick={decreaseMonth}\n                      disabled={prevMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_left</span>\n                    </button>\n                    <div className=\"text-lg font-medium\">\n                      {date.toLocaleDateString('en-US', {\n                        month: 'long',\n                        year: 'numeric',\n                      })}\n                    </div>\n                    <button\n                      onClick={increaseMonth}\n                      disabled={nextMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_right</span>\n                    </button>\n                  </div>\n                )}\n              />\n            </div>\n          </div>\n          \n          {/* Payment Mode Filter */}\n          <div>\n            <Label htmlFor=\"modeFilter\" className=\"mb-1 block\">Payment Mode</Label>\n            <Select\n              value={filterByMode}\n              onValueChange={setFilterByMode}\n            >\n              <SelectTrigger id=\"modeFilter\">\n                <SelectValue placeholder=\"All payment modes\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All payment modes</SelectItem>\n                <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </div>\n      \n      {/* Payment list - desktop view */}\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden hidden md:block\">\n        <table className=\"w-full\">\n          <thead className=\"bg-neutral-100 text-left\">\n            <tr>\n              <th className=\"px-4 py-3 font-medium\">Date</th>\n              <th className=\"px-4 py-3 font-medium\">Receipt No.</th>\n              <th className=\"px-4 py-3 font-medium\">Description</th>\n              <th className=\"px-4 py-3 font-medium\">User</th>\n              <th className=\"px-4 py-3 font-medium\">Amount</th>\n              <th className=\"px-4 py-3 font-medium\">Mode</th>\n              <th className=\"px-4 py-3 font-medium\">Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filteredPayments.length === 0 ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-4 text-center text-neutral-500\">\n                  No payment records found\n                </td>\n              </tr>\n            ) : (\n              filteredPayments.map((payment, index) => (\n                <tr key={`${payment.entryId}-${index}`} className=\"border-t border-neutral-200\">\n                  <td className=\"px-4 py-3\">{formatDate(payment.date)}</td>\n                  <td className=\"px-4 py-3\">\n                    <span className=\"text-sm font-medium\">\n                      {payment.receiptNo || 'N/A'}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <Button \n                      variant=\"link\" \n                      className=\"p-0 h-auto text-blue-600 font-medium\"\n                      onClick={() => setLocation(`/entries/${payment.entryId}`)}\n                    >\n                      {payment.entryDescription}\n                    </Button>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div>\n                      <div>{payment.userName}</div>\n                      {payment.userMobile && (\n                        <div className=\"text-xs text-neutral-500\">üì± {payment.userMobile}</div>\n                      )}\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 font-medium text-green-500\">\n                    ‚Çπ{payment.amount.toLocaleString()}\n                  </td>\n                  <td className=\"px-4 py-3\">{payment.mode}</td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center gap-2\">\n                      {/* Hindi Receipt Button */}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-blue-600\"\n                        onClick={() => {\n                          setHindiReceiptState({\n                            isOpen: true,\n                            entry: payment.entry,\n                            payment: payment,\n                            paymentIndex: payment.paymentIndex\n                          });\n                        }}\n                      >\n                        Hindi Receipt\n                      </Button>\n                      \n                      {/* WhatsApp Button */}\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-green-600\"\n                        onClick={() => sendWhatsAppPaymentNotification(payment)}\n                      >\n                        WhatsApp\n                      </Button>\n                      \n                      {/* View Payment Screenshot Button (if available) */}\n                      {payment.fileUrl && (\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              className=\"text-blue-600\"\n                            >\n                              View Upload\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-3xl\">\n                            <DialogHeader>\n                              <DialogTitle>Payment Upload</DialogTitle>\n                            </DialogHeader>\n                            <div className=\"flex justify-center p-2\">\n                              <img \n                                src={payment.fileUrl}\n                                alt=\"Payment upload\" \n                                className=\"max-h-[70vh] object-contain\"\n                              />\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n                      )}\n                      \n                      {/* Admin Controls */}\n                      {user?.role === 'admin' && (\n                        <>\n                          {/* Edit payment functionality has been disabled */}\n                          \n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-red-600\"\n                            onClick={() => handleDeletePayment(payment.entryId, payment.paymentIndex)}\n                          >\n                            <span className=\"material-icons text-sm\">delete</span>\n                            <span className=\"sr-only\">Delete</span>\n                          </Button>\n                        </>\n                      )}\n                    </div>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n      \n      {/* Payment list - mobile view */}\n      <div className=\"md:hidden space-y-4\">\n        {filteredPayments.length === 0 ? (\n          <div className=\"bg-white p-4 rounded-lg shadow text-center text-neutral-500\">\n            No payment records found\n          </div>\n        ) : (\n          filteredPayments.map((payment, index) => (\n            <Card key={`${payment.entryId}-${index}`} className=\"overflow-hidden\">\n              <CardContent className=\"p-0\">\n                <div className=\"bg-primary text-white p-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <div>\n                      <h3 className=\"font-medium\">{payment.entryDescription}</h3>\n                      <p className=\"text-sm opacity-90\">{payment.userName}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-bold\">‚Çπ{payment.amount.toLocaleString()}</div>\n                      <div className=\"text-xs\">{formatDate(payment.date)}</div>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"p-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <div>\n                      <p className=\"text-sm text-neutral-500\">Receipt No:</p>\n                      <p className=\"font-medium\">{payment.receiptNo || 'N/A'}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-neutral-500\">Mode:</p>\n                      <p className=\"font-medium\">{payment.mode}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-3 pt-3 border-t flex justify-between\">\n                    <Button \n                      variant=\"link\" \n                      className=\"p-0 h-auto text-blue-600 text-sm\"\n                      onClick={() => setLocation(`/entries/${payment.entryId}`)}\n                    >\n                      View Entry\n                    </Button>\n                    \n                    <div className=\"flex space-x-2\">\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-blue-600 text-xs\"\n                        onClick={() => {\n                          setHindiReceiptState({\n                            isOpen: true,\n                            entry: payment.entry,\n                            payment: payment,\n                            paymentIndex: payment.paymentIndex\n                          });\n                        }}\n                      >\n                        Hindi Receipt\n                      </Button>\n                      \n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        className=\"text-green-600 text-xs\"\n                        onClick={() => sendWhatsAppPaymentNotification(payment)}\n                      >\n                        WhatsApp\n                      </Button>\n                      \n                      {payment.fileUrl && (\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          className=\"text-blue-600 text-xs\"\n                          onClick={() => {\n                            // Open file view dialog\n                          }}\n                        >\n                          Upload\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n      \n      {/* Hindi Receipt Component */}\n      {hindiReceiptState.isOpen && hindiReceiptState.entry && hindiReceiptState.payment && (\n        <HindiReceipt\n          entry={hindiReceiptState.entry}\n          payment={hindiReceiptState.payment}\n          paymentIndex={hindiReceiptState.paymentIndex}\n          isOpen={hindiReceiptState.isOpen}\n          onClose={() => setHindiReceiptState({\n            isOpen: false,\n            entry: null,\n            payment: null,\n            paymentIndex: -1\n          })}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":21695},"local-deployment/server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":1921},"local-deployment/scripts/restore-database.sh":{"content":"#!/bin/bash\n\n# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Database Restore Script\n# Restores database from backup file\n\nset -e\n\n# Check if backup file is provided\nif [ $# -eq 0 ]; then\n    echo \"‚ùå Usage: $0 <backup_file>\"\n    echo \"   Example: $0 database-backups/daan_darpan_backup_20250817_120000.sql.gz\"\n    echo \"   Or use: $0 latest  (to restore latest backup)\"\n    exit 1\nfi\n\n# Load environment variables\nif [ -f .env ]; then\n    export $(cat .env | grep -v '#' | awk '/=/ {print $1}')\nfi\n\n# Default values\nDB_NAME=${PGDATABASE:-\"daan_darpan\"}\nDB_USER=${PGUSER:-\"daan_user\"}\nDB_HOST=${PGHOST:-\"localhost\"}\nDB_PORT=${PGPORT:-\"5432\"}\n\n# Determine backup file\nif [ \"$1\" = \"latest\" ]; then\n    BACKUP_FILE=\"database-backups/latest_backup.sql.gz\"\n    if [ ! -f \"$BACKUP_FILE\" ]; then\n        BACKUP_FILE=\"database-backups/latest_backup.sql\"\n    fi\nelse\n    BACKUP_FILE=\"$1\"\nfi\n\n# Check if backup file exists\nif [ ! -f \"$BACKUP_FILE\" ]; then\n    echo \"‚ùå Backup file not found: $BACKUP_FILE\"\n    exit 1\nfi\n\necho \"üèõÔ∏è  Restoring ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Database...\"\necho \"Database: $DB_NAME\"\necho \"User: $DB_USER\"\necho \"Host: $DB_HOST:$DB_PORT\"\necho \"Backup file: $BACKUP_FILE\"\necho \"\"\n\n# Confirm before proceeding\nread -p \"‚ö†Ô∏è  This will replace ALL data in database '$DB_NAME'. Continue? (y/N): \" -n 1 -r\necho\nif [[ ! $REPLY =~ ^[Yy]$ ]]; then\n    echo \"Restore cancelled.\"\n    exit 1\nfi\n\n# Create temporary file for decompressed backup\nTEMP_FILE=\"/tmp/daan_darpan_restore_$$.sql\"\n\n# Decompress if needed\nif [[ \"$BACKUP_FILE\" == *.gz ]]; then\n    echo \"üì¶ Decompressing backup file...\"\n    gunzip -c \"$BACKUP_FILE\" > \"$TEMP_FILE\"\n    RESTORE_FILE=\"$TEMP_FILE\"\nelse\n    RESTORE_FILE=\"$BACKUP_FILE\"\nfi\n\n# Stop application if running\necho \"üõë Stopping application...\"\npkill -f \"tsx server/index.ts\" || true\npkill -f \"node dist/index.js\" || true\nsleep 2\n\n# Restore database\necho \"üîÑ Restoring database...\"\nPGPASSWORD=\"$PGPASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d postgres \\\n    -v ON_ERROR_STOP=1 \\\n    -f \"$RESTORE_FILE\"\n\n# Clean up temporary file\nif [ -f \"$TEMP_FILE\" ]; then\n    rm \"$TEMP_FILE\"\nfi\n\nif [ $? -eq 0 ]; then\n    echo \"‚úÖ Database restored successfully!\"\n    echo \"\"\n    echo \"üöÄ You can now start the application:\"\n    echo \"   npm run dev    (development mode)\"\n    echo \"   npm start      (production mode)\"\nelse\n    echo \"‚ùå Database restore failed!\"\n    exit 1\nfi","size_bytes":2403},"server/bulk-import-users.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\nimport bcrypt from 'bcrypt';\n\ninterface ExcelUser {\n  name: string;\n  username: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\nasync function bulkImportUsers() {\n  try {\n    console.log('Reading differential Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'Address_Mobile_Differential_Users.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} users to import`);\n\n    // Get current user count before import\n    const currentUsers = await db.select().from(users);\n    const currentCount = currentUsers.length;\n    console.log(`Current users in database: ${currentCount}`);\n\n    // Get the highest serial number to continue from\n    const maxSerialNumber = Math.max(...currentUsers.map(u => u.serialNumber), 0);\n    console.log(`Highest serial number: ${maxSerialNumber}`);\n\n    // Create sets of existing usernames and emails for quick lookup\n    const existingUsernames = new Set(currentUsers.map(u => u.username.toLowerCase()));\n    const existingEmails = new Set(currentUsers.map(u => u.email.toLowerCase()));\n    console.log(`Existing usernames: ${existingUsernames.size}, emails: ${existingEmails.size}`);\n\n    let importedCount = 0;\n    let skippedCount = 0;\n    let nextSerialNumber = maxSerialNumber + 1;\n\n    for (const [index, excelRow] of excelData.entries()) {\n      try {\n        // Normalize Excel row data\n        const excelUser: ExcelUser = {\n          name: String(excelRow.name || '').trim(),\n          username: String(excelRow.username || '').trim(),\n          email: String(excelRow.email || '').trim().toLowerCase(),\n          mobile: String(excelRow.mobile || '').trim(),\n          address: String(excelRow.address || '').trim(),\n          role: String(excelRow.role || 'viewer').trim().toLowerCase(),\n          status: String(excelRow.status || 'active').trim().toLowerCase()\n        };\n\n        // Skip empty rows\n        if (!excelUser.name || !excelUser.username || !excelUser.email) {\n          console.log(`Skipping row ${index + 1}: Missing required fields`);\n          skippedCount++;\n          continue;\n        }\n\n        // Handle duplicate usernames by adding suffix\n        let finalUsername = excelUser.username;\n        let usernameCounter = 1;\n        while (existingUsernames.has(finalUsername.toLowerCase())) {\n          finalUsername = `${excelUser.username}${usernameCounter}`;\n          usernameCounter++;\n        }\n        \n        if (finalUsername !== excelUser.username) {\n          console.log(`Modified username from '${excelUser.username}' to '${finalUsername}'`);\n        }\n\n        // Handle duplicate emails by adding suffix\n        let finalEmail = excelUser.email;\n        let emailCounter = 1;\n        while (existingEmails.has(finalEmail.toLowerCase())) {\n          const emailParts = excelUser.email.split('@');\n          if (emailParts.length === 2) {\n            finalEmail = `${emailParts[0]}${emailCounter}@${emailParts[1]}`;\n          } else {\n            finalEmail = `${excelUser.email}${emailCounter}`;\n          }\n          emailCounter++;\n        }\n        \n        if (finalEmail !== excelUser.email) {\n          console.log(`Modified email from '${excelUser.email}' to '${finalEmail}'`);\n        }\n\n        // Validate role\n        if (!['admin', 'operator', 'viewer'].includes(excelUser.role)) {\n          excelUser.role = 'viewer';\n        }\n\n        // Validate status\n        if (!['active', 'inactive'].includes(excelUser.status)) {\n          excelUser.status = 'active';\n        }\n\n        // Create user with auto-generated password (can be changed later)\n        const defaultPassword = 'password123'; // Users should change this\n\n        // Insert user with serial number using final (unique) values\n        await db.insert(users).values({\n          serialNumber: nextSerialNumber,\n          username: finalUsername,\n          password: defaultPassword,\n          name: excelUser.name,\n          email: finalEmail,\n          mobile: excelUser.mobile,\n          address: excelUser.address,\n          role: excelUser.role as 'admin' | 'operator' | 'viewer',\n          status: excelUser.status\n        });\n\n        // Add to existing sets to prevent duplicates in the same batch\n        existingUsernames.add(finalUsername.toLowerCase());\n        existingEmails.add(finalEmail.toLowerCase());\n\n        console.log(`Imported user ${nextSerialNumber}: ${excelUser.name} (${finalUsername})`);\n        importedCount++;\n        nextSerialNumber++;\n\n      } catch (error) {\n        console.error(`Error importing user at row ${index + 1}:`, error);\n        skippedCount++;\n      }\n    }\n\n    // Get final user count\n    const finalUsers = await db.select().from(users);\n    const finalCount = finalUsers.length;\n\n    console.log('\\n=== BULK IMPORT COMPLETE ===');\n    console.log(`Users before import: ${currentCount}`);\n    console.log(`Users imported: ${importedCount}`);\n    console.log(`Users skipped: ${skippedCount}`);\n    console.log(`Users after import: ${finalCount}`);\n    console.log(`Total increase: ${finalCount - currentCount}`);\n\n    return {\n      beforeCount: currentCount,\n      importedCount,\n      skippedCount,\n      afterCount: finalCount,\n      increase: finalCount - currentCount\n    };\n\n  } catch (error) {\n    console.error('Error during bulk import:', error);\n    throw error;\n  }\n}\n\n// Run the import\nbulkImportUsers()\n  .then(result => {\n    console.log('\\n=== FINAL SUMMARY ===');\n    console.log(`Successfully imported ${result.importedCount} users`);\n    console.log(`Database now contains ${result.afterCount} total users`);\n    console.log(`Net increase: ${result.increase} users`);\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Bulk import failed:', error);\n    process.exit(1);\n  });","size_bytes":6139},"local-deployment/client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":777},"client/src/lib/context/auth-context.tsx":{"content":"import { createContext, useEffect, useState, ReactNode } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { AuthUser } from \"@/lib/auth\";\n\ntype AuthContextType = {\n  user: AuthUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  refreshUser: () => void;\n};\n\nexport const AuthContext = createContext<AuthContextType>({\n  user: null,\n  isLoading: false,\n  error: null,\n  refreshUser: () => {}\n});\n\ntype AuthProviderProps = {\n  children: ReactNode;\n};\n\nexport function AuthProvider({ children }: AuthProviderProps) {\n  const queryClient = useQueryClient();\n  \n  const { data, isLoading, error, refetch } = useQuery<AuthUser | null>({\n    queryKey: ['/api/auth/user'],\n    queryFn: async () => {\n      const res = await fetch('/api/auth/user', {\n        credentials: 'include',\n      });\n      \n      if (res.status === 401) {\n        return null; // Not authenticated\n      }\n      \n      if (!res.ok) {\n        throw new Error(`Failed to fetch user: ${res.status}`);\n      }\n      \n      return res.json();\n    },\n    retry: false,\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n    staleTime: 2 * 60 * 1000\n  });\n  \n  // Function to force refresh user data\n  const refreshUser = () => {\n    refetch();\n  };\n\n  return (\n    <AuthContext.Provider value={{ \n      user: data || null, \n      isLoading, \n      error: error as Error,\n      refreshUser\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n","size_bytes":1462},"local-deployment/client/src/components/entries-form-menu.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\n\nexport default function EntriesFormMenu() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [location, setLocation] = useLocation();\n  const { user } = useAuth();\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    }\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  const isFormsActive = location === '/entry/new' || location === '/dravya-entry-form' || location === '/expense-entry-form' || location === '/advance-payment-form' || location === '/previous-outstanding/new';\n\n  // Only show this menu for operators and admins\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return null;\n  }\n\n  const menuItems = [\n    {\n      path: '/entry/new',\n      icon: 'add_circle',\n      label: 'New Boli Entry',\n      description: 'Create new boli entry'\n    },\n    {\n      path: '/dravya-entry-form',\n      icon: 'add_circle',\n      label: 'New Dravya Entry',\n      description: 'Create new dravya entry'\n    },\n    ...(user?.role === 'operator' ? [{\n      path: '/expense-entry-form',\n      icon: 'receipt_long',\n      label: 'New Expense Entry',\n      description: 'Create new expense entry'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/advance-payment-form',\n      icon: 'account_balance_wallet',\n      label: 'Add Advance Payment',\n      description: 'Record new advance payment'\n    }] : []),\n    ...((user?.role === 'admin' || user?.role === 'operator') ? [{\n      path: '/previous-outstanding/new',\n      icon: 'history',\n      label: 'Previous Outstanding',\n      description: 'Record past outstanding amounts with proof'\n    }] : [])\n  ];\n\n  return (\n    <div className=\"relative\" ref={menuRef}>\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className={`flex flex-col items-center py-2 px-4 ${\n          isFormsActive ? 'text-primary' : 'text-neutral-500'\n        }`}\n      >\n        <span className=\"material-icons text-primary\">add_circle</span>\n        <span className=\"text-xs\">Add Entry</span>\n      </button>\n\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <div \n            className=\"fixed inset-0 bg-black bg-opacity-20 z-40\"\n            onClick={() => setIsOpen(false)}\n          />\n          \n          {/* Menu */}\n          <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg border border-neutral-200 z-50 min-w-64\">\n            <div className=\"p-2\">\n              <div className=\"text-sm font-medium text-neutral-700 px-3 py-2 border-b border-neutral-100\">\n                Create New Entry\n              </div>\n              \n              {menuItems.map((item) => (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsOpen(false);\n                  }}\n                  className={`w-full flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-neutral-50 transition-colors ${\n                    location === item.path ? 'bg-primary/10 text-primary' : 'text-neutral-700'\n                  }`}\n                >\n                  <span className=\"material-icons text-lg text-primary\">{item.icon}</span>\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.label}</div>\n                    <div className=\"text-xs text-neutral-500\">{item.description}</div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":4000},"client/src/pages/advance-payment-form.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ArrowLeft, Upload, X } from \"lucide-react\";\nimport { UserSelect } from \"@/components/user-select\";\n\ninterface User {\n  id: number;\n  name: string;\n  mobile?: string;\n}\n\nexport default function AdvancePaymentForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  \n  // Form state\n  const [selectedUserId, setSelectedUserId] = useState<number | null>(null);\n  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\n  const [amount, setAmount] = useState(\"\");\n  const [paymentMode, setPaymentMode] = useState(\"\");\n  \n  // File upload state\n  const [paymentScreenshot, setPaymentScreenshot] = useState<File | null>(null);\n  const fileRef = useRef<HTMLInputElement>(null);\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const selectedUser = users?.find(u => u.id === selectedUserId);\n\n  // Handle file selection\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file type\n      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\n      if (!allowedTypes.includes(file.type)) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload JPG, PNG, or PDF files only.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      // Validate file size (10MB limit)\n      if (file.size > 10 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Please upload files smaller than 10MB.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      setPaymentScreenshot(file);\n    }\n  };\n\n  const removeFile = () => {\n    setPaymentScreenshot(null);\n    if (fileRef.current) {\n      fileRef.current.value = \"\";\n    }\n  };\n\n  // Create advance payment mutation\n  const createAdvancePaymentMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/advance-payments', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create advance payment');\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (createdPayment) => {\n      toast({\n        title: \"Success\",\n        description: `Advance payment of ‚Çπ${createdPayment.amount.toLocaleString()} recorded successfully.`,\n      });\n\n      // Invalidate all related queries immediately\n      await Promise.all([\n        queryClient.invalidateQueries({ queryKey: ['/api/advance-payments'] }),\n        queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] }),\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] }),\n        queryClient.invalidateQueries({ predicate: (query) => {\n          const queryKey = query.queryKey[0];\n          return queryKey ? queryKey.toString().includes('/advance-balance') : false;\n        } })\n      ]);\n      \n      // Clear form\n      setSelectedUserId(null);\n      setDate(new Date().toISOString().split('T')[0]);\n      setAmount(\"\");\n      setPaymentMode(\"\");\n      setPaymentScreenshot(null);\n      if (fileRef.current) fileRef.current.value = \"\";\n      \n      // Navigate to list immediately\n      setLocation('/advance-payments');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create advance payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!selectedUserId || !selectedUser) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!amount || parseFloat(amount) <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid amount\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!paymentMode) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a payment mode\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check if payment screenshot is required for non-cash payments\n    if (paymentMode !== 'cash' && !paymentScreenshot) {\n      toast({\n        title: \"Error\",\n        description: \"Payment screenshot is required for UPI, Cheque, and Net Banking\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append('userId', selectedUserId.toString());\n    formData.append('userName', selectedUser.name);\n    formData.append('userMobile', selectedUser.mobile || '');\n    formData.append('date', date);\n    formData.append('amount', parseFloat(amount).toString()); // Amount in rupees\n    formData.append('paymentMode', paymentMode);\n    formData.append('createdBy', user?.username || 'system');\n    \n    if (paymentScreenshot) {\n      formData.append('paymentScreenshot', paymentScreenshot);\n    }\n\n    createAdvancePaymentMutation.mutate(formData);\n  };\n\n  const paymentModeOptions = [\n    { value: 'cash', label: 'Cash' },\n    { value: 'upi', label: 'UPI' },\n    { value: 'cheque', label: 'Cheque' },\n    { value: 'netbanking', label: 'Net Banking' }\n  ];\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          onClick={() => setLocation('/advance-payments')}\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to List\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Add Advance Payment</h1>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Advance Payment Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user\">Select User *</Label>\n                <UserSelect\n                  value={selectedUserId || undefined}\n                  onValueChange={(value) => setSelectedUserId(value || null)}\n                  placeholder=\"Search and select user\"\n                  className=\"w-full\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"date\">Date *</Label>\n                <Input\n                  id=\"date\"\n                  type=\"date\"\n                  value={date}\n                  onChange={(e) => setDate(e.target.value)}\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0.01\"\n                  placeholder=\"Enter amount in rupees\"\n                  value={amount}\n                  onChange={(e) => setAmount(e.target.value)}\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"paymentMode\">Payment Mode *</Label>\n                <Select value={paymentMode} onValueChange={setPaymentMode}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select payment mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {paymentModeOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Payment Screenshot Upload - Required for non-cash payments */}\n            {paymentMode && paymentMode !== 'cash' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"paymentScreenshot\">Payment Screenshot *</Label>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => fileRef.current?.click()}\n                      className=\"w-full sm:w-auto\"\n                    >\n                      <Upload className=\"h-4 w-4 mr-2\" />\n                      Choose Payment Screenshot\n                    </Button>\n                    <input\n                      ref={fileRef}\n                      type=\"file\"\n                      accept=\".jpg,.jpeg,.png,.pdf\"\n                      onChange={handleFileSelect}\n                      className=\"hidden\"\n                    />\n                  </div>\n                  \n                  {paymentScreenshot && (\n                    <div className=\"flex items-center justify-between p-2 bg-gray-50 rounded border\">\n                      <span className=\"text-sm text-gray-600 truncate\">\n                        {paymentScreenshot.name}\n                      </span>\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={removeFile}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  )}\n                  \n                  <p className=\"text-sm text-gray-500\">\n                    Upload payment screenshot for {paymentMode.toUpperCase()}. Accepted formats: JPG, PNG, PDF (Max 10MB)\n                  </p>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button \n                type=\"submit\" \n                disabled={createAdvancePaymentMutation.isPending}\n                className=\"min-w-[120px]\"\n              >\n                {createAdvancePaymentMutation.isPending ? \"Creating...\" : \"Create Payment\"}\n              </Button>\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setLocation('/advance-payments')}\n              >\n                Cancel\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11291},"replit.md":{"content":"# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ (Daan-Darpan) - Account Ledger Management System\n\n## Overview\nThis project is a full-stack web application designed for comprehensive account ledger management. It provides user authentication, robust entry management (specifically for \"boli\" entries, a form of ledger entry), payment tracking, and detailed transaction logging. The system supports role-based access control, offering administrative, operational, and viewing permissions. The core vision is to streamline financial record-keeping for specific types of transactions, ensuring accountability and easy access to historical data.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React with TypeScript, built using Vite.\n- **UI/UX**: Utilizes Radix UI primitives and custom shadcn/ui components, styled with Tailwind CSS following a mobile-first approach.\n- **State Management**: TanStack Query for server state.\n- **Form Handling**: React Hook Form with Zod validation.\n- **Routing**: Wouter for client-side navigation.\n\n### Backend\n- **Framework**: Express.js with TypeScript.\n- **Database**: PostgreSQL, integrated via Drizzle ORM for type-safe operations.\n- **Authentication**: Session-based using Passport.js (local strategy) and express-session, with role-based access control.\n- **API Design**: RESTful with consistent error handling.\n\n### Key Features\n- **Authentication & Authorization**: Session-based, role-based (admin, operator, viewer) access control with protected routes.\n- **Boli Entry Management**: Full CRUD operations for ledger entries, including payment status tracking (pending, partial, full) and file upload for payment records.\n- **Dravya Entry System**: Completely isolated module for spiritual donations, with its own database table and API endpoints, excluding payment tracking or dashboard integration.\n- **Payment System**: Records partial and full payments for boli entries, supports multiple payment modes, generates receipt numbers, and tracks payment history.\n- **Transaction Logging**: Comprehensive audit trail for boli entry and payment modifications, with user attribution.\n- **Advance Payment Integration**: System for tracking and automatically applying advance payments to boli entries, with manual processing options.\n- **Expense Management**: Dedicated module for operators to track expenses, including file uploads for receipts.\n- **Reporting & Dashboards**: Includes daily earnings/payments calendars, user-specific detail dashboards, and comprehensive financial summaries.\n- **Communication**: WhatsApp reminder integration for pending boli payments and email-based database backup distribution.\n- **User Management**: Operators have restricted access to manage other operators and viewers, including bulk user upload via Excel/CSV. Each user is assigned a sequential serial number based on creation order. System handles duplicate usernames by adding numeric suffixes (e.g., username1, username2) during bulk imports.\n- **Role-based Navigation**: Viewer role has completely simplified navigation with only \"My Account\" and \"My Profile\" (renamed from Settings). Viewers are blocked from dashboard access both in frontend and backend API. Admin users have access to all operator functionalities plus admin-exclusive features.\n- **Terminology**: \"Auction\" terminology has been globally replaced with \"Boli\".\n\n### Core Architectural Decisions\n- **Monorepo Structure**: Shared TypeScript types between frontend and backend.\n- **Type Safety**: End-to-end type safety using TypeScript and Drizzle ORM.\n- **Session-based Auth**: Chosen for enhanced security and session management.\n- **Component-based UI**: Reusable UI components for a consistent design system.\n- **Mobile-first Design**: Ensures responsiveness and optimal mobile experience.\n- **Audit Trail**: Detailed transaction logging for compliance.\n- **Data Isolation**: Dravya entries are completely separate to prevent interference with main application logic.\n- **Admin Privilege Inheritance**: Admin users can access all operator functionalities plus admin-exclusive features (logs, user management, corpus settings). Backend uses `isAdminOrOperator` middleware to ensure proper access control.\n\n## External Dependencies\n\n### Core\n- **@neondatabase/serverless**: PostgreSQL serverless connection.\n- **drizzle-orm**: Type-safe database operations.\n- **express**: Web framework.\n- **passport**: Authentication middleware.\n- **@tanstack/react-query**: Server state management.\n- **@radix-ui/***: UI component primitives.\n- **react-hook-form**: Form state management.\n- **zod**: Schema validation.\n- **SendGrid/Nodemailer**: For email distribution (database backups).\n\n### Development Tools\n- **drizzle-kit**: Database migrations.\n- **tsx**: TypeScript execution.\n- **esbuild**: Production bundling.\n- **tailwindcss**: CSS framework.","size_bytes":4907},"server/storage.ts":{"content":"import {\n  users, entries, transactionLogs, previousOutstandingRecords,\n  type User, type InsertUser,\n  type Entry, type InsertEntry,\n  type PaymentRecord, type UserRoleType, type PaymentStatusType,\n  PaymentStatus, UserRole, TransactionType, type TransactionTypeValue,\n  type TransactionLog, type InsertTransactionLog\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, SQL, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User management\n  getUsers(): Promise<User[]>;\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByMobile(mobile: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, updates: Partial<User>): Promise<User | undefined>;\n  \n  // Entry management\n  getEntries(): Promise<Entry[]>;\n  getEntry(id: number): Promise<Entry | undefined>;\n  getUserEntries(userId: number): Promise<Entry[]>;\n  getEntriesByUserId(userId: number): Promise<Entry[]>;\n  createEntry(entry: InsertEntry, createdByUserId: number): Promise<Entry>;\n  updateEntry(id: number, updates: Partial<Entry>, updatedByUserId: number): Promise<Entry | undefined>;\n  deleteEntry(id: number, deletedByUserId: number): Promise<boolean>;\n  \n  // Advance payment management\n  getAdvancePayments(): Promise<any[]>;\n  getAdvancePaymentsByUserId(userId: number): Promise<any[]>;\n  calculateRemainingAdvancePayment(userId: number): Promise<number>;\n  \n  // Dravya entry management\n  getDravyaEntries(): Promise<any[]>;\n  getDravyaEntriesByUserId(userId: number): Promise<any[]>;\n  \n  // Payment management\n  recordPayment(entryId: number, payment: PaymentRecord, recordedByUserId: number): Promise<Entry | undefined>;\n  deletePayment(entryId: number, paymentIndex: number, deletedByUserId: number): Promise<Entry | undefined>;\n  \n  // Transaction logging\n  getTransactionLogs(): Promise<TransactionLog[]>;\n  getEntryTransactionLogs(entryId: number): Promise<TransactionLog[]>;\n  createTransactionLog(log: InsertTransactionLog): Promise<TransactionLog>;\n}\n\n// Function to get next available number in boli payment ranges (1-200, 301-500, 701-900, etc.)\nfunction getNextBoliNumber(existingNumbers: Set<number>): number {\n  // Boli payment ranges: 1-200, 301-500, 601-800, 901-1100, 1201-1400, etc.\n  // Pattern: start at 1, then skip 200s series (301, 601, 901, 1201...)\n  const boliRanges = [\n    { start: 1, end: 200 },\n    { start: 301, end: 500 },\n    { start: 601, end: 800 },\n    { start: 901, end: 1100 },\n    { start: 1201, end: 1400 },\n    { start: 1501, end: 1700 },\n    { start: 1801, end: 2000 }\n  ];\n  \n  for (const range of boliRanges) {\n    for (let num = range.start; num <= range.end; num++) {\n      if (!existingNumbers.has(num)) {\n        return num;\n      }\n    }\n  }\n  \n  // If all predefined ranges are full, continue the pattern\n  let rangeStart = 2101;\n  while (true) {\n    for (let num = rangeStart; num <= rangeStart + 199; num++) {\n      if (!existingNumbers.has(num)) {\n        return num;\n      }\n    }\n    rangeStart += 300; // Move to next boli range (skip 200s series)\n  }\n}\n\n// Function to generate sequential SPDJMSJ receipt numbers for boli payments using block allocation\nexport async function generateBoliReceiptNumber(paymentDate: string): Promise<string> {\n  try {\n    const year = paymentDate.split('-')[0]; // Extract year from YYYY-MM-DD\n    \n    // Get all existing SPDJMSJ serial numbers from entries\n    const existingNumbers = new Set<number>();\n    \n    // Get boli payment numbers from entries\n    const allEntries = await db.select().from(entries);\n    \n    for (const entry of allEntries) {\n      if (!entry.payments || !Array.isArray(entry.payments)) continue;\n      \n      for (const payment of entry.payments) {\n        if (!payment.receiptNo) continue;\n        \n        const match = payment.receiptNo.match(/SPDJMSJ-(\\d{4})-(\\d{5})/);\n        if (match && match[1] === year) {\n          const foundNumber = parseInt(match[2], 10);\n          if (!isNaN(foundNumber)) {\n            existingNumbers.add(foundNumber);\n          }\n        }\n      }\n    }\n    \n    // Get outstanding payment numbers\n    const poRecords = await db.select()\n      .from(previousOutstandingRecords)\n      .orderBy(desc(previousOutstandingRecords.id))\n      .limit(200);\n    \n    for (const record of poRecords) {\n      if (!record.payments || !Array.isArray(record.payments)) continue;\n      \n      for (const payment of record.payments) {\n        if (!payment.receiptNo) continue;\n        \n        const match = payment.receiptNo.match(/SPDJMSJ-(\\d{4})-(\\d{5})/);\n        if (match && match[1] === year) {\n          const foundNumber = parseInt(match[2], 10);\n          if (!isNaN(foundNumber)) {\n            existingNumbers.add(foundNumber);\n          }\n        }\n      }\n    }\n    \n    // Get next available number in boli ranges\n    const nextNumber = getNextBoliNumber(existingNumbers);\n    \n    // Format with 5 digits (00001, 00002, etc.)\n    const formattedNumber = nextNumber.toString().padStart(5, '0');\n    return `SPDJMSJ-${year}-${formattedNumber}`;\n  } catch (error) {\n    console.error(\"Error generating boli receipt number:\", error);\n    // Fallback to a timestamp-based format if there's an error\n    const timestamp = new Date().getTime();\n    return `SPDJMSJ-${paymentDate.split('-')[0]}-${timestamp.toString().slice(-5)}`;\n  }\n}\n\n// Function to get next available number in outstanding payment ranges (201-300, 501-600, 801-900, 1101-1200, etc.)\nfunction getNextOutstandingNumber(existingNumbers: Set<number>): number {\n  // Outstanding payment ranges: 201-300, 501-600, 801-900, 1101-1200, etc.\n  // Pattern: start at 201, then add 300 each time (201‚Üí501‚Üí801‚Üí1101...)\n  const outstandingRanges = [\n    { start: 201, end: 300 },\n    { start: 501, end: 600 },\n    { start: 801, end: 900 },\n    { start: 1101, end: 1200 },\n    { start: 1401, end: 1500 },\n    { start: 1701, end: 1800 },\n    { start: 2001, end: 2100 }\n  ];\n  \n  for (const range of outstandingRanges) {\n    for (let num = range.start; num <= range.end; num++) {\n      if (!existingNumbers.has(num)) {\n        return num;\n      }\n    }\n  }\n  \n  // If all predefined ranges are full, continue the pattern\n  let rangeStart = 2301;\n  while (true) {\n    for (let num = rangeStart; num <= rangeStart + 99; num++) {\n      if (!existingNumbers.has(num)) {\n        return num;\n      }\n    }\n    rangeStart += 300; // Move to next outstanding range (add 300)\n  }\n}\n\n// Function to generate sequential receipt numbers for previous outstanding payments using block allocation\nexport async function generatePreviousOutstandingReceiptNumber(paymentDate: string): Promise<string> {\n  try {\n    const year = paymentDate.split('-')[0]; // Extract year from YYYY-MM-DD\n    \n    // Get all existing SPDJMSJ serial numbers\n    const existingNumbers = new Set<number>();\n    \n    // Get boli payment numbers from entries\n    const allEntries = await db.select().from(entries);\n    \n    for (const entry of allEntries) {\n      if (!entry.payments || !Array.isArray(entry.payments)) continue;\n      \n      for (const payment of entry.payments) {\n        if (!payment.receiptNo) continue;\n        \n        const match = payment.receiptNo.match(/SPDJMSJ-(\\d{4})-(\\d{5})/);\n        if (match && match[1] === year) {\n          const foundNumber = parseInt(match[2], 10);\n          if (!isNaN(foundNumber)) {\n            existingNumbers.add(foundNumber);\n          }\n        }\n      }\n    }\n    \n    // Get outstanding payment numbers\n    const poRecords = await db.select()\n      .from(previousOutstandingRecords)\n      .orderBy(desc(previousOutstandingRecords.id))\n      .limit(200);\n    \n    for (const record of poRecords) {\n      if (!record.payments || !Array.isArray(record.payments)) continue;\n      \n      for (const payment of record.payments) {\n        if (!payment.receiptNo) continue;\n        \n        const match = payment.receiptNo.match(/SPDJMSJ-(\\d{4})-(\\d{5})/);\n        if (match && match[1] === year) {\n          const foundNumber = parseInt(match[2], 10);\n          if (!isNaN(foundNumber)) {\n            existingNumbers.add(foundNumber);\n          }\n        }\n      }\n    }\n    \n    // Get next available number in outstanding ranges\n    const nextNumber = getNextOutstandingNumber(existingNumbers);\n    \n    // Format with 5 digits (00001, 00002, etc.)\n    const formattedNumber = nextNumber.toString().padStart(5, '0');\n    return `SPDJMSJ-${year}-${formattedNumber}`;\n  } catch (error) {\n    console.error(\"Error generating previous outstanding receipt number:\", error);\n    // Fallback to a timestamp-based format if there's an error\n    const timestamp = new Date().getTime();\n    return `SPDJMSJ-${paymentDate.split('-')[0]}-${timestamp.toString().slice(-5)}`;\n  }\n}\n\n// Function to generate serial numbers for outstanding records (PO-2025-001, PO-2025-002, etc.)\nexport async function generateOutstandingRecordSerialNumber(): Promise<string> {\n  try {\n    const year = new Date().getFullYear();\n    \n    // Get existing outstanding record serial numbers for this year\n    const records = await db.select()\n      .from(previousOutstandingRecords)\n      .orderBy(desc(previousOutstandingRecords.id))\n      .limit(100);\n    \n    let maxSequenceNumber = 0;\n    \n    for (const record of records) {\n      if (!record.serialNumber) continue;\n      \n      const match = record.serialNumber.match(/PO-(\\d{4})-(\\d{3})/);\n      if (match && match[1] === year.toString()) {\n        const foundNumber = parseInt(match[2], 10);\n        if (!isNaN(foundNumber) && foundNumber > maxSequenceNumber) {\n          maxSequenceNumber = foundNumber;\n        }\n      }\n    }\n    \n    // Next sequence number\n    const nextSequenceNumber = maxSequenceNumber + 1;\n    \n    // Format with 3 digits (001, 002, etc.)\n    const formattedNumber = nextSequenceNumber.toString().padStart(3, '0');\n    return `PO-${year}-${formattedNumber}`;\n  } catch (error) {\n    console.error(\"Error generating outstanding record serial number:\", error);\n    // Fallback to a timestamp-based format if there's an error\n    const timestamp = new Date().getTime();\n    return `PO-${new Date().getFullYear()}-${timestamp.toString().slice(-3)}`;\n  }\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getTransactionLogs(): Promise<TransactionLog[]> {\n    try {\n      return await db.select().from(transactionLogs).orderBy(desc(transactionLogs.id));\n    } catch (error) {\n      console.error(\"Error fetching transaction logs:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getEntryTransactionLogs(entryId: number): Promise<TransactionLog[]> {\n    try {\n      return await db\n        .select()\n        .from(transactionLogs)\n        .where(eq(transactionLogs.entryId, entryId))\n        .orderBy(desc(transactionLogs.id));\n    } catch (error) {\n      console.error(`Error fetching transaction logs for entry ${entryId}:`, error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async createTransactionLog(log: InsertTransactionLog): Promise<TransactionLog> {\n    try {\n      // Ensure we have a valid transaction type\n      const transactionType = log.transactionType || TransactionType.UPDATE_ENTRY;\n      \n      const [result] = await db.insert(transactionLogs).values({\n        entryId: log.entryId || 0,\n        userId: log.userId || 0,\n        username: log.username || 'system',\n        description: log.description || 'Transaction record',\n        amount: log.amount || 0,\n        transactionType: transactionType as TransactionTypeValue,\n        details: log.details || {},\n        date: new Date().toISOString().split('T')[0]\n      }).returning();\n      \n      return result;\n    } catch (error) {\n      console.error(\"Error creating transaction log:\", error);\n      throw error;\n    }\n  }\n\n  async getUsers(): Promise<User[]> {\n    try {\n      return await db.select().from(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getUser(id: number): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.id, id));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserByUsername(username: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.username, username));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user by username ${username}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserByMobile(mobile: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.mobile, mobile));\n      return user;\n    } catch (error) {\n      console.error(`Error fetching user by mobile ${mobile}:`, error);\n      return undefined;\n    }\n  }\n  \n  async createUser(insertUser: InsertUser): Promise<User> {\n    try {\n      // Ensure default values\n      const userRole: UserRoleType = insertUser.role as UserRoleType || UserRole.VIEWER;\n      \n      // Get the next serial number based on existing users\n      const allUsers = await db.select().from(users);\n      const nextSerialNumber = allUsers.length + 1;\n      \n      const [newUser] = await db.insert(users).values({\n        ...insertUser,\n        role: userRole,\n        serialNumber: nextSerialNumber\n      }).returning();\n      \n      return newUser;\n    } catch (error) {\n      console.error(\"Error creating user:\", error);\n      throw error;\n    }\n  }\n  \n  async updateUser(id: number, updates: Partial<User>): Promise<User | undefined> {\n    try {\n      const [updatedUser] = await db\n        .update(users)\n        .set(updates)\n        .where(eq(users.id, id))\n        .returning();\n      \n      return updatedUser;\n    } catch (error) {\n      console.error(`Error updating user ${id}:`, error);\n      return undefined;\n    }\n  }\n\n  async getEntries(includeDeleted: boolean = false): Promise<Entry[]> {\n    try {\n      let query = db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id));\n      \n      // Filter by entry_status unless includeDeleted is true\n      if (!includeDeleted) {\n        query = query.where(eq(entries.entryStatus, 'active')) as any;\n      }\n      \n      const entriesData = await query.orderBy(entries.id);\n      \n      // Merge user information from users table to entries\n      return entriesData.map(item => ({\n        ...item.entry,\n        userName: item.user?.name || item.entry.userName,\n        userMobile: item.user?.mobile || item.entry.userMobile,\n        userAddress: item.user?.address || item.entry.userAddress\n      }));\n    } catch (error) {\n      console.error(\"Error fetching entries:\", error);\n      return []; // Return empty array instead of failing\n    }\n  }\n  \n  async getEntry(id: number): Promise<Entry | undefined> {\n    try {\n      const entryData = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, id));\n      \n      if (entryData.length === 0) return undefined;\n      \n      // Merge user information from users table to entry\n      return {\n        ...entryData[0].entry,\n        userName: entryData[0].user?.name || entryData[0].entry.userName,\n        userMobile: entryData[0].user?.mobile || entryData[0].entry.userMobile,\n        userAddress: entryData[0].user?.address || entryData[0].entry.userAddress\n      };\n    } catch (error) {\n      console.error(`Error fetching entry ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async getUserEntries(userId: number, includeDeleted: boolean = false): Promise<Entry[]> {\n    try {\n      let query = db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id));\n      \n      // Build where conditions\n      const conditions = [eq(entries.userId, userId)];\n      if (!includeDeleted) {\n        conditions.push(eq(entries.entryStatus, 'active'));\n      }\n      \n      const entriesData = await query.where(and(...conditions));\n      \n      // Merge user information from users table to entries\n      return entriesData.map(item => ({\n        ...item.entry,\n        userName: item.user?.name || item.entry.userName,\n        userMobile: item.user?.mobile || item.entry.userMobile,\n        userAddress: item.user?.address || item.entry.userAddress\n      }));\n    } catch (error) {\n      console.error(`Error fetching entries for user ${userId}:`, error);\n      return []; // Return empty array instead of failing\n    }\n  }\n\n  async getNextBoliNumber(): Promise<number> {\n    try {\n      // Get all existing boli/bedi numbers from the database, including from previous_outstanding_records\n      const [existingEntries, existingOutstanding] = await Promise.all([\n        db.select({ bediNumber: entries.bediNumber }).from(entries),\n        db.select({ serialNumber: previousOutstandingRecords.serialNumber }).from(previousOutstandingRecords)\n      ]);\n      \n      // Convert both sets to numbers for efficient lookup\n      const existingNumbers = new Set<number>();\n      \n      // Add bedi numbers from entries\n      existingEntries.forEach(entry => {\n        const num = parseInt(entry.bediNumber, 10);\n        if (!isNaN(num) && num > 0) {\n          existingNumbers.add(num);\n        }\n      });\n      \n      // Add numbers from previous outstanding records (these use PO-YYYY-NNN format)\n      existingOutstanding.forEach(record => {\n        if (record.serialNumber) {\n          const match = record.serialNumber.match(/PO-\\d{4}-(\\d{3})/);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num) && num > 0) {\n              existingNumbers.add(num);\n            }\n          }\n        }\n      });\n      \n      const maxNumber = existingNumbers.size > 0 ? Math.max(...Array.from(existingNumbers)) : 0;\n      console.log(`Found ${existingNumbers.size} existing boli numbers, max: ${maxNumber}`);\n      console.log(`Existing numbers sample:`, Array.from(existingNumbers).sort((a, b) => a - b).slice(0, 20));\n      \n      // Use the existing function to get next number in sequence\n      const nextNumber = getNextBoliNumber(existingNumbers);\n      console.log(`Generated next boli number: ${nextNumber}`);\n      return nextNumber;\n      \n    } catch (error) {\n      console.error(\"Error getting next boli number:\", error);\n      // Emergency fallback: Since all current entries have bedi_number=\"1\", \n      // we should continue from where production left off (around 1310+)\n      const fallbackStart = 1310;\n      console.log(`Using fallback starting from ${fallbackStart}`);\n      return fallbackStart;\n    }\n  }\n\n  async createEntry(insertEntry: InsertEntry, createdByUserId?: number): Promise<Entry> {\n    try {\n      console.log(\"Creating entry with data:\", insertEntry);\n      \n      const quantity = insertEntry.quantity || 1;\n      const totalAmount = insertEntry.amount * quantity;\n      \n      // Get the current user data to ensure we have the latest information\n      const userResult = await db.select().from(users).where(eq(users.id, insertEntry.userId));\n      const user = userResult.length > 0 ? userResult[0] : null;\n      \n      console.log(\"User found for entry:\", user);\n      \n      // Generate next sequential boli number \n      const nextBoliNumber = await this.getNextBoliNumber();\n      console.log(`Using boli number: ${nextBoliNumber}`);\n      \n      // Use Drizzle ORM for better error handling and auto-ID generation\n      const [newEntry] = await db.insert(entries).values({\n        userId: insertEntry.userId,\n        userName: user?.name || insertEntry.userName || 'Unknown User',\n        userMobile: user?.mobile || '',\n        userAddress: user?.address || '',\n        description: insertEntry.description || '',\n        amount: insertEntry.amount,\n        quantity: quantity,\n        totalAmount: totalAmount,\n        occasion: insertEntry.occasion || '',\n        bediNumber: nextBoliNumber.toString(),\n        auctionDate: insertEntry.auctionDate || new Date().toISOString().split('T')[0],\n        pendingAmount: totalAmount,\n        receivedAmount: 0,\n        status: PaymentStatus.PENDING,\n        payments: [],\n        createdBy: createdByUserId ? 'operator' : 'system',\n        updatedAt: new Date().toISOString() // Dynamic timestamp\n      }).returning();\n      \n      console.log(\"Entry creation result:\", newEntry);\n      \n      // Log this entry creation as a CREDIT transaction if we have the creator's ID\n      if (createdByUserId && newEntry) {\n        // Get the user who created the entry\n        const creatorResult = await db.select().from(users).where(eq(users.id, createdByUserId));\n        const creator = creatorResult.length > 0 ? creatorResult[0] : null;\n        \n        if (creator) {\n          try {\n            await this.createTransactionLog({\n              entryId: newEntry.id,\n              userId: createdByUserId,\n              username: creator.username,\n              description: `Created new entry: \"${newEntry.description}\"`,\n              amount: newEntry.totalAmount,\n              transactionType: TransactionType.CREDIT,\n              details: newEntry\n            });\n          } catch (logError) {\n            console.error(\"Error logging transaction:\", logError);\n            // Continue anyway so entry creation succeeds\n          }\n        }\n      }\n      \n      // Return the entry directly since Drizzle ORM returns camelCase properties\n      return newEntry;\n    } catch (error) {\n      console.error(\"Error in createEntry:\", error);\n      throw error;\n    }\n  }\n\n  async updateEntry(id: number, updates: Partial<Entry>, updatedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the original entry first\n      const [originalEntry] = await db.select().from(entries).where(eq(entries.id, id));\n      if (!originalEntry) return undefined;\n      \n      // Get the user who is updating this entry\n      const [updater] = await db.select().from(users).where(eq(users.id, updatedByUserId));\n      if (!updater) return undefined;\n      \n      // If userId is being changed, fetch the new user's data\n      let newUserName = updates.userName || originalEntry.userName;\n      let newUserMobile = updates.userMobile || originalEntry.userMobile;\n      let newUserAddress = updates.userAddress || originalEntry.userAddress;\n      \n      if (updates.userId && updates.userId !== originalEntry.userId) {\n        const [newUser] = await db.select().from(users).where(eq(users.id, updates.userId));\n        if (newUser) {\n          newUserName = newUser.name;\n          newUserMobile = newUser.mobile || '';\n          newUserAddress = newUser.address || '';\n          console.log(`User change detected: ${originalEntry.userName} -> ${newUser.name}`);\n        }\n      }\n      \n      // Use provided totalAmount directly, or calculate from amount/quantity if not provided\n      const newAmount = updates.amount !== undefined ? updates.amount : originalEntry.amount;\n      const newQuantity = updates.quantity !== undefined ? updates.quantity : originalEntry.quantity;\n      const newTotal = updates.totalAmount !== undefined ? updates.totalAmount : (newAmount * newQuantity);\n      const newPendingAmount = newTotal - originalEntry.receivedAmount;\n      \n      // Update the entry with all fields including user data\n      const [updatedEntry] = await db\n        .update(entries)\n        .set({\n          userId: updates.userId || originalEntry.userId,\n          userName: newUserName,\n          userMobile: newUserMobile,\n          userAddress: newUserAddress,\n          description: updates.description || originalEntry.description,\n          amount: newAmount,\n          quantity: newQuantity,\n          totalAmount: newTotal,\n          pendingAmount: newPendingAmount,\n          occasion: updates.occasion || originalEntry.occasion,\n          bediNumber: updates.bediNumber || originalEntry.bediNumber,\n          auctionDate: updates.auctionDate || originalEntry.auctionDate,\n          updatedAt: new Date().toISOString()\n        })\n        .where(eq(entries.id, id))\n        .returning();\n        \n      if (!updatedEntry) {\n        console.error(`No entry returned after update for ID: ${id}`);\n        return undefined;\n      }\n      \n      console.log(`Successfully updated entry ${id}:`, {\n        id: updatedEntry.id,\n        userName: updatedEntry.userName,\n        description: updatedEntry.description,\n        totalAmount: updatedEntry.totalAmount,\n        quantity: updatedEntry.quantity,\n        occasion: updatedEntry.occasion,\n        auctionDate: updatedEntry.auctionDate,\n        updatedBy: updater.username,\n        updatedAt: updatedEntry.updatedAt\n      });\n      \n      // Return the updated entry with proper field mapping to match frontend expectations\n      return {\n        ...updatedEntry,\n        userId: updatedEntry.userId,\n        userName: updatedEntry.userName,\n        userMobile: updatedEntry.userMobile,\n        userAddress: updatedEntry.userAddress,\n        totalAmount: updatedEntry.totalAmount,\n        pendingAmount: updatedEntry.pendingAmount,\n        receivedAmount: updatedEntry.receivedAmount,\n        auctionDate: updatedEntry.auctionDate,\n        updatedAt: updatedEntry.updatedAt,\n        createdBy: updatedEntry.createdBy\n      };\n    } catch (error) {\n      console.error(`Error updating entry ${id}:`, error);\n      return undefined;\n    }\n  }\n  \n  async deleteEntry(id: number, deletedByUserId: number): Promise<boolean> {\n    try {\n      // Get the entry first to log the deletion\n      const [entry] = await db.select().from(entries).where(eq(entries.id, id));\n      if (!entry) return false;\n      \n      // Get the user who is deleting this entry\n      const [deleter] = await db.select().from(users).where(eq(users.id, deletedByUserId));\n      if (!deleter) return false;\n      \n      // Log this as a DEBIT transaction (canceling the original CREDIT)\n      await this.createTransactionLog({\n        entryId: entry.id,\n        userId: deletedByUserId,\n        username: deleter.username,\n        description: `Deleted entry #${entry.id}`,\n        amount: entry.totalAmount,\n        transactionType: TransactionType.DEBIT,\n        details: entry\n      });\n      \n      // Delete the entry\n      await db\n        .delete(entries)\n        .where(eq(entries.id, id));\n      \n      return true;\n    } catch (error) {\n      console.error(`Error deleting entry ${id}:`, error);\n      return false;\n    }\n  }\n  \n  async deletePayment(entryId: number, paymentIndex: number, deletedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the entry to modify its payments\n      const entryResult = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, entryId));\n      \n      if (entryResult.length === 0) return undefined;\n      \n      const entry = entryResult[0].entry;\n      const user = entryResult[0].user;\n      \n      if (!entry.payments || paymentIndex >= entry.payments.length) {\n        return undefined;\n      }\n      \n      // Get payment to be deleted\n      const paymentToDelete = entry.payments[paymentIndex];\n      \n      // Delete the payment by removing it from the array\n      const updatedPayments = [...entry.payments];\n      updatedPayments.splice(paymentIndex, 1);\n      \n      // Recalculate received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entry.totalAmount - newReceivedAmount;\n      \n      // Determine new payment status\n      let newStatus: PaymentStatusType;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entry.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      const oldStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      \n      // Update the entry with new payments and amounts\n      const [updateResult] = await db\n        .update(entries)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: newPendingAmount,\n          status: newStatus\n        })\n        .where(eq(entries.id, entryId))\n        .returning();\n      \n      if (!updateResult) return undefined;\n      \n      // Log deletion as a CREDIT transaction (canceling the original DEBIT)\n      await this.createTransactionLog({\n        entryId: entryId,\n        userId: deletedByUserId,\n        username: user?.username || \"system\",\n        description: `Deleted payment record of ‚Çπ${paymentToDelete.amount} from entry #${entryId}`,\n        amount: paymentToDelete.amount,\n        transactionType: TransactionType.CREDIT,\n        details: paymentToDelete\n      });\n      \n      // Also log status change if it happened\n      if (oldStatus !== newStatus) {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: deletedByUserId,\n          username: user?.username || \"system\",\n          description: `Payment status changed from ${oldStatus} to ${newStatus}`,\n          amount: 0,\n          transactionType: TransactionType.UPDATE_PAYMENT,\n          details: {\n            oldStatus,\n            newStatus\n          }\n        });\n      }\n      \n      return updateResult;\n    } catch (error) {\n      console.error(`Error deleting payment for entry ${entryId}:`, error);\n      return undefined;\n    }\n  }\n  \n  async recordPayment(entryId: number, payment: PaymentRecord, recordedByUserId: number): Promise<Entry | undefined> {\n    try {\n      // Get the entry to modify\n      const entryResult = await db.select({\n        entry: entries,\n        user: users\n      })\n      .from(entries)\n      .leftJoin(users, eq(entries.userId, users.id))\n      .where(eq(entries.id, entryId));\n      \n      if (entryResult.length === 0) return undefined;\n      \n      const entry = entryResult[0].entry;\n      const user = entryResult[0].user;\n      \n      // Ensure payments array exists\n      const currentPayments = entry.payments || [];\n      \n      // Add the new payment\n      const updatedPayments = [...currentPayments, payment];\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entry.totalAmount - newReceivedAmount;\n      \n      // Determine payment status\n      const oldStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      let newStatus: PaymentStatusType = entry.status as PaymentStatusType;\n      \n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entry.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with the new payment and amounts\n      const [updateResult] = await db\n        .update(entries)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: newPendingAmount,\n          status: newStatus\n        })\n        .where(eq(entries.id, entryId))\n        .returning();\n      \n      if (!updateResult) return undefined;\n      \n      // Get user who recorded the payment\n      const recordingUser = await this.getUser(recordedByUserId);\n      \n      // Log the payment as a DEBIT transaction - Ensuring TransactionType is specified\n      try {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: recordedByUserId,\n          username: recordingUser?.username || \"system\",\n          description: `Payment of ‚Çπ${payment.amount} recorded by ${recordingUser?.username || \"system\"}`,\n          amount: payment.amount,\n          transactionType: TransactionType.DEBIT, // Explicitly setting the transaction type\n          details: {\n            date: payment.date,\n            paymentMode: payment.mode,\n            receiptNo: payment.receiptNo\n          }\n        });\n      } catch (logError) {\n        console.error(\"Error creating transaction log:\", logError);\n        // Continue execution even if logging fails\n      }\n      \n      // Log status change if status has changed\n      if (oldStatus !== newStatus) {\n        await this.createTransactionLog({\n          entryId: entryId,\n          userId: recordedByUserId,\n          username: user?.username || \"system\",\n          description: `Payment status changed from ${oldStatus} to ${newStatus}`,\n          amount: 0,\n          transactionType: TransactionType.UPDATE_PAYMENT,\n          details: {\n            oldStatus,\n            newStatus,\n            payment\n          }\n        });\n      }\n      \n      return updateResult;\n    } catch (error) {\n      console.error(`Error recording payment for entry ${entryId}:`, error);\n      return undefined;\n    }\n  }\n\n  // New methods for user detail functionality\n  async getEntriesByUserId(userId: number): Promise<Entry[]> {\n    return this.getUserEntries(userId);\n  }\n\n  async getAdvancePayments(): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your advance payments schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(\"Error fetching advance payments:\", error);\n      return [];\n    }\n  }\n\n  async getAdvancePaymentsByUserId(userId: number): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your advance payments schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(`Error fetching advance payments for user ${userId}:`, error);\n      return [];\n    }\n  }\n\n  async getDravyaEntries(): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your dravya entries schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(\"Error fetching dravya entries:\", error);\n      return [];\n    }\n  }\n\n  async getDravyaEntriesByUserId(userId: number): Promise<any[]> {\n    try {\n      // This is a placeholder - you'll need to implement based on your dravya entries schema\n      // For now, return empty array\n      return [];\n    } catch (error) {\n      console.error(`Error fetching dravya entries for user ${userId}:`, error);\n      return [];\n    }\n  }\n\n  async calculateRemainingAdvancePayment(userId: number): Promise<number> {\n    try {\n      const { query } = await import(\"./db\");\n      \n      // Get total advance payments for the user\n      const advanceResult = await query(\n        'SELECT COALESCE(SUM(amount), 0) as total_advance FROM advance_payments WHERE user_id = $1',\n        [userId]\n      );\n      \n      // Get total used advance payments (payments made using advance)\n      const usedResult = await query(\n        'SELECT COALESCE(SUM(amount), 0) as total_used FROM advance_payment_usage WHERE user_id = $1',\n        [userId]\n      );\n      \n      const totalAdvance = parseInt(advanceResult.rows[0]?.total_advance || '0');\n      const totalUsed = parseInt(usedResult.rows[0]?.total_used || '0');\n      \n      console.log(`[DEBUG] User ${userId} - Total Advance: ${totalAdvance}, Total Used: ${totalUsed}`);\n      \n      const remainingBalance = totalAdvance - totalUsed;\n      \n      console.log(`[DEBUG] User ${userId} - Calculated Balance: ${remainingBalance}`);\n      \n      // Return 0 if balance would be negative (user can't have negative advance balance)\n      const finalBalance = Math.max(0, remainingBalance);\n      console.log(`[DEBUG] User ${userId} - Final Balance: ${finalBalance}`);\n      \n      return finalBalance;\n    } catch (error) {\n      console.error(`Error calculating advance payment for user ${userId}:`, error);\n      return 0;\n    }\n  }\n}\n\n// Initialize the database and storage\nasync function initializeDatabase() {\n  // Database initialization can happen here if needed\n  console.log(\"Database initialized\");\n}\n\nexport const storage = new DatabaseStorage();","size_bytes":36509},"local-deployment/client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"local-deployment/client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5615},"local-deployment/client/src/pages/users.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type User, UserRole } from \"@shared/schema\";\nimport { Link } from \"wouter\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport BulkUserUpload from \"@/components/bulk-user-upload\";\n\n// User form schema - dynamic based on user role\nconst createUserFormSchema = (currentUserRole: string) => z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  username: z.string().min(3, \"Username must be at least 3 characters\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  email: z.string().email(\"Please enter a valid email\"),\n  mobile: z.string().min(10, \"Mobile number should be at least 10 digits\"),\n  address: z.string().optional(),\n  role: currentUserRole === 'admin' \n    ? z.enum([\"admin\", \"operator\", \"viewer\"])\n    : z.enum([\"operator\", \"viewer\"]), // Operators can only create operator/viewer users\n  status: z.enum([\"active\", \"inactive\"])\n});\n\nexport default function Users() {\n  const { user, isLoading } = useAuth();\n  const { toast } = useToast();\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n  const [isNewUserDialogOpen, setIsNewUserDialogOpen] = useState(false);\n  const [isEditUserDialogOpen, setIsEditUserDialogOpen] = useState(false);\n  const [showBulkUpload, setShowBulkUpload] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  \n  // Show loading while authentication is being checked\n  if (isLoading) {\n    return (\n      <div className=\"flex-grow flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2\"></div>\n          <p className=\"text-neutral-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  // Only allow access for admin and operator\n  if (!user || (user.role !== 'admin' && user.role !== 'operator')) {\n    return (\n      <div className=\"flex-grow flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold mb-2\">Access Denied</h2>\n          <p className=\"text-neutral-600\">You don't have permission to access user management.</p>\n        </div>\n      </div>\n    );\n  }\n  \n  const userFormSchema = createUserFormSchema(user.role);\n  type UserFormValues = z.infer<typeof userFormSchema>;\n  \n  // Form for new user\n  const newUserForm = useForm<UserFormValues>({\n    resolver: zodResolver(userFormSchema),\n    defaultValues: {\n      name: \"\",\n      username: \"\",\n      password: \"\",\n      email: \"\",\n      mobile: \"\",\n      address: \"\",\n      role: \"viewer\",\n      status: \"active\"\n    }\n  });\n  \n  // Form for editing user\n  const editUserForm = useForm<Partial<UserFormValues>>({\n    resolver: zodResolver(userFormSchema.partial()),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      mobile: \"\",\n      address: \"\",\n      role: \"viewer\",\n      status: \"active\"\n    }\n  });\n  \n  // Fetch users\n  const { data: allUsers, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n\n  // Filter users based on role and search term\n  const users = useMemo(() => {\n    if (!allUsers) return [];\n    \n    // Role-based filtering: operators can't see admin users\n    let filteredUsers = allUsers;\n    if (user?.role === 'operator') {\n      filteredUsers = allUsers.filter(u => u.role !== 'admin');\n    }\n    \n    // Search filtering across all displayed user details\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filteredUsers = filteredUsers.filter(u => \n        u.name.toLowerCase().includes(searchLower) ||\n        u.username.toLowerCase().includes(searchLower) ||\n        u.email.toLowerCase().includes(searchLower) ||\n        (u.mobile && u.mobile.toLowerCase().includes(searchLower)) ||\n        (u.address && u.address.toLowerCase().includes(searchLower)) ||\n        u.role.toLowerCase().includes(searchLower) ||\n        u.status.toLowerCase().includes(searchLower)\n      );\n    }\n    \n    // Sort by serial number in ascending order\n    return filteredUsers.sort((a, b) => a.serialNumber - b.serialNumber);\n  }, [allUsers, user?.role, searchTerm]);\n  \n  // Create user mutation\n  const createUserMutation = useMutation({\n    mutationFn: async (userData: UserFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/users\", userData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"User created successfully\",\n      });\n      setIsNewUserDialogOpen(false);\n      newUserForm.reset();\n      // Invalidate all user-related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create user: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Update user mutation\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number, data: Partial<UserFormValues> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/users/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"User updated successfully\",\n      });\n      setIsEditUserDialogOpen(false);\n      editUserForm.reset();\n      \n      // Invalidate all user-related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // If the updated user is the current logged-in user, also refresh the auth user data\n      if (user && selectedUser && user.id === selectedUser.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      }\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update user: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Submit handlers\n  const onCreateUser = (data: UserFormValues) => {\n    createUserMutation.mutate(data);\n  };\n  \n  const onUpdateUser = (data: Partial<UserFormValues>) => {\n    if (!selectedUser) return;\n    updateUserMutation.mutate({ id: selectedUser.id, data });\n  };\n  \n  // Handle edit button click\n  const handleEditUser = (user: User) => {\n    setSelectedUser(user);\n    editUserForm.reset({\n      name: user.name,\n      email: user.email,\n      mobile: user.mobile || \"\",\n      address: user.address || \"\",\n      role: user.role as \"admin\" | \"operator\" | \"viewer\",\n      status: user.status as \"active\" | \"inactive\"\n    });\n    setIsEditUserDialogOpen(true);\n  };\n\n  if (usersLoading) {\n    return <div className=\"flex justify-center p-8\">Loading users...</div>;\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-xl font-medium\">User Management</h1>\n        <div className=\"flex gap-2\">\n          <Button \n            onClick={() => setShowBulkUpload(!showBulkUpload)}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"flex items-center gap-2\"\n          >\n            <span className=\"material-icons text-sm\">upload_file</span>\n            Bulk Upload\n          </Button>\n        </div>\n      </div>\n      \n      {/* Bulk Upload Section */}\n      {showBulkUpload && (\n        <div className=\"mb-6\">\n          <BulkUserUpload />\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <Dialog open={isNewUserDialogOpen} onOpenChange={setIsNewUserDialogOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"rounded-full h-10 w-10 p-0\" variant=\"default\">\n                <span className=\"material-icons\">person_add</span>\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Create New User</DialogTitle>\n            </DialogHeader>\n            <Form {...newUserForm}>\n              <form onSubmit={newUserForm.handleSubmit(onCreateUser)} className=\"space-y-4 py-4\">\n                <FormField\n                  control={newUserForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Full Name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Username</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Username\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <Input type=\"password\" placeholder=\"Password\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Email\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Mobile Number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select role\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {user.role === 'admin' && (\n                            <SelectItem value=\"admin\">Admin</SelectItem>\n                          )}\n                          <SelectItem value=\"operator\">Operator</SelectItem>\n                          <SelectItem value=\"viewer\">Viewer</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={newUserForm.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">Active</SelectItem>\n                          <SelectItem value=\"inactive\">Inactive</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={createUserMutation.isPending}\n                >\n                  {createUserMutation.isPending ? \"Creating...\" : \"Create User\"}\n                </Button>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n      \n      {/* Search Bar */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n            <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n          </span>\n          <Input \n            placeholder=\"Search users by name, username, email, mobile, address, role, or status\" \n            className=\"w-full pl-10 pr-4 py-2\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n        {searchTerm && (\n          <p className=\"text-sm text-neutral-600 mt-2\">\n            Found {users.length} user{users.length !== 1 ? 's' : ''} matching \"{searchTerm}\"\n          </p>\n        )}\n      </div>\n      \n      {/* User List */}\n      <div>\n        {!users || users.length === 0 ? (\n          <div className=\"text-center py-8 text-neutral-500\">No users found</div>\n        ) : (\n          users.map(user => (\n            <div \n              key={user.id} \n              className=\"bg-white rounded-lg shadow-md p-4 mb-4 flex justify-between items-center\"\n            >\n              <div>\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className=\"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 font-mono\">\n                    #{user.serialNumber}\n                  </span>\n                  <Link href={`/users/${user.id}`}>\n                    <h3 className=\"font-medium text-primary hover:underline cursor-pointer\">{user.name}</h3>\n                  </Link>\n                </div>\n                <p className=\"text-sm text-neutral-500\">{user.email}</p>\n                {user.mobile && <p className=\"text-sm text-neutral-500\">üì± {user.mobile}</p>}\n                {user.address && <p className=\"text-sm text-neutral-500\">üè† {user.address}</p>}\n                <div className=\"flex items-center mt-1\">\n                  <span className={`text-xs ${user.role === UserRole.ADMIN ? 'bg-secondary' : 'bg-primary'} text-white px-2 py-0.5 rounded-full mr-2`}>\n                    {user.role}\n                  </span>\n                  <span className={`text-xs ${user.status === 'active' ? 'bg-green-500' : 'bg-neutral-500'} text-white px-2 py-0.5 rounded-full`}>\n                    {user.status}\n                  </span>\n                </div>\n              </div>\n              <div>\n                <Button \n                  variant=\"ghost\" \n                  className=\"text-primary p-2\"\n                  onClick={() => handleEditUser(user)}\n                >\n                  <span className=\"material-icons\">edit</span>\n                </Button>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n      \n      {/* Edit User Dialog */}\n      <Dialog open={isEditUserDialogOpen} onOpenChange={setIsEditUserDialogOpen}>\n        <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit User</DialogTitle>\n          </DialogHeader>\n          {selectedUser && (\n            <Form {...editUserForm}>\n              <form onSubmit={editUserForm.handleSubmit(onUpdateUser)} className=\"space-y-4 py-4\">\n                <FormField\n                  control={editUserForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Full Name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Email\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Mobile Number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select role\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {user.role === 'admin' && (\n                            <SelectItem value=\"admin\">Admin</SelectItem>\n                          )}\n                          <SelectItem value=\"operator\">Operator</SelectItem>\n                          <SelectItem value=\"viewer\">Viewer</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editUserForm.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Status</FormLabel>\n                      <Select \n                        onValueChange={field.onChange} \n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select status\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">Active</SelectItem>\n                          <SelectItem value=\"inactive\">Inactive</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={updateUserMutation.isPending}\n                >\n                  {updateUserMutation.isPending ? \"Updating...\" : \"Update User\"}\n                </Button>\n              </form>\n            </Form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":22574},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/user-select.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Check, ChevronsUpDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface User {\n  id: number;\n  name: string;\n  mobile?: string;\n  address?: string;\n}\n\ninterface UserSelectProps {\n  value?: number;\n  onValueChange: (value: number | undefined) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport function UserSelect({ value, onValueChange, placeholder = \"Select user\", disabled = false, className }: UserSelectProps) {\n  const [open, setOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  const { data: users, isLoading } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const selectedUser = users?.find(user => user.id === value);\n\n  const formatUserDisplay = (user: User) => {\n    const parts = [user.name];\n    if (user.mobile) parts.push(user.mobile);\n    if (user.address) parts.push(user.address);\n    return parts.join(' - ');\n  };\n\n  const filteredUsers = useMemo(() => {\n    if (!users) return [];\n    if (!searchTerm) return users;\n    \n    const searchLower = searchTerm.toLowerCase();\n    return users.filter(user => \n      user.name.toLowerCase().includes(searchLower) ||\n      (user.mobile && user.mobile.toLowerCase().includes(searchLower)) ||\n      (user.address && user.address.toLowerCase().includes(searchLower))\n    );\n  }, [users, searchTerm]);\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\"w-full justify-between\", className)}\n          disabled={disabled || isLoading}\n        >\n          {selectedUser ? formatUserDisplay(selectedUser) : (isLoading ? \"Loading users...\" : placeholder)}\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-[400px] p-0\">\n        <div className=\"p-2\">\n          <Input\n            placeholder=\"Search users by name, mobile, or address...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full\"\n          />\n        </div>\n        <div className=\"max-h-[200px] overflow-auto\">\n          {filteredUsers.length > 0 ? (\n            filteredUsers.map((user) => (\n              <div\n                key={user.id}\n                className={cn(\n                  \"flex items-center px-2 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground\",\n                  value === user.id && \"bg-accent text-accent-foreground\"\n                )}\n                onClick={() => {\n                  onValueChange(user.id === value ? undefined : user.id);\n                  setOpen(false);\n                  setSearchTerm(\"\");\n                }}\n              >\n                <Check\n                  className={cn(\n                    \"mr-2 h-4 w-4\",\n                    value === user.id ? \"opacity-100\" : \"opacity-0\"\n                  )}\n                />\n                <div className=\"flex flex-col\">\n                  <span className=\"font-medium\">{user.name}</span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {user.mobile && `üì± ${user.mobile}`}\n                    {user.mobile && user.address && ' ‚Ä¢ '}\n                    {user.address && `üè† ${user.address}`}\n                  </span>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"px-2 py-2 text-sm text-muted-foreground\">\n              {isLoading ? \"Loading users...\" : searchTerm ? \"No users found matching search\" : \"No users available\"}\n            </div>\n          )}\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}","size_bytes":4060},"client/src/pages/dravya-entry-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Plus } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { EntryType, UnitOfMeasurement, PaymentStatus, type User } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\nexport default function DravyaEntryForm() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  // Form state\n  const [selectedUserId, setSelectedUserId] = useState<number>(0);\n  const [userName, setUserName] = useState(\"\");\n  const [userMobile, setUserMobile] = useState(\"\");\n  const [userAddress, setUserAddress] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  // Removed amount, quantity, and unitOfMeasurement - not needed for dravya entries\n  const [occasion, setOccasion] = useState(\"\");\n  const [boliDate, setBoliDate] = useState(new Date().toISOString().split('T')[0]);\n\n  // Fetch users for selection\n  const { data: users, error: usersError } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  // No need for quantity/UOM logic in dravya entries\n\n  const createEntryMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch('/api/dravya-entries', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create dravya entry');\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (createdEntry) => {\n      // Dravya entries are spiritual donations - successfully created\n      toast({\n        title: \"Success\",\n        description: `Dravya entry created successfully for ${createdEntry.user_name || 'the selected user'}.`,\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/dravya-entries'] });\n      \n      // Clear form\n      setSelectedUserId(0);\n      setUserName(\"\");\n      setUserMobile(\"\");\n      setUserAddress(\"\");\n      setDescription(\"\");\n      setOccasion(\"\");\n      setBoliDate(new Date().toISOString().split('T')[0]);\n      \n      // Navigate to list\n      setTimeout(() => setLocation('/dravya-entries'), 1000);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create dravya entry\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleUserChange = (userId: string) => {\n    const selectedUser = users?.find(u => u.id === parseInt(userId));\n    if (selectedUser) {\n      setSelectedUserId(selectedUser.id);\n      setUserName(selectedUser.name);\n      setUserMobile(selectedUser.mobile || \"\");\n      setUserAddress(selectedUser.address || \"\");\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Basic validation\n    if (selectedUserId <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!description.trim()) {\n      toast({\n        title: \"Error\", \n        description: \"Please provide a description\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Simplified payload for dravya entries - only essential fields\n    const payload = {\n      userId: selectedUserId,\n      userName,\n      userMobile,\n      userAddress,\n      description: description.trim(),\n      occasion: occasion.trim(),\n      entryDate: boliDate,\n      createdBy: user?.username || \"system\",\n    };\n\n    createEntryMutation.mutate(payload);\n  };\n\n  if (usersError) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center text-red-500\">\n              <p>Error loading users. Please refresh the page and try again.</p>\n              <Button onClick={() => window.location.reload()} className=\"mt-4\">\n                Refresh Page\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (user?.role !== 'operator' && user?.role !== 'admin') {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Only operators and admins can create Dravya entries.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={() => setLocation('/dravya-entries')}\n          className=\"flex items-center gap-2\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to Dravya Entries\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Plus className=\"h-5 w-5\" />\n            Create New Dravya Entry\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground\">\n            Dravya entries are spiritual donations that don't require quantity or amount tracking.\n          </p>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* User Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"user\">Name of User *</Label>\n              <UserSelect\n                value={selectedUserId > 0 ? selectedUserId : undefined}\n                onValueChange={(userId) => {\n                  if (userId) {\n                    const selectedUser = users?.find(u => u.id === userId);\n                    if (selectedUser) {\n                      setSelectedUserId(selectedUser.id);\n                      setUserName(selectedUser.name);\n                      setUserMobile(selectedUser.mobile || \"\");\n                      setUserAddress(selectedUser.address || \"\");\n                    }\n                  } else {\n                    setSelectedUserId(0);\n                    setUserName(\"\");\n                    setUserMobile(\"\");\n                    setUserAddress(\"\");\n                  }\n                }}\n                placeholder=\"Search and select user\"\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Line Item Description */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Line Item Description *</Label>\n              <Input \n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"Enter item description\"\n              />\n            </div>\n\n            {/* Quantity and UOM removed - not needed for dravya entries */}\n\n            {/* Occasion */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"occasion\">Occasion</Label>\n              <Input \n                id=\"occasion\"\n                value={occasion}\n                onChange={(e) => setOccasion(e.target.value)}\n                placeholder=\"Enter occasion (optional)\"\n              />\n            </div>\n\n            {/* Date of Entry */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"date\">Date of Entry *</Label>\n              <Input \n                id=\"date\"\n                type=\"date\" \n                value={boliDate}\n                onChange={(e) => setBoliDate(e.target.value)}\n              />\n            </div>\n\n            {/* Amount removed - not needed for dravya entries */}\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setLocation('/dravya-entries')}\n                className=\"flex-1\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={createEntryMutation.isPending}\n                className=\"flex-1\"\n              >\n                {createEntryMutation.isPending ? \"Creating...\" : \"Create Dravya Entry\"}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8911},"local-deployment/client/src/hooks/use-auth.ts":{"content":"import { useContext } from \"react\";\nimport { AuthContext } from \"@/lib/context/auth-context\";\nimport { logout } from \"@/lib/auth\";\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  \n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  \n  return {\n    ...context,\n    logout,\n  };\n}\n","size_bytes":358},"tmp/fix_database_name.sh":{"content":"#!/bin/bash\n# Fix database name in backup file\n\nINPUT_FILE=\"$1\"\nOUTPUT_FILE=\"$2\"\n\n# Replace database name references\nsed 's/DROP DATABASE IF EXISTS neondb;/DROP DATABASE IF EXISTS daan_darpan;/g' \"$INPUT_FILE\" | \\\nsed 's/CREATE DATABASE neondb/CREATE DATABASE daan_darpan/g' | \\\nsed 's/\\\\connect neondb/\\\\connect daan_darpan/g' > \"$OUTPUT_FILE\"\n\necho \"Database name fixed in backup file\"","size_bytes":387},"client/src/components/dravya-hindi-receipt.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DravyaEntry {\n  id: number;\n  userId: number;\n  userName: string;\n  description: string;\n  quantity: number;\n  createdAt: string;\n  userAddress?: string;\n  userMobile?: string;\n}\n\ninterface DravyaHindiReceiptProps {\n  entry: DravyaEntry;\n  receiptNo?: string;\n}\n\nexport function DravyaHindiReceipt({ entry, receiptNo }: DravyaHindiReceiptProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [editableData, setEditableData] = useState({\n    dharmanuyayi: entry.userName || \"\",\n    address: entry.userAddress || \"‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)\",\n    date: new Date().toLocaleDateString('hi-IN', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(/\\//g, '/'),\n    receiptNumber: receiptNo || `DD-${new Date().getFullYear()}-${String(entry.id).padStart(5, '0')}`\n  });\n  const { toast } = useToast();\n\n  const formatDateDDMMYY = (date: string | Date) => {\n    const d = new Date(date);\n    const day = String(d.getDate()).padStart(2, '0');\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const year = String(d.getFullYear()).slice(-2);\n    return `${day}/${month}/${year}`;\n  };\n\n  // Function to convert English names to Hindi\n  const convertToHindi = (text: string): string => {\n    if (!text) return text;\n    \n    // Name and description conversion mappings\n    const conversions: { [key: string]: string } = {\n      // Common English names to Hindi\n      'Akansha': '‡§Ü‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡§æ',\n      'Shailesh': '‡§∂‡•à‡§≤‡•á‡§∂',\n      'Jain': '‡§ú‡•à‡§®',\n      'Sandheliya': '‡§∏‡§Ç‡§ß‡•á‡§≤‡§ø‡§Ø‡§æ',\n      'Suresh': '‡§∏‡•Å‡§∞‡•á‡§∂',\n      'Ramesh': '‡§∞‡§Æ‡•á‡§∂',\n      'Rajesh': '‡§∞‡§æ‡§ú‡•á‡§∂',\n      'Mukesh': '‡§Æ‡•Å‡§ï‡•á‡§∂',\n      'Mahesh': '‡§Æ‡§π‡•á‡§∂',\n      'Dinesh': '‡§¶‡§ø‡§®‡•á‡§∂',\n      'Naresh': '‡§®‡§∞‡•á‡§∂',\n      'Prakash': '‡§™‡•ç‡§∞‡§ï‡§æ‡§∂',\n      'Anil': '‡§Ö‡§®‡§ø‡§≤',\n      'Sunil': '‡§∏‡•Å‡§®‡•Ä‡§≤',\n      'Vinod': '‡§µ‡§ø‡§®‡•ã‡§¶',\n      'Manoj': '‡§Æ‡§®‡•ã‡§ú',\n      'Sandeep': '‡§∏‡§Ç‡§¶‡•Ä‡§™',\n      'Pradeep': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n      'Deepak': '‡§¶‡•Ä‡§™‡§ï',\n      'Ashok': '‡§Ö‡§∂‡•ã‡§ï',\n      'Vijay': '‡§µ‡§ø‡§ú‡§Ø',\n      'Ajay': '‡§Ö‡§ú‡§Ø',\n      'Sanjay': '‡§∏‡§Ç‡§ú‡§Ø',\n      'Ravi': '‡§∞‡§µ‡§ø',\n      'Kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n      'Singh': '‡§∏‡§ø‡§Ç‡§π',\n      'Sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n      'Gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n      'Agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n      'Bansal': '‡§¨‡§Ç‡§∏‡§≤',\n      'Mittal': '‡§Æ‡§ø‡§§‡•ç‡§§‡§≤',\n      'Garg': '‡§ó‡§∞‡•ç‡§ó',\n      'Arora': '‡§Ö‡§∞‡•ã‡§°‡§º‡§æ',\n      'Malhotra': '‡§Æ‡§≤‡•ç‡§π‡•ã‡§§‡•ç‡§∞‡§æ',\n      'Chopra': '‡§ö‡•ã‡§™‡§°‡§º‡§æ',\n      'Kapoor': '‡§ï‡§™‡•Ç‡§∞',\n      'Verma': '‡§µ‡§∞‡•ç‡§Æ‡§æ',\n      'Yadav': '‡§Ø‡§æ‡§¶‡§µ',\n      'Mishra': '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§æ',\n      'Pandey': '‡§™‡§æ‡§Ç‡§°‡•á',\n      'Tiwari': '‡§§‡§ø‡§µ‡§æ‡§∞‡•Ä',\n      'Dubey': '‡§¶‡•Å‡§¨‡•á',\n      'Shukla': '‡§∂‡•Å‡§ï‡•ç‡§≤‡§æ',\n      'Srivastava': '‡§∂‡•ç‡§∞‡•Ä‡§µ‡§æ‡§∏‡•ç‡§§‡§µ',\n      'Tripathi': '‡§§‡•ç‡§∞‡§ø‡§™‡§æ‡§†‡•Ä',\n      \n      // Common descriptions and items to Hindi\n      'bora': '‡§¨‡•ã‡§∞‡§æ',\n      'nariyal': '‡§®‡§æ‡§∞‡§ø‡§Ø‡§≤',\n      'coconut': '‡§®‡§æ‡§∞‡§ø‡§Ø‡§≤',\n      'rice': '‡§ö‡§æ‡§µ‡§≤',\n      'wheat': '‡§ó‡•á‡§π‡•Ç‡§Ç',\n      'dal': '‡§¶‡§æ‡§≤',\n      'oil': '‡§§‡•á‡§≤',\n      'sugar': '‡§ö‡•Ä‡§®‡•Ä',\n      'salt': '‡§®‡§Æ‡§ï',\n      'ghee': '‡§ò‡•Ä',\n      'milk': '‡§¶‡•Ç‡§ß',\n      'fruits': '‡§´‡§≤',\n      'vegetables': '‡§∏‡§¨‡•ç‡§ú‡•Ä',\n      'clothes': '‡§ï‡§™‡§°‡§º‡•á',\n      'books': '‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç',\n      'cash': '‡§®‡§ï‡§¶',\n      'donation': '‡§¶‡§æ‡§®',\n      'food': '‡§≠‡•ã‡§ú‡§®',\n      'grains': '‡§Ö‡§®‡§æ‡§ú',\n      'pulses': '‡§¶‡§æ‡§≤‡•á‡§Ç',\n      'spices': '‡§Æ‡§∏‡§æ‡§≤‡•á',\n      'tea': '‡§ö‡§æ‡§Ø',\n      'coffee': '‡§ï‡•â‡§´‡•Ä',\n      'sweets': '‡§Æ‡§ø‡§†‡§æ‡§à',\n      'flour': '‡§Ü‡§ü‡§æ',\n      'kg': '‡§ï‡§ø‡§≤‡•ã',\n      'liter': '‡§≤‡•Ä‡§ü‡§∞',\n      'packet': '‡§™‡•à‡§ï‡•á‡§ü',\n      'bag': '‡§¨‡•à‡§ó',\n      'box': '‡§°‡§ø‡§¨‡•ç‡§¨‡§æ'\n    };\n\n    let convertedText = text;\n    \n    // Convert each word if it has a Hindi mapping\n    Object.entries(conversions).forEach(([english, hindi]) => {\n      const regex = new RegExp(`\\\\b${english}\\\\b`, 'gi');\n      convertedText = convertedText.replace(regex, hindi);\n    });\n    \n    return convertedText;\n  };\n\n  const generateReceiptHTML = () => {\n    const formattedUserName = convertToHindi(editableData.dharmanuyayi || entry.userName);\n    const hindiAddress = editableData.address;\n    const hindiDescription = convertToHindi(entry.description);\n    \n    // Add cache breaker for images\n    const cacheBreaker = Date.now();\n    \n    return `\n      <!DOCTYPE html>\n      <html lang=\"hi\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${formattedUserName}</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap');\n            \n            body {\n              font-family: 'Noto Sans Devanagari', sans-serif;\n              margin: 0;\n              padding: 5px;\n              background-color: #f5f5f5;\n            }\n            \n            .receipt-container {\n              max-width: 600px;\n              margin: 0 auto;\n              background: white;\n              border: 2px solid #000;\n              border-radius: 8px;\n              padding: 0;\n              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n              font-family: 'Noto Sans Devanagari', Arial, sans-serif;\n            }\n            \n            .receipt-header {\n              text-align: center;\n              border-bottom: 3px solid #000;\n              padding: 12px;\n              background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n              position: relative;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            }\n            \n            .left-logo, .right-logo {\n              position: absolute;\n              top: 12px;\n              width: 60px;\n              height: 60px;\n              object-fit: contain;\n            }\n            \n            .left-logo {\n              left: 15px;\n            }\n            \n            .right-logo {\n              right: 15px;\n            }\n            \n            .center-content {\n              flex: 1;\n              text-align: center;\n            }\n            \n            .temple-name {\n              font-size: 18px;\n              font-weight: 700;\n              color: #d97706;\n              margin: 5px 0 3px 0;\n              text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n            }\n            \n            .temple-subtitle {\n              font-size: 11px;\n              color: #374151;\n              margin: 3px 0;\n              font-weight: 500;\n            }\n            \n            .receipt-title {\n              font-size: 14px;\n              font-weight: 700;\n              color: #1f2937;\n              margin: 8px 0 3px 0;\n              padding: 6px 12px;\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 4px;\n              display: inline-block;\n            }\n            \n            .receipt-body {\n              padding: 10px 15px;\n              flex: 1;\n            }\n            \n            .info-section {\n              margin-bottom: 12px;\n            }\n            \n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n              font-size: 11px;\n            }\n            \n            .left-info, .right-info {\n              flex: 1;\n              color: #333;\n            }\n            \n            .left-info {\n              text-align: left;\n            }\n            \n            .right-info {\n              text-align: right;\n            }\n            \n            .dravya-section {\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 4px;\n              padding: 8px;\n              margin: 12px 0;\n              text-align: center;\n            }\n            \n            .dravya-title {\n              font-size: 12px;\n              font-weight: 700;\n              color: #92400e;\n              margin-bottom: 5px;\n            }\n            \n            .dravya-description {\n              font-size: 11px;\n              font-weight: 600;\n              color: #1f2937;\n            }\n            \n            .signature-area {\n              margin-top: 20px;\n              display: flex;\n              justify-content: space-between;\n              align-items: end;\n            }\n            \n            .signature-box {\n              width: 180px;\n              text-align: center;\n            }\n            \n            .signature-line {\n              border-top: 1px solid #000;\n              padding-top: 6px;\n              margin-top: 30px;\n              font-size: 11px;\n            }\n            \n\n            \n            @media print {\n              .no-print { display: none; }\n              body { padding: 10px; }\n              .receipt-container { max-width: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt-container\">\n            <!-- Header with logos -->\n            <div class=\"receipt-header\">\n              <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" class=\"left-logo\">\n              \n              <div class=\"center-content\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" class=\"right-logo\">\n            </div>\n            \n            <!-- Receipt body -->\n            <div class=\"receipt-body\">\n              <div class=\"info-section\">\n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${editableData.receiptNumber}</div>\n                  <div class=\"right-info\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${editableData.date}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä: ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä ${formattedUserName}</div>\n                  <div class=\"right-info\"></div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§™‡§§‡§æ: ${hindiAddress}</div>\n                  <div class=\"right-info\"></div>\n                </div>\n                \n              </div>\n              \n              <!-- Dravya Section -->\n              <div class=\"dravya-section\">\n                <div class=\"dravya-title\">‡§¶‡§æ‡§® ‡§µ‡§∏‡•ç‡§§‡•Å</div>\n                <div class=\"dravya-description\">${hindiDescription}</div>\n              </div>\n              \n              <!-- Signature area -->\n              <div class=\"signature-area\">\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n              </div>\n              \n              <div style=\"text-align: center; margin-top: 15px; font-size: 10px; color: #666;\">\n                <p><strong>‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</strong></p>\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"no-print\" style=\"text-align: center; margin-top: 20px;\">\n            <button onclick=\"window.print();\" style=\"padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Noto Sans Devanagari', Arial, sans-serif;\">\n              ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n            </button>\n          </div>\n        </body>\n      </html>\n    `;\n  };\n\n  const handleSaveAndPrint = () => {\n    const receiptHTML = generateReceiptHTML();\n    \n    // Create a new window for printing\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(receiptHTML);\n      printWindow.document.close();\n      \n      // Wait for content to load, then print\n      printWindow.onload = () => {\n        setTimeout(() => {\n          printWindow.print();\n        }, 100);\n      };\n      \n      toast({\n        title: \"Success\",\n        description: \"Receipt opened for printing\"\n      });\n    } else {\n      toast({\n        title: \"Error\", \n        description: \"Unable to open print window. Please check popup settings.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" className=\"bg-orange-50 text-orange-700 border-orange-200 hover:bg-orange-100\">\n          üßæ Hindi Receipt\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* Left side - Editable fields */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold\">Edit Receipt Details</h3>\n            \n            <div>\n              <Label htmlFor=\"dharmanuyayi\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä (‡§∏‡§Ç‡§™‡§æ‡§¶‡§®‡•Ä‡§Ø)</Label>\n              <Input\n                id=\"dharmanuyayi\"\n                value={editableData.dharmanuyayi}\n                onChange={(e) => setEditableData({...editableData, dharmanuyayi: e.target.value})}\n                placeholder=\"‡§®‡§æ‡§Æ\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"address\">‡§™‡§§‡§æ (‡§∏‡§Ç‡§™‡§æ‡§¶‡§®‡•Ä‡§Ø)</Label>\n              <Textarea\n                id=\"address\"\n                value={editableData.address}\n                onChange={(e) => setEditableData({...editableData, address: e.target.value})}\n                placeholder=\"‡§™‡§§‡§æ\"\n                rows={2}\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"date\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï (‡§∏‡§Ç‡§™‡§æ‡§¶‡§®‡•Ä‡§Ø)</Label>\n              <Input\n                id=\"date\"\n                value={editableData.date}\n                onChange={(e) => setEditableData({...editableData, date: e.target.value})}\n                placeholder=\"DD/MM/YY\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"receiptNumber\">‡§∞‡§∏‡•Ä‡§¶ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ (‡§∏‡§Ç‡§™‡§æ‡§¶‡§®‡•Ä‡§Ø)</Label>\n              <Input\n                id=\"receiptNumber\"\n                value={editableData.receiptNumber}\n                onChange={(e) => setEditableData({...editableData, receiptNumber: e.target.value})}\n                placeholder=\"‡§∞‡§∏‡•Ä‡§¶ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ\"\n              />\n            </div>\n          </div>\n          \n          {/* Right side - Preview */}\n          <div className=\"border rounded-lg p-4 bg-gray-50\">\n            <h3 className=\"text-lg font-semibold mb-4\">Receipt Preview</h3>\n            <div \n              className=\"bg-white border rounded scale-75 origin-top-left\"\n              style={{ width: '133%', height: 'auto' }}\n              dangerouslySetInnerHTML={{ __html: generateReceiptHTML() }}\n            />\n          </div>\n        </div>\n        \n        <div className=\"flex justify-end gap-2 mt-6\">\n          <Button variant=\"outline\" onClick={() => setIsOpen(false)}>\n            Cancel\n          </Button>\n          <Button onClick={handleSaveAndPrint} className=\"bg-orange-600 hover:bg-orange-700\">\n            Save & Print Receipt\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":16745},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3007},"local-deployment/client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { PaymentStatus, type Entry } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport DailyEarningsCalendar from \"@/components/daily-earnings-calendar\";\nimport DailyPaymentsCalendar from \"@/components/daily-payments-calendar\";\n\ntype DashboardData = {\n  summary: {\n    totalAmount: number;\n    receivedAmount: number;\n    pendingAmount: number;\n    pendingEntries: number;\n    partialEntries: number;\n    completedEntries: number;\n    totalAdvancePayments?: number;\n  };\n  overallSummary: {\n    corpusValue: number;\n    totalReceived: number;\n    totalAdvancePayments: number;\n    totalExpenses: number;\n    totalReceivedOutstanding: number;\n    cashInBank: number;\n  };\n  recentActivity: Entry[];\n};\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case 'pending': return 'bg-destructive';\n    case 'partial': return 'bg-orange-500';\n    case 'full': return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case 'pending': return 'Payment Pending';\n    case 'partial': return 'Partially Paid';\n    case 'full': return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nconst getActivityIcon = (status: string) => {\n  switch(status) {\n    case 'pending': return 'pending';\n    case 'partial': return 'sync';\n    case 'full': return 'check_circle';\n    default: return 'info';\n  }\n};\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  \n  // Block access for viewer role\n  if (user?.role === 'viewer') {\n    return (\n      <div className=\"p-4 text-center\">\n        <h2 className=\"text-lg font-semibold mb-2\">Access Restricted</h2>\n        <p className=\"text-muted-foreground\">Dashboard is not available for your role.</p>\n      </div>\n    );\n  }\n  const [, setLocation] = useLocation();\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  const [startDate, setStartDate] = useState<Date | null>(new Date(new Date().getFullYear(), 0, 1)); // Start of current year\n  const [endDate, setEndDate] = useState<Date | null>(new Date()); // Today\n  \n  // Build query parameters for date range\n  const queryParams = new URLSearchParams();\n  if (startDate) queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  if (endDate) queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n\n  const { data, isLoading, error } = useQuery<DashboardData>({\n    queryKey: ['/api/dashboard', startDate?.toISOString(), endDate?.toISOString()],\n    queryFn: () => fetch(`/api/dashboard?${queryParams.toString()}`).then(res => res.json()),\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 30 * 1000 // Consider data stale after 30 seconds\n  });\n\n  // Dashboard only shows boli entries - dravya entries are completely separate\n  const { data: entries } = useQuery<Entry[]>({\n    queryKey: ['/api/entries'],\n  });\n\n  // Fetch expense entries for total expenses calculation (only for admin/operator)\n  const { data: expenseEntries } = useQuery<any[]>({\n    queryKey: ['/api/expense-entries', startDate?.toISOString(), endDate?.toISOString()],\n    queryFn: () => {\n      const expenseParams = new URLSearchParams();\n      if (startDate) expenseParams.append('startDate', startDate.toISOString().split('T')[0]);\n      if (endDate) expenseParams.append('endDate', endDate.toISOString().split('T')[0]);\n      return fetch(`/api/expense-entries?${expenseParams.toString()}`).then(res => res.json());\n    },\n    enabled: user?.role === 'admin' || user?.role === 'operator', // Only fetch for admin/operator\n    retry: false, // Don't retry on 403 errors\n  });\n\n  // Calculate total expenses from expense entries within date range (only for admin/operator)\n  const totalExpenses = (user?.role === 'admin' || user?.role === 'operator') \n    ? (Array.isArray(expenseEntries) ? expenseEntries.reduce((sum, expense) => {\n        const expenseDate = new Date(expense.expense_date);\n        const isInRange = (!startDate || expenseDate >= startDate) && (!endDate || expenseDate <= endDate);\n        return isInRange ? sum + expense.amount : sum;\n      }, 0) : 0)\n    : 0; // Viewers always get 0 for expenses\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading dashboard data...</div>;\n  }\n\n  if (error) {\n    return <div className=\"p-4 text-destructive\">Error loading dashboard: {error.message}</div>;\n  }\n\n  const { summary, overallSummary, recentActivity } = data || { \n    summary: { \n      totalAmount: 0, \n      receivedAmount: 0, \n      pendingAmount: 0,\n      pendingEntries: 0,\n      partialEntries: 0,\n      completedEntries: 0\n    }, \n    recentActivity: [] \n  };\n\n  return (\n    <div className=\"flex-grow p-4\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-xl font-medium\">Dashboard</h1>\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"flex items-center space-x-2\">\n            <span className=\"text-sm text-muted-foreground\">From:</span>\n            <DatePicker\n              selected={startDate}\n              onChange={(date) => setStartDate(date)}\n              dateFormat=\"yyyy-MM-dd\"\n              className=\"px-3 py-2 border border-neutral-300 rounded-md text-sm\"\n              placeholderText=\"Start date\"\n            />\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <span className=\"text-sm text-muted-foreground\">To:</span>\n            <DatePicker\n              selected={endDate}\n              onChange={(date) => setEndDate(date)}\n              dateFormat=\"yyyy-MM-dd\"\n              className=\"px-3 py-2 border border-neutral-300 rounded-md text-sm\"\n              placeholderText=\"End date\"\n            />\n          </div>\n          <Button \n            onClick={() => {\n              setStartDate(new Date(new Date().getFullYear(), 0, 1));\n              setEndDate(new Date());\n            }}\n            variant=\"outline\"\n            size=\"sm\"\n          >\n            Reset\n          </Button>\n          <div className=\"text-sm bg-primary text-white px-3 py-1 rounded-full\">\n            {user?.role === 'admin' ? 'Admin View' : 'User View'}\n          </div>\n        </div>\n      </div>\n\n      {/* Overall Summary - Independent of filters */}\n      {overallSummary && (\n        <>\n          <h2 className=\"text-lg font-medium mb-3\">Overall Summary</h2>\n          <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6\">\n            <div className=\"grid grid-cols-11 gap-2 items-center\">\n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Corpus as on 31st Jul'25</p>\n                <p className=\"text-xl font-semibold text-blue-600\">‚Çπ{overallSummary.corpusValue.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-green-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Received</p>\n                <p className=\"text-xl font-semibold text-green-600\">‚Çπ{overallSummary.totalReceived.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-orange-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Advance Payments</p>\n                <p className=\"text-xl font-semibold text-orange-600\">‚Çπ{overallSummary.totalAdvancePayments.toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-purple-600\">+</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Received Outstanding</p>\n                <p className=\"text-xl font-semibold text-purple-600\">‚Çπ{(overallSummary.totalReceivedOutstanding || 0).toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-red-600\">-</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-sm text-neutral-600\">Total Expenses</p>\n                <p className=\"text-xl font-semibold text-red-600\">‚Çπ{Math.round(overallSummary.totalExpenses / 100).toLocaleString()}</p>\n              </div>\n              \n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-blue-700\">=</p>\n              </div>\n              \n              <div className=\"text-center bg-white rounded-lg p-3 border-2 border-blue-300 min-w-[140px]\">\n                <p className=\"text-sm text-neutral-600\">Cash in Bank</p>\n                <p className=\"text-xl font-bold text-blue-700\">‚Çπ{overallSummary.cashInBank.toLocaleString()}</p>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n      \n      {/* Boli Entry Receivables Summary - Filtered by date range */}\n      <h2 className=\"text-lg font-medium mb-3\">Boli Entry Receivables Summary</h2>\n      <div className=\"grid grid-cols-5 gap-3 mb-6\">\n        {/* Total Earnings */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Total Earnings</p>\n          <p className=\"text-lg font-medium\">‚Çπ{summary?.totalAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Received Amount */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Received</p>\n          <p className=\"text-lg font-medium text-green-500\">‚Çπ{summary?.receivedAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Pending Amount */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Pending</p>\n          <p className=\"text-lg font-medium text-destructive\">‚Çπ{summary?.pendingAmount?.toLocaleString() || '0'}</p>\n        </div>\n        \n        {/* Total Expenses */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <p className=\"text-xs text-neutral-500\">Total Expenses</p>\n          <p className=\"text-lg font-medium text-red-500\">‚Çπ{(totalExpenses / 100).toLocaleString()}</p>\n        </div>\n        \n        {/* Total Advance Payments - Only show for admin/operator */}\n        {(user?.role === 'admin' || user?.role === 'operator') && (\n          <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n            <p className=\"text-xs text-neutral-500\">Total Advance Payments</p>\n            <p className=\"text-lg font-medium text-orange-600\">‚Çπ{(summary.totalAdvancePayments || 0).toLocaleString()}</p>\n          </div>\n        )}\n      </div>\n      \n      {/* Status Summary */}\n      <h2 className=\"text-lg font-medium mb-3\">Payment Status</h2>\n      <div className=\"grid grid-cols-3 gap-3 mb-6\">\n        {/* Pending Entries */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-destructive\">pending</span>\n            <span className=\"text-lg font-medium\">{summary.pendingEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Pending</p>\n        </div>\n        \n        {/* Partial Entries */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-orange-500\">sync</span>\n            <span className=\"text-lg font-medium\">{summary.partialEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Partial</p>\n        </div>\n        \n        {/* Completed Entries */}\n        <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"material-icons text-green-500\">check_circle</span>\n            <span className=\"text-lg font-medium\">{summary.completedEntries}</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-2\">Completed</p>\n        </div>\n      </div>\n      \n      {/* Daily Earnings Calendar */}\n      <div className=\"mt-6\">\n        <DailyEarningsCalendar />\n      </div>\n      \n      {/* Daily Payments Calendar */}\n      <div className=\"mt-6\">\n        <DailyPaymentsCalendar />\n      </div>\n      \n      {/* Recent Activity */}\n      <div className=\"mt-6\">\n        <h2 className=\"text-lg font-medium mb-3\">Recent Activity</h2>\n        <div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\n          <div>\n            {recentActivity.length === 0 ? (\n              <div className=\"p-8 text-center text-neutral-500\">No recent activity</div>\n            ) : (\n              recentActivity.map(entry => (\n                <div key={entry.id} className=\"flex items-center p-3 border-b border-neutral-200\">\n                  <div className=\"w-10 h-10 rounded-full bg-neutral-200 flex items-center justify-center mr-3\">\n                    <span className=\"material-icons text-neutral-500\">{getActivityIcon(entry.status)}</span>\n                  </div>\n                  <div className=\"flex-grow\">\n                    <div className=\"font-medium\">{entry.description}</div>\n                    <div className=\"text-sm text-neutral-500\">\n                      {entry.userName} - {new Date(entry.auctionDate).toLocaleDateString()}\n                    </div>\n                  </div>\n                  <div>\n                    <span className={`px-2 py-1 rounded-full text-white text-xs font-medium ${getStatusClass(entry.status)}`}>\n                      {getStatusText(entry.status)}\n                    </span>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n          {recentActivity.length > 0 && (\n            <div className=\"p-3 text-center\">\n              <button onClick={() => setLocation('/entries')} className=\"text-primary font-medium text-sm\">View All Activities</button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":14899},"local-deployment/client/src/components/hindi-receipt.tsx":{"content":"import React, { useState, useRef, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Separator } from '@/components/ui/separator';\nimport { Entry, PaymentRecord } from '@shared/schema';\n\ninterface HindiReceiptProps {\n  entry: Entry;\n  payment: PaymentRecord;\n  paymentIndex: number;\n  isOpen: boolean;\n  onClose: () => void;\n  userRole?: string;\n}\n\n// Function to convert numbers to Hindi words\nconst numberToHindiWords = (num: number): string => {\n  const ones = ['', '‡§è‡§ï', '‡§¶‡•ã', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Å‡§ö', '‡§õ‡§π', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];\n  const teens = ['‡§¶‡§∏', '‡§ó‡•ç‡§Ø‡§æ‡§∞‡§π', '‡§¨‡§æ‡§∞‡§π', '‡§§‡•á‡§∞‡§π', '‡§ö‡•å‡§¶‡§π', '‡§™‡§Ç‡§¶‡•ç‡§∞‡§π', '‡§∏‡•ã‡§≤‡§π', '‡§∏‡§§‡•ç‡§∞‡§π', '‡§Ö‡§†‡§æ‡§∞‡§π', '‡§â‡§®‡•ç‡§®‡•Ä‡§∏'];\n  const tens = ['', '', '‡§¨‡•Ä‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†', '‡§∏‡§§‡•ç‡§§‡§∞', '‡§Ö‡§∏‡•ç‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];\n  const hundreds = ['', '‡§è‡§ï ‡§∏‡•å', '‡§¶‡•ã ‡§∏‡•å', '‡§§‡•Ä‡§® ‡§∏‡•å', '‡§ö‡§æ‡§∞ ‡§∏‡•å', '‡§™‡§æ‡§Å‡§ö ‡§∏‡•å', '‡§õ‡§π ‡§∏‡•å', '‡§∏‡§æ‡§§ ‡§∏‡•å', '‡§Ü‡§† ‡§∏‡•å', '‡§®‡•å ‡§∏‡•å'];\n\n  if (num === 0) return '‡§∂‡•Ç‡§®‡•ç‡§Ø';\n  if (num < 10) return ones[num];\n  if (num < 20) return teens[num - 10];\n  if (num < 100) {\n    const tensDigit = Math.floor(num / 10);\n    const onesDigit = num % 10;\n    return tens[tensDigit] + (onesDigit > 0 ? ' ' + ones[onesDigit] : '');\n  }\n  if (num < 1000) {\n    const hundredsDigit = Math.floor(num / 100);\n    const remainder = num % 100;\n    return hundreds[hundredsDigit] + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  if (num < 100000) {\n    const thousands = Math.floor(num / 1000);\n    const remainder = num % 1000;\n    return numberToHindiWords(thousands) + ' ‡§π‡§ú‡§æ‡§∞' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  if (num < 10000000) {\n    const lakhs = Math.floor(num / 100000);\n    const remainder = num % 100000;\n    return numberToHindiWords(lakhs) + ' ‡§≤‡§æ‡§ñ' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n  }\n  \n  const crores = Math.floor(num / 10000000);\n  const remainder = num % 10000000;\n  return numberToHindiWords(crores) + ' ‡§ï‡§∞‡•ã‡§°‡§º' + (remainder > 0 ? ' ' + numberToHindiWords(remainder) : '');\n};\n\n// Note: Payment modes are kept in English as requested\n\n// Function to format date in DD/MM/YY format\nconst formatDateDDMMYY = (dateString: string): string => {\n  const date = new Date(dateString);\n  const day = date.getDate().toString().padStart(2, '0');\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const year = date.getFullYear().toString().slice(-2);\n  return `${day}/${month}/${year}`;\n};\n\n// Simplified Hindi translation function\nconst convertToHindi = (englishText: string): string => {\n  if (!englishText || englishText.trim() === '') return englishText;\n  \n  // If already contains Hindi characters, return as is\n  if (/[\\u0900-\\u097F]/.test(englishText)) {\n    return englishText;\n  }\n  \n  // Focused mapping for common boli descriptions and terms\n  const englishToHindi: { [key: string]: string } = {\n    // Common names\n    'sanskar': '‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shailesh': '‡§∂‡•à‡§≤‡•á‡§∂', \n    'aashi': '‡§Ü‡§∂‡•Ä',\n    'jain': '‡§ú‡•à‡§®',\n    'anand': '‡§Ü‡§®‡§Ç‡§¶',\n    'sunil': '‡§∏‡•Å‡§®‡•Ä‡§≤',\n    'choudhary': '‡§ö‡•å‡§ß‡§∞‡•Ä',\n    'kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n    'singh': '‡§∏‡§ø‡§Ç‡§π',\n    'sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n    'gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n    'agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'system': '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ',\n    'admin': '‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï',\n    'operator': '‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ï',\n    'sanad': '‡§∏‡§®‡§¶',\n    'manish': '‡§Æ‡§®‡•Ä‡§∑',\n    'prasann': '‡§™‡•ç‡§∞‡§∏‡§®‡•ç‡§®',\n    'rajesh': '‡§∞‡§æ‡§ú‡•á‡§∂',\n    'suresh': '‡§∏‡•Å‡§∞‡•á‡§∂',\n    'ramesh': '‡§∞‡§Æ‡•á‡§∂',\n    'mukesh': '‡§Æ‡•Å‡§ï‡•á‡§∂',\n    'dinesh': '‡§¶‡§ø‡§®‡•á‡§∂',\n    'mahesh': '‡§Æ‡§π‡•á‡§∂',\n    'naresh': '‡§®‡§∞‡•á‡§∂',\n    'rakesh': '‡§∞‡§æ‡§ï‡•á‡§∂',\n    'umesh': '‡§â‡§Æ‡•á‡§∂',\n    'yogesh': '‡§Ø‡•ã‡§ó‡•á‡§∂',\n    'ritesh': '‡§∞‡§ø‡§§‡•á‡§∂',\n    'hitesh': '‡§π‡§ø‡§§‡•á‡§∂',\n    'nilesh': '‡§®‡•Ä‡§≤‡•á‡§∂',\n    'pradip': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'pradeep': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'deepak': '‡§¶‡•Ä‡§™‡§ï',\n    'deepika': '‡§¶‡•Ä‡§™‡§ø‡§ï‡§æ',\n    'priya': '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ',\n    'pooja': '‡§™‡•Ç‡§ú‡§æ',\n    'ashish': '‡§Ü‡§∂‡•Ä‡§∑',\n    'sanjay': '‡§∏‡§Ç‡§ú‡§Ø',\n    'ajay': '‡§Ö‡§ú‡§Ø',\n    'vijay': '‡§µ‡§ø‡§ú‡§Ø',\n    'ravi': '‡§∞‡§µ‡§ø',\n    'kiran': '‡§ï‡§ø‡§∞‡§£',\n    'aman': '‡§Ö‡§Æ‡§®',\n    'arun': '‡§Ö‡§∞‡•Å‡§£',\n    'anita': '‡§Ö‡§®‡•Ä‡§§‡§æ',\n    'sunita': '‡§∏‡•Å‡§®‡•Ä‡§§‡§æ',\n    'rekha': '‡§∞‡•á‡§ñ‡§æ',\n    'meera': '‡§Æ‡•Ä‡§∞‡§æ',\n    'seeta': '‡§∏‡•Ä‡§§‡§æ',\n    'geeta': '‡§ó‡•Ä‡§§‡§æ',\n    'rita': '‡§∞‡•Ä‡§§‡§æ',\n    'kavita': '‡§ï‡§µ‡§ø‡§§‡§æ',\n    'savita': '‡§∏‡§µ‡§ø‡§§‡§æ',\n    'mamta': '‡§Æ‡§Æ‡§§‡§æ',\n    'sushma': '‡§∏‡•Å‡§∑‡•ç‡§Æ‡§æ',\n    'krishna': '‡§ï‡•É‡§∑‡•ç‡§£‡§æ',\n    'radha': '‡§∞‡§æ‡§ß‡§æ',\n    'shanti': '‡§∂‡§æ‡§Ç‡§§‡§ø',\n    'bharti': '‡§≠‡§æ‡§∞‡§§‡•Ä',\n    // Places\n    'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',\n    'shivnagar': '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞',\n    'damoh': '‡§¶‡§Æ‡•ã‡§π',\n    'road': '‡§∞‡•ã‡§°',\n    'mp': '‡§Æ.‡§™‡•ç‡§∞.',\n    'madhya': '‡§Æ‡§ß‡•ç‡§Ø',\n    'pradesh': '‡§™‡•ç‡§∞‡§¶‡•á‡§∂',\n    'colony': '‡§ï‡•â‡§≤‡•ã‡§®‡•Ä',\n    'nagar': '‡§®‡§ó‡§∞',\n    'gali': '‡§ó‡§≤‡•Ä',\n    'mohalla': '‡§Æ‡•ã‡§π‡§≤‡•ç‡§≤‡§æ',\n    'ward': '‡§µ‡§æ‡§∞‡•ç‡§°',\n    'near': '‡§ï‡•á ‡§™‡§æ‡§∏',\n    'behind': '‡§ï‡•á ‡§™‡•Ä‡§õ‡•á',\n    'front': '‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á',\n    'street': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü',\n    'sector': '‡§∏‡•á‡§ï‡•ç‡§ü‡§∞',\n    'block': '‡§¨‡•ç‡§≤‡•â‡§ï',\n    'house': '‡§Æ‡§ï‡§æ‡§®',\n    'no': '‡§®‡§Ç',\n    'number': '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',\n    'plot': '‡§™‡•ç‡§≤‡•â‡§ü',\n    'area': '‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',\n    'circle': '‡§∏‡§∞‡•ç‡§ï‡§≤',\n    'phase': '‡§´‡•á‡§ú',\n    'extension': '‡§è‡§ï‡•ç‡§∏‡§ü‡•á‡§Ç‡§∂‡§®',\n    'main': '‡§Æ‡•Å‡§ñ‡•ç‡§Ø',\n    'chowk': '‡§ö‡•å‡§ï',\n    'park': '‡§™‡§æ‡§∞‡•ç‡§ï',\n    'market': '‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü',\n    'complex': '‡§ï‡•â‡§Æ‡•ç‡§™‡•ç‡§≤‡•á‡§ï‡•ç‡§∏',\n    'apartment': '‡§Ö‡§™‡§æ‡§∞‡•ç‡§ü‡§Æ‡•á‡§Ç‡§ü',\n    'society': '‡§∏‡•ã‡§∏‡§æ‡§á‡§ü‡•Ä',\n    'layout': '‡§≤‡•á‡§Ü‡§â‡§ü',\n    'township': '‡§ü‡§æ‡§â‡§®‡§∂‡§ø‡§™',\n    'residency': '‡§∞‡•á‡§∏‡§ø‡§°‡•á‡§Ç‡§∏‡•Ä',\n    'enclave': '‡§è‡§®‡•ç‡§ï‡•ç‡§≤‡•á‡§µ',\n    'heights': '‡§π‡§æ‡§á‡§ü‡•ç‡§∏',\n    'gardens': '‡§ó‡§æ‡§∞‡•ç‡§°‡§®‡•ç‡§∏',\n    'vihar': '‡§µ‡§ø‡§π‡§æ‡§∞',\n    'puram': '‡§™‡•Å‡§∞‡§Æ',\n    'nagri': '‡§®‡§ó‡§∞‡•Ä',\n    'marg': '‡§Æ‡§æ‡§∞‡•ç‡§ó',\n    'path': '‡§™‡§•',\n    'lane': '‡§≤‡•á‡§®',\n    // Common words\n    'shantidhara': '‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ',\n    'puja': '‡§™‡•Ç‡§ú‡§æ',\n    'donation': '‡§¶‡§æ‡§®',\n    'temple': '‡§Æ‡§Ç‡§¶‡§ø‡§∞',\n    'festival': '‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞',\n    'ceremony': '‡§∏‡§Æ‡§æ‡§∞‡•ã‡§π',\n    'abhishek': '‡§Ö‡§≠‡§ø‡§∑‡•á‡§ï',\n    'aarti': '‡§Ü‡§∞‡§§‡•Ä',\n    'prasad': '‡§™‡•ç‡§∞‡§∏‡§æ‡§¶',\n    'darshan': '‡§¶‡§∞‡•ç‡§∂‡§®',\n    'birthday': '‡§ú‡§®‡•ç‡§Æ‡§¶‡§ø‡§®',\n    'anniversary': '‡§µ‡§∞‡•ç‡§∑‡§ó‡§æ‡§Ç‡§†',\n    'marriage': '‡§µ‡§ø‡§µ‡§æ‡§π',\n    'navratri': '‡§®‡§µ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø',\n    'diwali': '‡§¶‡§ø‡§µ‡§æ‡§≤‡•Ä',\n    'holi': '‡§π‡•ã‡§≤‡•Ä',\n    'mahavir': '‡§Æ‡§π‡§æ‡§µ‡•Ä‡§∞',\n    'jayanti': '‡§ú‡§Ø‡§Ç‡§§‡•Ä',\n    'paryushan': '‡§™‡§∞‡•ç‡§Ø‡•Å‡§∑‡§£',\n    'special': '‡§µ‡§ø‡§∂‡•á‡§∑',\n    'occasion': '‡§Ö‡§µ‡§∏‡§∞',\n    'general': '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø',\n    'regular': '‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§',\n    'monthly': '‡§Æ‡§æ‡§∏‡§ø‡§ï',\n    // Key boli description translations\n    'shanti dhara sanskar': '‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ß‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shantidhara sanskar': '‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    'shanti dhara': '‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ß‡§æ‡§∞‡§æ',\n    'dhara': '‡§ß‡§æ‡§∞‡§æ',\n    'food': '‡§≠‡•ã‡§ú‡§®',\n    'decoration': '‡§∏‡§ú‡§æ‡§µ‡§ü',\n    'flowers': '‡§´‡•Ç‡§≤',\n    'offering': '‡§Ö‡§∞‡•ç‡§™‡§£',\n    'daily': '‡§¶‡•à‡§®‡§ø‡§ï',\n    // Common address patterns\n    'p-207': '‡§™‡•Ä-207',\n    'shiv': '‡§∂‡§ø‡§µ'\n  };\n\n  // Convert the entire text as a phrase first, then word by word\n  const lowerText = englishText.toLowerCase();\n  \n  // Check for complete phrase matches first\n  for (const [eng, hindi] of Object.entries(englishToHindi)) {\n    if (lowerText === eng) {\n      return hindi;\n    }\n  }\n  \n  // Split the text into words and convert each word\n  const words = englishText.toLowerCase().split(' ');\n  const hindiWords = words.map(word => {\n    // Remove extra characters and check if word exists in mapping\n    const cleanWord = word.replace(/[^a-zA-Z]/g, '');\n    if (englishToHindi[cleanWord]) {\n      return englishToHindi[cleanWord];\n    }\n    \n    return word; // Return original if no mapping found\n  });\n\n  return hindiWords.join(' ');\n};\n\n// Function to get payment mode in Hindi\nconst getPaymentModeHindi = (mode: string): string => {\n  const modeMap: { [key: string]: string } = {\n    'cash': '‡§®‡§ó‡§¶',\n    'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à',\n    'cheque': '‡§ö‡•á‡§ï',\n    'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó',\n    'online': '‡§ë‡§®‡§≤‡§æ‡§á‡§®',\n    'card': '‡§ï‡§æ‡§∞‡•ç‡§°',\n    'bank_transfer': '‡§¨‡•à‡§Ç‡§ï ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§£',\n    'advance_payment': '‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®'\n  };\n  return modeMap[mode.toLowerCase()] || convertToHindi(mode);\n};\n\n// Local storage key for saved values\nconst SAVED_VALUES_KEY = 'hindi_receipt_saved_values';\n\n// Interface for saved values\ninterface SavedValues {\n  referredBy: string;\n  bediNumber: string;\n  customBediOptions: string[];\n}\n\nexport const HindiReceipt: React.FC<HindiReceiptProps> = ({\n  entry,\n  payment,\n  paymentIndex,\n  isOpen,\n  onClose,\n  userRole\n}) => {\n  const printRef = useRef<HTMLDivElement>(null);\n  \n  // Saved values state\n  const [savedValues, setSavedValues] = useState<SavedValues>({\n    referredBy: '',\n    bediNumber: '1',\n    customBediOptions: []\n  });\n  \n  // Editable fields state\n  const [editableFields, setEditableFields] = useState({\n    userName: entry.userName,\n    referredBy: '',\n    description: entry.description,\n    occasion: entry.occasion,\n    bediNumber: '1'\n  });\n\n  // Additional state for custom bedi number input\n  const [showCustomBediInput, setShowCustomBediInput] = useState(false);\n  const [customBediNumber, setCustomBediNumber] = useState('');\n  \n  // Combined bedi options (default + custom)\n  const allBediOptions = ['1', '2', '3', ...savedValues.customBediOptions];\n\n  // Load saved values on component mount\n  useEffect(() => {\n    const stored = localStorage.getItem(SAVED_VALUES_KEY);\n    if (stored) {\n      const parsedValues = JSON.parse(stored);\n      // Handle backward compatibility - add customBediOptions if missing\n      // Filter out any unwanted default values that might have been saved as custom\n      const cleanCustomOptions = (parsedValues.customBediOptions || []).filter(\n        (option: string) => !['1', '2', '3', 'Pandal', '9'].includes(option)\n      );\n      \n      const fullSavedValues = {\n        referredBy: parsedValues.referredBy || '',\n        bediNumber: parsedValues.bediNumber || '1',\n        customBediOptions: cleanCustomOptions\n      };\n      setSavedValues(fullSavedValues);\n      \n      // Save the cleaned values back to localStorage\n      localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(fullSavedValues));\n      \n      // Auto-fill with saved values\n      setEditableFields(prev => ({\n        ...prev,\n        referredBy: fullSavedValues.referredBy,\n        bediNumber: fullSavedValues.bediNumber\n      }));\n    }\n  }, [isOpen]);\n\n  const handleFieldChange = (field: string, value: string) => {\n    setEditableFields(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  // Function to add custom bedi option permanently\n  const addCustomBediOption = (newOption: string) => {\n    const trimmedOption = newOption.trim();\n    if (trimmedOption && !allBediOptions.includes(trimmedOption)) {\n      const updatedCustomOptions = [...savedValues.customBediOptions, trimmedOption];\n      const updatedSavedValues = {\n        ...savedValues,\n        customBediOptions: updatedCustomOptions,\n        bediNumber: trimmedOption\n      };\n      \n      localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(updatedSavedValues));\n      setSavedValues(updatedSavedValues);\n      \n      // Update editable fields\n      handleFieldChange('bediNumber', trimmedOption);\n      setShowCustomBediInput(false);\n      setCustomBediNumber('');\n    }\n  };\n\n  // Save editable values function\n  const handleSaveValues = () => {\n    const valuesToSave: SavedValues = {\n      referredBy: editableFields.referredBy,\n      bediNumber: editableFields.bediNumber,\n      customBediOptions: savedValues.customBediOptions\n    };\n    \n    localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(valuesToSave));\n    setSavedValues(valuesToSave);\n    alert('Values saved successfully!');\n  };\n\n  const handlePrint = () => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      const currentDate = new Date().toLocaleDateString('hi-IN');\n      const amountInWords = numberToHindiWords(amountInRupees);\n      const paymentModeHindi = getPaymentModeHindi(payment.mode);\n      \n      // Add ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä prefix to user name and convert to Hindi\n      const hindiUserName = convertToHindi(editableFields.userName);\n      const formattedUserName = hindiUserName.startsWith('‡§∂‡•ç‡§∞‡•Ä') || hindiUserName.startsWith('‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä') || hindiUserName.startsWith('‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä')\n        ? hindiUserName \n        : `‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä   ${hindiUserName}`;\n      \n      // Convert all text fields to Hindi\n      const hindiDescription = convertToHindi(editableFields.description);\n      const hindiOccasion = convertToHindi(editableFields.occasion);\n      const hindiAddress = convertToHindi(entry.userAddress || '');\n      \n      // Add cache breaker for images\n      const cacheBreaker = Date.now();\n      \n      const html = `\n        <!DOCTYPE html>\n        <html lang=\"hi\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <title>‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${payment.receiptNo}</title>\n            <style>\n              @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n              \n              body {\n                font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n                margin: 0;\n                padding: 20px;\n                background: white;\n                color: #000;\n                font-size: 14px;\n                line-height: 1.6;\n              }\n              \n              .receipt-container {\n                width: 210mm;\n                height: 148mm;\n                margin: 0 auto;\n                border: 2px solid #000;\n                padding: 0;\n                display: flex;\n                flex-direction: column;\n                box-sizing: border-box;\n              }\n              \n              .receipt-header {\n                text-align: center;\n                padding: 12px;\n                background: #f8f9fa;\n                position: relative;\n                min-height: 70px;\n              }\n              \n              .temple-name {\n                font-size: 22px;\n                font-weight: 700;\n                margin-bottom: 3px;\n                color: #d97706;\n                line-height: 1.1;\n              }\n              \n              .temple-subtitle {\n                font-size: 13px;\n                margin-bottom: 1px;\n                color: #666;\n              }\n              \n              .receipt-title {\n                font-size: 19px;\n                font-weight: 600;\n                margin-top: 4px;\n                color: #000;\n              }\n              \n              .receipt-body {\n                padding: 12px;\n                padding-top: 25px;\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n                font-size: 16px;\n              }\n              \n              .receipt-section {\n                margin-bottom: 1px;\n              }\n              \n              .section-title {\n                font-size: 18px;\n                font-weight: 600;\n                margin-bottom: 10px;\n                color: #374151;\n                border-bottom: 1px solid #e5e7eb;\n                padding-bottom: 5px;\n              }\n              \n              .receipt-row {\n                display: flex;\n                justify-content: flex-start;\n                align-items: center;\n                margin-bottom: 1px;\n                padding: 0;\n                width: 100%;\n                position: relative;\n              }\n              \n              .receipt-label {\n                font-weight: 600;\n                color: #374151;\n                font-size: 16px;\n              }\n              \n              .receipt-value {\n                color: #000;\n                margin-left: 3px;\n                font-size: 16px;\n              }\n              \n              .left-item {\n                display: flex;\n                align-items: center;\n                flex: 0 0 360px; /* Fixed width to prevent wrapping */\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n              }\n              \n              .right-item {\n                display: flex;\n                align-items: center;\n                flex: 0 0 auto;\n                justify-content: flex-start;\n                position: absolute;\n                left: 500px; /* Align with first letter '‡§∏' of '‡§∏‡§Æ‡§ø‡§§‡§ø' */\n                white-space: nowrap;\n              }\n              \n              .amount-section {\n                background: #fef3c7;\n                padding: 6px;\n                border: 1px solid #f59e0b;\n                margin: 6px 0;\n                border-radius: 3px;\n              }\n              \n              .amount-large {\n                font-size: 24px;\n                font-weight: 700;\n                color: #d97706;\n              }\n              \n              .amount-words {\n                font-size: 15px;\n                font-style: italic;\n                margin-top: 2px;\n                color: #92400e;\n              }\n              \n              .signature-section {\n                display: flex;\n                justify-content: space-between;\n                margin-top: 20px;\n                padding-top: 10px;\n                border-top: 1px solid #e5e7eb;\n              }\n              \n              .signature-box {\n                text-align: center;\n                flex: 1;\n                margin: 0 5px;\n              }\n              \n              .signature-line {\n                border-top: 1px solid #000;\n                margin-top: 45px;\n                padding-top: 2px;\n                font-size: 14px;\n                color: #666;\n              }\n              \n              .footer-notes {\n                margin-top: 12px;\n                padding: 8px;\n                background: #f9fafb;\n                border-radius: 3px;\n                text-align: center;\n                font-size: 11px;\n                color: #6b7280;\n              }\n              \n              .user-address {\n                font-size: 14px;\n                color: #6b7280;\n                margin-top: 5px;\n              }\n              \n              .two-column {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                gap: 20px;\n              }\n              \n              .left-column {\n                flex: 1;\n                min-width: 0;\n              }\n              \n              .right-column {\n                flex: 1;\n                text-align: right;\n                min-width: 0;\n              }\n              \n              .single-line {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n              }\n              \n              @media print {\n                body { \n                  margin: 0; \n                  padding: 5px; \n                }\n                .receipt-container {\n                  border: 1px solid #000;\n                  page-break-inside: avoid;\n                  box-shadow: none;\n                }\n                @page {\n                  size: A5 landscape;\n                  margin: 10mm;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"receipt-container\">\n              <!-- Header -->\n              <div class=\"receipt-header\" style=\"position: relative;\">\n                <!-- Left Logo - Jain Stambh (reduced by 10%: 74px - 10% = 67px) -->\n                <div style=\"position: absolute; left: 50px; top: 8px;\">\n                  <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" \n                       alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" style=\"width: 67px; height: 100px; object-fit: contain;\">\n                </div>\n                \n                <!-- Right Logo - New Mandir Color (reduced by 10% from 104px to 94px) -->\n                <div style=\"position: absolute; right: 50px; top: 8px;\">\n                  <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" \n                       alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" style=\"width: 94px; height: 94px; object-fit: contain; border-radius: 50%;\">\n                </div>\n                \n                <!-- Center Text -->\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <!-- Body -->\n              <div class=\"receipt-body\">\n                <!-- Row 1: Receipt Number and Date -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${payment.receiptNo}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${formatDateDDMMYY(payment.date)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 2: User Name and Boli Date -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä:</span>\n                      <span class=\"receipt-value\">${formattedUserName}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${formatDateDDMMYY(entry.auctionDate)}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 3: Address and Payment Method -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§™‡§§‡§æ:</span>\n                      <span class=\"receipt-value\">${hindiAddress ? `${hindiAddress}, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)` : '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)'}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø:</span>\n                      <span class=\"receipt-value\">${paymentModeHindi}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 4: Description and Bedi Number -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§¨‡§æ‡§¨‡§§:</span>\n                      <span class=\"receipt-value\">${hindiDescription}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <span class=\"receipt-label\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                      <span class=\"receipt-value\">${editableFields.bediNumber || '1'}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Row 5: Occasion -->\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"left-item\">\n                      <span class=\"receipt-label\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞:</span>\n                      <span class=\"receipt-value\">${hindiOccasion}</span>\n                    </div>\n                    <div class=\"right-item\">\n                      <!-- Empty right item for spacing -->\n                    </div>\n                  </div>\n                </div>\n                \n                <!-- Amount Section -->\n                <div class=\"amount-section\">\n                  <div class=\"receipt-row\">\n                    <span class=\"receipt-label\">‡§∞‡§æ‡§∂‡§ø (‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç):</span>\n                    <span class=\"receipt-value amount-large\">‚Çπ${amountInRupees.toLocaleString('hi-IN')}</span>\n                  </div>\n                  <div class=\"amount-words\">\n                    ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç: ${amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                  </div>\n                </div>\n                \n                <!-- Signature Section -->\n                <div class=\"signature-section\">\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ï‡§∞‡•ç‡§§‡§æ</div>\n                  </div>\n                </div>\n                \n                <!-- Footer -->\n                <div class=\"footer-notes\">\n                  <div>‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</div>\n                </div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;\n      \n      printWindow.document.write(html);\n      printWindow.document.close();\n      printWindow.focus();\n      \n      // Show print preview instead of immediate print\n      // User can then manually click print from the preview page\n      setTimeout(() => {\n        printWindow.print();\n      }, 1000);\n    }\n  };\n\n  const handleSaveAndPrint = () => {\n    // Convert all English text to Hindi before printing\n    setEditableFields(prev => ({\n      userName: convertToHindi(prev.userName),\n      referredBy: convertToHindi(prev.referredBy),\n      description: convertToHindi(prev.description),\n      occasion: convertToHindi(prev.occasion),\n      bediNumber: prev.bediNumber // Keep as is, no conversion needed\n    }));\n    \n    // Wait a moment for state to update, then print\n    setTimeout(() => {\n      handlePrint();\n    }, 100);\n  };\n\n  const amountInRupees = payment.amount; // Amount is already in rupees\n  const amountInWords = numberToHindiWords(amountInRupees);\n  const currentDate = formatDateDDMMYY(new Date().toISOString());\n  const boliDate = formatDateDDMMYY(entry.auctionDate);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-auto\">\n        <DialogHeader>\n          <DialogTitle>‡§¶‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - Edit & Print</DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          {/* Save Values Section */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-lg font-semibold\">Save Common Values</h3>\n                <Button onClick={handleSaveValues} variant=\"outline\" size=\"sm\">\n                  Save Values\n                </Button>\n              </div>\n              <div className=\"text-sm text-gray-600 mb-2\">\n                Save common values (‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§, ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï) for auto-fill in future receipts\n              </div>\n              {savedValues.referredBy && (\n                <div className=\"text-sm text-green-600\">\n                  ‚úì Saved values: ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§: {savedValues.referredBy}, ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: {savedValues.bediNumber}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Separator />\n\n          {/* Editable Fields - Only for admin and operator */}\n          {userRole !== 'viewer' ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded\">\n              <div>\n                <Label>‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä (Editable)</Label>\n                <Input \n                  value={editableFields.userName}\n                  onChange={(e) => handleFieldChange('userName', e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ (Editable)</Label>\n                <Input \n                  value={editableFields.referredBy}\n                  onChange={(e) => handleFieldChange('referredBy', e.target.value)}\n                  placeholder=\"Enter reference name\"\n                />\n              </div>\n\n              <div>\n                <Label>‡§¨‡§æ‡§¨‡§§ (Editable)</Label>\n                <Input \n                  value={editableFields.description}\n                  onChange={(e) => handleFieldChange('description', e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞ (Editable)</Label>\n                <Input \n                  value={editableFields.occasion}\n                  onChange={(e) => handleFieldChange('occasion', e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï (Editable)</Label>\n                <Select \n                  value={editableFields.bediNumber} \n                  onValueChange={(value) => {\n                    if (value === 'add-more') {\n                      setShowCustomBediInput(true);\n                      setCustomBediNumber('');\n                    } else {\n                      setShowCustomBediInput(false);\n                      handleFieldChange('bediNumber', value);\n                    }\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select ‡§¨‡•á‡§¶‡•Ä number\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {allBediOptions.map((option) => (\n                      <SelectItem key={option} value={option}>{option}</SelectItem>\n                    ))}\n                    <SelectItem value=\"add-more\">Add More</SelectItem>\n                  </SelectContent>\n                </Select>\n                {showCustomBediInput && (\n                  <Input \n                    value={customBediNumber}\n                    onChange={(e) => setCustomBediNumber(e.target.value)}\n                    placeholder=\"Enter custom ‡§¨‡•á‡§¶‡•Ä number\"\n                    className=\"mt-2\"\n                    onBlur={() => {\n                      if (customBediNumber.trim()) {\n                        addCustomBediOption(customBediNumber.trim());\n                      }\n                    }}\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter' && customBediNumber.trim()) {\n                        addCustomBediOption(customBediNumber.trim());\n                      }\n                    }}\n                  />\n                )}\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-4 bg-blue-50 border border-blue-200 rounded text-center\">\n              <p className=\"text-blue-700\">\n                üìÑ Print Only Mode - Receipt fields are not editable for viewers\n              </p>\n            </div>\n          )}\n\n          {/* Receipt Preview - Colorful Format */}\n          <div \n            ref={printRef}\n            className=\"bg-white border-2 border-gray-800 rounded-lg shadow-lg print:shadow-none print:border-2 max-w-2xl mx-auto\"\n          >\n            {/* Header */}\n            <div className=\"bg-gray-100 py-4 px-6 border-b-2 border-gray-800 rounded-t-lg relative\">\n              {/* Left Logo - Jain Symbol */}\n              <div className=\"absolute left-4 top-4\">\n                <img \n                  src=\"/jain-symbol.png\" \n                  alt=\"Jain Symbol\"\n                  className=\"w-16 h-16 object-contain\"\n                />\n              </div>\n              \n              {/* Right Logo - Temple Building */}\n              <div className=\"absolute right-4 top-4\">\n                <img \n                  src=\"/temple-logo.png\" \n                  alt=\"Temple Logo\"\n                  className=\"w-16 h-16 object-contain rounded-full\"\n                />\n              </div>\n              \n              {/* Center Text */}\n              <div className=\"text-center\">\n                <h1 className=\"text-2xl font-bold text-orange-600 mb-2\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</h1>\n                <p className=\"text-gray-600 mb-1\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§¶‡§Æ‡•ã‡§π ‡§∞‡•ã‡§°, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</p>\n                <h2 className=\"text-lg font-semibold text-black mt-2\">‡§¨‡•ã‡§≤‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</h2>\n              </div>\n            </div>\n\n            {/* Body */}\n            <div className=\"p-5 space-y-3\">\n              {/* Row 1: User Name and Address */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä:</span>\n                  <span className=\"text-black\">{editableFields.userName.startsWith('‡§∂‡•ç‡§∞‡•Ä') || editableFields.userName.startsWith('‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä') ? editableFields.userName : `‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä ${editableFields.userName}`}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§™‡§§‡§æ:</span>\n                  <span className=\"text-black\">{entry.userAddress ? `${entry.userAddress}, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)` : '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)'}</span>\n                </div>\n              </div>\n\n              {/* Row 2: Receipt Number and Date */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{payment.receiptNo}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{formatDateDDMMYY(payment.date)}</span>\n                </div>\n              </div>\n\n              {/* Row 3: Description and Bedi Number */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡§æ‡§¨‡§§:</span>\n                  <span className=\"text-black\">{editableFields.description}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{editableFields.bediNumber}</span>\n                </div>\n              </div>\n\n              {/* Row 4: Payment Method */}\n              <div className=\"flex items-center space-x-1\">\n                <span className=\"font-semibold text-gray-700\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø:</span>\n                <span className=\"text-black\">{getPaymentModeHindi(payment.mode)}</span>\n              </div>\n\n              {/* Row 5: Boli Date and Occasion */}\n              <div className=\"flex justify-between items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n                  <span className=\"text-black\">{boliDate}</span>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <span className=\"font-semibold text-gray-700\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞:</span>\n                  <span className=\"text-black\">{editableFields.occasion}</span>\n                </div>\n              </div>\n\n              {/* Amount Section - Highlighted */}\n              <div className=\"bg-yellow-100 border border-yellow-400 rounded p-4 my-4\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"font-semibold text-gray-700\">‡§∞‡§æ‡§∂‡§ø (‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§Æ‡•á‡§Ç):</span>\n                  <span className=\"text-2xl font-bold text-orange-600\">‚Çπ{amountInRupees.toLocaleString('hi-IN')}</span>\n                </div>\n                <div className=\"text-sm italic text-yellow-800\">\n                  ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç: {amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                </div>\n              </div>\n\n              {/* Signature Section */}\n              <div className=\"flex justify-between items-center mt-8 pt-6 border-t border-gray-300\">\n                <div className=\"text-center flex-1\">\n                  <div className=\"border-t border-black mt-10 pt-1 text-xs text-gray-600\">\n                    ‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞\n                  </div>\n                </div>\n                <div className=\"text-center flex-1 mx-4\">\n                  <div className=\"border-t border-black mt-10 pt-1 text-xs text-gray-600\">\n                    ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡§ï‡§∞‡•ç‡§§‡§æ\n                  </div>\n                </div>\n              </div>\n\n              {/* Footer */}\n              <div className=\"bg-gray-50 rounded p-3 text-center mt-6\">\n                <div className=\"text-sm text-gray-600\">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§Ö‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-4 justify-end\">\n            <Button variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            {userRole !== 'viewer' ? (\n              <Button onClick={handleSaveAndPrint} className=\"bg-blue-600 hover:bg-blue-700\">\n                Save & Print Receipt\n              </Button>\n            ) : (\n              <Button onClick={handlePrint} className=\"bg-green-600 hover:bg-green-700\">\n                Print Receipt Only\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};","size_bytes":40434},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"local-deployment/client/src/pages/payment-details.tsx":{"content":"import { useState } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Form, FormField, FormItem, FormControl } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { type Entry, PaymentStatus, PaymentMode, type PaymentRecord, type AdvancePayment } from \"@shared/schema\";\nimport PaymentReceipt from \"@/components/payment-receipt\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { Wallet, Loader2 } from \"lucide-react\";\n\n// Schema for partial payment\nconst partialPaymentSchema = z.object({\n  amount: z.coerce.number()\n    .positive(\"Amount must be positive\")\n    .refine(val => val > 0, \"Amount must be greater than 0\"),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  mode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  fileUrl: z.string().optional()\n});\n\ntype PartialPaymentValues = z.infer<typeof partialPaymentSchema>;\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'bg-destructive';\n    case PaymentStatus.PARTIAL: return 'bg-orange-500';\n    case PaymentStatus.FULL: return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'Payment Pending';\n    case PaymentStatus.PARTIAL: return 'Partially Paid';\n    case PaymentStatus.FULL: return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nexport default function PaymentDetails() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [match, params] = useRoute(\"/entries/:id\");\n  const entryId = match ? parseInt(params.id) : 0;\n  \n  // Hindi receipt state\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: PaymentRecord | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  const todayDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n  const [selectedPayment, setSelectedPayment] = useState<PaymentRecord | null>(null);\n  const [receiptDialogOpen, setReceiptDialogOpen] = useState(false);\n  // Edit mode permanently disabled\n  const isEditMode = false;\n  const editPaymentIndex = null;\n  \n  // Fetch entry details\n  const { data: entry, isLoading } = useQuery<Entry>({\n    queryKey: [`/api/entries/${entryId}`],\n    enabled: entryId > 0,\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 30 * 1000 // Consider data stale after 30 seconds\n  });\n\n  // Get user's advance payments to calculate balance\n  const { data: userAdvancePayments = [] } = useQuery<AdvancePayment[]>({\n    queryKey: [`/api/advance-payments?userId=${entry?.userId}`],\n    enabled: !!entry?.userId && (user?.role === 'admin' || user?.role === 'operator'),\n    staleTime: 0, // Always refetch to get current data\n    gcTime: 0, // Don't cache\n  });\n\n  // Get advance payment balance from server calculation\n  const { data: serverAdvanceBalance = 0 } = useQuery<number>({\n    queryKey: [`/api/users/${entry?.userId}/advance-balance`],\n    enabled: !!entry?.userId && (user?.role === 'admin' || user?.role === 'operator'),\n    staleTime: 0, // Always refetch\n    gcTime: 0, // Don't cache\n  });\n\n  // Use server-calculated balance as the source of truth\n  const advanceBalance = serverAdvanceBalance;\n  \n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [paymentMode, setPaymentMode] = useState<string>(PaymentMode.CASH);\n  \n  const form = useForm<PartialPaymentValues>({\n    resolver: zodResolver(partialPaymentSchema),\n    defaultValues: {\n      amount: 0,\n      date: todayDate,\n      mode: PaymentMode.CASH,\n      fileUrl: ''\n    }\n  });\n  \n  // Full payment mutation\n  const recordFullPaymentMutation = useMutation({\n    mutationFn: async () => {\n      if (!entry) return null;\n      \n      // For full payment, we always use CASH mode as default\n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/payments`, {\n        amount: entry.pendingAmount,\n        date: todayDate,\n        mode: PaymentMode.CASH\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Full payment recorded successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to record payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Delete payment mutation\n  const deletePaymentMutation = useMutation({\n    mutationFn: async (paymentIndex: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/entries/${entryId}/payments/${paymentIndex}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Payment record deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to delete payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Update payment mutation - disabled\n  const updatePaymentMutation = useMutation({\n    mutationFn: async ({ data, paymentIndex }: { data: PartialPaymentValues, paymentIndex: number }) => {\n      // Return error response since update functionality is disabled\n      return Promise.reject(new Error(\"Payment update functionality has been disabled\"));\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Payment update functionality has been disabled`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Partial payment mutation\n  const recordPartialPaymentMutation = useMutation({\n    mutationFn: async (data: PartialPaymentValues) => {\n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/payments`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Partial payment recorded successfully\",\n      });\n      form.reset({ amount: 0, date: todayDate });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to record payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Function to check if file upload is required based on payment mode\n  const isFileUploadRequired = (mode: string): boolean => {\n    return mode === PaymentMode.UPI || mode === PaymentMode.NETBANKING || mode === PaymentMode.CHEQUE;\n  };\n  \n  // Handle file selection\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setSelectedFile(e.target.files[0]);\n    }\n  };\n  \n  // Handle payment mode change\n  const handlePaymentModeChange = (value: string) => {\n    setPaymentMode(value);\n    form.setValue('mode', value as any);\n  };\n  \n  const onSubmitPartialPayment = (data: PartialPaymentValues) => {\n    if (!entry) return;\n    \n    if (data.amount > entry.pendingAmount) {\n      toast({\n        title: \"Error\",\n        description: \"Payment amount cannot exceed pending amount\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Check if file is required but not provided\n    if (isFileUploadRequired(data.mode) && !selectedFile) {\n      toast({\n        title: \"Error\",\n        description: `File upload is required for ${data.mode} payments`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Convert the file to a data URL for immediate viewing\n    if (selectedFile) {\n      // Create a FileReader to convert the file to a data URL\n      const reader = new FileReader();\n      reader.readAsDataURL(selectedFile);\n      \n      reader.onload = () => {\n        // Add the data URL to the form data\n        const fileDataUrl = reader.result as string;\n        const paymentData = {\n          ...data,\n          fileUrl: fileDataUrl\n        };\n        \n        // Now submit the form with the data URL\n        recordPartialPaymentMutation.mutate(paymentData);\n      };\n      \n      reader.onerror = () => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to process the uploaded file\",\n          variant: \"destructive\"\n        });\n      };\n      \n      // Return early since we're handling the submission in the onload callback\n      return;\n    }\n    \n    // Edit mode has been disabled\n    // No condition to enter edit mode anymore\n    \n    // Otherwise, record a new payment\n    recordPartialPaymentMutation.mutate(data);\n  };\n  \n  // Cancel edit function - disabled since editing is no longer available\n  const cancelEdit = () => {\n    form.reset({ amount: 0, date: todayDate, mode: PaymentMode.CASH });\n  };\n  \n  const handleFullPayment = () => {\n    recordFullPaymentMutation.mutate();\n  };\n\n  // Advance payment mutation\n  const recordAdvancePaymentMutation = useMutation({\n    mutationFn: async () => {\n      if (!entry || advanceBalance <= 0) return null;\n      \n      const paymentAmount = Math.min(advanceBalance, entry.pendingAmount);\n      \n      const response = await apiRequest(\"POST\", `/api/entries/${entryId}/advance-payment`, {\n        amount: paymentAmount,\n        date: todayDate,\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      const paymentAmount = Math.min(advanceBalance, entry?.pendingAmount || 0);\n      toast({\n        title: \"Success\",\n        description: `‚Çπ${paymentAmount.toLocaleString()} applied from advance payment`,\n      });\n      // Invalidate all related queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/advance-payments?userId=${entry?.userId}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/advance-payments`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${entry?.userId}/advance-balance`] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to apply advance payment: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Handle advance payment function\n  const handleAdvancePayment = () => {\n    if (!entry || advanceBalance <= 0) return;\n    \n    const paymentAmount = Math.min(advanceBalance, entry.pendingAmount);\n    const isFullPayment = paymentAmount >= entry.pendingAmount;\n    \n    const confirmMessage = isFullPayment \n      ? `This will fully pay the remaining ‚Çπ${entry.pendingAmount.toLocaleString()} using advance payment. Continue?`\n      : `This will apply ‚Çπ${paymentAmount.toLocaleString()} from advance payment, leaving ‚Çπ${(entry.pendingAmount - paymentAmount).toLocaleString()} pending. Continue?`;\n    \n    if (confirm(confirmMessage)) {\n      recordAdvancePaymentMutation.mutate();\n    }\n  };\n\n\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading entry details...</div>;\n  }\n\n  if (!entry) {\n    return (\n      <div className=\"flex-grow p-4\">\n        <div className=\"flex justify-center items-center h-64\">\n          <div className=\"text-center\">\n            <h2 className=\"text-xl font-medium mb-2\">Entry Not Found</h2>\n            <p className=\"text-neutral-500\">The requested entry could not be found.</p>\n            <Button \n              variant=\"link\" \n              className=\"mt-4\"\n              onClick={() => setLocation('/entries')}\n            >\n              Back to Entries\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow flex flex-col\">\n      {/* Header */}\n      <div className=\"bg-primary text-white p-4\">\n        <div className=\"flex justify-between items-center\">\n          <Button \n            variant=\"link\" \n            className=\"mb-2 flex items-center text-white p-0\"\n            onClick={() => setLocation('/entries')}\n          >\n            <span className=\"material-icons mr-1\">arrow_back</span>\n            <span>Back to Entries</span>\n          </Button>\n          \n          {/* Admin Controls */}\n          {user?.role === 'admin' && (\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"bg-white/10 text-white border-white/20 hover:bg-white/20\"\n                onClick={() => {\n                  if (confirm(\"Are you sure you want to delete this entry? This action cannot be undone.\")) {\n                    // Here you would call the API to delete the entry\n                    toast({\n                      title: \"Entry Deleted\",\n                      description: \"The entry has been deleted successfully.\"\n                    });\n                    setLocation('/entries');\n                  }\n                }}\n              >\n                <span className=\"material-icons text-sm mr-1\">delete</span>\n                Delete\n              </Button>\n            </div>\n          )}\n        </div>\n        <h1 className=\"text-xl font-medium\">{entry.description}</h1>\n        <p className=\"text-sm opacity-80\">{entry.userName} - {entry.occasion}</p>\n      </div>\n      \n      {/* Enhanced Details Card - All Table Information */}\n      <div className=\"bg-white m-4 rounded-lg shadow-md p-4\">\n        <div className=\"flex justify-between items-start mb-6\">\n          <h2 className=\"text-lg font-semibold text-neutral-700\">Entry Details</h2>\n          <span className={`px-3 py-1 rounded-full text-white text-sm font-medium ${getStatusClass(entry.status)}`}>\n            {getStatusText(entry.status)}\n          </span>\n        </div>\n        \n        {/* User Information */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-neutral-600\">User Information</p>\n            <div className=\"bg-neutral-50 p-3 rounded-lg\">\n              <p className=\"font-medium text-neutral-800\">{entry.userName}</p>\n              {entry.userMobile && (\n                <p className=\"text-sm text-neutral-600\">üì± {entry.userMobile}</p>\n              )}\n              {entry.userAddress && (\n                <p className=\"text-sm text-neutral-600\">üìç {entry.userAddress}</p>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-neutral-600\">Entry Information</p>\n            <div className=\"bg-neutral-50 p-3 rounded-lg\">\n              <p className=\"text-sm text-neutral-600\">Quantity: <span className=\"font-medium\">{entry.quantity}</span></p>\n              <p className=\"text-sm text-neutral-600\">Boli Date: <span className=\"font-medium\">{new Date(entry.auctionDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span></p>\n              {entry.updatedAt && (\n                <p className=\"text-sm text-neutral-600\">Last Updated: <span className=\"font-medium\">{new Date(entry.updatedAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span></p>\n              )}\n            </div>\n          </div>\n        </div>\n        \n        {/* Financial Summary */}\n        <div className=\"border-t pt-4\">\n          <p className=\"text-sm font-medium text-neutral-600 mb-3\">Financial Summary</p>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"bg-blue-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-blue-600\">Total Amount</p>\n              <p className=\"text-2xl font-bold text-blue-700\">‚Çπ{entry.totalAmount.toLocaleString()}</p>\n            </div>\n            <div className=\"bg-green-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-green-600\">Received Amount</p>\n              <p className=\"text-2xl font-bold text-green-700\">‚Çπ{entry.receivedAmount.toLocaleString()}</p>\n            </div>\n            <div className=\"bg-red-50 p-4 rounded-lg text-center\">\n              <p className=\"text-sm text-red-600\">Pending Amount</p>\n              <p className=\"text-2xl font-bold text-red-700\">‚Çπ{entry.pendingAmount.toLocaleString()}</p>\n            </div>\n          </div>\n        </div>\n        \n        {/* Advance Payment Balance - Only show for admin/operator */}\n        {(user?.role === 'admin' || user?.role === 'operator') && advanceBalance > 0 && (\n          <div className=\"mt-4 p-3 bg-orange-50 rounded-lg border border-orange-200\">\n            <div className=\"flex justify-between items-center\">\n              <div>\n                <p className=\"text-sm text-orange-700 font-medium\">Advance Payment Balance</p>\n                <p className=\"text-lg font-medium text-orange-600\">‚Çπ{advanceBalance.toLocaleString()}</p>\n              </div>\n              <Wallet className=\"h-5 w-5 text-orange-500\" />\n            </div>\n            {entry.pendingAmount > 0 && (\n              <div className=\"mt-3 flex flex-col gap-2\">\n                {advanceBalance > 0 ? (\n                  <>\n                    <p className=\"text-xs text-orange-600\">Available for payment processing</p>\n                    <Button\n                      onClick={handleAdvancePayment}\n                      disabled={recordAdvancePaymentMutation.isPending}\n                      size=\"sm\"\n                      className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n                    >\n                      {recordAdvancePaymentMutation.isPending ? (\n                        <span className=\"flex items-center gap-2\">\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          Processing...\n                        </span>\n                      ) : (\n                        <span className=\"flex items-center gap-2\">\n                          <Wallet className=\"h-4 w-4\" />\n                          Use Advance Payment (‚Çπ{Math.min(advanceBalance, entry.pendingAmount).toLocaleString()})\n                        </span>\n                      )}\n                    </Button>\n                  </>\n                ) : (\n                  <p className=\"text-xs text-orange-500\">No advance balance available</p>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {/* Payment History */}\n      <div className=\"bg-white mx-4 rounded-lg shadow-md overflow-hidden\">\n        <div className=\"p-4 border-b border-neutral-200\">\n          <h2 className=\"font-medium\">Payment History</h2>\n        </div>\n        <div className=\"p-4\">\n          {entry.payments.length === 0 ? (\n            <div className=\"text-center py-4 text-neutral-500\">No payment records yet</div>\n          ) : (\n            entry.payments.map((payment, index) => (\n              <div key={index} className=\"flex justify-between items-center py-3 border-b border-neutral-200\">\n                <div className=\"flex-1\">\n                  <div className=\"font-medium\">{new Date(payment.date).toLocaleDateString()}</div>\n                  <div className=\"text-sm text-neutral-500\">\n                    {payment.mode ? `Via ${payment.mode}` : \"Payment received\"}\n                    {payment.receiptNo && (\n                      <span className=\"ml-2 text-xs bg-neutral-100 px-2 py-1 rounded\">\n                        Receipt: {payment.receiptNo}\n                      </span>\n                    )}\n                    {payment.fileUrl && (\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button \n                            variant=\"link\" \n                            className=\"ml-2 p-0 h-auto text-blue-500 underline\"\n                          >\n                            View Upload\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent className=\"max-w-3xl\">\n                          <DialogHeader>\n                            <DialogTitle>Payment Upload</DialogTitle>\n                          </DialogHeader>\n                          <div className=\"flex justify-center p-2\">\n                            <img \n                              src={payment.fileUrl}\n                              alt=\"Payment upload\" \n                              className=\"max-h-[70vh] object-contain\"\n                            />\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                    )}\n                    \n                    <Button \n                      variant=\"link\" \n                      className=\"ml-2 p-0 h-auto text-blue-500 underline\"\n                      onClick={() => {\n                        setSelectedPayment(payment);\n                        setReceiptDialogOpen(true);\n                      }}\n                    >\n                      View Receipt\n                    </Button>\n                    \n                    <Button \n                      variant=\"link\" \n                      className=\"ml-2 p-0 h-auto text-green-600 underline\"\n                      onClick={() => {\n                        setHindiReceiptState({\n                          isOpen: true,\n                          entry: entry,\n                          payment: payment,\n                          paymentIndex: index\n                        });\n                      }}\n                    >\n                      Hindi Receipt\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"flex items-center\">\n                  <div className=\"font-medium text-green-500\">‚Çπ{payment.amount.toLocaleString()}</div>\n                  \n                  {/* Admin Payment Controls */}\n                  {user?.role === 'admin' && (\n                    <div className=\"flex ml-3\">\n                      {/* Edit payment functionality has been disabled */}\n                      \n                      <Button \n                        variant=\"ghost\" \n                        size=\"sm\"\n                        className=\"h-8 w-8 p-0 text-red-600\"\n                        onClick={() => {\n                          if (confirm(\"Are you sure you want to delete this payment record? This action cannot be undone.\")) {\n                            deletePaymentMutation.mutate(index);\n                          }\n                        }}\n                      >\n                        <span className=\"material-icons text-sm\">delete</span>\n                        <span className=\"sr-only\">Delete</span>\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n      \n      {/* Receipt Dialog */}\n      <Dialog open={receiptDialogOpen} onOpenChange={setReceiptDialogOpen}>\n        <DialogContent className=\"max-w-3xl\">\n          <DialogHeader>\n            <DialogTitle>Payment Receipt</DialogTitle>\n          </DialogHeader>\n          {selectedPayment && entry && (\n            <PaymentReceipt \n              entry={entry} \n              payment={selectedPayment} \n              onClose={() => setReceiptDialogOpen(false)} \n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Add Payment Section (only for operators if payment is not complete) */}\n      {user?.role === 'operator' && entry.status !== PaymentStatus.FULL && (\n        <div className=\"bg-white mx-4 my-4 rounded-lg shadow-md overflow-hidden\">\n          <div className=\"p-4 border-b border-neutral-200\">\n            <h2 className=\"font-medium\">Record Payment</h2>\n          </div>\n          <div className=\"p-4\">\n            <Button \n              variant=\"default\" \n              className=\"w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-md font-medium mb-3\"\n              onClick={handleFullPayment}\n              disabled={recordFullPaymentMutation.isPending}\n            >\n              {recordFullPaymentMutation.isPending \n                ? \"Processing...\" \n                : `Full payment (‚Çπ${entry.pendingAmount.toLocaleString()})`}\n            </Button>\n            \n            <div>\n              <p className=\"text-sm text-neutral-500 mb-2\">Or record partial payment:</p>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmitPartialPayment)}>\n                  {/* Amount Field */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"amount\">Amount</Label>\n                    <FormField\n                      control={form.control}\n                      name=\"amount\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              id=\"amount\"\n                              type=\"number\" \n                              placeholder=\"Enter amount\" \n                              {...field}\n                              onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Payment Date */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"paymentDate\">Payment Date</Label>\n                    <FormField\n                      control={form.control}\n                      name=\"date\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormControl>\n                            <Input \n                              id=\"paymentDate\"\n                              type=\"date\" \n                              {...field}\n                              max={new Date().toISOString().split('T')[0]}\n                            />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* Payment Mode Selector */}\n                  <div className=\"mb-4\">\n                    <Label htmlFor=\"paymentMode\">Payment Mode</Label>\n                    <Select \n                      value={paymentMode} \n                      onValueChange={handlePaymentModeChange}\n                    >\n                      <SelectTrigger id=\"paymentMode\">\n                        <SelectValue placeholder=\"Select payment mode\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value={PaymentMode.CASH}>Cash</SelectItem>\n                        <SelectItem value={PaymentMode.UPI}>UPI</SelectItem>\n                        <SelectItem value={PaymentMode.NETBANKING}>Net Banking</SelectItem>\n                        <SelectItem value={PaymentMode.CHEQUE}>Cheque</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    \n                    <FormField\n                      control={form.control}\n                      name=\"mode\"\n                      render={({ field }) => (\n                        <FormItem className=\"hidden\">\n                          <FormControl>\n                            <Input type=\"hidden\" {...field} />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  \n                  {/* File Upload */}\n                  {isFileUploadRequired(paymentMode) && (\n                    <div className=\"mb-4\">\n                      <Label htmlFor=\"fileUpload\">\n                        {paymentMode === PaymentMode.CHEQUE \n                          ? \"Upload Cheque Image\" \n                          : \"Upload Payment Screenshot\"}\n                      </Label>\n                      <Input \n                        id=\"fileUpload\"\n                        type=\"file\" \n                        accept=\"image/*\"\n                        onChange={handleFileChange}\n                        className=\"mt-1\"\n                      />\n                      <p className=\"text-xs text-neutral-500 mt-1\">\n                        {paymentMode === PaymentMode.CHEQUE \n                          ? \"Upload a clear image of the cheque\" \n                          : \"Upload a screenshot of the payment confirmation\"}\n                      </p>\n                    </div>\n                  )}\n                  \n                  {/* Hidden Date Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"date\"\n                    render={({ field }) => (\n                      <FormItem className=\"hidden\">\n                        <FormControl>\n                          <Input type=\"hidden\" {...field} />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Hidden FileUrl Field */}\n                  <FormField\n                    control={form.control}\n                    name=\"fileUrl\"\n                    render={({ field }) => (\n                      <FormItem className=\"hidden\">\n                        <FormControl>\n                          <Input type=\"hidden\" {...field} />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Submit Button - Edit mode disabled */}\n                  {false ? (\n                    <div className=\"hidden\">\n                      {/* Edit payment functionality has been disabled */}\n                    </div>\n                  ) : (\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full bg-primary text-white\"\n                      disabled={recordPartialPaymentMutation.isPending}\n                    >\n                      {recordPartialPaymentMutation.isPending ? \"Recording payment...\" : \"Record Payment\"}\n                    </Button>\n                  )}\n                </form>\n              </Form>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Hindi Receipt Component */}\n      {hindiReceiptState.isOpen && hindiReceiptState.entry && hindiReceiptState.payment && (\n        <HindiReceipt\n          entry={hindiReceiptState.entry}\n          payment={hindiReceiptState.payment}\n          paymentIndex={hindiReceiptState.paymentIndex}\n          isOpen={hindiReceiptState.isOpen}\n          userRole={user?.role}\n          onClose={() => setHindiReceiptState({\n            isOpen: false,\n            entry: null,\n            payment: null,\n            paymentIndex: -1\n          })}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":32615},"local-deployment/client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3007},"client/src/pages/entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type Entry, PaymentStatus, EntryType, PaymentRecord, recordPaymentSchema } from \"@shared/schema\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { exportBoliEntries } from \"@/lib/excel-export\";\n// Create a simplified media query hook inline since the import is failing\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nconst getStatusClass = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'bg-destructive';\n    case PaymentStatus.PARTIAL: return 'bg-orange-500';\n    case PaymentStatus.FULL: return 'bg-green-500';\n    default: return 'bg-neutral-500';\n  }\n};\n\nconst getStatusText = (status: string) => {\n  switch(status) {\n    case PaymentStatus.PENDING: return 'Payment Pending';\n    case PaymentStatus.PARTIAL: return 'Partially Paid';\n    case PaymentStatus.FULL: return 'Fully Paid';\n    default: return 'Unknown';\n  }\n};\n\nconst formatDate = (dateString: string) => {\n  try {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  } catch (e) {\n    return dateString;\n  }\n};\n\n// Function to send WhatsApp reminder\nconst sendWhatsAppReminder = (entry: Entry) => {\n  // Clean phone number (remove spaces, dashes, parentheses)\n  const cleanNumber = entry.userMobile?.replace(/[\\s\\-\\(\\)]/g, '');\n  \n  if (!cleanNumber) {\n    alert('No phone number available for this user');\n    return;\n  }\n  \n  // Format phone number for WhatsApp (ensure it starts with country code)\n  let formattedNumber = cleanNumber;\n  if (!formattedNumber.startsWith('91') && formattedNumber.length === 10) {\n    formattedNumber = '91' + formattedNumber; // Add India country code\n  }\n  \n  // Create reminder message with simple text markers\n  const message = \n    `‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•á ‡§Ö‡§ó‡•ç‡§∞‡§£‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§Ü‡§™‡§ï‡•ã ‡§∏‡•å‡§Æ‡•ç‡§Ø ‡§Ø‡§æ‡§¶ ‡§¶‡§ø‡§≤‡§æ‡§®‡•á ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡•á‡§∑‡§ø‡§§ ‡§π‡•à:\\n\\n` +\n    `üìù ‡§µ‡§ø‡§µ‡§∞‡§£: ${entry.description}\\n` +\n    `üóìÔ∏è ‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatDate(entry.auctionDate)}\\n` +\n    `üí∞ ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.totalAmount.toLocaleString()}\\n` +\n    `‚úÖ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§: ‚Çπ${entry.receivedAmount.toLocaleString()}\\n` +\n    `‚è≥ ‡§∂‡•á‡§∑: ‚Çπ${entry.pendingAmount.toLocaleString()}\\n\\n` +\n    `‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ ‡§π‡•á‡§§‡•Å ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™‡§ø‡§§ ‡§∞‡§æ‡§∂‡§ø ‡§ú‡§Æ‡§æ ‡§ï‡§∞ ‡§™‡•Å‡§£‡•ç‡§Ø ‡§≤‡§æ‡§≠ ‡§∏‡§Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§\\n\\n` +\n    `‡§Ü‡§™‡§ï‡•á ‡§∏‡§π‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;\n  \n  // Create WhatsApp URL using different encoding approach\n  const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedNumber}&text=${encodeURIComponent(message)}`;\n  \n  // Open WhatsApp in new tab/window\n  window.open(whatsappUrl, '_blank');\n};\n\n// Function to handle bulk WhatsApp reminders\nconst sendBulkWhatsAppReminders = (entries: Entry[], selectedIds: number[]) => {\n  const selectedEntries = entries.filter(entry => selectedIds.includes(entry.id));\n  const validEntries = selectedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0);\n  \n  if (validEntries.length === 0) {\n    alert('No valid entries selected for WhatsApp reminders. Entries must have mobile numbers and pending amounts.');\n    return;\n  }\n  \n  // Send reminders with a small delay between each\n  validEntries.forEach((entry, index) => {\n    setTimeout(() => {\n      sendWhatsAppReminder(entry);\n    }, index * 500); // 500ms delay between each message\n  });\n  \n  alert(`WhatsApp reminders will be sent to ${validEntries.length} recipients.`);\n};\n\nexport default function Entries() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [sortBy, setSortBy] = useState(\"serial-desc\");\n  const [boliDateRange, setBoliDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [updatedAtRange, setUpdatedAtRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [isFilterOpen, setIsFilterOpen] = useState(false);\n  const [selectedEntries, setSelectedEntries] = useState<number[]>([]);\n  const [showBulkActions, setShowBulkActions] = useState(false);\n  const [hindiReceiptState, setHindiReceiptState] = useState<{\n    isOpen: boolean;\n    entry: Entry | null;\n    payment: PaymentRecord | null;\n    paymentIndex: number;\n  }>({\n    isOpen: false,\n    entry: null,\n    payment: null,\n    paymentIndex: -1\n  });\n  const isMobile = useMediaQuery(\"(max-width: 640px)\");\n  const { toast } = useToast();\n  \n  const [activeTab, setActiveTab] = useState(\"active\");\n  \n  const { data: entries, isLoading } = useQuery<Entry[]>({\n    queryKey: ['/api/entries'],\n    // Increase refetch intervals for fresher data\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 0, // Always consider data stale to ensure fresh updates\n    gcTime: 0 // Don't cache old data in memory\n  });\n  \n  // Query for deleted entries (admin only)\n  const { data: deletedEntries, isLoading: isLoadingDeleted } = useQuery<any[]>({\n    queryKey: ['/api/entries/deleted'],\n    enabled: user?.role === 'admin' && activeTab === 'deleted',\n    refetchOnMount: true,\n    staleTime: 0\n  });\n  \n  // Function to handle entry restoration (admin only)\n  const handleRestoreEntry = async (entryId: number, description: string) => {\n    // Double-check admin role before allowing restore\n    if (user?.role !== 'admin') {\n      toast({\n        title: \"Access Denied\",\n        description: \"Only administrators can restore deleted entries.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (confirm(`Are you sure you want to restore entry \"${description}\"?`)) {\n      try {\n        await apiRequest('PUT', `/api/entries/${entryId}/restore`);\n        toast({\n          title: \"Entry Restored\",\n          description: \"The entry has been successfully restored.\"\n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/entries/deleted'] });\n      } catch (error) {\n        console.error(\"Error restoring entry:\", error);\n        toast({\n          title: \"Restore Failed\",\n          description: \"There was a problem restoring the entry. Please try again.\",\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n  \n  // Function to handle entry deletion\n  const handleDeleteEntry = async (entry: Entry) => {\n    if (confirm(`Are you sure you want to delete entry \"${entry.description}\"? This action cannot be undone.`)) {\n      try {\n        await apiRequest('DELETE', `/api/entries/${entry.id}`);\n        toast({\n          title: \"Entry Deleted\",\n          description: \"The entry has been successfully deleted and logged as a transaction.\"\n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      } catch (error) {\n        console.error(\"Error deleting entry:\", error);\n        toast({\n          title: \"Delete Failed\",\n          description: \"There was a problem deleting the entry. Please try again.\",\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n\n  // Filter only Boli entries (all entries in this system are boli entries)\n  // Add serial numbers: earliest entry gets serial 1, latest gets highest number\n  const boliEntries = useMemo(() => {\n    if (!entries) return [];\n    \n    // Sort entries by ID (creation order) to assign serial numbers\n    const sortedByCreation = [...entries].sort((a, b) => a.id - b.id);\n    \n    // Add serial numbers (earliest gets 1, latest gets highest)\n    return sortedByCreation.map((entry, index) => ({\n      ...entry,\n      serialNumber: index + 1\n    }));\n  }, [entries]);\n\n  // Filter and sort entries\n  const filteredAndSortedEntries = useMemo(() => {\n    if (!boliEntries) return [];\n    \n    // First apply filters\n    let filtered = boliEntries.filter(entry => {\n      // Apply text search independently\n      const searchLower = searchTerm.toLowerCase();\n      const matchesSearch = searchTerm === \"\" || \n        entry.description.toLowerCase().includes(searchLower) ||\n        entry.userName.toLowerCase().includes(searchLower) ||\n        entry.occasion.toLowerCase().includes(searchLower) ||\n        (entry.userMobile && entry.userMobile.toLowerCase().includes(searchLower)) ||\n        (entry.userAddress && entry.userAddress.toLowerCase().includes(searchLower));\n      \n      if (!matchesSearch) return false;\n      \n      // Apply status filter independently\n      const matchesStatus = statusFilter === \"all\" || entry.status === statusFilter;\n      if (!matchesStatus) return false;\n      \n      // Apply boli date range filter independently\n      if (boliDateRange[0] || boliDateRange[1]) {\n        const entryDate = new Date(entry.auctionDate);\n        \n        if (boliDateRange[0]) {\n          // Start date is set, check if entry date is on or after it\n          const startDate = new Date(boliDateRange[0]);\n          startDate.setHours(0, 0, 0, 0);\n          if (entryDate < startDate) {\n            return false;\n          }\n        }\n        \n        if (boliDateRange[1]) {\n          // End date is set, check if entry date is on or before it\n          const endDate = new Date(boliDateRange[1]);\n          // Set to end of day to include the full day\n          endDate.setHours(23, 59, 59, 999);\n          if (entryDate > endDate) {\n            return false;\n          }\n        }\n      }\n      \n      // Apply updated at range filter independently\n      if (updatedAtRange[0] || updatedAtRange[1]) {\n        // If entry doesn't have updatedAt, filter it out if filtering by updated date\n        if (!entry.updatedAt) {\n          return false;\n        }\n        \n        const entryUpdateDate = new Date(entry.updatedAt);\n        \n        if (updatedAtRange[0]) {\n          // Start date is set, check if entry date is on or after it\n          const startDate = new Date(updatedAtRange[0]);\n          startDate.setHours(0, 0, 0, 0);\n          if (entryUpdateDate < startDate) {\n            return false;\n          }\n        }\n        \n        if (updatedAtRange[1]) {\n          // End date is set, check if entry date is on or before it\n          const endDate = new Date(updatedAtRange[1]);\n          // Set to end of day to include the full day\n          endDate.setHours(23, 59, 59, 999);\n          if (entryUpdateDate > endDate) {\n            return false;\n          }\n        }\n      }\n      \n      // If it passes all filters, include it\n      return true;\n    });\n    \n    // Then sort\n    return filtered.sort((a, b) => {\n      switch(sortBy) {\n        case \"serial-asc\":\n          return (a as any).serialNumber - (b as any).serialNumber;\n        case \"serial-desc\":\n          return (b as any).serialNumber - (a as any).serialNumber;\n        case \"date-asc\":\n          return new Date(a.auctionDate).getTime() - new Date(b.auctionDate).getTime();\n        case \"date-desc\":\n          return new Date(b.auctionDate).getTime() - new Date(a.auctionDate).getTime();\n        case \"amount-asc\":\n          return a.totalAmount - b.totalAmount;\n        case \"amount-desc\":\n          return b.totalAmount - a.totalAmount;\n        case \"name-asc\":\n          return a.userName.localeCompare(b.userName);\n        case \"name-desc\":\n          return b.userName.localeCompare(a.userName);\n        default:\n          return (b as any).serialNumber - (a as any).serialNumber; // Default to serial desc\n      }\n    });\n  }, [entries, searchTerm, statusFilter, sortBy, boliDateRange, updatedAtRange]);\n  \n  const handleViewDetails = (entryId: number) => {\n    setLocation(`/entries/${entryId}`);\n  };\n  \n  // Bulk selection functions\n  const handleSelectEntry = (entryId: number) => {\n    setSelectedEntries(prev => {\n      const newSelection = prev.includes(entryId) \n        ? prev.filter(id => id !== entryId)\n        : [...prev, entryId];\n      setShowBulkActions(newSelection.length > 0);\n      return newSelection;\n    });\n  };\n  \n  const handleSelectAll = () => {\n    const eligibleEntries = filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0);\n    const allEligibleIds = eligibleEntries.map(entry => entry.id);\n    \n    if (selectedEntries.length === allEligibleIds.length) {\n      // Deselect all\n      setSelectedEntries([]);\n      setShowBulkActions(false);\n    } else {\n      // Select all eligible\n      setSelectedEntries(allEligibleIds);\n      setShowBulkActions(allEligibleIds.length > 0);\n    }\n  };\n  \n  const handleBulkWhatsAppReminder = () => {\n    if (selectedEntries.length === 0) return;\n    \n    if (confirm(`Send WhatsApp reminders to ${selectedEntries.length} selected entries?`)) {\n      sendBulkWhatsAppReminders(filteredAndSortedEntries, selectedEntries);\n      setSelectedEntries([]);\n      setShowBulkActions(false);\n    }\n  };\n\n  // Reset search when navigating away\n  useEffect(() => {\n    return () => {\n      setSearchTerm(\"\");\n      setStatusFilter(\"all\");\n      setSortBy(\"serial-desc\");\n    };\n  }, []);\n\n  // Mobile card view for each entry\n  const EntryCard = ({ entry }: { entry: Entry }) => (\n    <Card key={entry.id} className=\"mb-4\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex justify-between items-start\">\n          <div className=\"flex items-start gap-3 flex-1\">\n            {/* Checkbox for bulk selection */}\n            {entry.userMobile && entry.pendingAmount > 0 && (\n              <input\n                type=\"checkbox\"\n                checked={selectedEntries.includes(entry.id)}\n                onChange={() => handleSelectEntry(entry.id)}\n                className=\"mt-1 w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n              />\n            )}\n            <div>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs text-neutral-500 bg-neutral-100 px-2 py-0.5 rounded\">#{(entry as any).serialNumber}</span>\n                <h3 className=\"font-medium text-lg\">{entry.description}</h3>\n              </div>\n              <p className=\"text-sm text-neutral-500\">{entry.userName}</p>\n              {entry.userMobile && (\n                <p className=\"text-xs text-neutral-500\">üì± {entry.userMobile}</p>\n              )}\n            </div>\n          </div>\n          <Badge className={getStatusClass(entry.status)}>\n            {getStatusText(entry.status)}\n          </Badge>\n        </div>\n        <div className=\"grid grid-cols-2 gap-2 my-3 text-sm\">\n          <div>\n            <p className=\"text-neutral-500\">Amount:</p>\n            <p>‚Çπ{entry.amount.toLocaleString()} √ó {entry.quantity}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Total:</p>\n            <p>‚Çπ{entry.totalAmount.toLocaleString()}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Occasion:</p>\n            <p>{entry.occasion}</p>\n          </div>\n          <div>\n            <p className=\"text-neutral-500\">Boli Date:</p>\n            <p>{formatDate(entry.auctionDate)}</p>\n          </div>\n        </div>\n        {entry.userAddress && (\n          <div className=\"text-xs text-neutral-600 mt-1 mb-2\">\n            <span className=\"text-neutral-500\">üìç Address:</span> {entry.userAddress}\n          </div>\n        )}\n        {entry.updatedAt && (\n          <div className=\"text-xs text-neutral-600 mt-1\">\n            <span className=\"text-neutral-500\">Updated:</span> {formatDate(entry.updatedAt)}\n          </div>\n        )}\n        <div className=\"mt-4 pt-2 border-t border-neutral-200\">\n          <div className=\"flex justify-between text-sm mb-3\">\n            <div>\n              <span className=\"text-neutral-500\">Received:</span>\n              <span className=\"text-green-500 font-medium ml-1\">‚Çπ{entry.receivedAmount.toLocaleString()}</span>\n            </div>\n            <div>\n              <span className=\"text-neutral-500\">Pending:</span>\n              <span className=\"text-destructive font-medium ml-1\">‚Çπ{entry.pendingAmount.toLocaleString()}</span>\n            </div>\n          </div>\n          <div className=\"flex flex-wrap gap-2 items-center\">\n            {/* Edit Button - visible to admin and operator */}\n            {user && (user.role === 'admin' || user.role === 'operator') && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setLocation(`/entries/${entry.id}/edit`)}\n                className=\"text-blue-600 border-blue-200 hover:bg-blue-50 flex items-center gap-1\"\n                data-testid={`button-edit-${entry.id}`}\n              >\n                <span className=\"material-icons text-sm\">edit</span>\n                Edit\n              </Button>\n            )}\n            \n            {/* Delete Button - visible to admin only */}\n            {user?.role === 'admin' && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => handleDeleteEntry(entry)}\n                className=\"text-red-600 border-red-200 hover:bg-red-50 flex items-center gap-1\"\n                data-testid={`button-delete-${entry.id}`}\n              >\n                <span className=\"material-icons text-sm\">delete</span>\n                Delete\n              </Button>\n            )}\n            \n            {/* WhatsApp Button */}\n            {entry.userMobile && entry.pendingAmount > 0 && (\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"text-green-600 border-green-200 hover:bg-green-50 flex items-center gap-1\"\n                onClick={() => sendWhatsAppReminder(entry)}\n                title=\"Send WhatsApp Reminder\"\n              >\n                <span className=\"material-icons text-sm\">chat</span>\n                WhatsApp\n              </Button>\n            )}\n            \n            {/* View Details Button */}\n            <Button \n              variant=\"link\" \n              className=\"text-primary font-medium p-0 ml-auto\"\n              onClick={() => handleViewDetails(entry.id)}\n            >\n              View Details ‚Üí\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n\n  // Loading skeleton\n  if (isLoading) {\n    return (\n      <div className=\"flex-grow p-4\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"flex items-center gap-2\">\n            <Skeleton className=\"h-8 w-8 rounded-full\" />\n            <Skeleton className=\"h-8 w-8 rounded-full\" />\n          </div>\n        </div>\n        <Skeleton className=\"h-10 w-full mb-6\" />\n        {Array(3).fill(0).map((_, i) => (\n          <div key={i} className=\"mb-4\">\n            <Skeleton className=\"h-32 w-full rounded-lg\" />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        {/* Header with title and buttons */}\n        <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-xl font-medium\">Boli Entries</h1>\n            \n            {/* Tabs list - show Deleted tab only for admin */}\n            <TabsList>\n              <TabsTrigger value=\"active\" data-testid=\"tab-active-entries\">\n                Active\n              </TabsTrigger>\n              {user?.role === 'admin' && (\n                <TabsTrigger value=\"deleted\" data-testid=\"tab-deleted-entries\">\n                  Deleted\n                </TabsTrigger>\n              )}\n            </TabsList>\n            \n            {/* Bulk actions buttons - only on active tab */}\n            {activeTab === 'active' && showBulkActions && (\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-neutral-500\">\n                {selectedEntries.length} selected\n              </span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                onClick={handleBulkWhatsAppReminder}\n              >\n                <span className=\"material-icons text-sm mr-1\">chat</span>\n                Bulk WhatsApp\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center w-full sm:w-auto gap-2\">\n          {/* Export Button */}\n          <Button \n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => exportBoliEntries(filteredAndSortedEntries)}\n            className=\"bg-green-50 text-green-700 border-green-200 hover:bg-green-100 rounded-full shadow-sm flex gap-2 items-center\"\n          >\n            <span className=\"text-sm\">üìä</span>\n            <span>Export</span>\n          </Button>\n          \n          {/* Past Records Button */}\n          {user && (user.role === 'admin' || user.role === 'operator') && (\n            <Button \n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setLocation('/previous-outstanding/new')}\n              className=\"bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 rounded-full shadow-sm flex gap-2 items-center\"\n            >\n              <span className=\"text-sm\">üìù</span>\n              <span>Past Records</span>\n            </Button>\n          )}\n          \n          {/* Mobile: Filter Dialog */}\n          {isMobile ? (\n            <Dialog open={isFilterOpen} onOpenChange={setIsFilterOpen}>\n              <DialogTrigger asChild>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"rounded-full bg-white shadow-sm flex gap-2 items-center\"\n                >\n                  <span className=\"material-icons text-neutral-500 text-sm\">filter_list</span>\n                  <span>Filter & Sort</span>\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Filter & Sort Entries</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4 pt-4\">\n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Boli Date Range</label>\n                    <div className=\"datepicker-container w-full\">\n                      <DatePicker\n                        selectsRange={true}\n                        startDate={boliDateRange[0]}\n                        endDate={boliDateRange[1]}\n                        onChange={(update) => {\n                          setBoliDateRange(update);\n                        }}\n                        isClearable={true}\n                        placeholderText=\"Select date range\"\n                        className=\"w-full border rounded-md p-2 text-sm\"\n                        dateFormat=\"MMM d, yyyy\"\n                        calendarClassName=\"calendar-popup\"\n                        monthsShown={2}\n                        showMonthDropdown\n                        showYearDropdown\n                        dropdownMode=\"select\"\n                        renderMonthContent={(month, shortMonth) => (\n                          <div>{shortMonth}</div>\n                        )}\n                        renderCustomHeader={({\n                          date,\n                          decreaseMonth,\n                          increaseMonth,\n                          prevMonthButtonDisabled,\n                          nextMonthButtonDisabled,\n                        }) => (\n                          <div className=\"flex items-center justify-between px-2 py-2\">\n                            <button\n                              onClick={decreaseMonth}\n                              disabled={prevMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_left</span>\n                            </button>\n                            <div className=\"text-lg font-medium\">\n                              {date.toLocaleDateString('en-US', {\n                                month: 'long',\n                                year: 'numeric',\n                              })}\n                            </div>\n                            <button\n                              onClick={increaseMonth}\n                              disabled={nextMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_right</span>\n                            </button>\n                          </div>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Last Updated Range</label>\n                    <div className=\"datepicker-container w-full\">\n                      <DatePicker\n                        selectsRange={true}\n                        startDate={updatedAtRange[0]}\n                        endDate={updatedAtRange[1]}\n                        onChange={(update) => {\n                          setUpdatedAtRange(update);\n                        }}\n                        isClearable={true}\n                        placeholderText=\"Select date range\"\n                        className=\"w-full border rounded-md p-2 text-sm\"\n                        dateFormat=\"MMM d, yyyy\"\n                        calendarClassName=\"calendar-popup\"\n                        monthsShown={2}\n                        showMonthDropdown\n                        showYearDropdown\n                        dropdownMode=\"select\"\n                        renderCustomHeader={({\n                          date,\n                          decreaseMonth,\n                          increaseMonth,\n                          prevMonthButtonDisabled,\n                          nextMonthButtonDisabled,\n                        }) => (\n                          <div className=\"flex items-center justify-between px-2 py-2\">\n                            <button\n                              onClick={decreaseMonth}\n                              disabled={prevMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_left</span>\n                            </button>\n                            <div className=\"text-lg font-medium\">\n                              {date.toLocaleDateString('en-US', {\n                                month: 'long',\n                                year: 'numeric',\n                              })}\n                            </div>\n                            <button\n                              onClick={increaseMonth}\n                              disabled={nextMonthButtonDisabled}\n                              type=\"button\"\n                              className=\"p-1 rounded-full hover:bg-neutral-100\"\n                            >\n                              <span className=\"material-icons\">chevron_right</span>\n                            </button>\n                          </div>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Status</label>\n                    <Select value={statusFilter} onValueChange={setStatusFilter}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Filter by status\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Statuses</SelectItem>\n                        <SelectItem value={PaymentStatus.PENDING}>Payment Pending</SelectItem>\n                        <SelectItem value={PaymentStatus.PARTIAL}>Partially Paid</SelectItem>\n                        <SelectItem value={PaymentStatus.FULL}>Fully Paid</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div>\n                    <label className=\"text-sm font-medium mb-2 block\">Sort By</label>\n                    <Select value={sortBy} onValueChange={setSortBy}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Sort entries\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"date-desc\">Boli Date (Newest First)</SelectItem>\n                        <SelectItem value=\"date-asc\">Boli Date (Oldest First)</SelectItem>\n                        <SelectItem value=\"amount-desc\">Amount (High to Low)</SelectItem>\n                        <SelectItem value=\"amount-asc\">Amount (Low to High)</SelectItem>\n                        <SelectItem value=\"name-asc\">Name (A to Z)</SelectItem>\n                        <SelectItem value=\"name-desc\">Name (Z to A)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <Button \n                    className=\"w-full\" \n                    onClick={() => setIsFilterOpen(false)}\n                  >\n                    Apply Filters\n                  </Button>\n                </div>\n              </DialogContent>\n            </Dialog>\n          ) : (\n            /* Desktop: Inline filters */\n            <div className=\"flex flex-wrap gap-4\">\n              <div>\n                <label className=\"text-sm whitespace-nowrap mb-1 block\">Boli Date Range</label>\n                <div className=\"datepicker-container w-full\">\n                  <DatePicker\n                    selectsRange={true}\n                    startDate={boliDateRange[0]}\n                    endDate={boliDateRange[1]}\n                    onChange={(update) => {\n                      setBoliDateRange(update);\n                    }}\n                    isClearable={true}\n                    placeholderText=\"Select date range\"\n                    className=\"w-full border rounded-md p-2 text-sm\"\n                    dateFormat=\"MMM d, yyyy\"\n                    monthsShown={2}\n                    showMonthDropdown\n                    showYearDropdown\n                    dropdownMode=\"select\"\n                    renderCustomHeader={({\n                      date,\n                      decreaseMonth,\n                      increaseMonth,\n                      prevMonthButtonDisabled,\n                      nextMonthButtonDisabled,\n                    }) => (\n                      <div className=\"flex items-center justify-between px-2 py-2\">\n                        <button\n                          onClick={decreaseMonth}\n                          disabled={prevMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_left</span>\n                        </button>\n                        <div className=\"text-lg font-medium\">\n                          {date.toLocaleDateString('en-US', {\n                            month: 'long',\n                            year: 'numeric',\n                          })}\n                        </div>\n                        <button\n                          onClick={increaseMonth}\n                          disabled={nextMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_right</span>\n                        </button>\n                      </div>\n                    )}\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <label className=\"text-sm whitespace-nowrap mb-1 block\">Updated Date Range</label>\n                <div className=\"datepicker-container w-full\">\n                  <DatePicker\n                    selectsRange={true}\n                    startDate={updatedAtRange[0]}\n                    endDate={updatedAtRange[1]}\n                    onChange={(update) => {\n                      setUpdatedAtRange(update);\n                    }}\n                    isClearable={true}\n                    placeholderText=\"Select date range\"\n                    className=\"w-full border rounded-md p-2 text-sm\"\n                    dateFormat=\"MMM d, yyyy\"\n                    monthsShown={2}\n                    showMonthDropdown\n                    showYearDropdown\n                    dropdownMode=\"select\"\n                    renderCustomHeader={({\n                      date,\n                      decreaseMonth,\n                      increaseMonth,\n                      prevMonthButtonDisabled,\n                      nextMonthButtonDisabled,\n                    }) => (\n                      <div className=\"flex items-center justify-between px-2 py-2\">\n                        <button\n                          onClick={decreaseMonth}\n                          disabled={prevMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_left</span>\n                        </button>\n                        <div className=\"text-lg font-medium\">\n                          {date.toLocaleDateString('en-US', {\n                            month: 'long',\n                            year: 'numeric',\n                          })}\n                        </div>\n                        <button\n                          onClick={increaseMonth}\n                          disabled={nextMonthButtonDisabled}\n                          type=\"button\"\n                          className=\"p-1 rounded-full hover:bg-neutral-100\"\n                        >\n                          <span className=\"material-icons\">chevron_right</span>\n                        </button>\n                      </div>\n                    )}\n                  />\n                </div>\n              </div>\n              \n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[160px]\">\n                  <SelectValue placeholder=\"Filter by status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  <SelectItem value={PaymentStatus.PENDING}>Payment Pending</SelectItem>\n                  <SelectItem value={PaymentStatus.PARTIAL}>Partially Paid</SelectItem>\n                  <SelectItem value={PaymentStatus.FULL}>Fully Paid</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Select value={sortBy} onValueChange={setSortBy}>\n                <SelectTrigger className=\"w-[160px]\">\n                  <SelectValue placeholder=\"Sort by\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"serial-desc\">Serial No. (Latest First)</SelectItem>\n                  <SelectItem value=\"serial-asc\">Serial No. (Oldest First)</SelectItem>\n                  <SelectItem value=\"date-desc\">Date (Newest First)</SelectItem>\n                  <SelectItem value=\"date-asc\">Date (Oldest First)</SelectItem>\n                  <SelectItem value=\"amount-desc\">Amount (High to Low)</SelectItem>\n                  <SelectItem value=\"amount-asc\">Amount (Low to High)</SelectItem>\n                  <SelectItem value=\"name-asc\">Name (A to Z)</SelectItem>\n                  <SelectItem value=\"name-desc\">Name (Z to A)</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n        </div>\n      </div>\n      \n      {/* Active Entries Tab Content */}\n      <TabsContent value=\"active\" className=\"mt-0\">\n      \n      {/* Search Bar and Select All */}\n      <div className=\"flex gap-4 mb-6\">\n        <div className=\"relative flex-1\">\n          <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n            <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n          </span>\n          <Input \n            type=\"text\" \n            placeholder=\"Search by name, description, or occasion\" \n            className=\"w-full pl-10 pr-4 py-2\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n          />\n        </div>\n        \n        {/* Select All button */}\n        {filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length > 0 && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleSelectAll}\n            className=\"whitespace-nowrap\"\n          >\n            {selectedEntries.length === filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length \n              ? 'Deselect All' : 'Select All'}\n          </Button>\n        )}\n      </div>\n      \n      {/* Empty state */}\n      {(!filteredAndSortedEntries || filteredAndSortedEntries.length === 0) && (\n        <div className=\"text-center py-12 text-neutral-500\">\n          <span className=\"material-icons text-5xl mb-2\">search_off</span>\n          <p className=\"text-lg font-medium\">No entries found</p>\n          <p className=\"text-sm\">Try adjusting your search filters</p>\n        </div>\n      )}\n      \n      {/* Mobile view: Card layout */}\n      {isMobile && filteredAndSortedEntries.length > 0 && (\n        <div>\n          {filteredAndSortedEntries.map(entry => (\n            <EntryCard key={entry.id} entry={entry} />\n          ))}\n        </div>\n      )}\n      \n      {/* Desktop view: Table layout */}\n      {!isMobile && filteredAndSortedEntries.length > 0 && (\n        <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-12\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedEntries.length === filteredAndSortedEntries.filter(entry => entry.userMobile && entry.pendingAmount > 0).length && selectedEntries.length > 0}\n                    onChange={handleSelectAll}\n                    className=\"w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n                  />\n                </TableHead>\n                <TableHead className=\"w-16\">Serial</TableHead>\n                <TableHead>Description</TableHead>\n                <TableHead>User</TableHead>\n                <TableHead className=\"hidden lg:table-cell\">Mobile</TableHead>\n                <TableHead className=\"hidden xl:table-cell\">Address</TableHead>\n                <TableHead>Amount</TableHead>\n                <TableHead className=\"hidden md:table-cell\">Occasion</TableHead>\n                <TableHead className=\"hidden sm:table-cell\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</TableHead>\n                <TableHead className=\"hidden md:table-cell\">Boli Date</TableHead>\n                <TableHead className=\"hidden lg:table-cell\">Updated At</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredAndSortedEntries.map(entry => (\n                <TableRow key={entry.id} className=\"hover:bg-neutral-50\">\n                  <TableCell>\n                    {entry.userMobile && entry.pendingAmount > 0 ? (\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedEntries.includes(entry.id)}\n                        onChange={() => handleSelectEntry(entry.id)}\n                        className=\"w-4 h-4 text-green-600 border-neutral-300 rounded focus:ring-green-500\"\n                      />\n                    ) : (\n                      <span className=\"w-4 h-4 inline-block\"></span>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-sm text-neutral-600\">{(entry as any).serialNumber}</TableCell>\n                  <TableCell className=\"font-medium\">{entry.description}</TableCell>\n                  <TableCell>{entry.userName}</TableCell>\n                  <TableCell className=\"hidden lg:table-cell\">{entry.userMobile || \"-\"}</TableCell>\n                  <TableCell className=\"hidden xl:table-cell\">{entry.userAddress || \"-\"}</TableCell>\n                  <TableCell>\n                    <div>‚Çπ{entry.totalAmount.toLocaleString()}</div>\n                    <div className=\"text-xs text-neutral-500\">\n                      <span className=\"text-green-500\">‚Çπ{entry.receivedAmount.toLocaleString()}</span>\n                      {entry.pendingAmount > 0 && (\n                        <> / <span className=\"text-destructive\">‚Çπ{entry.pendingAmount.toLocaleString()}</span></>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"hidden md:table-cell\">{entry.occasion}</TableCell>\n                  <TableCell className=\"hidden sm:table-cell\">{entry.bediNumber}</TableCell>\n                  <TableCell className=\"hidden md:table-cell\">{formatDate(entry.auctionDate)}</TableCell>\n                  <TableCell className=\"hidden lg:table-cell\">{entry.updatedAt ? formatDate(entry.updatedAt) : \"-\"}</TableCell>\n                  <TableCell>\n                    <Badge className={getStatusClass(entry.status)}>\n                      {getStatusText(entry.status)}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex justify-end items-center space-x-1\">\n                      {entry.userMobile && entry.pendingAmount > 0 && (\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                          onClick={() => sendWhatsAppReminder(entry)}\n                          title=\"Send WhatsApp Reminder\"\n                        >\n                          <span className=\"material-icons text-sm mr-1\">chat</span>\n                          WhatsApp\n                        </Button>\n                      )}\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleViewDetails(entry.id)}\n                      >\n                        View\n                      </Button>\n                      \n                      {/* Edit controls for both operators and admins */}\n                      {(user?.role === 'admin' || user?.role === 'operator') && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => setLocation(`/entries/${entry.id}/edit`)}\n                          className=\"text-blue-600\"\n                        >\n                          <span className=\"material-icons text-sm mr-1\">edit</span>\n                          Edit\n                        </Button>\n                      )}\n                      \n                      {/* Admin-only controls for deleting entries */}\n                      {user?.role === 'admin' && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-red-600\"\n                          onClick={() => handleDeleteEntry(entry)}\n                        >\n                          <span className=\"material-icons text-sm\">delete</span>\n                          <span className=\"sr-only\">Delete</span>\n                        </Button>\n                      )}\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n      )}\n      </TabsContent>\n      \n      {/* Deleted Entries Tab Content */}\n      <TabsContent value=\"deleted\" className=\"mt-0\">\n        <div className=\"mb-6\">\n          <p className=\"text-sm text-neutral-600\">View and restore deleted boli entries.</p>\n        </div>\n        \n        {isLoadingDeleted ? (\n          <div className=\"space-y-4\">\n            {Array(3).fill(0).map((_, i) => (\n              <Skeleton key={i} className=\"h-32 w-full rounded-lg\" />\n            ))}\n          </div>\n        ) : (!deletedEntries || deletedEntries.length === 0) ? (\n          <div className=\"text-center py-12 text-neutral-500\">\n            <span className=\"material-icons text-5xl mb-2\">delete_outline</span>\n            <p className=\"text-lg font-medium\">No deleted entries</p>\n            <p className=\"text-sm\">All your deleted entries will appear here</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {deletedEntries.map((entry: any) => (\n              <Card key={entry.id} className=\"bg-neutral-50\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-medium text-lg\">{entry.description}</h3>\n                      <p className=\"text-sm text-neutral-600\">User: {entry.user_name}</p>\n                      <p className=\"text-sm text-neutral-600\">Amount: ‚Çπ{entry.total_amount?.toLocaleString()}</p>\n                      <p className=\"text-sm text-neutral-600\">Boli Date: {formatDate(entry.auction_date)}</p>\n                      <p className=\"text-sm text-neutral-500\">Deleted entry</p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleRestoreEntry(entry.id, entry.description)}\n                        className=\"text-green-600 border-green-200 hover:bg-green-50\"\n                        data-testid={`button-restore-${entry.id}`}\n                      >\n                        <span className=\"material-icons text-sm mr-1\">restore</span>\n                        Restore\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </TabsContent>\n      \n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":48612},"client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1145},"local-deployment/client/src/components/auth/login-form.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport mandirLogo from \"@assets/new logo mandir color_1754807711657.jpg\";\nimport daanDarpanLogo from \"@assets/generated_images/Hindi_Daan-Darpan_Logo_2653169f.png\";\n\nconst loginFormSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\")\n});\n\ntype LoginFormValues = z.infer<typeof loginFormSchema>;\n\nexport default function LoginForm() {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  \n  const form = useForm<LoginFormValues>({\n    resolver: zodResolver(loginFormSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\"\n    }\n  });\n  \n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", credentials);\n      return response.json();\n    },\n    onMutate: () => {\n      setIsSubmitting(true);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Authentication Failed\",\n        description: error.message || \"Invalid username or password\",\n        variant: \"destructive\"\n      });\n      setIsSubmitting(false);\n    },\n    onSettled: () => {\n      setIsSubmitting(false);\n    }\n  });\n  \n  const onSubmit = (data: LoginFormValues) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col lg:flex-row\">\n      {/* Left Panel - Welcome Section */}\n      <div className=\"flex-1 bg-gradient-to-br from-primary to-primary/80 text-white p-6 lg:p-12 flex flex-col justify-between hidden lg:flex\">\n        <div>\n          {/* Logo Section */}\n          <div className=\"flex items-center gap-3 mb-12\">\n            <img \n              src={mandirLogo} \n              alt=\"‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø\" \n              className=\"w-12 h-12 rounded-full\"\n            />\n            <span className=\"text-lg font-bold\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</span>\n          </div>\n          \n          {/* Welcome Content */}\n          <div className=\"space-y-8\">\n            <h1 className=\"text-4xl font-bold\">‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</h1>\n            <p className=\"text-xl text-white/90 leading-relaxed\">\n              ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§®‡•ã‡§Ç ‡§î‡§∞ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§¶‡§æ‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ‡•§\n            </p>\n            \n            {/* Feature List */}\n            <ul className=\"space-y-4 text-white/90\">\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∞‡§∏‡•Ä‡§¶ ‡§ú‡•á‡§®‡§∞‡•á‡§∂‡§®</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <span className=\"w-2 h-2 bg-white rounded-full\"></span>\n                <span>‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡§π‡•Å‡§Å‡§ö ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£</span>\n              </li>\n            </ul>\n          </div>\n        </div>\n        \n        {/* Footer */}\n        <div className=\"text-white/70 text-sm\">\n          ¬© 2025 ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞. All rights reserved.\n        </div>\n      </div>\n      \n      {/* Right Panel - Login Form */}\n      <div className=\"flex-1 bg-gray-50 flex items-center justify-center p-4 lg:p-8\">\n        <div className=\"w-full max-w-md\">\n          {/* Header with Logo */}\n          <div className=\"text-center mb-8\">\n            {/* Mobile header with both logos */}\n            <div className=\"flex justify-center items-center gap-4 mb-4 lg:hidden\">\n              <img \n                src={mandirLogo} \n                alt=\"‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø\" \n                className=\"w-12 h-12 rounded-full\"\n              />\n              <h1 className=\"text-2xl font-bold text-primary\">‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£</h1>\n            </div>\n            \n            {/* Desktop header with app logo only */}\n            <div className=\"hidden lg:flex justify-center mb-4\">\n              <img \n                src={daanDarpanLogo} \n                alt=\"‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Logo\" \n                className=\"w-16 h-16\"\n              />\n            </div>\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Sign In</h2>\n            <p className=\"text-gray-600\">Enter your credentials to access your account</p>\n          </div>\n          \n          {/* Login Card */}\n          <Card className=\"shadow-lg border-0\">\n            <CardContent className=\"p-8\">\n              <h3 className=\"text-xl font-semibold text-gray-800 mb-6\">Welcome Back</h3>\n              \n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700\">Username</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"Enter username\" \n                            className=\"h-12 border-gray-300 focus:border-primary\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-gray-700\">Password</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"password\" \n                            placeholder=\"Enter password\" \n                            className=\"h-12 border-gray-300 focus:border-primary\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <Button \n                    type=\"submit\" \n                    className=\"w-full h-12 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg\" \n                    disabled={isSubmitting}\n                  >\n                    {isSubmitting ? \"Signing In...\" : \"Sign In\"}\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8199},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { z } from \"zod\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Download, Database, Settings as SettingsIcon } from \"lucide-react\";\n\n// Profile update schema\nconst profileSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  email: z.string().email(\"Please enter a valid email\"),\n  mobile: z.string().min(10, \"Mobile number should be at least 10 digits\").optional(),\n  address: z.string().optional()\n});\n\ntype ProfileFormValues = z.infer<typeof profileSchema>;\n\n// Corpus settings schema\nconst corpusSchema = z.object({\n  corpusValue: z.number().min(0, \"Corpus value must be positive\"),\n  baseDate: z.string().min(1, \"Base date is required\")\n});\n\ntype CorpusFormValues = z.infer<typeof corpusSchema>;\n\nexport default function Settings() {\n  const { user, logout, refreshUser } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [isEditing, setIsEditing] = useState(false);\n\n  // Fetch corpus settings (admin only)\n  const { data: corpusSettings } = useQuery({\n    queryKey: ['/api/corpus-settings'],\n    enabled: user?.role === 'admin',\n    retry: false\n  });\n\n  const profileForm = useForm<ProfileFormValues>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      name: user?.name || \"\",\n      email: user?.email || \"\",\n      mobile: user?.mobile || \"\",\n      address: user?.address || \"\"\n    }\n  });\n\n  const corpusForm = useForm<CorpusFormValues>({\n    resolver: zodResolver(corpusSchema),\n    defaultValues: {\n      corpusValue: 0,\n      baseDate: \"2025-07-31\"\n    }\n  });\n\n  // Update corpus form when settings data loads\n  useEffect(() => {\n    if (corpusSettings && typeof corpusSettings === 'object' && 'corpusValue' in corpusSettings) {\n      corpusForm.reset({\n        corpusValue: corpusSettings.corpusValue as number,\n        baseDate: corpusSettings.baseDate as string\n      });\n    }\n  }, [corpusSettings, corpusForm]);\n\n  // Update profile mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormValues) => {\n      const response = await apiRequest(\"PATCH\", \"/api/auth/profile\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: \"Your profile has been updated successfully\",\n      });\n      \n      // Refresh user data in auth context\n      refreshUser();\n      \n      // Invalidate cached data that might reference this user\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      setIsEditing(false);\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update profile: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Profile update handler\n  const onUpdateProfile = (data: ProfileFormValues) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  // Corpus settings mutation\n  const updateCorpusMutation = useMutation({\n    mutationFn: async (data: CorpusFormValues) => {\n      const response = await apiRequest(\"POST\", \"/api/corpus-settings\", data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: \"Corpus settings updated successfully\",\n      });\n      \n      // Invalidate dashboard data to refresh overall summary\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/corpus-settings'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update corpus settings: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Corpus update handler\n  const onUpdateCorpus = (data: CorpusFormValues) => {\n    updateCorpusMutation.mutate(data);\n  };\n\n  // Database backup mutation\n  const backupMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/database/backup\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      // Automatically download the backup file\n      if (data.downloadUrl) {\n        const link = document.createElement('a');\n        link.href = data.downloadUrl;\n        link.download = data.filename || 'database-backup.xlsx';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n      \n      toast({\n        title: \"Success\",\n        description: data.message || \"Database backup created successfully\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create database backup: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleBackup = () => {\n    backupMutation.mutate();\n  };\n\n  const handleLogout = async () => {\n    const success = await logout();\n    if (success) {\n      toast({\n        title: \"Logged out\",\n        description: \"You have been successfully logged out\",\n      });\n      setLocation(\"/\");\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Logout failed\",\n        description: \"An error occurred during logout\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-6\">\n      <h1 className=\"text-2xl font-bold mb-6\">Settings</h1>\n      \n      <Card className=\"mb-6\">\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle>Profile Information</CardTitle>\n              <CardDescription>\n                Update your personal information\n              </CardDescription>\n            </div>\n            {!isEditing && (\n              <Button \n                onClick={() => setIsEditing(true)}\n                variant=\"outline\"\n              >\n                Edit Profile\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isEditing ? (\n            <Form {...profileForm}>\n              <form onSubmit={profileForm.handleSubmit(onUpdateProfile)} className=\"space-y-4\">\n                <FormField\n                  control={profileForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Full Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Your full name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email Address</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"Your email address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"mobile\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Mobile Number</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder=\"Your mobile number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={profileForm.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Your address\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <div className=\"pt-4 flex gap-2 justify-end\">\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setIsEditing(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={updateProfileMutation.isPending}\n                  >\n                    {updateProfileMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Name</h3>\n                  <p className=\"text-base\">{user?.name}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Username</h3>\n                  <p className=\"text-base\">{user?.username}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Email</h3>\n                  <p className=\"text-base\">{user?.email}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Role</h3>\n                  <p className=\"text-base capitalize\">{user?.role}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Mobile</h3>\n                  <p className=\"text-base\">{user?.mobile || \"-\"}</p>\n                </div>\n                <div>\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Account Status</h3>\n                  <div className=\"flex items-center\">\n                    <span className={`inline-block w-2 h-2 rounded-full mr-2 ${user?.status === 'active' ? 'bg-green-500' : 'bg-gray-400'}`}></span>\n                    <span className=\"capitalize\">{user?.status || 'Active'}</span>\n                  </div>\n                </div>\n              </div>\n              \n              {user?.address && (\n                <div className=\"mt-4\">\n                  <h3 className=\"text-sm font-medium text-neutral-500\">Address</h3>\n                  <p className=\"text-base\">{user.address}</p>\n                </div>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Corpus Settings Section - Only visible to admins */}\n      {user?.role === 'admin' && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <SettingsIcon className=\"h-5 w-5\" />\n              Corpus Settings\n            </CardTitle>\n            <CardDescription>\n              Configure the corpus value as on 31st July 2025 for overall summary calculations\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...corpusForm}>\n              <form onSubmit={corpusForm.handleSubmit(onUpdateCorpus)} className=\"space-y-4\">\n                <FormField\n                  control={corpusForm.control}\n                  name=\"corpusValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Total Corpus as on 31st Jul'25 (‚Çπ)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          placeholder=\"Enter corpus value in rupees\" \n                          {...field} \n                          onChange={(e) => field.onChange(parseFloat(e.target.value) || 0)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={corpusForm.control}\n                  name=\"baseDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Base Date</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <div className=\"pt-4 bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                  <p className=\"text-sm text-blue-800 mb-2\">\n                    <strong>About Corpus Settings:</strong>\n                  </p>\n                  <ul className=\"text-sm text-blue-700 list-disc list-inside space-y-1\">\n                    <li>This value represents the total corpus amount as on the specified base date</li>\n                    <li>Used in Overall Summary calculation: Corpus + Total Received + Advance Payments - Total Expenses = Cash in Bank</li>\n                    <li>Overall Summary is displayed at the top of the Dashboard and works independent of date filters</li>\n                    <li>Only admins can modify this setting</li>\n                  </ul>\n                </div>\n                \n                <Button \n                  type=\"submit\" \n                  disabled={updateCorpusMutation.isPending}\n                  className=\"w-full\"\n                >\n                  {updateCorpusMutation.isPending ? \"Updating...\" : \"Update Corpus Settings\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Database Backup Section - Only visible to operators and admins */}\n      {(user?.role === 'operator' || user?.role === 'admin') && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5\" />\n              Database Management\n            </CardTitle>\n            <CardDescription>\n              Create and email database backup to all operators\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                <p className=\"text-sm text-blue-800 mb-2\">\n                  <strong>Database Backup Features:</strong>\n                </p>\n                <ul className=\"text-sm text-blue-700 list-disc list-inside space-y-1\">\n                  <li>Exports all database tables as Excel sheets (6 worksheets)</li>\n                  <li>Includes: Users, Boli Entries, Advance Payments, Dravya Entries, Expense Entries, Transaction Logs</li>\n                  <li>Automatically downloads backup file to your device</li>\n                  <li>Emails backup to all operators (requires SendGrid API key)</li>\n                  <li>Timestamp included in filename: Database_Backup_YYYY-MM-DD.xlsx</li>\n                </ul>\n                <div className=\"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded\">\n                  <p className=\"text-xs text-yellow-800\">\n                    <strong>Note:</strong> Email functionality requires SendGrid API key configuration. \n                    Without it, backup will still be created and downloaded locally.\n                  </p>\n                </div>\n              </div>\n              <Button \n                onClick={handleBackup}\n                disabled={backupMutation.isPending}\n                className=\"w-full\"\n                variant=\"default\"\n              >\n                {backupMutation.isPending ? (\n                  <>\n                    <Database className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Creating Backup...\n                  </>\n                ) : (\n                  <>\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Create & Download Database Backup\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n      \n      <Card>\n        <CardHeader>\n          <CardTitle>Account Actions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Button \n              variant=\"destructive\" \n              className=\"w-full\" \n              onClick={handleLogout}\n            >\n              Logout\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":17582},"local-deployment/client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* DatePicker Custom Styles - Google Flights style */\n.react-datepicker {\n  @apply shadow-lg border-0 rounded-lg font-sans !important;\n  width: auto !important;\n}\n\n.react-datepicker-wrapper {\n  @apply w-full;\n}\n\n.react-datepicker__month-container {\n  @apply float-left w-64;\n}\n\n.react-datepicker__header {\n  @apply bg-transparent border-b-0 rounded-none py-2 !important;\n}\n\n.react-datepicker__current-month {\n  @apply text-lg font-medium mb-4 !important;\n}\n\n.react-datepicker__day-names {\n  @apply flex justify-around mt-2;\n}\n\n.react-datepicker__day-name {\n  @apply text-xs text-neutral-500 w-8 !important;\n}\n\n.react-datepicker__month {\n  @apply m-0 !important;\n}\n\n.react-datepicker__week {\n  @apply flex justify-around;\n}\n\n.react-datepicker__day {\n  @apply w-8 h-8 m-0 text-sm rounded-full flex items-center justify-center cursor-pointer hover:bg-neutral-100 !important;\n  line-height: 2rem !important;\n}\n\n.react-datepicker__day--keyboard-selected, \n.react-datepicker__day--selected {\n  @apply bg-primary text-white hover:bg-primary/90 !important;\n}\n\n.react-datepicker__day--in-selecting-range, \n.react-datepicker__day--in-range {\n  @apply bg-primary/20 text-primary rounded-none !important;\n}\n\n.react-datepicker__day--range-start,\n.react-datepicker__day--range-end {\n  @apply bg-primary text-white rounded-full !important;\n}\n\n.react-datepicker__triangle {\n  @apply hidden !important;\n}\n\n.react-datepicker__navigation {\n  @apply top-4 !important;\n}\n\n.react-datepicker__navigation--previous {\n  @apply left-2 !important;\n}\n\n.react-datepicker__navigation--next {\n  @apply right-2 !important;\n}\n\n/* Month header styling */\n.react-datepicker__header {\n  @apply py-4 !important;\n}\n\n.datepicker-container {\n  @apply relative;\n}\n\n/* Make popover container large enough for two months */\n.react-datepicker-popper {\n  @apply z-50;\n  min-width: 36rem;\n}\n\n/* Done button styling */\n.datepicker-done-btn {\n  @apply mt-2 px-4 py-2 bg-primary text-white rounded-md float-right mr-4 mb-2;\n}\n\n/* Multi-month layout fixes */\n.react-datepicker__month-container + .react-datepicker__month-container {\n  @apply border-l border-neutral-200;\n}\n\n/* Custom styling to fix calendar display */\n.react-datepicker {\n  display: flex !important;\n  flex-direction: row !important;\n}\n\n/* Ensure second calendar shows next month */\n.react-datepicker .react-datepicker__month-container:nth-child(2) {\n  margin-left: 1rem !important;\n}\n\n/* Custom styling for second month display */\n.react-datepicker .react-datepicker__month-container:nth-child(2) {\n  position: relative;\n}\n\n/* Add a \"June 2025\" label for the second month */\n.react-datepicker .react-datepicker__month-container:nth-child(2)::before {\n  content: \"June 2025\";\n  position: absolute;\n  top: 1rem;\n  left: 0;\n  right: 0;\n  text-align: center;\n  font-weight: 500;\n  font-size: 1rem;\n}\n\n/* Hide the original second month header which would show May 2025 */\n.react-datepicker__month-container:nth-child(2) .react-datepicker__current-month {\n  visibility: hidden !important;\n}\n\n/* Fix specific styling for month containers */\n.react-datepicker__month-container {\n  width: 280px !important;\n  margin: 0 !important;\n}\n\n/* Force Datepicker to use separate month containers */\n.react-datepicker__month--selected {\n  background-color: transparent !important;\n}","size_bytes":3472},"client/src/components/user-form.tsx":{"content":"import { FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { UseFormReturn } from \"react-hook-form\";\nimport { UserRole } from \"@shared/schema\";\nimport { useState, useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function UserFormFields({ \n  form, \n  isNewUser = false, \n  isSubmitting = false \n}: { \n  form: UseFormReturn<any>;\n  isNewUser?: boolean;\n  isSubmitting?: boolean;\n}) {\n  const [mobileCheckResult, setMobileCheckResult] = useState<{ exists: boolean; user?: any } | null>(null);\n  const [isCheckingMobile, setIsCheckingMobile] = useState(false);\n  \n  // Watch mobile field changes\n  const mobileValue = form.watch(\"mobile\");\n  \n  // Check for duplicate mobile when mobile changes and is for new user\n  useEffect(() => {\n    if (!isNewUser || !mobileValue || mobileValue.length < 10) {\n      setMobileCheckResult(null);\n      return;\n    }\n    \n    const timeoutId = setTimeout(async () => {\n      if (mobileValue.length >= 10) {\n        setIsCheckingMobile(true);\n        try {\n          const response = await apiRequest('POST', '/api/users/check-mobile', {\n            mobile: mobileValue\n          });\n          const result = await response.json();\n          setMobileCheckResult(result);\n          \n          // Set form error if mobile exists\n          if (result.exists) {\n            form.setError('mobile', {\n              message: `Mobile number belongs to: ${result.user.name} (${result.user.username})`\n            });\n          } else {\n            form.clearErrors('mobile');\n          }\n        } catch (error) {\n          console.error('Error checking mobile:', error);\n        } finally {\n          setIsCheckingMobile(false);\n        }\n      }\n    }, 500); // Debounce for 500ms\n    \n    return () => clearTimeout(timeoutId);\n  }, [mobileValue, isNewUser, form]);\n  return (\n    <>\n      <FormField\n        control={form.control}\n        name=\"name\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Name</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Full Name\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      {isNewUser && (\n        <>\n          <FormField\n            control={form.control}\n            name=\"username\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Username</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Username\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          \n          <FormField\n            control={form.control}\n            name=\"password\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Password</FormLabel>\n                <FormControl>\n                  <Input type=\"password\" placeholder=\"Password\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </>\n      )}\n      \n      <FormField\n        control={form.control}\n        name=\"email\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Email</FormLabel>\n            <FormControl>\n              <Input type=\"email\" placeholder=\"Email\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"mobile\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Mobile Number</FormLabel>\n            <FormControl>\n              <div className=\"relative\">\n                <Input \n                  type=\"tel\" \n                  placeholder=\"Mobile Number\" \n                  {...field}\n                  className={mobileCheckResult?.exists ? \"border-red-500\" : \"\"}\n                />\n                {isCheckingMobile && (\n                  <div className=\"absolute right-3 top-2.5\">\n                    <div className=\"animate-spin h-4 w-4 border-2 border-gray-300 border-t-blue-600 rounded-full\"></div>\n                  </div>\n                )}\n              </div>\n            </FormControl>\n            <FormMessage />\n            {mobileCheckResult?.exists && (\n              <div className=\"text-sm text-red-600 mt-1\">\n                ‚ö†Ô∏è Mobile number belongs to: <strong>{mobileCheckResult.user.name}</strong> ({mobileCheckResult.user.username})\n              </div>\n            )}\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"address\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Address</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Address\" {...field} />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"role\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Role</FormLabel>\n            <Select \n              onValueChange={field.onChange} \n              defaultValue={field.value}\n            >\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select role\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value={UserRole.ADMIN}>Admin</SelectItem>\n                <SelectItem value={UserRole.OPERATOR}>Operator</SelectItem>\n                <SelectItem value={UserRole.VIEWER}>Viewer</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <FormField\n        control={form.control}\n        name=\"status\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Status</FormLabel>\n            <Select \n              onValueChange={field.onChange} \n              defaultValue={field.value}\n            >\n              <FormControl>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select status\" />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"active\">Active</SelectItem>\n                <SelectItem value=\"inactive\">Inactive</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n      \n      <Button \n        type=\"submit\" \n        className=\"w-full\" \n        disabled={isSubmitting || (isNewUser && mobileCheckResult?.exists)}\n      >\n        {isSubmitting \n          ? (isNewUser ? \"Creating...\" : \"Updating...\") \n          : (isNewUser ? \"Create User\" : \"Update User\")\n        }\n      </Button>\n    </>\n  );\n}","size_bytes":7112},"local-deployment/client/src/pages/advance-payment-form.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ArrowLeft, Upload, X } from \"lucide-react\";\nimport { UserSelect } from \"@/components/user-select\";\n\ninterface User {\n  id: number;\n  name: string;\n  mobile?: string;\n}\n\nexport default function AdvancePaymentForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  \n  // Form state\n  const [selectedUserId, setSelectedUserId] = useState<number | null>(null);\n  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\n  const [amount, setAmount] = useState(\"\");\n  const [paymentMode, setPaymentMode] = useState(\"\");\n  \n  // File upload state\n  const [paymentScreenshot, setPaymentScreenshot] = useState<File | null>(null);\n  const fileRef = useRef<HTMLInputElement>(null);\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const selectedUser = users?.find(u => u.id === selectedUserId);\n\n  // Handle file selection\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file type\n      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\n      if (!allowedTypes.includes(file.type)) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload JPG, PNG, or PDF files only.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      // Validate file size (10MB limit)\n      if (file.size > 10 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Please upload files smaller than 10MB.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      setPaymentScreenshot(file);\n    }\n  };\n\n  const removeFile = () => {\n    setPaymentScreenshot(null);\n    if (fileRef.current) {\n      fileRef.current.value = \"\";\n    }\n  };\n\n  // Create advance payment mutation\n  const createAdvancePaymentMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/advance-payments', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create advance payment');\n      }\n      \n      return response.json();\n    },\n    onSuccess: async (createdPayment) => {\n      toast({\n        title: \"Success\",\n        description: `Advance payment of ‚Çπ${createdPayment.amount.toLocaleString()} recorded successfully.`,\n      });\n\n      // Invalidate all related queries immediately\n      await Promise.all([\n        queryClient.invalidateQueries({ queryKey: ['/api/advance-payments'] }),\n        queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] }),\n        queryClient.invalidateQueries({ queryKey: ['/api/entries'] }),\n        queryClient.invalidateQueries({ predicate: (query) => {\n          const queryKey = query.queryKey[0];\n          return queryKey ? queryKey.toString().includes('/advance-balance') : false;\n        } })\n      ]);\n      \n      // Clear form\n      setSelectedUserId(null);\n      setDate(new Date().toISOString().split('T')[0]);\n      setAmount(\"\");\n      setPaymentMode(\"\");\n      setPaymentScreenshot(null);\n      if (fileRef.current) fileRef.current.value = \"\";\n      \n      // Navigate to list immediately\n      setLocation('/advance-payments');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create advance payment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!selectedUserId || !selectedUser) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a user\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!amount || parseFloat(amount) <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid amount\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (!paymentMode) {\n      toast({\n        title: \"Error\",\n        description: \"Please select a payment mode\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check if payment screenshot is required for non-cash payments\n    if (paymentMode !== 'cash' && !paymentScreenshot) {\n      toast({\n        title: \"Error\",\n        description: \"Payment screenshot is required for UPI, Cheque, and Net Banking\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append('userId', selectedUserId.toString());\n    formData.append('userName', selectedUser.name);\n    formData.append('userMobile', selectedUser.mobile || '');\n    formData.append('date', date);\n    formData.append('amount', parseFloat(amount).toString()); // Amount in rupees\n    formData.append('paymentMode', paymentMode);\n    formData.append('createdBy', user?.username || 'system');\n    \n    if (paymentScreenshot) {\n      formData.append('paymentScreenshot', paymentScreenshot);\n    }\n\n    createAdvancePaymentMutation.mutate(formData);\n  };\n\n  const paymentModeOptions = [\n    { value: 'cash', label: 'Cash' },\n    { value: 'upi', label: 'UPI' },\n    { value: 'cheque', label: 'Cheque' },\n    { value: 'netbanking', label: 'Net Banking' }\n  ];\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          onClick={() => setLocation('/advance-payments')}\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to List\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Add Advance Payment</h1>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Advance Payment Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"user\">Select User *</Label>\n                <UserSelect\n                  value={selectedUserId || undefined}\n                  onValueChange={(value) => setSelectedUserId(value || null)}\n                  placeholder=\"Search and select user\"\n                  className=\"w-full\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"date\">Date *</Label>\n                <Input\n                  id=\"date\"\n                  type=\"date\"\n                  value={date}\n                  onChange={(e) => setDate(e.target.value)}\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Amount (‚Çπ) *</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0.01\"\n                  placeholder=\"Enter amount in rupees\"\n                  value={amount}\n                  onChange={(e) => setAmount(e.target.value)}\n                  required\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"paymentMode\">Payment Mode *</Label>\n                <Select value={paymentMode} onValueChange={setPaymentMode}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select payment mode\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {paymentModeOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Payment Screenshot Upload - Required for non-cash payments */}\n            {paymentMode && paymentMode !== 'cash' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"paymentScreenshot\">Payment Screenshot *</Label>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => fileRef.current?.click()}\n                      className=\"w-full sm:w-auto\"\n                    >\n                      <Upload className=\"h-4 w-4 mr-2\" />\n                      Choose Payment Screenshot\n                    </Button>\n                    <input\n                      ref={fileRef}\n                      type=\"file\"\n                      accept=\".jpg,.jpeg,.png,.pdf\"\n                      onChange={handleFileSelect}\n                      className=\"hidden\"\n                    />\n                  </div>\n                  \n                  {paymentScreenshot && (\n                    <div className=\"flex items-center justify-between p-2 bg-gray-50 rounded border\">\n                      <span className=\"text-sm text-gray-600 truncate\">\n                        {paymentScreenshot.name}\n                      </span>\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={removeFile}\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  )}\n                  \n                  <p className=\"text-sm text-gray-500\">\n                    Upload payment screenshot for {paymentMode.toUpperCase()}. Accepted formats: JPG, PNG, PDF (Max 10MB)\n                  </p>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-4 pt-4\">\n              <Button \n                type=\"submit\" \n                disabled={createAdvancePaymentMutation.isPending}\n                className=\"min-w-[120px]\"\n              >\n                {createAdvancePaymentMutation.isPending ? \"Creating...\" : \"Create Payment\"}\n              </Button>\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setLocation('/advance-payments')}\n              >\n                Cancel\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11291},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"local-deployment/client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"local-deployment/client/src/pages/entry-edit.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type Entry } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\n// Create edit schema that excludes auto-generated fields\nconst editEntrySchema = z.object({\n  userId: z.coerce.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  userMobile: z.string().optional(),\n  userAddress: z.string().optional(),\n  description: z.string().min(1, \"Description is required\"),\n  totalAmount: z.coerce.number().positive(\"Total amount must be positive\"),\n  quantity: z.coerce.number().positive(\"Quantity must be positive\"),\n  occasion: z.string().min(1, \"Occasion is required\"),\n  auctionDate: z.string().min(1, \"Auction date is required\"),\n});\n\ntype EditEntryValues = z.infer<typeof editEntrySchema>;\n\nexport default function EntryEdit() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [match, params] = useRoute(\"/entries/:id/edit\");\n  const entryId = match ? parseInt(params.id) : 0;\n  \n  // Fetch entry details for editing\n  const { data: entry, isLoading } = useQuery<Entry>({\n    queryKey: [`/api/entries/${entryId}`],\n    enabled: entryId > 0,\n  });\n\n  // Fetch users for selection\n  const { data: users } = useQuery<any[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const form = useForm<EditEntryValues>({\n    resolver: zodResolver(editEntrySchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      userMobile: \"\",\n      userAddress: \"\",\n      description: \"\",\n      totalAmount: 0,\n      quantity: 1,\n      occasion: \"\",\n      auctionDate: new Date().toISOString().split('T')[0],\n    },\n  });\n\n  // Update form when entry data is loaded\n  useEffect(() => {\n    if (entry) {\n      form.reset({\n        userId: entry.userId,\n        userName: entry.userName,\n        userMobile: entry.userMobile || \"\",\n        userAddress: entry.userAddress || \"\",\n        description: entry.description,\n        totalAmount: entry.totalAmount,\n        quantity: entry.quantity,\n        occasion: entry.occasion,\n        auctionDate: entry.auctionDate,\n      });\n    }\n  }, [entry, form]);\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async (data: EditEntryValues) => {\n      const response = await apiRequest(\"PUT\", `/api/entries/${entryId}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Entry updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/entries/${entryId}`] });\n      setLocation('/entries');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update entry\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: EditEntryValues) => {\n    updateMutation.mutate(data);\n  };\n\n  // Handle user selection\n  const handleUserSelect = (userId: number) => {\n    const selectedUser = users?.find(u => u.id === userId);\n    if (selectedUser) {\n      form.setValue('userId', selectedUser.id);\n      form.setValue('userName', selectedUser.name);\n      form.setValue('userMobile', selectedUser.mobile || '');\n      form.setValue('userAddress', selectedUser.address || '');\n    }\n  };\n\n  if (!user || (user.role !== 'admin' && user.role !== 'operator')) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Access Denied</h1>\n          <p className=\"text-neutral-600\">You don't have permission to edit entries.</p>\n          <Button onClick={() => setLocation('/entries')} className=\"mt-4\">\n            Back to Entries\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p>Loading entry details...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!entry) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Entry Not Found</h1>\n          <p className=\"text-neutral-600\">The entry you're trying to edit doesn't exist.</p>\n          <Button onClick={() => setLocation('/entries')} className=\"mt-4\">\n            Back to Entries\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <div className=\"max-w-2xl mx-auto p-4\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setLocation('/entries')}\n                >\n                  <ArrowLeft className=\"h-4 w-4 mr-1\" />\n                  Back\n                </Button>\n                <CardTitle>Edit Boli Entry</CardTitle>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* User Selection */}\n                <div className=\"space-y-2\">\n                  <Label>Select User *</Label>\n                  <UserSelect\n                    value={form.watch('userId') > 0 ? form.watch('userId') : undefined}\n                    onValueChange={(userId) => {\n                      if (userId) {\n                        handleUserSelect(userId);\n                      }\n                    }}\n                    className=\"w-full\"\n                    disabled={user?.role !== 'admin'}\n                  />\n                  {user?.role !== 'admin' && (\n                    <p className=\"text-xs text-orange-600\">Only administrators can change the user selection</p>\n                  )}\n                  {form.watch('userId') > 0 && (\n                    <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                      <p className=\"text-sm font-medium text-blue-800\">Selected User:</p>\n                      <p className=\"text-sm text-blue-700\">{form.watch('userName')}</p>\n                      {form.watch('userMobile') && (\n                        <p className=\"text-sm text-blue-600\">Mobile: {form.watch('userMobile')}</p>\n                      )}\n                      {form.watch('userAddress') && (\n                        <p className=\"text-sm text-blue-600\">Address: {form.watch('userAddress')}</p>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Hidden fields for user data */}\n                <FormField\n                  control={form.control}\n                  name=\"userName\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"userMobile\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"userAddress\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormControl>\n                        <Input {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n\n                {/* Description */}\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter boli description\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Total Amount - Only editable by admin */}\n                <FormField\n                  control={form.control}\n                  name=\"totalAmount\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Total Amount (‚Çπ) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"Enter amount\"\n                          {...field}\n                          disabled={user.role !== 'admin'}\n                          className={user.role !== 'admin' ? 'bg-neutral-100 text-neutral-500' : ''}\n                        />\n                      </FormControl>\n                      {user.role !== 'admin' && (\n                        <p className=\"text-sm text-orange-600\">\n                          Only administrators can edit the amount field.\n                        </p>\n                      )}\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Quantity */}\n                <FormField\n                  control={form.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Quantity *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          placeholder=\"Enter quantity\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Occasion */}\n                <FormField\n                  control={form.control}\n                  name=\"occasion\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Occasion *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter occasion\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Date of Boli */}\n                <FormField\n                  control={form.control}\n                  name=\"auctionDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date of Boli *</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          max={new Date().toISOString().split('T')[0]}\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Submit Button */}\n                <div className=\"flex gap-4 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setLocation('/entries')}\n                    className=\"flex-1\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    className=\"flex-1\"\n                    disabled={updateMutation.isPending}\n                  >\n                    {updateMutation.isPending ? \"Updating...\" : \"Update Entry\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":13572},"local-deployment/client/src/lib/auth.ts":{"content":"import { queryClient } from \"./queryClient\";\n\nexport type AuthUser = {\n  id: number;\n  username: string;\n  name: string;\n  email: string;\n  role: string;\n  status?: string;\n  mobile?: string;\n  address?: string;\n};\n\nexport async function logout() {\n  try {\n    await fetch(\"/api/auth/logout\", {\n      method: \"POST\",\n      credentials: \"include\",\n    });\n    queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    \n    // Force reload the page to clear any state and redirect to login\n    window.location.href = \"/\";\n    return true;\n  } catch (error) {\n    console.error(\"Logout failed:\", error);\n    return false;\n  }\n}\n","size_bytes":636},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":772},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4879},"local-deployment/client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"local-deployment/setup.sh":{"content":"#!/bin/bash\n\necho \"üèõÔ∏è  ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Local Setup Script\"\necho \"==================================\"\n\n# Check if Node.js is installed\nif ! command -v node &> /dev/null; then\n    echo \"‚ùå Node.js is not installed. Please install Node.js v18 or higher.\"\n    exit 1\nfi\n\n# Check Node.js version\nNODE_VERSION=$(node --version | cut -d'v' -f2 | cut -d'.' -f1)\nif [ \"$NODE_VERSION\" -lt 18 ]; then\n    echo \"‚ùå Node.js version $NODE_VERSION is too old. Please install Node.js v18 or higher.\"\n    exit 1\nfi\n\n# Check if PostgreSQL is installed\nif ! command -v psql &> /dev/null; then\n    echo \"‚ùå PostgreSQL is not installed. Please install PostgreSQL v14 or higher.\"\n    exit 1\nfi\n\necho \"‚úÖ Prerequisites check passed\"\n\n# Install dependencies\necho \"üì¶ Installing dependencies...\"\nnpm install\n\n# Copy environment file if it doesn't exist\nif [ ! -f .env ]; then\n    cp .env.example .env\n    echo \"üìù Created .env file from template\"\n    echo \"‚ö†Ô∏è  Please edit .env file with your database credentials\"\nfi\n\n# Create uploads directory\nmkdir -p uploads\necho \"üìÅ Created uploads directory\"\n\n# Database setup script already created\necho \"üóÑÔ∏è  Database setup script ready (setup_database.sql)\"\n\n\necho \"\"\necho \"Next steps:\"\necho \"1. Start PostgreSQL: sudo service postgresql start\"\necho \"2. Run database setup: sudo -u postgres psql -f setup_database.sql\"\necho \"3. Edit .env file with your credentials\"\necho \"4. Push database schema: npm run db:push\"\necho \"5. Start application: npm run dev\"\necho \"\"\necho \"Access your application at: http://223.190.85.106:5000\"","size_bytes":1575},"client/src/components/bulk-user-upload.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Download, Upload, Users, FileSpreadsheet } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function BulkUserUpload() {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Generate and download template\n  const downloadTemplate = () => {\n    // Create CSV template with sample data\n    const headers = ['username', 'password', 'name', 'email', 'mobile', 'address', 'role'];\n    const sampleData = [\n      'user1', 'password123', 'Sample User 1', 'user1@example.com', '9876543210', 'Sample Address 1', 'viewer',\n      'user2', 'password123', 'Sample User 2', 'user2@example.com', '9876543211', 'Sample Address 2', 'operator'\n    ];\n\n    const csvContent = [\n      headers.join(','),\n      sampleData.slice(0, 7).join(','),\n      sampleData.slice(7, 14).join(',')\n    ].join('\\n');\n\n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'sample_template.csv';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url);\n\n    toast({\n      title: \"Template Downloaded\",\n      description: \"CSV template downloaded successfully. Fill it with user data and upload.\",\n    });\n  };\n\n  // Handle file selection\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      // Validate file type\n      if (!file.name.endsWith('.csv') && !file.name.endsWith('.xlsx')) {\n        toast({\n          title: \"Invalid File Type\",\n          description: \"Please upload a CSV or Excel file.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  // Upload mutation\n  const uploadMutation = useMutation({\n    mutationFn: async (formData: FormData) => {\n      const response = await fetch('/api/users/bulk-upload', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Upload failed');\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      setSelectedFile(null);\n      setUploading(false);\n      \n      toast({\n        title: \"Upload Successful\",\n        description: `${data.created} users created successfully. ${data.errors || 0} errors encountered.`,\n      });\n      \n      // Reset file input\n      const fileInput = document.getElementById('bulk-upload-input') as HTMLInputElement;\n      if (fileInput) fileInput.value = '';\n    },\n    onError: (error: any) => {\n      setUploading(false);\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload users. Please check your file format.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle upload\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    const formData = new FormData();\n    formData.append('file', selectedFile);\n\n    uploadMutation.mutate(formData);\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n          Bulk User Upload\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Template Download Section */}\n        <div className=\"border rounded-lg p-4 bg-blue-50\">\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <h3 className=\"font-medium text-blue-900 mb-2\">Step 1: Download Template</h3>\n              <p className=\"text-sm text-blue-800 mb-3\">\n                Download the CSV template with required columns and sample data.\n              </p>\n              <div className=\"text-xs text-blue-700 space-y-1\">\n                <p><strong>Required columns:</strong></p>\n                <p>‚Ä¢ username, password, name, email, mobile, address, role</p>\n                <p><strong>Valid roles:</strong> admin, operator, viewer</p>\n              </div>\n            </div>\n            <Button \n              onClick={downloadTemplate}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-100\"\n            >\n              <Download className=\"h-4 w-4\" />\n              Download Template\n            </Button>\n          </div>\n        </div>\n\n        {/* File Upload Section */}\n        <div className=\"border rounded-lg p-4\">\n          <h3 className=\"font-medium mb-3\">Step 2: Upload Filled Template</h3>\n          \n          <div className=\"space-y-4\">\n            {/* File Input */}\n            <div>\n              <input\n                id=\"bulk-upload-input\"\n                type=\"file\"\n                accept=\".csv,.xlsx\"\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              <Button\n                onClick={() => document.getElementById('bulk-upload-input')?.click()}\n                variant=\"outline\"\n                className=\"w-full flex items-center gap-2\"\n              >\n                <FileSpreadsheet className=\"h-4 w-4\" />\n                Select CSV/Excel File\n              </Button>\n            </div>\n\n            {/* Selected File Display */}\n            {selectedFile && (\n              <div className=\"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  <FileSpreadsheet className=\"h-4 w-4 text-green-600\" />\n                  <span className=\"text-sm font-medium text-green-800\">\n                    {selectedFile.name}\n                  </span>\n                  <span className=\"text-xs text-green-600\">\n                    ({(selectedFile.size / 1024).toFixed(1)} KB)\n                  </span>\n                </div>\n                <Button\n                  onClick={() => setSelectedFile(null)}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"text-green-700 hover:text-green-900\"\n                >\n                  Remove\n                </Button>\n              </div>\n            )}\n\n            {/* Upload Button */}\n            <Button\n              onClick={handleUpload}\n              disabled={!selectedFile || uploading}\n              className=\"w-full flex items-center gap-2\"\n            >\n              <Upload className=\"h-4 w-4\" />\n              {uploading ? 'Uploading...' : 'Upload Users'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Instructions */}\n        <div className=\"text-sm text-gray-600 space-y-2\">\n          <p><strong>Instructions:</strong></p>\n          <ul className=\"list-disc list-inside space-y-1 ml-2\">\n            <li>Download the template and fill in user details</li>\n            <li>Ensure all required fields are completed</li>\n            <li>Use valid roles: admin, operator, or viewer</li>\n            <li>Mobile numbers should be 10 digits</li>\n            <li>Usernames must be unique across the system</li>\n            <li>Save as CSV format before uploading</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":7849},"client/src/hooks/use-media-query.tsx":{"content":"import { useState, useEffect } from 'react';\n\nexport function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const media = window.matchMedia(query);\n      \n      // Initial check\n      setMatches(media.matches);\n      \n      // Update matches when media query changes\n      const listener = (e: MediaQueryListEvent) => {\n        setMatches(e.matches);\n      };\n      \n      // Add event listener\n      media.addEventListener('change', listener);\n      \n      // Cleanup\n      return () => {\n        media.removeEventListener('change', listener);\n      };\n    }\n    \n    return undefined;\n  }, [query]);\n\n  return matches;\n}","size_bytes":733},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, json, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Define role type\nexport const UserRole = {\n  ADMIN: \"admin\",\n  OPERATOR: \"operator\",\n  VIEWER: \"viewer\",\n} as const;\n\nexport type UserRoleType = typeof UserRole[keyof typeof UserRole];\n\n// Define payment status type\nexport const PaymentStatus = {\n  PENDING: \"pending\",\n  PARTIAL: \"partial\",\n  FULL: \"full\",\n} as const;\n\nexport type PaymentStatusType = typeof PaymentStatus[keyof typeof PaymentStatus];\n\n// Define entry status type (for soft delete)\nexport const EntryStatus = {\n  ACTIVE: \"active\",\n  DELETED: \"deleted\",\n} as const;\n\nexport type EntryStatusType = typeof EntryStatus[keyof typeof EntryStatus];\n\n// Define payment mode type\nexport const PaymentMode = {\n  CASH: \"cash\",\n  UPI: \"upi\",\n  CHEQUE: \"cheque\",\n  NETBANKING: \"netbanking\",\n  ADVANCE_PAYMENT: \"advance_payment\",\n} as const;\n\nexport type PaymentModeType = typeof PaymentMode[keyof typeof PaymentMode];\n\n// Define transaction type for logging\nexport const TransactionType = {\n  CREDIT: \"credit\", // Adding new entry or deleting payment\n  DEBIT: \"debit\",   // Recording payment or deleting entry\n  UPDATE_PAYMENT: \"update_payment\", // Updating an existing payment\n  UPDATE_ENTRY: \"update_entry\",     // Updating an existing entry\n} as const;\n\nexport type TransactionTypeValue = typeof TransactionType[keyof typeof TransactionType];\n\n// Define entry types\nexport const EntryType = {\n  AUCTION: \"auction\",\n  DRAVYA: \"dravya\",\n} as const;\n\nexport type EntryTypeValue = typeof EntryType[keyof typeof EntryType];\n\n// Define UOM (Unit of Measurement) types for Dravya entries\nexport const UnitOfMeasurement = {\n  GRAM: \"gram\",\n  KG: \"kg\",\n  NO_UNIT: \"no_unit\",\n} as const;\n\nexport type UnitOfMeasurementType = typeof UnitOfMeasurement[keyof typeof UnitOfMeasurement];\n\n// Define payment record type\nexport type PaymentRecord = {\n  id?: string; // Unique ID for each payment record (for editing)\n  date: string;\n  amount: number;\n  mode: PaymentModeType;\n  fileUrl?: string; // For storing the path to uploaded files\n  receiptNo?: string; // Receipt number for tracking payments\n  updatedBy?: string; // Username of the person who recorded this payment\n  status?: 'active' | 'deleted'; // Status for soft delete\n};\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  serialNumber: integer(\"serial_number\").notNull().default(1),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  mobile: text(\"mobile\").notNull().default(\"\"),\n  address: text(\"address\").notNull().default(\"\"),\n  role: text(\"role\").$type<UserRoleType>().notNull().default(UserRole.VIEWER),\n  status: text(\"status\").notNull().default(\"active\"),\n}, (table) => ({\n  // Add indexes for performance\n  usernameIdx: index(\"users_username_idx\").on(table.username),\n  roleIdx: index(\"users_role_idx\").on(table.role),\n}));\n\n// Account entries table - only for boli entries\nexport const entries = pgTable(\"entries\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  description: text(\"description\").notNull(),\n  amount: integer(\"amount\").notNull().default(0),\n  quantity: integer(\"quantity\").notNull().default(1),\n  totalAmount: integer(\"total_amount\").notNull(),\n  occasion: text(\"occasion\").notNull(),\n  bediNumber: text(\"bedi_number\").notNull().default(\"1\"), // ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\n  auctionDate: text(\"auction_date\").notNull(), // Note: Column name stays same for DB compatibility\n  status: text(\"status\").$type<PaymentStatusType>().notNull().default(PaymentStatus.PENDING),\n  entryStatus: text(\"entry_status\").$type<EntryStatusType>().notNull().default(\"active\"), // For soft delete\n  pendingAmount: integer(\"pending_amount\").notNull(),\n  receivedAmount: integer(\"received_amount\").notNull().default(0),\n  payments: json(\"payments\").$type<PaymentRecord[]>().notNull().default([]),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n}, (table) => ({\n  // Add indexes for performance\n  userIdIdx: index(\"entries_user_id_idx\").on(table.userId),\n  statusIdx: index(\"entries_status_idx\").on(table.status),\n  entryStatusIdx: index(\"entries_entry_status_idx\").on(table.entryStatus),\n  auctionDateIdx: index(\"entries_auction_date_idx\").on(table.auctionDate),\n}));\n\n// Separate table for dravya entries - completely isolated\nexport const dravyaEntries = pgTable(\"dravya_entries\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  description: text(\"description\").notNull(),\n  occasion: text(\"occasion\").notNull().default(\"\"),\n  entryDate: text(\"entry_date\").notNull(),\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Expense entries table (completely separate from main entries and dravya entries)\nexport const expenseEntries = pgTable(\"expense_entries\", {\n  id: serial(\"id\").primaryKey(),\n  firmName: text(\"firm_name\"), // Firm Name (optional)\n  billNo: text(\"bill_no\"), // Bill No (optional)\n  billDate: text(\"bill_date\"), // Bill Date (optional)\n  description: text(\"description\").notNull(), // Line Item Description\n  amount: integer(\"amount\").notNull(), // Amount in rupees (‚Çπ)\n  quantity: integer(\"quantity\"), // Quantity (optional)\n  reason: text(\"reason\"), // Reason for expense (optional)\n  expenseDate: text(\"expense_date\").notNull(), // Date of Expense\n  paymentMode: text(\"payment_mode\").notNull(), // Mode of Payment\n  attachmentUrl: text(\"attachment_url\"), // Attachment for expense receipt\n  approvedBy: text(\"approved_by\").notNull(), // Approved By\n  paidBy: text(\"paid_by\"), // Paid By (temporarily optional for migration)\n  createdBy: text(\"created_by\").notNull(), // Created by (operator)\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Advance payments table (completely separate module)\nexport const advancePayments = pgTable(\"advance_payments\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  date: text(\"date\").notNull(), // Date of advance payment\n  amount: integer(\"amount\").notNull(), // Amount in rupees (‚Çπ)\n  paymentMode: text(\"payment_mode\").notNull(), // cash, upi, cheque, netbanking\n  attachmentUrl: text(\"attachment_url\"), // Payment screenshot for non-cash\n  receiptNo: text(\"receipt_no\"), // Advance payment receipt number - AP-YYYY-XXXXX format\n  createdBy: text(\"created_by\").notNull(), // Created by\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()),\n});\n\n// Transaction logs table for tracking all credit and debit activities\nexport const transactionLogs = pgTable(\"transaction_logs\", {\n  id: serial(\"id\").primaryKey(),\n  entryId: integer(\"entry_id\").notNull(), // Reference to the entry\n  userId: integer(\"user_id\").notNull(), // User who performed the action\n  username: text(\"username\").notNull(), // Username for display\n  transactionType: text(\"transaction_type\").$type<TransactionTypeValue>().notNull(), // CREDIT or DEBIT\n  amount: integer(\"amount\").notNull(), // Amount involved\n  description: text(\"description\").notNull(), // Description of the transaction\n  date: text(\"date\").notNull().default(new Date().toISOString().split('T')[0]), // Date of transaction\n  details: json(\"details\").notNull(), // Additional details like payment method, etc.\n  timestamp: text(\"timestamp\").notNull().default(new Date().toISOString()), // When this log was created\n});\n\n// Advance payment usage tracking table\nexport const advancePaymentUsage = pgTable(\"advance_payment_usage\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(), // User whose advance payment was used\n  entryId: integer(\"entry_id\").notNull(), // Entry against which advance payment was applied\n  amount: integer(\"amount\").notNull(), // Amount of advance payment used\n  date: text(\"date\").notNull(), // Date when advance payment was applied\n  createdBy: text(\"created_by\").notNull(), // Who processed this usage\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()), // When this usage was recorded\n});\n\n// Previous outstanding records table - for migrating past account balances\nexport const previousOutstandingRecords = pgTable(\"previous_outstanding_records\", {\n  id: serial(\"id\").primaryKey(),\n  serialNumber: text(\"serial_number\"), // Serial number for this outstanding record (PO-2025-001, PO-2025-002, etc.)\n  recordNumber: integer(\"record_number\"), // Fixed record number for display (REC-1, REC-2, etc.)\n  userId: integer(\"user_id\").notNull(),\n  userName: text(\"user_name\").notNull(),\n  userMobile: text(\"user_mobile\"),\n  userAddress: text(\"user_address\"),\n  outstandingAmount: integer(\"outstanding_amount\").notNull(), // Amount in rupees\n  receivedAmount: integer(\"received_amount\").notNull().default(0), // Amount received in rupees\n  pendingAmount: integer(\"pending_amount\").notNull().default(0), // Calculated pending amount in rupees\n  status: text(\"status\").$type<PaymentStatusType>().notNull().default(PaymentStatus.PENDING),\n  payments: json(\"payments\").$type<PaymentRecord[]>().notNull().default([]),\n  description: text(\"description\").notNull().default(\"31.07.2025 ‡§§‡§ï ‡§ï‡•Å‡§≤ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø\"),\n  attachmentUrl: text(\"attachment_url\"), // Path to the uploaded proof file\n  attachmentName: text(\"attachment_name\"), // Original filename\n  createdBy: text(\"created_by\").notNull().default(\"system\"),\n  createdAt: text(\"created_at\").notNull().default(new Date().toISOString()),\n  updatedAt: text(\"updated_at\").notNull().default(new Date().toISOString()),\n});\n\n// Zod schemas for validation\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  serialNumber: true,\n});\n\nexport const insertEntrySchema = createInsertSchema(entries).omit({\n  id: true,\n  status: true,\n  pendingAmount: true,\n  receivedAmount: true,\n  payments: true,\n}).extend({\n  // Make amount optional for entries\n  amount: z.number().nonnegative().optional().default(0),\n  // Make quantity optional with default 1\n  quantity: z.number().positive().optional().default(1),\n  // Occasion is optional\n  occasion: z.string().optional().default(\"\"),\n  // Bedi number is optional with default \"1\"\n  bediNumber: z.string().optional().default(\"1\"),\n});\n\nexport const insertDravyaEntrySchema = createInsertSchema(dravyaEntries).omit({\n  id: true,\n}).extend({\n  // Occasion is optional for dravya entries\n  occasion: z.string().optional().default(\"\"),\n});\n\nexport const insertExpenseEntrySchema = createInsertSchema(expenseEntries).omit({\n  id: true,\n  updatedAt: true,\n}).extend({\n  // All fields are mandatory for expense entries\n  description: z.string().min(1, \"Description is required\"),\n  amount: z.number().positive(\"Amount must be positive\"),\n  quantity: z.number().positive(\"Quantity must be positive\"),\n  reason: z.string().min(1, \"Reason is required\"),\n  expenseDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  paymentMode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  attachmentUrl: z.string().optional(),\n  approvedBy: z.string().min(1, \"Approved by is required\"),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertEntry = z.infer<typeof insertEntrySchema>;\nexport type Entry = typeof entries.$inferSelect;\nexport type InsertDravyaEntry = z.infer<typeof insertDravyaEntrySchema>;\nexport type DravyaEntry = typeof dravyaEntries.$inferSelect;\nexport type InsertExpenseEntry = z.infer<typeof insertExpenseEntrySchema>;\nexport type ExpenseEntry = typeof expenseEntries.$inferSelect;\n\nexport const insertAdvancePaymentSchema = createInsertSchema(advancePayments).omit({\n  id: true,\n  createdAt: true,\n  receiptNo: true, // Receipt number is auto-generated\n}).extend({\n  userId: z.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\"),\n  amount: z.number().positive(\"Amount must be positive\"),\n  paymentMode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING]),\n  attachmentUrl: z.string().optional(),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertAdvancePayment = z.infer<typeof insertAdvancePaymentSchema>;\nexport type AdvancePayment = typeof advancePayments.$inferSelect;\n\n// Previous outstanding record schema\nexport const insertPreviousOutstandingRecordSchema = createInsertSchema(previousOutstandingRecords).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  receivedAmount: true,\n  pendingAmount: true,\n  status: true,\n  payments: true,\n}).extend({\n  userId: z.number().positive(\"User is required\"),\n  userName: z.string().min(1, \"User name is required\"),\n  outstandingAmount: z.number().positive(\"Outstanding amount must be positive\"),\n  description: z.string().optional().default(\"Previous Outstanding Amount\"),\n  attachmentUrl: z.string().optional(),\n  attachmentName: z.string().optional(),\n  createdBy: z.string().min(1, \"Created by is required\"),\n});\n\nexport type InsertPreviousOutstandingRecord = z.infer<typeof insertPreviousOutstandingRecordSchema>;\nexport type PreviousOutstandingRecord = typeof previousOutstandingRecords.$inferSelect;\n\nexport const recordPaymentSchema = z.object({\n  entryId: z.number(),\n  amount: z.number().positive(),\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, { message: \"Date must be in YYYY-MM-DD format\" }),\n  mode: z.enum([PaymentMode.CASH, PaymentMode.UPI, PaymentMode.CHEQUE, PaymentMode.NETBANKING, PaymentMode.ADVANCE_PAYMENT]),\n  fileUrl: z.string().optional(),\n  receiptNo: z.string().optional(),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Transaction log schema\nexport const insertTransactionLogSchema = createInsertSchema(transactionLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport type InsertTransactionLog = z.infer<typeof insertTransactionLogSchema>;\nexport type TransactionLog = typeof transactionLogs.$inferSelect;\nexport type RecordPayment = z.infer<typeof recordPaymentSchema>;\n\n// Corpus settings table (for admin configuration)\nexport const corpusSettings = pgTable(\"corpus_settings\", {\n  id: serial(\"id\").primaryKey(),\n  corpusValue: integer(\"corpus_value\").notNull().default(0), // Corpus value as of 31st July 2025 (in rupees)\n  baseDate: text(\"base_date\").notNull().default(\"2025-07-31\"), // Base date for corpus calculation\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  updatedBy: text(\"updated_by\").notNull(), // Username of admin who updated\n});\n\n// Corpus settings schema\nexport const insertCorpusSettingsSchema = createInsertSchema(corpusSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertCorpusSettings = z.infer<typeof insertCorpusSettingsSchema>;\nexport type CorpusSettings = typeof corpusSettings.$inferSelect;\n","size_bytes":15464},"local-deployment/server/read-excel-headers.ts":{"content":"import XLSX from 'xlsx';\nimport * as path from 'path';\n\nasync function readExcelHeaders() {\n  try {\n    console.log('Reading original Excel file headers...');\n    const filePath = path.join(process.cwd(), '..', 'attached_assets', 'Shivnagar Worksheet_1754753646977.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Get first row (headers)\n    const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1');\n    const headers: string[] = [];\n    \n    for (let col = range.s.c; col <= range.e.c; col++) {\n      const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });\n      const cell = worksheet[cellAddress];\n      if (cell && cell.v) {\n        headers.push(String(cell.v));\n      }\n    }\n    \n    console.log('Excel Headers:', headers);\n    \n    // Also get first few rows to see data structure\n    const jsonData = XLSX.utils.sheet_to_json(worksheet, { range: 5 }); // First 5 rows\n    console.log('Sample data structure:');\n    console.log(jsonData[0]);\n    \n    return headers;\n    \n  } catch (error) {\n    console.error('Error reading Excel file:', error);\n    throw error;\n  }\n}\n\nreadExcelHeaders();","size_bytes":1224},"local-deployment/client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1184},"client/src/components/ui/sheet.tsx":{"content":"import * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4267},"local-deployment/client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7361},"client/src/components/copyright-footer.tsx":{"content":"import mandirLogo from \"@assets/new logo mandir color_1754807711657.jpg\";\n\nexport default function CopyrightFooter() {\n  return (\n    <footer className=\"bg-white border-t p-3 mt-8\">\n      <div className=\"flex items-center justify-center gap-2 text-xs text-gray-600\">\n        <img \n          src={mandirLogo} \n          alt=\"‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞\" \n          className=\"w-4 h-4 rounded-full\"\n        />\n        <span className=\"text-center\">\n          ¬© ‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞\n        </span>\n      </div>\n    </footer>\n  );\n}","size_bytes":755},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"DEPLOYMENT-CREDENTIALS.md":{"content":"# üîë ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Database Credentials\n\n## PostgreSQL Configuration\n\n### Database Details:\n- **Database Name**: `daan_darpan`\n- **PostgreSQL User**: `daan_user`  \n- **PostgreSQL Password**: `daan_password`\n- **Host**: `localhost`\n- **Port**: `5432`\n\n### Environment Variables (.env):\n```env\nDATABASE_URL=postgresql://daan_user:daan_password@localhost:5432/daan_darpan\nPGHOST=localhost\nPGPORT=5432\nPGUSER=daan_user\nPGPASSWORD=daan_password\nPGDATABASE=daan_darpan\n```\n\n### Database Setup Commands:\n```sql\n-- Run as PostgreSQL superuser (postgres)\nCREATE USER daan_user WITH PASSWORD 'daan_password';\nCREATE DATABASE daan_darpan WITH OWNER daan_user ENCODING 'UTF8';\nGRANT ALL PRIVILEGES ON DATABASE daan_darpan TO daan_user;\n```\n\n### Quick Setup:\n```bash\n# Extract package\ntar -xzf daan-darpan-local-v1.3.tar.gz\ncd daan-darpan-local\n\n# Run setup script\n./setup.sh\n\n# Setup PostgreSQL database\nsudo -u postgres psql -f setup_database.sql\n\n# Restore production backup\nnpm run restore database-backups/full_production_backup.sql.gz\n\n# Start application\nnpm run dev\n```\n\n### Access:\n- **Local**: http://localhost:5000\n- **Network**: http://223.190.85.106:5000\n\n---\n**Package**: daan-darpan-local-v1.3.tar.gz  \n**Updated**: August 17, 2025  \n**Production Data**: Complete current database backup included","size_bytes":1312},"client/src/components/ui/resizable.tsx":{"content":"import { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1709},"deploy/setup-database.sh":{"content":"#!/bin/bash\n\necho \"üóÑÔ∏è Setting up Daan Darpan Database...\"\n\n# Color codes for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\n# Function to print colored output\nprint_status() {\n    echo -e \"${BLUE}[INFO]${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\n# Load environment variables\nif [ -f .env ]; then\n    export $(cat .env | grep -v '#' | xargs)\nelse\n    print_error \".env file not found. Please run ./deploy/install.sh first.\"\n    exit 1\nfi\n\n# Extract database details from DATABASE_URL\nDB_NAME=\"daan_darpan\"\nDB_USER=${DATABASE_USER:-\"daan_darpan_user\"}\nDB_PASS=${DATABASE_PASSWORD:-\"daan_darpan_pass\"}\nDB_HOST=${DATABASE_HOST:-\"localhost\"}\nDB_PORT=${DATABASE_PORT:-\"5432\"}\n\nprint_status \"Database configuration:\"\nprint_status \"Host: $DB_HOST\"\nprint_status \"Port: $DB_PORT\"\nprint_status \"Database: $DB_NAME\"\nprint_status \"User: $DB_USER\"\n\n# Check if PostgreSQL is running\nif ! pg_isready -h $DB_HOST -p $DB_PORT &> /dev/null; then\n    print_warning \"PostgreSQL is not running. Attempting to start...\"\n    \n    # Try to start PostgreSQL service\n    if command -v systemctl &> /dev/null; then\n        sudo systemctl start postgresql\n    elif command -v service &> /dev/null; then\n        sudo service postgresql start\n    elif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n        brew services start postgresql\n    else\n        print_error \"Could not start PostgreSQL. Please start it manually.\"\n        exit 1\n    fi\n    \n    # Wait for PostgreSQL to start\n    sleep 3\n    \n    if ! pg_isready -h $DB_HOST -p $DB_PORT &> /dev/null; then\n        print_error \"PostgreSQL failed to start. Please check the service status.\"\n        exit 1\n    fi\nfi\n\nprint_success \"PostgreSQL is running\"\n\n# Create database user and database\nprint_status \"Creating database user and database...\"\n\n# Function to execute SQL as admin\nexecute_sql_as_admin() {\n    local sql_commands=\"$1\"\n    \n    # Try different methods to connect as admin\n    \n    # Method 1: Try postgres user (most common)\n    if id \"postgres\" >/dev/null 2>&1; then\n        print_status \"Using postgres user...\"\n        sudo -u postgres psql <<< \"$sql_commands\"\n        return $?\n    fi\n    \n    # Method 2: Try current user with admin privileges\n    if psql -d postgres -c \"\\l\" >/dev/null 2>&1; then\n        print_status \"Using current user with admin privileges...\"\n        psql -d postgres <<< \"$sql_commands\"\n        return $?\n    fi\n    \n    # Method 3: Try root/admin user\n    if sudo psql -d postgres -c \"\\l\" >/dev/null 2>&1; then\n        print_status \"Using sudo with psql...\"\n        sudo psql -d postgres <<< \"$sql_commands\"\n        return $?\n    fi\n    \n    # Method 4: Try connecting without specifying user\n    if psql postgres -c \"\\l\" >/dev/null 2>&1; then\n        print_status \"Using default connection...\"\n        psql postgres <<< \"$sql_commands\"\n        return $?\n    fi\n    \n    return 1\n}\n\n# SQL commands to create user and database\nSQL_COMMANDS=\"\n-- Create user if it doesn't exist\nDO \\$\\$\nBEGIN\n    IF NOT EXISTS (SELECT FROM pg_catalog.pg_user WHERE usename = '$DB_USER') THEN\n        CREATE USER $DB_USER WITH PASSWORD '$DB_PASS';\n    END IF;\nEND\n\\$\\$;\n\n-- Create database if it doesn't exist\nSELECT 'CREATE DATABASE $DB_NAME OWNER $DB_USER'\nWHERE NOT EXISTS (SELECT FROM pg_database WHERE datname = '$DB_NAME')\\gexec\n\n-- Grant privileges\nGRANT ALL PRIVILEGES ON DATABASE $DB_NAME TO $DB_USER;\nALTER USER $DB_USER CREATEDB;\n\"\n\n# Execute SQL commands\nif execute_sql_as_admin \"$SQL_COMMANDS\"; then\n    print_success \"Database and user created successfully\"\nelse\n    print_error \"Failed to create database and user\"\n    print_status \"Trying manual database creation...\"\n    \n    # Try creating database manually with simpler commands\n    print_status \"Please run these commands manually in PostgreSQL:\"\n    echo \"\"\n    echo \"psql -d postgres\"\n    echo \"CREATE USER $DB_USER WITH PASSWORD '$DB_PASS';\"\n    echo \"CREATE DATABASE $DB_NAME OWNER $DB_USER;\"\n    echo \"GRANT ALL PRIVILEGES ON DATABASE $DB_NAME TO $DB_USER;\"\n    echo \"ALTER USER $DB_USER CREATEDB;\"\n    echo \"\\q\"\n    echo \"\"\n    \n    read -p \"Have you created the database manually? (y/n): \" manual_created\n    if [ \"$manual_created\" != \"y\" ] && [ \"$manual_created\" != \"Y\" ]; then\n        print_error \"Database setup incomplete. Please create the database manually.\"\n        exit 1\n    fi\n    \n    print_success \"Database setup completed manually\"\nfi\n\n# Update DATABASE_URL in .env\nNEW_DATABASE_URL=\"postgresql://$DB_USER:$DB_PASS@$DB_HOST:$DB_PORT/$DB_NAME\"\nsed -i \"s|DATABASE_URL=.*|DATABASE_URL=$NEW_DATABASE_URL|\" .env\n\nprint_status \"Running database migrations...\"\n\n# Push database schema\nnpm run db:push\n\nif [ $? -eq 0 ]; then\n    print_success \"Database schema created successfully\"\nelse\n    print_error \"Failed to create database schema\"\n    exit 1\nfi\n\nprint_success \"Database setup completed!\"\nprint_status \"\"\nprint_status \"Database Details:\"\nprint_status \"‚Ä¢ Database: $DB_NAME\"\nprint_status \"‚Ä¢ User: $DB_USER\"\nprint_status \"‚Ä¢ Host: $DB_HOST\"\nprint_status \"‚Ä¢ Port: $DB_PORT\"\nprint_status \"\"\nprint_status \"You can now start the application with: npm run start\"","size_bytes":5301},"local-deployment/client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/lib/constants.ts":{"content":"// Payment status\nexport const PAYMENT_STATUS = {\n  PENDING: \"pending\",\n  PARTIAL: \"partial\",\n  FULL: \"full\",\n};\n\n// User roles\nexport const USER_ROLE = {\n  ADMIN: \"admin\",\n  VIEWER: \"viewer\",\n};\n\n// Local storage keys\nexport const STORAGE_KEYS = {\n  AUTH_TOKEN: \"ledger_auth_token\",\n};\n","size_bytes":287},"local-deployment/scripts/backup-database.sh":{"content":"#!/bin/bash\n\n# ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Database Backup Script\n# Creates a complete backup of the application database\n\nset -e\n\n# Load environment variables\nif [ -f .env ]; then\n    export $(cat .env | grep -v '#' | awk '/=/ {print $1}')\nfi\n\n# Default values\nDB_NAME=${PGDATABASE:-\"daan_darpan\"}\nDB_USER=${PGUSER:-\"daan_user\"}\nDB_HOST=${PGHOST:-\"localhost\"}\nDB_PORT=${PGPORT:-\"5432\"}\n\n# Create backup directory\nBACKUP_DIR=\"database-backups\"\nmkdir -p \"$BACKUP_DIR\"\n\n# Generate timestamp\nTIMESTAMP=$(date +\"%Y%m%d_%H%M%S\")\nBACKUP_FILE=\"$BACKUP_DIR/daan_darpan_backup_$TIMESTAMP.sql\"\n\necho \"üèõÔ∏è  Creating ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£ Database Backup...\"\necho \"Database: $DB_NAME\"\necho \"User: $DB_USER\"\necho \"Host: $DB_HOST:$DB_PORT\"\necho \"Backup file: $BACKUP_FILE\"\necho \"\"\n\n# Create database backup\nPGPASSWORD=\"$PGPASSWORD\" pg_dump -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" \\\n    --verbose \\\n    --clean \\\n    --if-exists \\\n    --create \\\n    --column-inserts \\\n    --disable-triggers \\\n    > \"$BACKUP_FILE\"\n\nif [ $? -eq 0 ]; then\n    echo \"‚úÖ Database backup created successfully!\"\n    echo \"üìÅ File: $BACKUP_FILE\"\n    echo \"üìä Size: $(du -h \"$BACKUP_FILE\" | cut -f1)\"\n    \n    # Create latest backup symlink\n    ln -sf \"$(basename \"$BACKUP_FILE\")\" \"$BACKUP_DIR/latest_backup.sql\"\n    echo \"üîó Latest backup linked as: $BACKUP_DIR/latest_backup.sql\"\n    \n    # Compress backup\n    gzip \"$BACKUP_FILE\"\n    echo \"üóúÔ∏è  Backup compressed: $BACKUP_FILE.gz\"\n    \n    # Update latest compressed backup symlink\n    ln -sf \"$(basename \"$BACKUP_FILE.gz\")\" \"$BACKUP_DIR/latest_backup.sql.gz\"\n    \n    echo \"\"\n    echo \"üìã To restore this backup, use:\"\n    echo \"   ./scripts/restore-database.sh $BACKUP_FILE.gz\"\n    \nelse\n    echo \"‚ùå Database backup failed!\"\n    exit 1\nfi","size_bytes":1791},"local-deployment/client/src/components/admin-entry-controls.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Entry } from \"@shared/schema\";\n\ninterface AdminEntryControlsProps {\n  entry: Entry;\n  onEdit?: () => void;\n  onDelete?: () => void;\n}\n\nexport default function AdminEntryControls({ entry, onEdit, onDelete }: AdminEntryControlsProps) {\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  \n  // Check if entry is fully paid (no pending amount)\n  const isFullyPaid = entry.status === \"full\";\n  \n  return (\n    <div className=\"flex gap-2\">\n      {/* Edit functionality has been disabled */}\n      <Button \n        variant=\"outline\" \n        size=\"sm\"\n        className=\"text-neutral-400 flex items-center gap-1\"\n        disabled\n        title=\"Edit entry functionality has been disabled\"\n      >\n        <span className=\"material-icons text-sm\">edit_off</span>\n        Edit Entry\n      </Button>\n      \n      {!isFullyPaid ? (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          className=\"text-red-600 flex items-center gap-1\"\n          onClick={() => setShowDeleteConfirm(true)}\n        >\n          <span className=\"material-icons text-sm\">delete</span>\n          Delete\n        </Button>\n      ) : (\n        <Button \n          variant=\"outline\" \n          size=\"sm\"\n          className=\"text-neutral-400 flex items-center gap-1\"\n          disabled\n          title=\"Fully paid entries cannot be deleted\"\n        >\n          <span className=\"material-icons text-sm\">delete_off</span>\n          Delete\n        </Button>\n      )}\n      \n      <AlertDialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you sure you want to delete this entry?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete entry \"{entry.description}\" and all associated payment records.\n              This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => {\n                if (onDelete) onDelete();\n                setShowDeleteConfirm(false);\n              }}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}","size_bytes":2821},"local-deployment/client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/edit-previous-outstanding.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { UserSelect } from \"@/components/user-select\";\nimport { ArrowLeft, Save } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PreviousOutstanding {\n  id: number;\n  serialNumber?: string;\n  recordNumber?: number;\n  userId: number;\n  userName: string;\n  userMobile?: string;\n  userAddress?: string;\n  outstandingAmount: number;\n  receivedAmount?: number;\n  pendingAmount?: number;\n  status: 'pending' | 'partial' | 'full';\n  description: string;\n  attachmentUrl?: string;\n  attachmentName?: string;\n  createdBy?: string;\n  createdAt?: string;\n  updatedAt?: string;\n  payments?: any[];\n}\n\nexport default function EditPreviousOutstanding() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Get record ID from URL\n  const recordId = parseInt(window.location.pathname.split('/')[2]);\n  \n  // Form states\n  const [editUserId, setEditUserId] = useState<number | undefined>(undefined);\n  const [editDescription, setEditDescription] = useState<string>(\"\");\n  const [editAmount, setEditAmount] = useState<string>(\"\");\n  const [editAttachment, setEditAttachment] = useState<File | null>(null);\n\n  // Fetch the record to edit\n  const { data: record, isLoading, error } = useQuery({\n    queryKey: ['/api/previous-outstanding', recordId],\n    queryFn: async () => {\n      const response = await fetch(`/api/previous-outstanding/${recordId}`, {\n        credentials: 'include',\n      });\n      if (!response.ok) {\n        throw new Error(`Failed to fetch record: ${response.status}`);\n      }\n      const data = await response.json();\n      console.log('API response:', data);\n      return data as PreviousOutstanding;\n    },\n    enabled: !!recordId && !isNaN(recordId),\n  });\n\n  // Initialize form values when record loads\n  useEffect(() => {\n    if (record) {\n      setEditUserId(record.userId);\n      setEditDescription(record.description || \"\");\n      setEditAmount((record.outstandingAmount || 0).toString());\n    }\n  }, [record]);\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async (updateData: { userId?: number; description?: string; outstandingAmount: number; attachmentFile?: File }) => {\n      if (updateData.attachmentFile) {\n        // Use FormData for file upload\n        const formData = new FormData();\n        formData.append('outstandingAmount', updateData.outstandingAmount.toString());\n        formData.append('attachmentFile', updateData.attachmentFile);\n        if (updateData.userId) formData.append('userId', updateData.userId.toString());\n        if (updateData.description !== undefined) formData.append('description', updateData.description);\n        \n        const response = await fetch(`/api/previous-outstanding/${recordId}`, {\n          method: 'PATCH',\n          body: formData,\n          credentials: 'include',\n        });\n        \n        if (!response.ok) {\n          const error = await response.json();\n          throw new Error(error.message || 'Failed to update record');\n        }\n        \n        return response.json();\n      } else {\n        const payload: any = { outstandingAmount: updateData.outstandingAmount };\n        if (updateData.userId) payload.userId = updateData.userId;\n        if (updateData.description !== undefined) payload.description = updateData.description;\n        return apiRequest('PATCH', `/api/previous-outstanding/${recordId}`, payload);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/previous-outstanding'] });\n      toast({\n        title: \"Success\",\n        description: \"Outstanding record updated successfully\"\n      });\n      setLocation('/previous-outstanding');\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update outstanding record\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    const amount = parseFloat(editAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a valid amount\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!record) return;\n\n    const minAmount = record.receivedAmount || 0;\n    if (amount < minAmount) {\n      toast({\n        title: \"Error\",\n        description: `Amount cannot be less than already received amount of ‚Çπ${minAmount.toLocaleString()}`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    updateMutation.mutate({\n      userId: user?.role === 'admin' ? editUserId : undefined,\n      description: user?.role === 'admin' ? editDescription : undefined,\n      outstandingAmount: amount,\n      attachmentFile: editAttachment || undefined\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-600\">Error loading record: {error.message}</div>\n      </div>\n    );\n  }\n\n  if (!record) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-600\">Record not found</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Button \n          variant=\"outline\" \n          size=\"sm\" \n          onClick={() => setLocation('/previous-outstanding')}\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to List\n        </Button>\n        <h1 className=\"text-2xl font-bold\">Edit Outstanding Payment</h1>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Edit Outstanding Payment Details</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* User Field - Editable for admin, readonly for others */}\n              {user?.role === 'admin' ? (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"user-select\">Select User *</Label>\n                  <UserSelect\n                    value={editUserId}\n                    onValueChange={setEditUserId}\n                    placeholder=\"Search and select user\"\n                    className=\"w-full\"\n                  />\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <Label>User</Label>\n                  <Input\n                    value={record?.userName || \"\"}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n\n              {/* Description Field - Editable for admin, readonly for others */}\n              {user?.role === 'admin' ? (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description *</Label>\n                  <Input\n                    id=\"description\"\n                    value={editDescription}\n                    onChange={(e) => setEditDescription(e.target.value)}\n                    placeholder=\"Enter description\"\n                    required\n                  />\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  <Label>Description</Label>\n                  <Input\n                    value={record?.description || \"\"}\n                    disabled\n                    className=\"bg-gray-50\"\n                  />\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label>Already Received</Label>\n                <Input\n                  value={`‚Çπ${((record?.receivedAmount || 0)).toLocaleString()}`}\n                  disabled\n                  className=\"bg-gray-50 text-green-700 font-medium\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"amount\">Outstanding Amount (‚Çπ) *</Label>\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  value={editAmount}\n                  onChange={(e) => setEditAmount(e.target.value)}\n                  min={record.receivedAmount || 0}\n                  step=\"0.01\"\n                  placeholder=\"Enter amount in rupees\"\n                  required\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  Minimum: ‚Çπ{(record.receivedAmount || 0).toLocaleString()} (already received)\n                </p>\n              </div>\n\n              <div className=\"space-y-2 md:col-span-2\">\n                <Label htmlFor=\"attachment\">Replace Attachment (Optional)</Label>\n                <Input\n                  id=\"attachment\"\n                  type=\"file\"\n                  accept=\"image/*,application/pdf\"\n                  onChange={(e) => setEditAttachment(e.target.files?.[0] || null)}\n                  className=\"cursor-pointer\"\n                />\n                {record.attachmentUrl && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    Current: <a href={record.attachmentUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 hover:underline\">File attached</a>\n                  </p>\n                )}\n                {editAttachment && (\n                  <p className=\"text-xs text-green-600\">\n                    New file selected: {editAttachment.name}\n                  </p>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setLocation('/previous-outstanding')}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={updateMutation.isPending}\n                className=\"min-w-[120px]\"\n              >\n                {updateMutation.isPending ? (\n                  \"Updating...\"\n                ) : (\n                  <>\n                    <Save className=\"h-4 w-4 mr-2\" />\n                    Update\n                  </>\n                )}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":10992},"local-deployment/client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"local-deployment/client/src/components/user-select.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Check, ChevronsUpDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface User {\n  id: number;\n  name: string;\n  mobile?: string;\n  address?: string;\n}\n\ninterface UserSelectProps {\n  value?: number;\n  onValueChange: (value: number | undefined) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport function UserSelect({ value, onValueChange, placeholder = \"Select user\", disabled = false, className }: UserSelectProps) {\n  const [open, setOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  const { data: users, isLoading } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n  });\n\n  const selectedUser = users?.find(user => user.id === value);\n\n  const formatUserDisplay = (user: User) => {\n    const parts = [user.name];\n    if (user.mobile) parts.push(user.mobile);\n    if (user.address) parts.push(user.address);\n    return parts.join(' - ');\n  };\n\n  const filteredUsers = useMemo(() => {\n    if (!users) return [];\n    if (!searchTerm) return users;\n    \n    const searchLower = searchTerm.toLowerCase();\n    return users.filter(user => \n      user.name.toLowerCase().includes(searchLower) ||\n      (user.mobile && user.mobile.toLowerCase().includes(searchLower)) ||\n      (user.address && user.address.toLowerCase().includes(searchLower))\n    );\n  }, [users, searchTerm]);\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\"w-full justify-between\", className)}\n          disabled={disabled || isLoading}\n        >\n          {selectedUser ? formatUserDisplay(selectedUser) : (isLoading ? \"Loading users...\" : placeholder)}\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-[400px] p-0\">\n        <div className=\"p-2\">\n          <Input\n            placeholder=\"Search users by name, mobile, or address...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"w-full\"\n          />\n        </div>\n        <div className=\"max-h-[200px] overflow-auto\">\n          {filteredUsers.length > 0 ? (\n            filteredUsers.map((user) => (\n              <div\n                key={user.id}\n                className={cn(\n                  \"flex items-center px-2 py-2 cursor-pointer hover:bg-accent hover:text-accent-foreground\",\n                  value === user.id && \"bg-accent text-accent-foreground\"\n                )}\n                onClick={() => {\n                  onValueChange(user.id === value ? undefined : user.id);\n                  setOpen(false);\n                  setSearchTerm(\"\");\n                }}\n              >\n                <Check\n                  className={cn(\n                    \"mr-2 h-4 w-4\",\n                    value === user.id ? \"opacity-100\" : \"opacity-0\"\n                  )}\n                />\n                <div className=\"flex flex-col\">\n                  <span className=\"font-medium\">{user.name}</span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    {user.mobile && `üì± ${user.mobile}`}\n                    {user.mobile && user.address && ' ‚Ä¢ '}\n                    {user.address && `üè† ${user.address}`}\n                  </span>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"px-2 py-2 text-sm text-muted-foreground\">\n              {isLoading ? \"Loading users...\" : searchTerm ? \"No users found matching search\" : \"No users available\"}\n            </div>\n          )}\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}","size_bytes":4060},"local-deployment/client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":772},"local-deployment/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};","size_bytes":80},"local-deployment/server/find-duplicate-mobiles.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as path from 'path';\n\nasync function findDuplicateMobiles() {\n  try {\n    console.log('Fetching all users from database...');\n    \n    // Get all users from database\n    const allUsers = await db.select().from(users).orderBy(users.serialNumber);\n    console.log(`Total users in database: ${allUsers.length}`);\n\n    // Group users by mobile number\n    const mobileGroups: { [mobile: string]: typeof allUsers } = {};\n    \n    allUsers.forEach(user => {\n      const mobile = user.mobile.trim();\n      if (mobile) {\n        if (!mobileGroups[mobile]) {\n          mobileGroups[mobile] = [];\n        }\n        mobileGroups[mobile].push(user);\n      }\n    });\n\n    // Find mobile numbers with duplicates\n    const duplicateMobiles = Object.entries(mobileGroups)\n      .filter(([mobile, userList]) => userList.length > 1)\n      .sort(([a], [b]) => a.localeCompare(b));\n\n    console.log(`Found ${duplicateMobiles.length} mobile numbers with duplicates`);\n\n    // Create data for Excel export\n    const duplicateUsersData: any[] = [];\n    let totalDuplicateUsers = 0;\n\n    duplicateMobiles.forEach(([mobile, userList]) => {\n      console.log(`Mobile ${mobile}: ${userList.length} users`);\n      \n      userList.forEach((user, index) => {\n        duplicateUsersData.push({\n          'username': user.username,\n          'password': 'password123', // Default password for all users\n          'name': user.name,\n          'email': user.email,\n          'mobile': mobile,\n          'address': user.address,\n          'role': user.role,\n          'status': user.status,\n          'serial_number': user.serialNumber,\n          'duplicate_count': userList.length,\n          'duplicate_position': index + 1\n        });\n        totalDuplicateUsers++;\n      });\n    });\n\n    console.log(`Total users with duplicate mobile numbers: ${totalDuplicateUsers}`);\n\n    // Create Excel workbook\n    const workbook = XLSX.utils.book_new();\n    \n    // Summary sheet\n    const summaryData = [\n      ['Total Users in Database', allUsers.length],\n      ['Unique Mobile Numbers', Object.keys(mobileGroups).length],\n      ['Mobile Numbers with Duplicates', duplicateMobiles.length],\n      ['Total Users with Duplicate Mobiles', totalDuplicateUsers],\n      [''],\n      ['Mobile Number', 'Duplicate Count'],\n      ...duplicateMobiles.map(([mobile, userList]) => [mobile, userList.length])\n    ];\n    \n    const summarySheet = XLSX.utils.aoa_to_sheet(summaryData);\n    XLSX.utils.book_append_sheet(workbook, summarySheet, 'Summary');\n\n    // Detailed users sheet\n    const detailedSheet = XLSX.utils.json_to_sheet(duplicateUsersData);\n    XLSX.utils.book_append_sheet(workbook, detailedSheet, 'Duplicate Mobile Users');\n\n    // Write the file\n    const fileName = `Duplicate_Mobile_Users_${new Date().toISOString().split('T')[0]}.xlsx`;\n    const filePath = path.join(process.cwd(), '..', fileName);\n    \n    XLSX.writeFile(workbook, filePath);\n    console.log(`\\nExcel file created: ${fileName}`);\n    console.log(`File path: ${filePath}`);\n\n    // Create summary report\n    console.log('\\n=== DUPLICATE MOBILE NUMBERS SUMMARY ===');\n    console.log(`Total users in database: ${allUsers.length}`);\n    console.log(`Users with duplicate mobile numbers: ${totalDuplicateUsers}`);\n    console.log(`Mobile numbers with duplicates: ${duplicateMobiles.length}`);\n    console.log(`Percentage of users with duplicate mobiles: ${((totalDuplicateUsers / allUsers.length) * 100).toFixed(2)}%`);\n\n    console.log('\\n=== TOP 10 MOST DUPLICATED MOBILE NUMBERS ===');\n    const topDuplicates = duplicateMobiles\n      .sort(([, a], [, b]) => b.length - a.length)\n      .slice(0, 10);\n    \n    topDuplicates.forEach(([mobile, userList]) => {\n      console.log(`${mobile}: ${userList.length} users`);\n    });\n\n    return {\n      totalUsers: allUsers.length,\n      duplicateUsers: totalDuplicateUsers,\n      duplicateMobiles: duplicateMobiles.length,\n      fileName: fileName\n    };\n\n  } catch (error) {\n    console.error('Error finding duplicate mobiles:', error);\n    throw error;\n  }\n}\n\n// Run the analysis\nfindDuplicateMobiles()\n  .then(result => {\n    console.log('\\n=== ANALYSIS COMPLETE ===');\n    console.log(`Excel file ready for download: ${result.fileName}`);\n    console.log(`Found ${result.duplicateUsers} users with duplicate mobile numbers`);\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Analysis failed:', error);\n    process.exit(1);\n  });","size_bytes":4522},"local-deployment/client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"local-deployment/drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set in .env file\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});","size_bytes":313},"client/src/components/sidebar-navigation.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { \n  Menu, \n  Home, \n  Users, \n  FileText, \n  Plus, \n  CreditCard, \n  BarChart3, \n  Settings,\n  UserCircle,\n  Receipt,\n  DollarSign,\n  BookOpen,\n  ChevronDown,\n  ChevronRight\n} from \"lucide-react\";\nimport daanDarpanLogo from \"@assets/daan_darpan_new_logo.png\";\n\ninterface User {\n  role: string;\n  name?: string;\n  username: string;\n}\n\nexport function SidebarNavigation() {\n  const [location] = useLocation();\n  const [isOpen, setIsOpen] = useState(false);\n  const [openMenus, setOpenMenus] = useState<string[]>([]);\n  \n  const { data: user } = useQuery<User>({\n    queryKey: ['/api/auth/user'],\n    retry: false\n  });\n\n  const isViewer = user?.role === 'viewer';\n\n  const toggleMenu = (menuKey: string) => {\n    setOpenMenus(prev => \n      prev.includes(menuKey) \n        ? prev.filter(key => key !== menuKey)\n        : [...prev, menuKey]\n    );\n  };\n  \n  const menuGroups = [\n    {\n      key: \"dashboard\",\n      label: \"Dashboard\",\n      icon: Home,\n      href: \"/dashboard\",\n      show: user?.role === 'admin' || user?.role === 'operator',\n      isMainItem: true\n    },\n    {\n      key: \"account\",\n      label: \"My Account\", \n      icon: UserCircle,\n      show: true,\n      items: [\n        {\n          label: \"My Account\",\n          href: \"/my-account\",\n          show: true\n        }\n      ]\n    },\n    {\n      key: \"users\",\n      label: \"Users\",\n      icon: Users,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"All Users\",\n          href: \"/users\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"entries\",\n      label: \"Boli Entries\",\n      icon: FileText,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"View Boli Entries\",\n          href: \"/entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"Add New Boli Entry\",\n          href: \"/entry/new\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"dravya\",\n      label: \"Dravya\",\n      icon: BookOpen,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"Dravya Entries\",\n          href: \"/dravya-entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Dravya Entry\",\n          href: \"/dravya-entry-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"expenses\",\n      label: \"Expenses\",\n      icon: Receipt,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"Expense Entries\",\n          href: \"/expense-entries\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Expense\",\n          href: \"/expense-entry-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"payments\",\n      label: \"Payments\",\n      icon: DollarSign,\n      show: user?.role === 'admin' || user?.role === 'operator',\n      items: [\n        {\n          label: \"All Boli Payments\",\n          href: \"/payments\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"All Advance Payments\",\n          href: \"/advance-payments\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"New Advance Payment\",\n          href: \"/advance-payment-form\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"Previous Outstanding\",\n          href: \"/previous-outstanding\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        },\n        {\n          label: \"All Previous Outstanding Payments\",\n          href: \"/previous-outstanding-payments\",\n          show: user?.role === 'admin' || user?.role === 'operator'\n        }\n      ]\n    },\n    {\n      key: \"logs\",\n      label: \"Logs\",\n      icon: BarChart3,\n      href: \"/logs\",\n      show: user?.role === 'admin',\n      isMainItem: true\n    },\n    {\n      key: \"settings\",\n      label: user?.role === 'viewer' ? \"My Profile\" : \"Settings\",\n      icon: Settings,\n      href: \"/settings\",\n      show: true,\n      isMainItem: true\n    }\n  ];\n\n  const filteredMenuGroups = menuGroups.filter(group => group.show);\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full\">\n      {/* Header */}\n      <div className=\"p-4 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <img \n            src={daanDarpanLogo} \n            alt=\"Daan-Darpan Logo\" \n            className=\"w-10 h-8 object-contain\"\n          />\n          <div>\n            <h2 className=\"font-semibold text-sm\">‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£</h2>\n            <p className=\"text-xs text-muted-foreground\">\n              {user?.name || user?.username}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <div className=\"flex-1 overflow-auto p-4\">\n        <nav className=\"space-y-2\">\n          {filteredMenuGroups.map((group) => {\n            const Icon = group.icon;\n            const isMenuOpen = openMenus.includes(group.key);\n            \n            // For main items without sub-menus\n            if (group.isMainItem) {\n              const isActive = location === group.href;\n              return (\n                <Link key={group.key} href={group.href!}>\n                  <Button\n                    variant={isActive ? \"default\" : \"ghost\"}\n                    className=\"w-full justify-start gap-3\"\n                    onClick={() => setIsOpen(false)}\n                  >\n                    <Icon size={18} />\n                    {group.label}\n                  </Button>\n                </Link>\n              );\n            }\n\n            // For menu groups with sub-items\n            return (\n              <Collapsible key={group.key} open={isMenuOpen} onOpenChange={() => toggleMenu(group.key)}>\n                <CollapsibleTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    className=\"w-full justify-between gap-3\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Icon size={18} />\n                      {group.label}\n                    </div>\n                    {isMenuOpen ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\n                  </Button>\n                </CollapsibleTrigger>\n                <CollapsibleContent className=\"space-y-1 mt-1\">\n                  {group.items?.filter(item => item.show).map((item) => {\n                    const isActive = location === item.href || \n                      (item.href === \"/my-account\" && location.includes(\"/users/\"));\n                    \n                    return (\n                      <Link key={item.href} href={item.href}>\n                        <Button\n                          variant={isActive ? \"default\" : \"ghost\"}\n                          className=\"w-full justify-start gap-3 ml-6 text-sm\"\n                          onClick={() => setIsOpen(false)}\n                        >\n                          {item.label}\n                        </Button>\n                      </Link>\n                    );\n                  })}\n                </CollapsibleContent>\n              </Collapsible>\n            );\n          })}\n        </nav>\n      </div>\n    </div>\n  );\n\n  return (\n    <>\n      <Button \n        variant=\"outline\" \n        size=\"icon\"\n        className=\"fixed top-4 left-4 z-50 bg-white shadow-md\"\n        onClick={() => setIsOpen(true)}\n      >\n        <Menu size={20} />\n      </Button>\n      \n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 flex\">\n          <div className=\"fixed inset-0 bg-black/50\" onClick={() => setIsOpen(false)} />\n          <div className=\"relative bg-white w-72 h-full shadow-lg\">\n            <SidebarContent />\n          </div>\n        </div>\n      )}\n    </>\n  );\n}","size_bytes":8531},"local-deployment/client/src/components/advance-payment-receipt.tsx":{"content":"import { useRef, useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Printer, Save, X } from \"lucide-react\";\n\ninterface AdvancePayment {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile?: string;\n  userAddress?: string;\n  date: string;\n  amount: number;\n  paymentMode: string;\n  receiptNo?: string;\n  createdBy: string;\n  createdAt: string;\n}\n\ninterface AdvancePaymentReceiptProps {\n  advancePayment: AdvancePayment;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\n// Local storage key for saved values\nconst SAVED_VALUES_KEY = 'advance_receipt_saved_values';\n\n// Interface for saved values\ninterface SavedValues {\n  referredBy: string;\n  recordedBy: string;\n}\n\n// Function to get payment mode in Hindi\nconst getPaymentModeHindi = (mode: string): string => {\n  const modeMap: { [key: string]: string } = {\n    'cash': '‡§®‡§ó‡§¶',\n    'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à',\n    'cheque': '‡§ö‡•á‡§ï',\n    'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó'\n  };\n  return modeMap[mode.toLowerCase()] || mode;\n};\n\n// Function to convert English names to Hindi (enhanced transliteration)\nconst convertNameToHindi = (name: string): string => {\n  if (!name) return name;\n  \n  // Comprehensive name mappings\n  const nameMap: { [key: string]: string } = {\n    // Common names\n    'shailesh': '‡§∂‡•à‡§≤‡•á‡§∂',\n    'aashi': '‡§Ü‡§∂‡•Ä',\n    'raj': '‡§∞‡§æ‡§ú',\n    'rajesh': '‡§∞‡§æ‡§ú‡•á‡§∂',\n    'suresh': '‡§∏‡•Å‡§∞‡•á‡§∂',\n    'ramesh': '‡§∞‡§Æ‡•á‡§∂',\n    'mukesh': '‡§Æ‡•Å‡§ï‡•á‡§∂',\n    'dinesh': '‡§¶‡§ø‡§®‡•á‡§∂',\n    'mahesh': '‡§Æ‡§π‡•á‡§∂',\n    'naresh': '‡§®‡§∞‡•á‡§∂',\n    'rakesh': '‡§∞‡§æ‡§ï‡•á‡§∂',\n    'umesh': '‡§â‡§Æ‡•á‡§∂',\n    'yogesh': '‡§Ø‡•ã‡§ó‡•á‡§∂',\n    'ritesh': '‡§∞‡§ø‡§§‡•á‡§∂',\n    'hitesh': '‡§π‡§ø‡§§‡•á‡§∂',\n    'nilesh': '‡§®‡•Ä‡§≤‡•á‡§∂',\n    'pradip': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'pradeep': '‡§™‡•ç‡§∞‡§¶‡•Ä‡§™',\n    'deepak': '‡§¶‡•Ä‡§™‡§ï',\n    'deepika': '‡§¶‡•Ä‡§™‡§ø‡§ï‡§æ',\n    'priya': '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ',\n    'pooja': '‡§™‡•Ç‡§ú‡§æ',\n    'manish': '‡§Æ‡§®‡•Ä‡§∑',\n    'ashish': '‡§Ü‡§∂‡•Ä‡§∑',\n    'sanjay': '‡§∏‡§Ç‡§ú‡§Ø',\n    'ajay': '‡§Ö‡§ú‡§Ø',\n    'vijay': '‡§µ‡§ø‡§ú‡§Ø',\n    'ravi': '‡§∞‡§µ‡§ø',\n    'kiran': '‡§ï‡§ø‡§∞‡§£',\n    'aman': '‡§Ö‡§Æ‡§®',\n    'arun': '‡§Ö‡§∞‡•Å‡§£',\n    'anita': '‡§Ö‡§®‡•Ä‡§§‡§æ',\n    'sunita': '‡§∏‡•Å‡§®‡•Ä‡§§‡§æ',\n    'rekha': '‡§∞‡•á‡§ñ‡§æ',\n    'meera': '‡§Æ‡•Ä‡§∞‡§æ',\n    'seeta': '‡§∏‡•Ä‡§§‡§æ',\n    'geeta': '‡§ó‡•Ä‡§§‡§æ',\n    'rita': '‡§∞‡•Ä‡§§‡§æ',\n    'kavita': '‡§ï‡§µ‡§ø‡§§‡§æ',\n    'savita': '‡§∏‡§µ‡§ø‡§§‡§æ',\n    'mamta': '‡§Æ‡§Æ‡§§‡§æ',\n    'sushma': '‡§∏‡•Å‡§∑‡•ç‡§Æ‡§æ',\n    'krishna': '‡§ï‡•É‡§∑‡•ç‡§£‡§æ',\n    'radha': '‡§∞‡§æ‡§ß‡§æ',\n    'shanti': '‡§∂‡§æ‡§Ç‡§§‡§ø',\n    'bharti': '‡§≠‡§æ‡§∞‡§§‡•Ä',\n    'aarti': '‡§Ü‡§∞‡§§‡•Ä',\n    'sanskar': '‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞',\n    \n    // Surnames\n    'jain': '‡§ú‡•à‡§®',\n    'sharma': '‡§∂‡§∞‡•ç‡§Æ‡§æ',\n    'kumar': '‡§ï‡•Å‡§Æ‡§æ‡§∞',\n    'singh': '‡§∏‡§ø‡§Ç‡§π',\n    'gupta': '‡§ó‡•Å‡§™‡•ç‡§§‡§æ',\n    'agarwal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'agrawal': '‡§Ö‡§ó‡•ç‡§∞‡§µ‡§æ‡§≤',\n    'shah': '‡§∂‡§æ‡§π',\n    'patel': '‡§™‡§ü‡•á‡§≤',\n    'mehta': '‡§Æ‡•á‡§π‡§§‡§æ',\n    'modi': '‡§Æ‡•ã‡§¶‡•Ä',\n    'verma': '‡§µ‡§∞‡•ç‡§Æ‡§æ',\n    'tiwari': '‡§§‡§ø‡§µ‡§æ‡§∞‡•Ä',\n    'pandey': '‡§™‡§æ‡§Ç‡§°‡•á',\n    'mishra': '‡§Æ‡§ø‡§∂‡•ç‡§∞‡§æ',\n    'yadav': '‡§Ø‡§æ‡§¶‡§µ',\n    'soni': '‡§∏‡•ã‡§®‡•Ä',\n    'goel': '‡§ó‡•ã‡§Ø‡§≤',\n    'goyal': '‡§ó‡•ã‡§Ø‡§≤',\n    'bansal': '‡§¨‡§Ç‡§∏‡§≤',\n    'mittal': '‡§Æ‡§ø‡§§‡•ç‡§§‡§≤',\n    'singhal': '‡§∏‡§ø‡§Ç‡§ò‡§≤',\n    'jindal': '‡§ú‡§ø‡§Ç‡§¶‡§≤',\n    'chopra': '‡§ö‡•ã‡§™‡§°‡§º‡§æ',\n    'kapoor': '‡§ï‡§™‡•Ç‡§∞',\n    'malhotra': '‡§Æ‡§≤‡•ç‡§π‡•ã‡§§‡•ç‡§∞‡§æ',\n    'khanna': '‡§ñ‡§®‡•ç‡§®‡§æ',\n    'arora': '‡§Ö‡§∞‡•ã‡§°‡§º‡§æ',\n    'bhatia': '‡§≠‡§æ‡§ü‡§ø‡§Ø‡§æ',\n    'sethi': '‡§∏‡•á‡§†‡•Ä',\n    'tandon': '‡§ü‡§Ç‡§°‡§®',\n    'saxena': '‡§∏‡§ï‡•ç‡§∏‡•á‡§®‡§æ',\n    'srivastava': '‡§∂‡•ç‡§∞‡•Ä‡§µ‡§æ‡§∏‡•ç‡§§‡§µ',\n    'mathur': '‡§Æ‡§æ‡§•‡•Å‡§∞',\n    'chandra': '‡§ö‡§Ç‡§¶‡•ç‡§∞',\n    'prakash': '‡§™‡•ç‡§∞‡§ï‡§æ‡§∂',\n    \n    // Titles\n    'shree': '‡§∂‡•ç‡§∞‡•Ä',\n    'shri': '‡§∂‡•ç‡§∞‡•Ä',\n    'smt': '‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä',\n    'mr': '‡§∂‡•ç‡§∞‡•Ä',\n    'mrs': '‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä',\n    'ms': '‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä',\n    'dr': '‡§°‡•â',\n    'prof': '‡§™‡•ç‡§∞‡•ã'\n  };\n  \n  // Split name into words and process each\n  const words = name.toLowerCase().trim().split(/\\s+/);\n  const hindiWords = words.map(word => {\n    // Remove punctuation for mapping lookup\n    const cleanWord = word.replace(/[.,!?;:]/g, '');\n    \n    // Check direct mapping\n    if (nameMap[cleanWord]) {\n      return nameMap[cleanWord];\n    }\n    \n    // Check partial matches for compound names\n    for (const [eng, hindi] of Object.entries(nameMap)) {\n      if (cleanWord.includes(eng) && eng.length > 2) {\n        return hindi;\n      }\n    }\n    \n    // Return original with proper case if no mapping found\n    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n  });\n  \n  return hindiWords.join(' ');\n};\n\n// Function to convert addresses and locations to Hindi\nconst convertAddressToHindi = (address: string): string => {\n  if (!address) return address;\n  \n  const addressMap: { [key: string]: string } = {\n    'sector': '‡§∏‡•á‡§ï‡•ç‡§ü‡§∞',\n    'block': '‡§¨‡•ç‡§≤‡•â‡§ï',\n    'plot': '‡§™‡•ç‡§≤‡•â‡§ü',\n    'house': '‡§Æ‡§ï‡§æ‡§®',\n    'flat': '‡§´‡•ç‡§≤‡•à‡§ü',\n    'apartment': '‡§Ö‡§™‡§æ‡§∞‡•ç‡§ü‡§Æ‡•á‡§Ç‡§ü',\n    'colony': '‡§ï‡•â‡§≤‡•ã‡§®‡•Ä',\n    'nagar': '‡§®‡§ó‡§∞',\n    'city': '‡§∂‡§π‡§∞',\n    'road': '‡§∞‡•ã‡§°',\n    'street': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü',\n    'lane': '‡§≤‡•á‡§®',\n    'main': '‡§Æ‡•Å‡§ñ‡•ç‡§Ø',\n    'near': '‡§ï‡•á ‡§™‡§æ‡§∏',\n    'behind': '‡§ï‡•á ‡§™‡•Ä‡§õ‡•á',\n    'front': '‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á',\n    'jabalpur': '‡§ú‡§¨‡§≤‡§™‡•Å‡§∞',\n    'shivnagar': '‡§∂‡§ø‡§µ‡§®‡§ó‡§∞',\n    'bhopal': '‡§≠‡•ã‡§™‡§æ‡§≤',\n    'indore': '‡§á‡§Ç‡§¶‡•å‡§∞',\n    'gwalior': '‡§ó‡•ç‡§µ‡§æ‡§≤‡§ø‡§Ø‡§∞',\n    'ujjain': '‡§â‡§ú‡•ç‡§ú‡•à‡§®'\n  };\n  \n  let hindiAddress = address;\n  \n  // Replace each English word with Hindi if mapping exists\n  for (const [eng, hindi] of Object.entries(addressMap)) {\n    const regex = new RegExp(`\\\\b${eng}\\\\b`, 'gi');\n    hindiAddress = hindiAddress.replace(regex, hindi);\n  }\n  \n  return hindiAddress;\n};\n\n// Function to convert numbers to Hindi words\nconst convertToHindiWords = (amount: number): string => {\n  const ones = ['', '‡§è‡§ï', '‡§¶‡•ã', '‡§§‡•Ä‡§®', '‡§ö‡§æ‡§∞', '‡§™‡§æ‡§Ç‡§ö', '‡§õ‡§π', '‡§∏‡§æ‡§§', '‡§Ü‡§†', '‡§®‡•å'];\n  const teens = ['‡§¶‡§∏', '‡§ó‡•ç‡§Ø‡§æ‡§∞‡§π', '‡§¨‡§æ‡§∞‡§π', '‡§§‡•á‡§∞‡§π', '‡§ö‡•å‡§¶‡§π', '‡§™‡§Ç‡§¶‡•ç‡§∞‡§π', '‡§∏‡•ã‡§≤‡§π', '‡§∏‡§§‡•ç‡§∞‡§π', '‡§Ö‡§†‡§æ‡§∞‡§π', '‡§â‡§®‡•ç‡§®‡•Ä‡§∏'];\n  const tens = ['', '', '‡§¨‡•Ä‡§∏', '‡§§‡•Ä‡§∏', '‡§ö‡§æ‡§≤‡•Ä‡§∏', '‡§™‡§ö‡§æ‡§∏', '‡§∏‡§æ‡§†', '‡§∏‡§§‡•ç‡§§‡§∞', '‡§Ö‡§∏‡•ç‡§∏‡•Ä', '‡§®‡§¨‡•ç‡§¨‡•á'];\n  \n  if (amount === 0) return '‡§∂‡•Ç‡§®‡•ç‡§Ø';\n  if (amount < 10) return ones[amount];\n  if (amount < 20) return teens[amount - 10];\n  if (amount < 100) {\n    const ten = Math.floor(amount / 10);\n    const one = amount % 10;\n    return tens[ten] + (one > 0 ? ' ' + ones[one] : '');\n  }\n  if (amount < 1000) {\n    const hundred = Math.floor(amount / 100);\n    const remainder = amount % 100;\n    return ones[hundred] + ' ‡§∏‡•å' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  if (amount < 100000) {\n    const thousand = Math.floor(amount / 1000);\n    const remainder = amount % 1000;\n    return convertToHindiWords(thousand) + ' ‡§π‡§ú‡§æ‡§∞' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  if (amount < 10000000) {\n    const lakh = Math.floor(amount / 100000);\n    const remainder = amount % 100000;\n    return convertToHindiWords(lakh) + ' ‡§≤‡§æ‡§ñ' + (remainder > 0 ? ' ' + convertToHindiWords(remainder) : '');\n  }\n  \n  return amount.toString(); // Fallback for very large numbers\n};\n\nexport function AdvancePaymentReceipt({ advancePayment, isOpen, onClose }: AdvancePaymentReceiptProps) {\n  const printRef = useRef<HTMLDivElement>(null);\n  \n  // Saved values state\n  const [savedValues, setSavedValues] = useState<SavedValues>({\n    referredBy: '',\n    recordedBy: ''\n  });\n\n  // Load saved values on component mount\n  useEffect(() => {\n    const saved = localStorage.getItem(SAVED_VALUES_KEY);\n    if (saved) {\n      try {\n        setSavedValues(JSON.parse(saved));\n      } catch (error) {\n        console.error('Error loading saved values:', error);\n      }\n    }\n  }, []);\n\n  // Save values to localStorage\n  const handleSaveValues = () => {\n    localStorage.setItem(SAVED_VALUES_KEY, JSON.stringify(savedValues));\n    alert('‡§Æ‡§æ‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•á ‡§ó‡§è!');\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('hi-IN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const handlePrint = () => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      const currentDate = new Date().toLocaleDateString('hi-IN');\n      const amountInWords = convertToHindiWords(advancePayment.amount);\n      const paymentModeHindi = getPaymentModeHindi(advancePayment.paymentMode);\n      \n      const html = `\n        <!DOCTYPE html>\n        <html lang=\"hi\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <title>‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - ${advancePayment.receiptNo}</title>\n            <style>\n              @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n              \n              body {\n                font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n                margin: 0;\n                padding: 20px;\n                background: white;\n                color: #000;\n                font-size: 16px;\n                line-height: 1.4;\n              }\n              \n              .receipt-container {\n                max-width: 600px;\n                margin: 0 auto;\n                border: 2px solid #000;\n                padding: 0;\n              }\n              \n              .receipt-header {\n                text-align: center;\n                padding: 15px;\n                background: #f8f9fa;\n                border-bottom: 2px solid #000;\n              }\n              \n              .temple-name {\n                font-size: 28px;\n                font-weight: 700;\n                margin-bottom: 8px;\n                color: #d97706;\n              }\n              \n              .temple-subtitle {\n                font-size: 16px;\n                margin-bottom: 5px;\n                color: #666;\n              }\n              \n              .receipt-title {\n                font-size: 20px;\n                font-weight: 600;\n                margin-top: 10px;\n                color: #000;\n              }\n              \n              .receipt-body {\n                padding: 20px;\n              }\n              \n              .receipt-section {\n                margin-bottom: 20px;\n              }\n              \n              .section-title {\n                font-size: 18px;\n                font-weight: 600;\n                margin-bottom: 10px;\n                color: #374151;\n                border-bottom: 1px solid #e5e7eb;\n                padding-bottom: 5px;\n              }\n              \n              .receipt-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                margin-bottom: 8px;\n                padding: 4px 0;\n              }\n              \n              .receipt-label {\n                font-weight: 600;\n                color: #374151;\n                flex: 1;\n              }\n              \n              .receipt-value {\n                flex: 2;\n                text-align: right;\n                color: #000;\n              }\n              \n              .amount-section {\n                background: #fef3c7;\n                padding: 15px;\n                border: 1px solid #f59e0b;\n                margin: 15px 0;\n                border-radius: 4px;\n              }\n              \n              .amount-large {\n                font-size: 24px;\n                font-weight: 700;\n                color: #d97706;\n              }\n              \n              .amount-words {\n                font-size: 14px;\n                font-style: italic;\n                margin-top: 5px;\n                color: #92400e;\n              }\n              \n              .signature-section {\n                display: flex;\n                justify-content: space-between;\n                margin-top: 30px;\n                padding-top: 20px;\n                border-top: 1px solid #e5e7eb;\n              }\n              \n              .signature-box {\n                text-align: center;\n                flex: 1;\n                margin: 0 10px;\n              }\n              \n              .signature-line {\n                border-top: 1px solid #000;\n                margin-top: 40px;\n                padding-top: 5px;\n                font-size: 12px;\n                color: #666;\n              }\n              \n              .receipt-footer {\n                text-align: center;\n                margin-top: 20px;\n                padding-top: 15px;\n                border-top: 2px solid #000;\n                font-size: 12px;\n                color: #666;\n              }\n              \n              .footer-note {\n                margin: 5px 0;\n              }\n              \n              @media print {\n                body { margin: 0; padding: 10px; }\n                .no-print { display: none !important; }\n                .receipt-container { border: 2px solid #000; }\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"receipt-container\">\n              <div class=\"receipt-header\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</div>\n                <div class=\"receipt-title\">‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <div class=\"receipt-body\">\n                <div class=\"receipt-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞:</div>\n                    <div class=\"receipt-value\" style=\"font-weight: 600;\">${advancePayment.receiptNo || '‡§Ö‡§®‡•Å‡§™‡§≤‡§¨‡•ç‡§ß'}</div>\n                  </div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</div>\n                    <div class=\"receipt-value\">${formatDate(advancePayment.date)}</div>\n                  </div>\n                </div>\n                \n                <div class=\"receipt-section\">\n                  <div class=\"section-title\">‡§¶‡§æ‡§§‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§®‡§æ‡§Æ:</div>\n                    <div class=\"receipt-value\" style=\"font-weight: 700;\">${convertNameToHindi(advancePayment.userName)}</div>\n                  </div>\n                  ${advancePayment.userMobile ? `\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</div>\n                    <div class=\"receipt-value\">${advancePayment.userMobile}</div>\n                  </div>\n                  ` : ''}\n                  ${advancePayment.userAddress ? `\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§™‡§§‡§æ:</div>\n                    <div class=\"receipt-value\">${convertAddressToHindi(advancePayment.userAddress)}</div>\n                  </div>\n                  ` : ''}\n                </div>\n                \n                <div class=\"amount-section\">\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ:</div>\n                    <div class=\"receipt-value\">${paymentModeHindi}</div>\n                  </div>\n                  <div class=\"receipt-row\" style=\"margin-top: 10px;\">\n                    <div class=\"receipt-label\">‡§∞‡§æ‡§∂‡§ø:</div>\n                    <div class=\"receipt-value amount-large\">‚Çπ${advancePayment.amount.toLocaleString('hi-IN')}</div>\n                  </div>\n                  <div class=\"amount-words\">\n                    <strong>‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç:</strong> ${amountInWords} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n                  </div>\n                </div>\n                \n                <div class=\"receipt-section\">\n                  <div class=\"section-title\">‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ:</div>\n                    <div class=\"receipt-value\">${savedValues.referredBy || '‡§Ö‡§®‡•Å‡§™‡§≤‡§¨‡•ç‡§ß'}</div>\n                  </div>\n                  <div class=\"receipt-row\">\n                    <div class=\"receipt-label\">‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ:</div>\n                    <div class=\"receipt-value\">${convertNameToHindi(savedValues.recordedBy || advancePayment.createdBy)}</div>\n                  </div>\n                </div>\n                \n                <div class=\"signature-section\">\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§¶‡§æ‡§§‡§æ ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                  <div class=\"signature-box\">\n                    <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                  </div>\n                </div>\n              </div>\n              \n              <div class=\"receipt-footer\">\n                <div class=\"footer-note\"><strong>‡§®‡•ã‡§ü:</strong> ‡§Ø‡§π ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Ü‡§™‡§ï‡•Ä ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§ï‡•Ä ‡§¨‡•ã‡§≤‡•Ä ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§µ‡§ø‡§∞‡•Å‡§¶‡•ç‡§ß ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</div>\n                <div class=\"footer-note\">‡§Ø‡§π ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§ú‡§®‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§∏‡•Ä‡§¶ ‡§π‡•à ‡§î‡§∞ ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§≠‡•å‡§§‡§ø‡§ï ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</div>\n                <div class=\"footer-note\"><strong>‡§Æ‡•Å‡§¶‡•ç‡§∞‡§£ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> ${currentDate}</div>\n              </div>\n            </div>\n          </body>\n        </html>\n      `;\n      \n      printWindow.document.open();\n      printWindow.document.write(html);\n      printWindow.document.close();\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </DialogTitle>\n        </DialogHeader>\n        \n        {/* Saved Values Section */}\n        <div className=\"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg mb-4\">\n          <div>\n            <Label htmlFor=\"referredBy\">‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠‡§ø‡§§ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ</Label>\n            <Input\n              id=\"referredBy\"\n              value={savedValues.referredBy}\n              onChange={(e) => setSavedValues(prev => ({ ...prev, referredBy: e.target.value }))}\n              placeholder=\"‡§∞‡•á‡§´‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç\"\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"recordedBy\">‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ</Label>\n            <Input\n              id=\"recordedBy\"\n              value={savedValues.recordedBy}\n              onChange={(e) => setSavedValues(prev => ({ ...prev, recordedBy: e.target.value }))}\n              placeholder=\"‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç\"\n            />\n          </div>\n        </div>\n        \n        {/* Receipt Preview */}\n        <div className=\"border rounded-lg p-6 bg-white mb-4\">\n          <div className=\"text-center mb-6\">\n            <h1 className=\"text-2xl font-bold text-orange-600 mb-2\">‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</h1>\n            <p className=\"text-gray-600\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</p>\n            <h2 className=\"text-xl font-semibold mt-4\">‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</h2>\n          </div>\n          \n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§∞‡§∏‡•Ä‡§¶ ‡§®‡§Ç‡§¨‡§∞:</span>\n              <span>{advancePayment.receiptNo || 'N/A'}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</span>\n              <span>{formatDate(advancePayment.date)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"font-semibold\">‡§®‡§æ‡§Æ:</span>\n              <span className=\"font-bold\">{convertNameToHindi(advancePayment.userName)}</span>\n            </div>\n            {advancePayment.userMobile && (\n              <div className=\"flex justify-between\">\n                <span className=\"font-semibold\">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:</span>\n                <span>{advancePayment.userMobile}</span>\n              </div>\n            )}\n            {advancePayment.userAddress && (\n              <div className=\"flex justify-between\">\n                <span className=\"font-semibold\">‡§™‡§§‡§æ:</span>\n                <span>{convertAddressToHindi(advancePayment.userAddress)}</span>\n              </div>\n            )}\n            <div className=\"bg-yellow-50 p-4 rounded-lg border border-yellow-200\">\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"font-semibold\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ:</span>\n                <span>{getPaymentModeHindi(advancePayment.paymentMode)}</span>\n              </div>\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"font-semibold\">‡§∞‡§æ‡§∂‡§ø:</span>\n                <span className=\"text-xl font-bold text-orange-600\">‚Çπ{advancePayment.amount.toLocaleString('hi-IN')}</span>\n              </div>\n              <div className=\"text-sm italic text-orange-800\">\n                <strong>‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§Æ‡•á‡§Ç:</strong> {convertToHindiWords(advancePayment.amount)} ‡§∞‡•Å‡§™‡§Ø‡•á ‡§Æ‡§æ‡§§‡•ç‡§∞\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Action Buttons */}\n        <div className=\"flex gap-2\">\n          <Button onClick={handleSaveValues} variant=\"outline\" className=\"flex-1\">\n            <Save className=\"h-4 w-4 mr-2\" />\n            ‡§Æ‡§æ‡§® ‡§∏‡§π‡•á‡§ú‡•á‡§Ç\n          </Button>\n          <Button onClick={handlePrint} className=\"flex-1\">\n            <Printer className=\"h-4 w-4 mr-2\" />\n            ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":23623},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7246},"client/src/pages/entry-form.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type User, UserRole } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\n\nconst formSchema = z.object({\n  userId: z.coerce.number().positive(\"Please select a user\"),\n  userName: z.string(),\n  description: z.string().min(3, \"Description must be at least 3 characters\"),\n  amount: z.coerce.number().positive(\"Amount must be positive\"),\n  quantity: z.coerce.number().positive(\"Quantity must be positive\"),\n  totalAmount: z.coerce.number().positive(\"Total amount must be positive\"),\n  occasion: z.string().min(2, \"Occasion must be at least 2 characters\"),\n  bediNumber: z.string().min(1, \"Please select a ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\"),\n  auctionDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\")\n});\n\ntype FormValues = z.infer<typeof formSchema>;\n\n// Default dropdown options for description\nconst defaultDescriptionOptions = [\n  \"‡§Ö‡§≠‡§ø‡§∑‡•á‡§ï\",\n  \"‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ\", \n  \"‡§Ö‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§æ‡§§‡§ø‡§π‡§æ‡§∞‡•ç‡§Ø\",\n  \"‡§Ü‡§∞‡§§‡•Ä\",\n  \"‡§Æ‡§π‡§æ‡§Ü‡§∞‡§§‡•Ä\",\n  \"‡§≠‡§ï‡•ç‡§§‡§æ‡§Æ‡§∞ ‡§™‡§æ‡§†\",\n  \"‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§¶‡§æ‡§®\",\n  \"‡§™‡§æ‡§¶ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∑‡§æ‡§≤‡§®\",\n  \"‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§∞‡§æ‡§∂‡§ø\",\n  \"‡§ß‡•ç‡§µ‡§ú‡§æ‡§∞‡•ã‡§π‡§£\",\n  \"‡§ß‡§∞‡•ç‡§Æ‡§∂‡§æ‡§≤‡§æ\",\n  \"‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§ó‡•É‡§π\",\n  \"‡§ó‡•Å‡§™‡•ç‡§§‡§¶‡§æ‡§®\",\n  \"‡§ó‡•Å‡§≤‡•ç‡§≤‡§ï ‡§¶‡§æ‡§®\",\n  \"‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£(‡§Æ‡§Ç‡§¶‡§ø‡§∞)\",\n  \"‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£(‡§ß‡§∞‡•ç‡§Æ‡§∂‡§æ‡§≤‡§æ)\",\n  \"‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ\",\n  \"‡§≤‡§æ‡§°‡•Ç\",\n  \"‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ (‡§µ‡§ø‡§∂‡•á‡§∑)\",\n  \"‡§≠‡§µ‡§® ‡§ï‡•ç‡§∞‡§Ø\",\n  \"‡§∂‡§æ‡§¶‡•Ä\",\n  \"‡§ö‡§æ‡§§‡•Å‡§∞‡•ç‡§Æ‡§æ‡§∏ ‡§ï‡§≤‡§∂\"\n];\n\n// Default dropdown options for occasions\nconst defaultOccasionOptions = [\n  \"‡§™‡§∞‡•ç‡§Ø‡•Ç‡§∑‡§£ ‡§™‡§∞‡•ç‡§µ\",\n  \"‡§Æ‡•Å‡§ï‡•Å‡§ü ‡§∏‡§™‡•ç‡§§‡§Æ‡•Ä\",\n  \"‡§ö‡•å‡§Æ‡§æ‡§∏‡§æ ‡§∏‡•ç‡§•‡§æ‡§™‡§®‡§æ\"\n];\n\n// Default dropdown options for ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\nconst defaultBediOptions = [\n  \"1\",\n  \"2\", \n  \"3\"\n];\n\n// Helper functions for localStorage\nconst getStoredOptions = (key: string, defaultOptions: string[]) => {\n  try {\n    const stored = localStorage.getItem(key);\n    if (stored) {\n      const parsedOptions = JSON.parse(stored);\n      // Merge with default options to ensure we always have the base options\n      const uniqueOptions = Array.from(new Set([...defaultOptions, ...parsedOptions]));\n      return uniqueOptions;\n    }\n  } catch (error) {\n    console.warn(`Error loading ${key} from localStorage:`, error);\n  }\n  return defaultOptions;\n};\n\nconst saveOptionsToStorage = (key: string, options: string[]) => {\n  try {\n    localStorage.setItem(key, JSON.stringify(options));\n  } catch (error) {\n    console.warn(`Error saving ${key} to localStorage:`, error);\n  }\n};\n\nexport default function EntryForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const todayDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n  \n  // State for dropdown options - initialized from localStorage\n  const [descriptionOptions, setDescriptionOptions] = useState(() => \n    getStoredOptions('entry-form-descriptions', defaultDescriptionOptions)\n  );\n  const [occasionOptions, setOccasionOptions] = useState(() => \n    getStoredOptions('entry-form-occasions', defaultOccasionOptions)\n  );\n  const [bediOptions, setBediOptions] = useState(() => \n    getStoredOptions('entry-form-bedi-numbers', defaultBediOptions)\n  );\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\n  const [isOccasionModalOpen, setIsOccasionModalOpen] = useState(false);\n  const [isBediModalOpen, setIsBediModalOpen] = useState(false);\n  const [newOption, setNewOption] = useState(\"\");\n  const [newOccasion, setNewOccasion] = useState(\"\");\n  const [newBedi, setNewBedi] = useState(\"\");\n  \n  // Redirect viewers away from this page, but allow operators and admins\n  if (user && user.role === UserRole.VIEWER) {\n    setLocation('/dashboard');\n    return null;\n  }\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: isLoadingUsers } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n  \n  // Initialize form with default values\n  const form = useForm<FormValues>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      description: \"\",\n      amount: 0,\n      quantity: 1,\n      totalAmount: 0,\n      occasion: \"\",\n      bediNumber: \"1\",\n      auctionDate: todayDate\n    }\n  });\n  \n  // Watch values for automatic calculations\n  const watchUserId = form.watch(\"userId\");\n  const watchAmount = form.watch(\"amount\");\n  const watchQuantity = form.watch(\"quantity\");\n  \n  // Update userName when userId changes\n  const selectedUser = users?.find(user => user.id === watchUserId);\n  if (selectedUser && form.getValues(\"userName\") !== selectedUser.name) {\n    form.setValue(\"userName\", selectedUser.name);\n  }\n  \n  // Update totalAmount when amount or quantity changes\n  useEffect(() => {\n    const calculatedTotal = watchAmount * watchQuantity;\n    form.setValue(\"totalAmount\", calculatedTotal);\n  }, [watchAmount, watchQuantity, form]);\n  \n  const entryMutation = useMutation({\n    mutationFn: async (data: FormValues) => {\n      // Create new entry (edit mode completely disabled)\n      const response = await apiRequest(\"POST\", \"/api/entries\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Entry created successfully\",\n      });\n      // Invalidate all related queries to ensure UI updates properly\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n      setLocation('/entries');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create entry: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Function to add new option\n  const handleAddOption = () => {\n    if (newOption.trim() && !descriptionOptions.includes(newOption.trim())) {\n      const updatedOptions = [...descriptionOptions, newOption.trim()];\n      setDescriptionOptions(updatedOptions);\n      saveOptionsToStorage('entry-form-descriptions', updatedOptions);\n      form.setValue(\"description\", newOption.trim());\n      setNewOption(\"\");\n      setIsAddModalOpen(false);\n      toast({\n        title: \"Success\", \n        description: \"New option added successfully\"\n      });\n    }\n  };\n\n  // Function to add new occasion\n  const handleAddOccasion = () => {\n    if (newOccasion.trim() && !occasionOptions.includes(newOccasion.trim())) {\n      const updatedOptions = [...occasionOptions, newOccasion.trim()];\n      setOccasionOptions(updatedOptions);\n      saveOptionsToStorage('entry-form-occasions', updatedOptions);\n      form.setValue(\"occasion\", newOccasion.trim());\n      setNewOccasion(\"\");\n      setIsOccasionModalOpen(false);\n      toast({\n        title: \"Success\", \n        description: \"New occasion added successfully\"\n      });\n    }\n  };\n\n  // Function to add new bedi number\n  const handleAddBedi = () => {\n    if (newBedi.trim() && !bediOptions.includes(newBedi.trim())) {\n      const updatedOptions = [...bediOptions, newBedi.trim()];\n      setBediOptions(updatedOptions);\n      saveOptionsToStorage('entry-form-bedi-numbers', updatedOptions);\n      form.setValue(\"bediNumber\", newBedi.trim());\n      setNewBedi(\"\");\n      setIsBediModalOpen(false);\n      toast({\n        title: \"Success\", \n        description: \"New ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï added successfully\"\n      });\n    }\n  };\n\n  const onSubmit = (data: FormValues) => {\n    entryMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"flex-grow p-4\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-xl font-medium\">New Entry</h1>\n        <div className=\"flex items-center gap-2\">\n          <Button \n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setLocation('/previous-outstanding/new')}\n            className=\"bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 font-medium\"\n          >\n            üìù Past Records\n          </Button>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => setLocation('/entries')}\n          >\n            <span className=\"material-icons text-neutral-500\">close</span>\n          </Button>\n        </div>\n      </div>\n      \n      <div className=\"bg-white rounded-lg shadow-md p-4\">\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            {/* User Name */}\n            <FormField\n              control={form.control}\n              name=\"userId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Name of User</FormLabel>\n                  <FormControl>\n                    <UserSelect\n                      value={field.value}\n                      onValueChange={field.onChange}\n                      placeholder=\"Search and select user\"\n                      className=\"w-full\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Hidden fields */}\n            <input type=\"hidden\" {...form.register(\"userName\")} />\n            <input type=\"hidden\" {...form.register(\"totalAmount\")} />\n            \n            {/* Line Item Description */}\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Line Item Description</FormLabel>\n                  <FormControl>\n                    <Select \n                      value={field.value} \n                      onValueChange={(value) => {\n                        if (value === \"__add_more__\") {\n                          setIsAddModalOpen(true);\n                        } else {\n                          field.onChange(value);\n                        }\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select description\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {descriptionOptions.map((option) => (\n                          <SelectItem key={option} value={option}>\n                            {option}\n                          </SelectItem>\n                        ))}\n                        <SelectItem value=\"__add_more__\" className=\"text-blue-600 font-medium\">\n                          + Add More\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Add More Dialog */}\n            <Dialog open={isAddModalOpen} onOpenChange={setIsAddModalOpen}>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New Description Option</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <Input\n                    placeholder=\"Enter new description\"\n                    value={newOption}\n                    onChange={(e) => setNewOption(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault();\n                        handleAddOption();\n                      }\n                    }}\n                  />\n                  <div className=\"flex justify-end gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => {\n                        setIsAddModalOpen(false);\n                        setNewOption(\"\");\n                      }}\n                    >\n                      Cancel\n                    </Button>\n                    <Button onClick={handleAddOption}>\n                      Add Option\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            \n            {/* Amount and Quantity */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium text-neutral-700\">Amount (‚Çπ)</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        placeholder=\"0\" \n                        min=\"0\" \n                        step=\"1\" \n                        {...field}\n                        onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"quantity\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium text-neutral-700\">Quantity</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        placeholder=\"1\" \n                        min=\"1\" \n                        step=\"1\" \n                        {...field}\n                        onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            \n            {/* Occasion - Updated to dropdown */}\n            <FormField\n              control={form.control}\n              name=\"occasion\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞</FormLabel>\n                  <FormControl>\n                    <Select \n                      value={field.value} \n                      onValueChange={(value) => {\n                        if (value === \"__add_more__\") {\n                          setIsOccasionModalOpen(true);\n                        } else {\n                          field.onChange(value);\n                        }\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {occasionOptions.map((option) => (\n                          <SelectItem key={option} value={option}>\n                            {option}\n                          </SelectItem>\n                        ))}\n                        <SelectItem value=\"__add_more__\" className=\"text-blue-600 font-medium\">\n                          + Add More\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï */}\n            <FormField\n              control={form.control}\n              name=\"bediNumber\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</FormLabel>\n                  <FormControl>\n                    <Select \n                      value={field.value} \n                      onValueChange={(value) => {\n                        if (value === \"__add_more__\") {\n                          setIsBediModalOpen(true);\n                        } else {\n                          field.onChange(value);\n                        }\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {bediOptions.map((option) => (\n                          <SelectItem key={option} value={option}>\n                            {option}\n                          </SelectItem>\n                        ))}\n                        <SelectItem value=\"__add_more__\" className=\"text-blue-600 font-medium\">\n                          + Add More\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Add Occasion Dialog */}\n            <Dialog open={isOccasionModalOpen} onOpenChange={setIsOccasionModalOpen}>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <Input\n                    placeholder=\"Enter new ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞\"\n                    value={newOccasion}\n                    onChange={(e) => setNewOccasion(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault();\n                        handleAddOccasion();\n                      }\n                    }}\n                  />\n                  <div className=\"flex justify-end gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => {\n                        setIsOccasionModalOpen(false);\n                        setNewOccasion(\"\");\n                      }}\n                    >\n                      Cancel\n                    </Button>\n                    <Button onClick={handleAddOccasion}>\n                      Add Option\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {/* Add ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï Dialog */}\n            <Dialog open={isBediModalOpen} onOpenChange={setIsBediModalOpen}>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <Input\n                    placeholder=\"Enter new ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\"\n                    value={newBedi}\n                    onChange={(e) => setNewBedi(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault();\n                        handleAddBedi();\n                      }\n                    }}\n                  />\n                  <div className=\"flex justify-end gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => {\n                        setIsBediModalOpen(false);\n                        setNewBedi(\"\");\n                      }}\n                    >\n                      Cancel\n                    </Button>\n                    <Button onClick={handleAddBedi}>\n                      Add Option\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            \n            {/* Date of Auction */}\n            <FormField\n              control={form.control}\n              name=\"auctionDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Date of Boli</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"date\" \n                      max={new Date().toISOString().split('T')[0]}\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Submit Button */}\n            <Button \n              type=\"submit\" \n              className=\"w-full bg-primary text-white py-3 rounded-md font-medium\"\n              disabled={entryMutation.isPending}\n            >\n              {entryMutation.isPending ? \"Creating...\" : \"Create Entry\"}\n            </Button>\n          </form>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","size_bytes":21995},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1184},"client/public/sw.js":{"content":"// Service Worker for Daan Darpan PWA\nconst CACHE_NAME = 'daan-darpan-v1';\nconst urlsToCache = [\n  '/',\n  '/static/js/bundle.js',\n  '/static/css/main.css',\n  '/manifest.json',\n  '/icon-192.png',\n  '/icon-512.png'\n];\n\n// Install event - cache resources\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then((cache) => {\n        console.log('Opened cache');\n        return cache.addAll(urlsToCache);\n      })\n  );\n});\n\n// Fetch event - serve from cache when offline\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    caches.match(event.request)\n      .then((response) => {\n        // Return cached version or fetch from network\n        if (response) {\n          return response;\n        }\n        return fetch(event.request);\n      }\n    )\n  );\n});\n\n// Activate event - clean up old caches\nself.addEventListener('activate', (event) => {\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames.map((cacheName) => {\n          if (cacheName !== CACHE_NAME) {\n            return caches.delete(cacheName);\n          }\n        })\n      );\n    })\n  );\n});","size_bytes":1164},"client/src/components/daily-payments-calendar.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ntype DailyPaymentsData = {\n  [date: string]: number;\n};\n\nconst MONTHS = [\n  \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n  \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n];\n\nconst DAYS_IN_MONTH = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n\nconst isLeapYear = (year: number) => {\n  return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n};\n\nconst getDaysInMonth = (month: number, year: number) => {\n  if (month === 1 && isLeapYear(year)) return 29; // February in leap year\n  return DAYS_IN_MONTH[month];\n};\n\nconst formatAmount = (amount: number) => {\n  // Amount is already in rupees, no need to divide by 100\n  if (amount >= 100000) {\n    return `${(amount / 100000).toFixed(1)}L`;\n  } else if (amount >= 1000) {\n    return `${(amount / 1000).toFixed(1)}K`;\n  } else {\n    return amount.toString();\n  }\n};\n\nexport default function DailyPaymentsCalendar() {\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  \n  // Generate year options (current year and 5 years back/forward)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = [];\n  for (let year = currentYear - 5; year <= currentYear + 5; year++) {\n    yearOptions.push(year);\n  }\n  \n  // Fetch daily payments data\n  const { data: dailyPayments, isLoading } = useQuery<DailyPaymentsData>({\n    queryKey: ['/api/daily-payments', selectedYear],\n    queryFn: () => fetch(`/api/daily-payments?year=${selectedYear}`).then(res => res.json()),\n  });\n  \n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Daily Payments Calendar</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex justify-center p-8\">Loading payments data...</div>\n        </CardContent>\n      </Card>\n    );\n  }\n  \n  // Calculate monthly totals\n  const monthlyTotals = Array(12).fill(0);\n  if (dailyPayments) {\n    Object.entries(dailyPayments).forEach(([dateStr, amount]) => {\n      const date = new Date(dateStr);\n      const month = date.getMonth();\n      monthlyTotals[month] += amount;\n    });\n  }\n  \n  // Generate calendar grid\n  const generateCalendar = () => {\n    const calendar = [];\n    \n    for (let month = 0; month < 12; month++) {\n      const row = [];\n      const daysInMonth = getDaysInMonth(month, selectedYear);\n      \n      // Month name\n      row.push(\n        <div key={`month-${month}`} className=\"font-medium text-sm bg-blue-600 text-white p-2 text-center\">\n          {MONTHS[month]}\n        </div>\n      );\n      \n      // Days in month\n      for (let day = 1; day <= 31; day++) {\n        if (day <= daysInMonth) {\n          const dateKey = `${selectedYear}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n          const amount = dailyPayments?.[dateKey] || 0;\n          \n          row.push(\n            <div \n              key={`${month}-${day}`} \n              className={`p-1 text-xs text-center border border-neutral-200 min-h-[24px] flex items-center justify-center ${\n                amount > 0 \n                  ? 'bg-blue-100 text-blue-800 font-medium' \n                  : 'bg-neutral-50 text-neutral-400'\n              }`}\n              title={amount > 0 ? `‚Çπ${amount.toLocaleString()}` : 'No payments'}\n            >\n              {amount > 0 ? formatAmount(amount) : ''}\n            </div>\n          );\n        } else {\n          // Empty cell for days that don't exist in this month\n          row.push(\n            <div key={`${month}-${day}-empty`} className=\"p-1 text-xs bg-neutral-100 border border-neutral-200 min-h-[24px]\">\n            </div>\n          );\n        }\n      }\n      \n      // Monthly total\n      row.push(\n        <div key={`total-${month}`} className=\"font-medium text-sm bg-orange-100 text-orange-800 p-1 text-center min-h-[24px] flex items-center justify-center\">\n          ‚Çπ{monthlyTotals[month].toLocaleString()}\n        </div>\n      );\n      \n      calendar.push(\n        <div key={month} className=\"grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          {row}\n        </div>\n      );\n    }\n    \n    return calendar;\n  };\n  \n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle>Daily Payments Calendar</CardTitle>\n          <Select value={selectedYear.toString()} onValueChange={(value) => setSelectedYear(parseInt(value))}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {yearOptions.map(year => (\n                <SelectItem key={year} value={year.toString()}>\n                  {year}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Header row with day numbers */}\n        <div className=\"mb-2 grid gap-0\" style={{ gridTemplateColumns: 'repeat(33, minmax(0, 1fr))' }}>\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Month</div>\n          {Array.from({ length: 31 }, (_, i) => (\n            <div key={i + 1} className=\"font-medium text-xs p-1 text-center bg-neutral-100 border border-neutral-200\">\n              {i + 1}\n            </div>\n          ))}\n          <div className=\"font-medium text-sm p-2 text-center bg-neutral-100\">Total</div>\n        </div>\n        \n        {/* Calendar grid */}\n        <div className=\"space-y-0\">\n          {generateCalendar()}\n        </div>\n        \n        {/* Legend */}\n        <div className=\"mt-4 flex items-center gap-4 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-blue-100 border border-blue-200\"></div>\n            <span>Payments received</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 bg-neutral-50 border border-neutral-200\"></div>\n            <span>No payments</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6261},"local-deployment/client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":845},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"deploy/start.sh":{"content":"#!/bin/bash\n\necho \"üöÄ Starting Daan Darpan Temple Management System...\"\n\n# Color codes for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\nprint_status() {\n    echo -e \"${BLUE}[INFO]${NC} $1\"\n}\n\nprint_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $1\"\n}\n\nprint_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $1\"\n}\n\nprint_error() {\n    echo -e \"${RED}[ERROR]${NC} $1\"\n}\n\n# Load environment variables\nif [ -f .env ]; then\n    export $(cat .env | grep -v '#' | xargs)\n    print_success \"Environment loaded from .env\"\nelse\n    print_warning \".env file not found. Using default settings.\"\nfi\n\n# Check if node_modules exists\nif [ ! -d \"node_modules\" ]; then\n    print_warning \"Dependencies not installed. Installing...\"\n    npm install\nfi\n\n# Check if database is accessible\nprint_status \"Checking database connection...\"\n\n# Build the application\nprint_status \"Building application...\"\nnpm run build\n\nif [ $? -ne 0 ]; then\n    print_error \"Build failed. Please check the build logs.\"\n    exit 1\nfi\n\nprint_success \"Application built successfully\"\n\n# Start the application\nprint_status \"Starting server on host ${HOST:-0.0.0.0} port ${PORT:-8484}...\"\nprint_status \"\"\nprint_success \"üåü Daan Darpan Temple Management System üåü\"\nprint_status \"Application URL: http://${HOST:-localhost}:${PORT:-8484}\"\nprint_status \"\"\nprint_status \"Press Ctrl+C to stop the server\"\nprint_status \"\"\n\n# Start in production mode\nNODE_ENV=production npm start","size_bytes":1492},"local-deployment/client/src/temp-calendar-fix.css":{"content":"/* Fix for consecutive months in date picker */\n.react-datepicker__month-container:nth-child(1) .react-datepicker__current-month::after {\n  content: attr(data-month);\n}\n\n.react-datepicker__month-container:nth-child(2) .react-datepicker__current-month::after {\n  content: attr(data-next-month);\n}\n\n/* Ensure proper display of two consecutive months */\n.react-datepicker__month-container:nth-child(2) {\n  margin-left: 0;\n}\n\n/* Force display of consecutive months */\n.react-datepicker {\n  display: flex !important;\n  flex-wrap: nowrap !important;\n}","size_bytes":545},"server/notification.ts":{"content":"import { User, Entry, PaymentRecord, PaymentStatus } from \"@shared/schema\";\n\n// Notification service to send notifications to users\nexport class NotificationService {\n  /**\n   * Send mobile notification when a new entry is created for a user\n   * @param user The user to notify\n   * @param entry The entry that was created\n   */\n  static async notifyEntryCreated(user: User, entry: Entry): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] New entry created for ${user.name} (${user.mobile})`);\n      console.log(`Entry: ${entry.description} - ‚Çπ${entry.totalAmount}`);\n      \n      // In a real application, you would integrate with a mobile notification service\n      // such as Twilio, Firebase Cloud Messaging, or a custom mobile app API\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `New entry added: ${entry.description} for ‚Çπ${entry.totalAmount}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n\n  /**\n   * Send mobile notification when a payment is recorded for an entry\n   * @param user The user to notify\n   * @param entry The entry for which payment was recorded\n   * @param payment The payment that was recorded\n   */\n  static async notifyPaymentRecorded(user: User, entry: Entry, payment: PaymentRecord): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] Payment recorded for ${user.name} (${user.mobile})`);\n      console.log(`Payment: ‚Çπ${payment.amount} for ${entry.description} via ${payment.mode}`);\n      \n      // In a real application, you would integrate with a mobile notification service\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `Payment of ‚Çπ${payment.amount} recorded for ${entry.description} via ${payment.mode}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n  \n  /**\n   * Send mobile notification when payment status changes\n   * @param user The user to notify\n   * @param entry The entry for which status was updated\n   * @param oldStatus Previous payment status\n   * @param newStatus New payment status\n   */\n  static async notifyPaymentStatusChanged(\n    user: User, \n    entry: Entry, \n    oldStatus: string, \n    newStatus: string\n  ): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] Payment status changed for ${user.name} (${user.mobile})`);\n      console.log(`Status change: ${oldStatus} ‚Üí ${newStatus} for ${entry.description}`);\n      \n      // Generate a friendly status message\n      let statusMessage = \"\";\n      \n      if (newStatus === PaymentStatus.PARTIAL) {\n        statusMessage = \"Partial payment received\";\n      } else if (newStatus === PaymentStatus.FULL) {\n        statusMessage = \"Payment completed in full\";\n      }\n      \n      // In a real application, you would integrate with a mobile notification service\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `${statusMessage} for ${entry.description}. Updated amount received: ‚Çπ${entry.receivedAmount}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n}","size_bytes":3664},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport NotFound from \"@/pages/not-found\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Users from \"@/pages/users\";\nimport UserDetail from \"@/pages/user-detail\";\nimport Entries from \"@/pages/entries\";\nimport EntryForm from \"@/pages/entry-form\";\nimport EntryEdit from \"@/pages/entry-edit\";\nimport DravyaEntries from \"@/pages/dravya-entries\";\nimport DravyaEntryForm from \"@/pages/dravya-entry-form\";\nimport ExpenseEntries from \"@/pages/expense-entries\";\nimport ExpenseEntryForm from \"@/pages/expense-entry-form\";\nimport PreviousOutstandingForm from \"@/pages/previous-outstanding-form\";\nimport PreviousOutstanding from \"@/pages/previous-outstanding\";\nimport PreviousOutstandingDetails from \"@/pages/previous-outstanding-details\";\nimport PreviousOutstandingPayments from \"@/pages/previous-outstanding-payments\";\nimport EditPreviousOutstanding from \"@/pages/edit-previous-outstanding\";\nimport AdvancePayments from \"@/pages/advance-payments\";\nimport AdvancePaymentForm from \"@/pages/advance-payment-form\";\nimport PaymentDetails from \"@/pages/payment-details\";\nimport Payments from \"@/pages/payments\";\nimport TransactionLogs from \"@/pages/logs\";\nimport Settings from \"@/pages/settings\";\nimport { SidebarNavigation } from \"@/components/sidebar-navigation\";\nimport CopyrightFooter from \"@/components/copyright-footer\";\nimport { AuthProvider } from \"@/lib/context/auth-context\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport LoginForm from \"@/components/auth/login-form\";\nimport { PWAInstallPrompt } from \"@/components/pwa-install-prompt\";\n\nfunction ProtectedRoutes() {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return <div className=\"flex justify-center items-center h-screen\">Loading...</div>;\n  }\n\n  if (!user) {\n    return <LoginForm />;\n  }\n\n  // Component for root route that redirects based on user role\n  function RootRedirect() {\n    const [, setLocation] = useLocation();\n    \n    // Redirect viewers to their account page\n    if (user?.role === 'viewer') {\n      setLocation('/my-account');\n      return null;\n    }\n    return <Dashboard />;\n  }\n\n  // Component for dashboard route that blocks viewers\n  function DashboardRoute() {\n    if (user?.role === 'viewer') {\n      return <div className=\"p-4 text-center\">Access denied. This page is not available for your role.</div>;\n    }\n    return <Dashboard />;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col relative\">\n      <SidebarNavigation />\n      <div className=\"flex-grow pl-4 pt-16 pb-16\">\n        <PWAInstallPrompt />\n        <Switch>\n          <Route path=\"/\" component={RootRedirect} />\n          <Route path=\"/dashboard\" component={DashboardRoute} />\n          <Route path=\"/users\" component={Users} />\n          <Route path=\"/users/:id\" component={UserDetail} />\n          <Route path=\"/my-account\" component={UserDetail} />\n          <Route path=\"/entries\" component={Entries} />\n          <Route path=\"/entry/new\" component={EntryForm} />\n          <Route path=\"/entries/:id/edit\" component={EntryEdit} />\n          <Route path=\"/previous-outstanding\" component={PreviousOutstanding} />\n          <Route path=\"/previous-outstanding/new\" component={PreviousOutstandingForm} />\n          <Route path=\"/previous-outstanding/:id/edit\" component={EditPreviousOutstanding} />\n          <Route path=\"/previous-outstanding/:id/details\" component={PreviousOutstandingDetails} />\n          <Route path=\"/previous-outstanding-payments\" component={PreviousOutstandingPayments} />\n          <Route path=\"/dravya-entries\" component={DravyaEntries} />\n          <Route path=\"/dravya-entry-form\" component={DravyaEntryForm} />\n          <Route path=\"/expense-entries\" component={ExpenseEntries} />\n          <Route path=\"/expense-entry-form\" component={ExpenseEntryForm} />\n          <Route path=\"/expense-entry-form/:id\" component={ExpenseEntryForm} />\n          <Route path=\"/advance-payments\" component={AdvancePayments} />\n          <Route path=\"/advance-payment-form\" component={AdvancePaymentForm} />\n          {/* Edit entry functionality has been disabled */}\n          <Route path=\"/entries/:id\" component={PaymentDetails} />\n          <Route path=\"/payment-details/:id\" component={PaymentDetails} />\n          <Route path=\"/payments\" component={Payments} />\n          <Route path=\"/logs\" component={TransactionLogs} />\n          <Route path=\"/settings\" component={Settings} />\n          <Route component={NotFound} />\n        </Switch>\n      </div>\n      <CopyrightFooter />\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <ProtectedRoutes />\n        <Toaster />\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4935},"local-deployment/client/src/components/ui/avatar.tsx":{"content":"import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1405},"local-deployment/server/notification.ts":{"content":"import { User, Entry, PaymentRecord, PaymentStatus } from \"@shared/schema\";\n\n// Notification service to send notifications to users\nexport class NotificationService {\n  /**\n   * Send mobile notification when a new entry is created for a user\n   * @param user The user to notify\n   * @param entry The entry that was created\n   */\n  static async notifyEntryCreated(user: User, entry: Entry): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] New entry created for ${user.name} (${user.mobile})`);\n      console.log(`Entry: ${entry.description} - ‚Çπ${entry.totalAmount}`);\n      \n      // In a real application, you would integrate with a mobile notification service\n      // such as Twilio, Firebase Cloud Messaging, or a custom mobile app API\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `New entry added: ${entry.description} for ‚Çπ${entry.totalAmount}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n\n  /**\n   * Send mobile notification when a payment is recorded for an entry\n   * @param user The user to notify\n   * @param entry The entry for which payment was recorded\n   * @param payment The payment that was recorded\n   */\n  static async notifyPaymentRecorded(user: User, entry: Entry, payment: PaymentRecord): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] Payment recorded for ${user.name} (${user.mobile})`);\n      console.log(`Payment: ‚Çπ${payment.amount} for ${entry.description} via ${payment.mode}`);\n      \n      // In a real application, you would integrate with a mobile notification service\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `Payment of ‚Çπ${payment.amount} recorded for ${entry.description} via ${payment.mode}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n  \n  /**\n   * Send mobile notification when payment status changes\n   * @param user The user to notify\n   * @param entry The entry for which status was updated\n   * @param oldStatus Previous payment status\n   * @param newStatus New payment status\n   */\n  static async notifyPaymentStatusChanged(\n    user: User, \n    entry: Entry, \n    oldStatus: string, \n    newStatus: string\n  ): Promise<void> {\n    if (!user.mobile) return;\n    \n    try {\n      console.log(`[MOBILE NOTIFICATION] Payment status changed for ${user.name} (${user.mobile})`);\n      console.log(`Status change: ${oldStatus} ‚Üí ${newStatus} for ${entry.description}`);\n      \n      // Generate a friendly status message\n      let statusMessage = \"\";\n      \n      if (newStatus === PaymentStatus.PARTIAL) {\n        statusMessage = \"Partial payment received\";\n      } else if (newStatus === PaymentStatus.FULL) {\n        statusMessage = \"Payment completed in full\";\n      }\n      \n      // In a real application, you would integrate with a mobile notification service\n      \n      // Example implementation for future integration:\n      /*\n      const message = {\n        to: user.mobile,\n        body: `${statusMessage} for ${entry.description}. Updated amount received: ‚Çπ${entry.receivedAmount}`\n      };\n      await mobileNotificationProvider.send(message);\n      */\n    } catch (error) {\n      console.error(\"Failed to send mobile notification:\", error);\n    }\n  }\n}","size_bytes":3664},"client/src/components/bottom-navigation.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport EntriesListMenu from \"./entries-list-menu\";\nimport EntriesFormMenu from \"./entries-form-menu\";\n\nexport default function BottomNavigation() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  \n  const isActive = (path: string) => {\n    if (path === '/dashboard' && (location === '/' || location === '/dashboard')) {\n      return true;\n    }\n    if (path === '/entries' && (location === '/entries' || location === '/dravya-entries')) {\n      return true;\n    }\n    return location === path || location.startsWith(path);\n  };\n  \n  const getItemClass = (path: string) => {\n    return `bottom-nav-item flex flex-col items-center py-2 px-4 ${\n      isActive(path) ? 'text-primary' : 'text-neutral-500'\n    }`;\n  };\n  \n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-neutral-200 pb-safe\">\n      <div className=\"flex items-center relative\">\n        {/* Admin Navigation */}\n        {user?.role === 'admin' ? (\n          <div className=\"flex-1 grid grid-cols-6 w-full\">\n            {/* First column: Dashboard */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/dashboard\">\n                <a className={getItemClass('/dashboard')}>\n                  <span className=\"material-icons\">dashboard</span>\n                  <span className=\"text-xs\">Dashboard</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: Entries List Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesListMenu />\n            </div>\n            \n            {/* Third column: Payments */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/payments\">\n                <a className={getItemClass('/payments')}>\n                  <span className=\"material-icons\">payments</span>\n                  <span className=\"text-xs\">Payments</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fourth column: Logs */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/logs\">\n                <a className={getItemClass('/logs')}>\n                  <span className=\"material-icons\">account_balance</span>\n                  <span className=\"text-xs\">Logs</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fifth column: Users */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/users\">\n                <a className={getItemClass('/users')}>\n                  <span className=\"material-icons\">people</span>\n                  <span className=\"text-xs\">Users</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Sixth column: Settings */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">Settings</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        ) : user?.role === 'operator' ? (\n          /* Operator Navigation - Has dashboard, entries list, add entry functionality, users, and payments */\n          <div className=\"flex-1 grid grid-cols-6 w-full\">\n            {/* First column: Dashboard */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/dashboard\">\n                <a className={getItemClass('/dashboard')}>\n                  <span className=\"material-icons\">dashboard</span>\n                  <span className=\"text-xs\">Dashboard</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: Entries List Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesListMenu />\n            </div>\n            \n            {/* Third column: Add Entry Form Menu */}\n            <div className=\"flex justify-center\">\n              <EntriesFormMenu />\n            </div>\n            \n            {/* Fourth column: Payments */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/payments\">\n                <a className={getItemClass('/payments')}>\n                  <span className=\"material-icons\">payments</span>\n                  <span className=\"text-xs\">Payments</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Fifth column: Users */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/users\">\n                <a className={getItemClass('/users')}>\n                  <span className=\"material-icons\">people</span>\n                  <span className=\"text-xs\">Users</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Sixth column: Settings */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">Settings</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        ) : (\n          /* Regular viewer - 2 columns with equal spacing */\n          <div className=\"flex-1 grid grid-cols-2 w-full\">\n            {/* First column: My Account */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/my-account\">\n                <a className={getItemClass('/my-account')}>\n                  <span className=\"material-icons\">person</span>\n                  <span className=\"text-xs\">My Account</span>\n                </a>\n              </Link>\n            </div>\n            \n            {/* Second column: My Profile (Settings for viewers) */}\n            <div className=\"flex justify-center\">\n              <Link href=\"/settings\">\n                <a className={getItemClass('/settings')}>\n                  <span className=\"material-icons\">settings</span>\n                  <span className=\"text-xs\">My Profile</span>\n                </a>\n              </Link>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6342},"local-deployment/client/src/pages/entry-form.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Form, FormField, FormItem, FormLabel, FormControl, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { type User, UserRole } from \"@shared/schema\";\nimport { UserSelect } from \"@/components/user-select\";\n\nconst formSchema = z.object({\n  userId: z.coerce.number().positive(\"Please select a user\"),\n  userName: z.string(),\n  description: z.string().min(3, \"Description must be at least 3 characters\"),\n  amount: z.coerce.number().positive(\"Amount must be positive\"),\n  quantity: z.coerce.number().positive(\"Quantity must be positive\"),\n  totalAmount: z.coerce.number().positive(\"Total amount must be positive\"),\n  occasion: z.string().min(2, \"Occasion must be at least 2 characters\"),\n  auctionDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Date must be in YYYY-MM-DD format\")\n});\n\ntype FormValues = z.infer<typeof formSchema>;\n\n// Default dropdown options for description\nconst defaultDescriptionOptions = [\n  \"‡§Ö‡§≠‡§ø‡§∑‡•á‡§ï\",\n  \"‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ\", \n  \"‡§Ö‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§æ‡§§‡§ø‡§π‡§æ‡§∞‡•ç‡§Ø\",\n  \"‡§Ü‡§∞‡§§‡•Ä\",\n  \"‡§Æ‡§π‡§æ‡§Ü‡§∞‡§§‡•Ä\",\n  \"‡§≠‡§ï‡•ç‡§§‡§æ‡§Æ‡§∞ ‡§™‡§æ‡§†\",\n  \"‡§∂‡§æ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§¶‡§æ‡§®\",\n  \"‡§™‡§æ‡§¶ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∑‡§æ‡§≤‡§®\",\n  \"‡§¶‡•ç‡§∞‡§µ‡•ç‡§Ø ‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§∞‡§æ‡§∂‡§ø\",\n  \"‡§ß‡•ç‡§µ‡§ú‡§æ‡§∞‡•ã‡§π‡§£\",\n  \"‡§ß‡§∞‡•ç‡§Æ‡§∂‡§æ‡§≤‡§æ\",\n  \"‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§ó‡•É‡§π\",\n  \"‡§ó‡•Å‡§™‡•ç‡§§‡§¶‡§æ‡§®\",\n  \"‡§ó‡•Å‡§≤‡•ç‡§≤‡§ï ‡§¶‡§æ‡§®\",\n  \"‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£(‡§Æ‡§Ç‡§¶‡§ø‡§∞)\",\n  \"‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£(‡§ß‡§∞‡•ç‡§Æ‡§∂‡§æ‡§≤‡§æ)\",\n  \"‡§™‡§æ‡§†‡§∂‡§æ‡§≤‡§æ\",\n  \"‡§≤‡§æ‡§°‡•Ç\",\n  \"‡§∂‡§æ‡§Ç‡§§‡§ø‡§ß‡§æ‡§∞‡§æ (‡§µ‡§ø‡§∂‡•á‡§∑)\",\n  \"‡§≠‡§µ‡§® ‡§ï‡•ç‡§∞‡§Ø\",\n  \"‡§∂‡§æ‡§¶‡•Ä\",\n  \"‡§ö‡§æ‡§§‡•Å‡§∞‡•ç‡§Æ‡§æ‡§∏ ‡§ï‡§≤‡§∂\"\n];\n\nexport default function EntryForm() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const todayDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n  \n  // State for dropdown options\n  const [descriptionOptions, setDescriptionOptions] = useState(defaultDescriptionOptions);\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\n  const [newOption, setNewOption] = useState(\"\");\n  \n  // Redirect viewers away from this page, but allow operators and admins\n  if (user && user.role === UserRole.VIEWER) {\n    setLocation('/dashboard');\n    return null;\n  }\n\n  // Fetch users for dropdown\n  const { data: users, isLoading: isLoadingUsers } = useQuery<User[]>({\n    queryKey: ['/api/users']\n  });\n  \n  // Initialize form with default values\n  const form = useForm<FormValues>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      userId: 0,\n      userName: \"\",\n      description: \"\",\n      amount: 0,\n      quantity: 1,\n      totalAmount: 0,\n      occasion: \"\",\n      auctionDate: todayDate\n    }\n  });\n  \n  // Watch values for automatic calculations\n  const watchUserId = form.watch(\"userId\");\n  const watchAmount = form.watch(\"amount\");\n  const watchQuantity = form.watch(\"quantity\");\n  \n  // Update userName when userId changes\n  const selectedUser = users?.find(user => user.id === watchUserId);\n  if (selectedUser && form.getValues(\"userName\") !== selectedUser.name) {\n    form.setValue(\"userName\", selectedUser.name);\n  }\n  \n  // Update totalAmount when amount or quantity changes\n  useEffect(() => {\n    const calculatedTotal = watchAmount * watchQuantity;\n    form.setValue(\"totalAmount\", calculatedTotal);\n  }, [watchAmount, watchQuantity, form]);\n  \n  const entryMutation = useMutation({\n    mutationFn: async (data: FormValues) => {\n      // Create new entry (edit mode completely disabled)\n      const response = await apiRequest(\"POST\", \"/api/entries\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Entry created successfully\",\n      });\n      // Invalidate all related queries to ensure UI updates properly\n      queryClient.invalidateQueries({ queryKey: ['/api/entries'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/transaction-logs'] });\n      setLocation('/entries');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to create entry: ${error.message}`,\n        variant: \"destructive\"\n      });\n    }\n  });\n  \n  // Function to add new option\n  const handleAddOption = () => {\n    if (newOption.trim() && !descriptionOptions.includes(newOption.trim())) {\n      setDescriptionOptions([...descriptionOptions, newOption.trim()]);\n      form.setValue(\"description\", newOption.trim());\n      setNewOption(\"\");\n      setIsAddModalOpen(false);\n      toast({\n        title: \"Success\", \n        description: \"New option added successfully\"\n      });\n    }\n  };\n\n  const onSubmit = (data: FormValues) => {\n    entryMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"flex-grow p-4\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-xl font-medium\">New Entry</h1>\n        <div className=\"flex items-center gap-2\">\n          <Button \n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setLocation('/previous-outstanding/new')}\n            className=\"bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 font-medium\"\n          >\n            üìù Past Records\n          </Button>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => setLocation('/entries')}\n          >\n            <span className=\"material-icons text-neutral-500\">close</span>\n          </Button>\n        </div>\n      </div>\n      \n      <div className=\"bg-white rounded-lg shadow-md p-4\">\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            {/* User Name */}\n            <FormField\n              control={form.control}\n              name=\"userId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Name of User</FormLabel>\n                  <FormControl>\n                    <UserSelect\n                      value={field.value}\n                      onValueChange={field.onChange}\n                      placeholder=\"Search and select user\"\n                      className=\"w-full\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Hidden fields */}\n            <input type=\"hidden\" {...form.register(\"userName\")} />\n            <input type=\"hidden\" {...form.register(\"totalAmount\")} />\n            \n            {/* Line Item Description */}\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Line Item Description</FormLabel>\n                  <FormControl>\n                    <Select \n                      value={field.value} \n                      onValueChange={(value) => {\n                        if (value === \"__add_more__\") {\n                          setIsAddModalOpen(true);\n                        } else {\n                          field.onChange(value);\n                        }\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select description\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {descriptionOptions.map((option) => (\n                          <SelectItem key={option} value={option}>\n                            {option}\n                          </SelectItem>\n                        ))}\n                        <SelectItem value=\"__add_more__\" className=\"text-blue-600 font-medium\">\n                          + Add More\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Add More Dialog */}\n            <Dialog open={isAddModalOpen} onOpenChange={setIsAddModalOpen}>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New Description Option</DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4\">\n                  <Input\n                    placeholder=\"Enter new description\"\n                    value={newOption}\n                    onChange={(e) => setNewOption(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault();\n                        handleAddOption();\n                      }\n                    }}\n                  />\n                  <div className=\"flex justify-end gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      onClick={() => {\n                        setIsAddModalOpen(false);\n                        setNewOption(\"\");\n                      }}\n                    >\n                      Cancel\n                    </Button>\n                    <Button onClick={handleAddOption}>\n                      Add Option\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            \n            {/* Amount and Quantity */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"amount\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium text-neutral-700\">Amount (‚Çπ)</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        placeholder=\"0\" \n                        min=\"0\" \n                        step=\"1\" \n                        {...field}\n                        onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"quantity\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium text-neutral-700\">Quantity</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        placeholder=\"1\" \n                        min=\"1\" \n                        step=\"1\" \n                        {...field}\n                        onChange={(e) => field.onChange(e.target.valueAsNumber)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            \n            {/* Occasion */}\n            <FormField\n              control={form.control}\n              name=\"occasion\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Occasion</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Enter occasion\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Date of Auction */}\n            <FormField\n              control={form.control}\n              name=\"auctionDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"text-sm font-medium text-neutral-700\">Date of Boli</FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"date\" \n                      max={new Date().toISOString().split('T')[0]}\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            {/* Submit Button */}\n            <Button \n              type=\"submit\" \n              className=\"w-full bg-primary text-white py-3 rounded-md font-medium\"\n              disabled={entryMutation.isPending}\n            >\n              {entryMutation.isPending ? \"Creating...\" : \"Create Entry\"}\n            </Button>\n          </form>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","size_bytes":13544},"local-deployment/server/analyze-excel.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ninterface ExcelUser {\n  name: string;\n  username: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\ninterface DatabaseUser {\n  id: number;\n  serialNumber: number;\n  username: string;\n  name: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\nasync function analyzeExcelFile() {\n  try {\n    // Read Excel file\n    console.log('Reading Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'attached_assets', 'Shivnagar Worksheet_1754753646977.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} rows in Excel file`);\n\n    // Get all users from database\n    console.log('Fetching users from database...');\n    const dbUsers: DatabaseUser[] = await db.select().from(users);\n    console.log(`Found ${dbUsers.length} users in database`);\n\n    // Normalize and compare data\n    const missingUsers: ExcelUser[] = [];\n    \n    for (const excelRow of excelData) {\n      // Normalize Excel row data\n      const excelUser: ExcelUser = {\n        name: String(excelRow.Name || excelRow.name || '').trim(),\n        username: String(excelRow.Username || excelRow.username || '').trim(),\n        email: String(excelRow.Email || excelRow.email || '').trim().toLowerCase(),\n        mobile: String(excelRow.Mobile || excelRow.mobile || excelRow.phone || '').trim(),\n        address: String(excelRow.Address || excelRow.address || '').trim(),\n        role: String(excelRow.Role || excelRow.role || 'viewer').trim().toLowerCase(),\n        status: String(excelRow.Status || excelRow.status || 'active').trim().toLowerCase()\n      };\n\n      // Skip empty rows\n      if (!excelUser.name && !excelUser.username && !excelUser.email) {\n        continue;\n      }\n\n      // Check if this user's address exists in database\n      const addressExistsInDb = dbUsers.some(dbUser => {\n        // Compare only address field (case-insensitive)\n        const addressMatch = dbUser.address.toLowerCase().trim() === excelUser.address.toLowerCase();\n        return addressMatch;\n      });\n\n      // Check if this user's mobile exists in database\n      const mobileExistsInDb = dbUsers.some(dbUser => {\n        // Compare only mobile field (exact match)\n        const mobileMatch = dbUser.mobile.trim() === excelUser.mobile.trim();\n        return mobileMatch;\n      });\n\n      // Only include users where BOTH address and mobile are new (not found in database)\n      if (!addressExistsInDb && !mobileExistsInDb) {\n        missingUsers.push(excelUser);\n      }\n    }\n\n    console.log(`Found ${missingUsers.length} users with new addresses AND new mobiles`);\n\n    // Create differential Excel file\n    if (missingUsers.length > 0) {\n      const newWorkbook = XLSX.utils.book_new();\n      const newWorksheet = XLSX.utils.json_to_sheet(missingUsers);\n      XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, 'New Address & Mobile Users');\n      \n      const outputPath = path.join(process.cwd(), 'Address_Mobile_Differential_Users.xlsx');\n      XLSX.writeFile(newWorkbook, outputPath);\n      console.log(`Address and mobile differential Excel file created: ${outputPath}`);\n    }\n\n    // Return summary\n    return {\n      totalExcelRows: excelData.length,\n      totalDbUsers: dbUsers.length,\n      missingUsersCount: missingUsers.length,\n      missingUsers: missingUsers,\n      outputFile: missingUsers.length > 0 ? 'Address_Mobile_Differential_Users.xlsx' : null\n    };\n\n  } catch (error) {\n    console.error('Error analyzing Excel file:', error);\n    throw error;\n  }\n}\n\n// Run the analysis\nanalyzeExcelFile()\n  .then(result => {\n    console.log('\\n=== ANALYSIS COMPLETE ===');\n    console.log(`Total rows in Excel: ${result.totalExcelRows}`);\n    console.log(`Total users in database: ${result.totalDbUsers}`);\n    console.log(`Users with new addresses AND mobiles: ${result.missingUsersCount}`);\n    if (result.outputFile) {\n      console.log(`Address and mobile differential file created: ${result.outputFile}`);\n    } else {\n      console.log('No new addresses and mobiles found - all Excel data exists in database');\n    }\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Analysis failed:', error);\n    process.exit(1);\n  });","size_bytes":4603},"local-deployment/client/src/pages/dravya-entries.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { DravyaHindiReceipt } from \"@/components/dravya-hindi-receipt\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nfunction useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    const media = window.matchMedia(query);\n    setMatches(media.matches);\n    \n    const listener = () => setMatches(media.matches);\n    media.addEventListener('change', listener);\n    return () => media.removeEventListener('change', listener);\n  }, [query]);\n\n  return matches;\n}\n\nexport default function DravyaEntries() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [occasionFilter, setOccasionFilter] = useState(\"all-occasions\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n\n  const { data: dravyaEntries, isLoading, error } = useQuery<any[]>({\n    queryKey: ['/api/dravya-entries'],\n  });\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center text-red-500\">\n          <p>Error loading dravya entries: {error.message}</p>\n          <Button onClick={() => window.location.reload()} className=\"mt-4\">\n            Retry\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Get unique occasions from dravya entries\n  const uniqueOccasions = Array.from(new Set((dravyaEntries || []).map(entry => entry.occasion).filter(Boolean)));\n\n  // Apply filters\n  const filteredEntries = useMemo(() => {\n    return (dravyaEntries || []).filter(entry => {\n      const matchesSearch = !searchTerm || \n        entry.user_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        entry.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        entry.user_mobile?.includes(searchTerm);\n      \n      const matchesOccasion = !occasionFilter || occasionFilter === \"all-occasions\" || \n        entry.occasion?.toLowerCase().includes(occasionFilter.toLowerCase());\n      \n      const entryDate = new Date(entry.entry_date);\n      const matchesDateRange = (!startDate || entryDate >= startDate) && \n                              (!endDate || entryDate <= endDate);\n      \n      return matchesSearch && matchesOccasion && matchesDateRange;\n    });\n  }, [dravyaEntries, searchTerm, occasionFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setOccasionFilter(\"all-occasions\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {[...Array(4)].map((_, i) => (\n              <Skeleton key={i} className=\"h-10\" />\n            ))}\n          </div>\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\n        <h1 className=\"text-2xl font-bold\">Dravya Entries</h1>\n        {(user?.role === 'operator' || user?.role === 'admin') && (\n          <Button onClick={() => setLocation('/dravya-entry-form')}>\n            Add Dravya Entry\n          </Button>\n        )}\n      </div>\n\n      {/* Filters */}\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Search</label>\n              <Input\n                placeholder=\"Search by name, description, or mobile\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Occasion</label>\n              <Select value={occasionFilter || undefined} onValueChange={setOccasionFilter}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All occasions\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-occasions\">All occasions</SelectItem>\n                  {uniqueOccasions.map((occasion) => (\n                    <SelectItem key={occasion} value={occasion}>\n                      {occasion}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Actions</label>\n              <Button variant=\"outline\" onClick={clearFilters} className=\"w-full\">\n                Clear Filters\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Start Date</label>\n              <DatePicker\n                selected={startDate}\n                onChange={(date) => setStartDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select start date\"\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">End Date</label>\n              <DatePicker\n                selected={endDate}\n                onChange={(date) => setEndDate(date)}\n                dateFormat=\"yyyy-MM-dd\"\n                className=\"w-full px-3 py-2 border border-input rounded-md\"\n                placeholderText=\"Select end date\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Results Summary */}\n      <div className=\"mb-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Showing {filteredEntries.length} of {(dravyaEntries || []).length} dravya entries\n        </p>\n      </div>\n\n      {/* Entries Table/Cards */}\n      {isMobile ? (\n        <div className=\"space-y-4\">\n          {filteredEntries.map((entry) => (\n            <Card key={entry.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n              <CardContent className=\"pt-4\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg\">{entry.user_name}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{entry.user_mobile}</p>\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2 text-sm\">\n                  <div><strong>Description:</strong> {entry.description || 'N/A'}</div>\n                  {entry.occasion && <div><strong>Occasion:</strong> {entry.occasion}</div>}\n                  <div><strong>Date:</strong> {entry.entry_date ? new Date(entry.entry_date).toLocaleDateString() : 'N/A'}</div>\n                  <div><strong>Created by:</strong> {entry.created_by || 'system'}</div>\n                </div>\n                <div className=\"mt-3 pt-3 border-t\">\n                  <DravyaHindiReceipt \n                    entry={{\n                      id: entry.id,\n                      userId: entry.user_id,\n                      userName: entry.user_name,\n                      description: entry.description,\n                      quantity: entry.quantity || 1,\n                      createdAt: entry.entry_date,\n                      userAddress: entry.user_address,\n                      userMobile: entry.user_mobile\n                    }}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>User Name</TableHead>\n                  <TableHead>Mobile</TableHead>\n                  <TableHead>Description</TableHead>\n                  <TableHead>Occasion</TableHead>\n                  <TableHead>Date</TableHead>\n                  <TableHead>Created By</TableHead>\n                  <TableHead>Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredEntries.map((entry) => (\n                  <TableRow key={entry.id}>\n                    <TableCell className=\"font-medium\">{entry.user_name}</TableCell>\n                    <TableCell>{entry.user_mobile || 'N/A'}</TableCell>\n                    <TableCell>{entry.description || 'N/A'}</TableCell>\n                    <TableCell>{entry.occasion || 'N/A'}</TableCell>\n                    <TableCell>{entry.entry_date ? new Date(entry.entry_date).toLocaleDateString() : 'N/A'}</TableCell>\n                    <TableCell>{entry.created_by || 'system'}</TableCell>\n                    <TableCell>\n                      <DravyaHindiReceipt \n                        entry={{\n                          id: entry.id,\n                          userId: entry.user_id,\n                          userName: entry.user_name,\n                          description: entry.description,\n                          quantity: entry.quantity || 1,\n                          createdAt: entry.entry_date,\n                          userAddress: entry.user_address,\n                          userMobile: entry.user_mobile\n                        }}\n                      />\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      )}\n\n      {filteredEntries.length === 0 && !isLoading && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-lg text-muted-foreground\">No dravya entries found.</p>\n          {(user?.role === 'operator' || user?.role === 'admin') && (\n            <Button onClick={() => setLocation('/dravya-entry-form')} className=\"mt-4\">\n              Add First Dravya Entry\n            </Button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":10946},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"server/routes.ts":{"content":"import express, { type Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport csv from \"csv-parser\";\nimport bcrypt from \"bcrypt\";\nimport { storage, generatePreviousOutstandingReceiptNumber, generateBoliReceiptNumber } from \"./storage\";\nimport { ZodError } from \"zod\";\nimport { eq, desc, max } from \"drizzle-orm\";\nimport { db, query } from \"./db\";\nimport { \n  insertUserSchema, \n  insertEntrySchema,\n  insertDravyaEntrySchema,\n  insertExpenseEntrySchema,\n  insertAdvancePaymentSchema,\n  insertPreviousOutstandingRecordSchema,\n  insertCorpusSettingsSchema,\n  recordPaymentSchema, \n  PaymentStatus,\n  PaymentStatusType,\n  PaymentMode,\n  TransactionType,\n  entries,\n  expenseEntries,\n  advancePayments,\n  previousOutstandingRecords,\n  corpusSettings,\n  transactionLogs,\n  users\n} from \"@shared/schema\";\nimport { fromZodError } from \"zod-validation-error\";\nimport session from \"express-session\";\nimport MemoryStore from \"memorystore\";\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\n\n\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Serve uploaded files statically\n  app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\n  \n  // Set up session store\n  const MemoryStoreSession = MemoryStore(session);\n  \n  app.use(session({\n    secret: process.env.SESSION_SECRET || \"ledger-secret-key\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 },\n    store: new MemoryStoreSession({\n      checkPeriod: 86400000 // Prune expired entries every 24h\n    })\n  }));\n\n  // Set up authentication\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(new LocalStrategy(async (username, password, done) => {\n    try {\n      console.log(`[AUTH DEBUG] Login attempt for username: \"${username}\"`);\n      const user = await storage.getUserByUsername(username);\n      console.log(`[AUTH DEBUG] User found:`, user ? `ID: ${user.id}, Username: \"${user.username}\", Role: ${user.role}` : 'null');\n      \n      if (!user) {\n        console.log(`[AUTH DEBUG] No user found for username: \"${username}\"`);\n        return done(null, false, { message: \"Incorrect username\" });\n      }\n      \n      // Use bcrypt to compare hashed password\n      const isPasswordValid = await bcrypt.compare(password, user.password);\n      if (!isPasswordValid) {\n        console.log(`[AUTH DEBUG] Password mismatch for user: \"${username}\"`);\n        return done(null, false, { message: \"Incorrect password\" });\n      }\n      \n      if (user.status !== \"active\") {\n        console.log(`[AUTH DEBUG] User account inactive: \"${username}\", Status: ${user.status}`);\n        return done(null, false, { message: \"User account is inactive\" });\n      }\n      console.log(`[AUTH DEBUG] Login successful for username: \"${username}\"`);\n      return done(null, user);\n    } catch (err) {\n      console.error(`[AUTH DEBUG] Error during authentication:`, err);\n      return done(err);\n    }\n  }));\n\n  passport.serializeUser((user: any, done) => {\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: number, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (err) {\n      done(err);\n    }\n  });\n\n  // Auth middleware\n  const isAuthenticated = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated()) {\n      return next();\n    }\n    res.status(401).json({ message: \"Unauthorized\" });\n  };\n\n  const isAdmin = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && (req.user as any).role === \"admin\") {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Admin access required\" });\n  };\n\n  const isAdminOrOperator = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && \n        ((req.user as any).role === \"admin\" || (req.user as any).role === \"operator\")) {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n  };\n  \n  const isOperator = (req: Request, res: Response, next: any) => {\n    if (req.isAuthenticated() && req.user && (req.user as any).role === \"operator\") {\n      return next();\n    }\n    res.status(403).json({ message: \"Forbidden: Operator access required\" });\n  };\n\n  // Auth routes\n  app.post(\"/api/auth/login\", (req, res, next) => {\n    passport.authenticate(\"local\", (err: Error, user: any, info: any) => {\n      if (err) return next(err);\n      if (!user) return res.status(401).json({ message: info.message || \"Authentication failed\" });\n      \n      req.logIn(user, (err) => {\n        if (err) return next(err);\n        return res.json({ \n          id: user.id,\n          username: user.username,\n          name: user.name,\n          email: user.email,\n          role: user.role,\n          status: user.status,\n          mobile: user.mobile,\n          address: user.address\n        });\n      });\n    })(req, res, next);\n  });\n\n  app.get(\"/api/auth/user\", (req, res) => {\n    if (!req.user) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    const user = req.user as any;\n    res.json({\n      id: user.id,\n      username: user.username,\n      name: user.name,\n      email: user.email,\n      role: user.role,\n      status: user.status,\n      mobile: user.mobile,\n      address: user.address\n    });\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.logout(() => {\n      res.json({ success: true });\n    });\n  });\n\n  // Set up multer for file uploads\n  const uploadsDir = path.join(process.cwd(), 'uploads');\n  if (!fs.existsSync(uploadsDir)) {\n    fs.mkdirSync(uploadsDir, { recursive: true });\n  }\n\n  const storage_multer = multer.diskStorage({\n    destination: (req, file, cb) => {\n      cb(null, uploadsDir);\n    },\n    filename: (req, file, cb) => {\n      // Create unique filename with timestamp\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));\n    }\n  });\n\n  const upload = multer({ \n    storage: storage_multer,\n    limits: {\n      fileSize: 10 * 1024 * 1024, // 10MB limit\n    },\n    fileFilter: (req, file, cb) => {\n      const allowedTypes = [\n        'image/jpeg',\n        'image/jpg', \n        'image/png',\n        'application/pdf',\n        'text/csv',\n        'application/vnd.ms-excel',\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      ];\n      \n      if (file.fieldname === 'receiptFile' || file.fieldname === 'paymentScreenshot' || file.fieldname === 'attachmentFile' || file.fieldname === 'paymentFile') {\n        const imageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\n        if (imageTypes.includes(file.mimetype)) {\n          cb(null, true);\n        } else {\n          cb(new Error('Only JPG, JPEG, PNG and PDF files are allowed'));\n        }\n      } else if (file.fieldname === 'file') {\n        // For bulk upload files\n        const csvTypes = ['text/csv', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];\n        if (csvTypes.includes(file.mimetype) || file.originalname.endsWith('.csv')) {\n          cb(null, true);\n        } else {\n          cb(new Error('Only CSV and Excel files are allowed for bulk upload'));\n        }\n      } else {\n        cb(new Error('Unexpected field'));\n      }\n    }\n  });\n  \n  // Update current user's profile\n  app.patch(\"/api/auth/profile\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = currentUser.id;\n      \n      // Only allow certain fields to be updated\n      const allowedUpdates = [\"name\", \"email\", \"mobile\", \"address\"];\n      const updates: any = {};\n      \n      Object.keys(req.body).forEach(key => {\n        if (allowedUpdates.includes(key)) {\n          updates[key] = req.body[key];\n        }\n      });\n      \n      const updatedUser = await storage.updateUser(userId, updates);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Invalidate caches to ensure updated data is reflected everywhere\n      (req as any).sessionStore.all((err: any, sessions: any) => {\n        if (sessions) {\n          Object.values(sessions).forEach((session: any) => {\n            const wsClient = (req as any).app.get('wsClients')?.get(session.id);\n            if (wsClient) {\n              wsClient.send(JSON.stringify({\n                type: 'CACHE_INVALIDATION',\n                keys: [\n                  '/api/users',\n                  '/api/entries',\n                  '/api/dashboard',\n                  '/api/auth/user'\n                ]\n              }));\n            }\n          });\n        }\n      });\n      \n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // User management routes\n  app.get(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to access users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      const users = await storage.getUsers();\n      \n      // All users are visible to both admin and operator roles\n      // Edit permissions are controlled separately in the PATCH endpoint\n      res.json(users);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Get specific user details with related data\n  app.get(\"/api/users/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = parseInt(req.params.id);\n\n      // Allow users to view their own profile, or admin/operator to view others\n      const canViewProfile = \n        currentUser.id === userId || // User viewing their own profile\n        currentUser.role === 'admin' || \n        currentUser.role === 'operator';\n\n      if (!canViewProfile) {\n        return res.status(403).json({ message: \"Forbidden: Can only view your own profile\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Operators can view admin user profiles but cannot edit them (edit control is in PATCH endpoint)\n\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user details\" });\n    }\n  });\n\n  // Note: /api/entries route is defined elsewhere in the file, this just adds userId filtering\n\n  // Note: advance-payments and dravya-entries routes may be defined elsewhere\n\n  // Get user's advance balance\n  app.get(\"/api/users/:id/advance-balance\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      const balance = await storage.calculateRemainingAdvancePayment(userId);\n      res.json(balance);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch advance balance\" });\n    }\n  });\n\n  // Bulk user upload endpoint\n  app.post(\"/api/users/bulk-upload\", isAdminOrOperator, upload.single('file'), async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const filePath = req.file.path;\n      let errors = 0;\n      let created = 0;\n\n      // Read CSV file\n      const readCSV = () => {\n        return new Promise<any[]>((resolve, reject) => {\n          const results: any[] = [];\n          fs.createReadStream(filePath)\n            .pipe(csv())\n            .on('data', (data) => results.push(data))\n            .on('end', () => resolve(results))\n            .on('error', reject);\n        });\n      };\n\n      try {\n        const csvData = await readCSV();\n        \n        for (const row of csvData) {\n          try {\n            // Validate required fields\n            if (!row.username || !row.password || !row.name || !row.email) {\n              errors++;\n              continue;\n            }\n\n            // Role validation based on current user\n            const validRoles = currentUser.role === 'admin' \n              ? ['admin', 'operator', 'viewer'] \n              : ['operator', 'viewer'];\n            \n            if (!validRoles.includes(row.role)) {\n              errors++;\n              continue;\n            }\n\n            // Create user data\n            const userData = {\n              username: row.username.trim(),\n              password: row.password.trim(),\n              name: row.name.trim(),\n              email: row.email.trim(),\n              mobile: row.mobile ? row.mobile.trim() : \"\",\n              address: row.address ? row.address.trim() : \"\",\n              role: row.role.trim(),\n              status: row.status ? row.status.trim() : \"active\"\n            };\n\n            // Validate with schema\n            const validatedData = insertUserSchema.parse(userData);\n            \n            // Check if username already exists\n            const existingUser = await storage.getUserByUsername(validatedData.username);\n            if (existingUser) {\n              errors++;\n              continue;\n            }\n\n            // Hash the password before storing\n            const hashedPassword = await bcrypt.hash(validatedData.password, 10);\n            const userWithHashedPassword = {\n              ...validatedData,\n              password: hashedPassword\n            };\n\n            // Create user\n            await storage.createUser(userWithHashedPassword);\n            created++;\n            \n          } catch (error) {\n            console.error(\"Error creating user from CSV:\", error);\n            errors++;\n          }\n        }\n\n        // Clean up uploaded file\n        fs.unlinkSync(filePath);\n\n        res.json({\n          message: \"Bulk upload completed\",\n          created,\n          errors,\n          total: csvData.length\n        });\n\n      } catch (error) {\n        // Clean up uploaded file in case of error\n        if (fs.existsSync(filePath)) {\n          fs.unlinkSync(filePath);\n        }\n        throw error;\n      }\n\n    } catch (error) {\n      console.error(\"Bulk upload error:\", error);\n      res.status(500).json({ message: \"Failed to process bulk upload\" });\n    }\n  });\n\n  // Check for duplicate mobile number\n  app.post(\"/api/users/check-mobile\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to check mobile numbers\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n\n      const { mobile } = req.body;\n      \n      if (!mobile) {\n        return res.status(400).json({ message: \"Mobile number is required\" });\n      }\n\n      // Check if mobile number already exists\n      const existingUser = await storage.getUserByMobile(mobile);\n      \n      if (existingUser) {\n        return res.status(200).json({ \n          exists: true, \n          user: {\n            id: existingUser.id,\n            name: existingUser.name,\n            username: existingUser.username,\n            mobile: existingUser.mobile\n          }\n        });\n      } else {\n        return res.status(200).json({ exists: false });\n      }\n    } catch (error) {\n      console.error(\"Error checking mobile number:\", error);\n      res.status(500).json({ message: \"Failed to check mobile number\" });\n    }\n  });\n\n  app.post(\"/api/users\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      \n      // Only allow admin and operator to create users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      const userData = insertUserSchema.parse(req.body);\n      \n      // Operators cannot create admin users\n      if (currentUser.role === 'operator' && userData.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot create admin users\" });\n      }\n\n      // Check for duplicate mobile number before creating user\n      if (userData.mobile) {\n        const existingUser = await storage.getUserByMobile(userData.mobile);\n        if (existingUser) {\n          return res.status(400).json({ \n            message: `Mobile number already exists for user: ${existingUser.name} (${existingUser.username})` \n          });\n        }\n      }\n      \n      // Hash the password before storing\n      const hashedPassword = await bcrypt.hash(userData.password, 10);\n      const userWithHashedPassword = {\n        ...userData,\n        password: hashedPassword\n      };\n      \n      const user = await storage.createUser(userWithHashedPassword);\n      res.status(201).json(user);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      const userId = parseInt(req.params.id);\n      \n      // Only allow admin and operator to update users\n      if (currentUser.role !== 'admin' && currentUser.role !== 'operator') {\n        return res.status(403).json({ message: \"Forbidden: Admin or Operator access required\" });\n      }\n      \n      // Get the user being updated to check their role\n      const existingUser = await storage.getUser(userId);\n      if (!existingUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Operators cannot edit admin users\n      if (currentUser.role === 'operator' && existingUser.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot edit admin users\" });\n      }\n      \n      // Operators cannot change user role to admin\n      if (currentUser.role === 'operator' && req.body.role === 'admin') {\n        return res.status(403).json({ message: \"Forbidden: Operators cannot assign admin role\" });\n      }\n      \n      // Hash password if it's being updated\n      let updateData = req.body;\n      if (req.body.password) {\n        const hashedPassword = await bcrypt.hash(req.body.password, 10);\n        updateData = {\n          ...req.body,\n          password: hashedPassword\n        };\n      }\n      \n      const updatedUser = await storage.updateUser(userId, updateData);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Since we're updating a user, we need to clear all entry caches where this user is referenced\n      // This ensures entries will show the updated user name\n      (req as any).sessionStore.all((err: any, sessions: any) => {\n        if (sessions) {\n          Object.values(sessions).forEach((session: any) => {\n            const wsClient = (req as any).app.get('wsClients')?.get(session.id);\n            if (wsClient) {\n              wsClient.send(JSON.stringify({\n                type: 'CACHE_INVALIDATION',\n                keys: [\n                  '/api/users',\n                  '/api/entries',\n                  `/api/entries/${userId}`,\n                  '/api/dashboard'\n                ]\n              }));\n            }\n          });\n        }\n      });\n      \n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // Entry management routes - only for boli entries\n  app.get(\"/api/entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { userId, includeDeleted } = req.query;\n      let entries;\n      \n      // Only admins can view deleted entries\n      const showDeleted = includeDeleted === 'true' && user.role === 'admin';\n      \n      if (userId) {\n        // Specific user requested - only for admin/operator or current user\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          entries = await storage.getUserEntries(targetUserId, showDeleted);\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else {\n        // No specific user - use role-based logic\n        if (user.role === \"admin\" || user.role === \"operator\") {\n          entries = await storage.getEntries(showDeleted);\n        } else {\n          entries = await storage.getUserEntries(user.id, showDeleted);\n        }\n      }\n      \n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entries\" });\n    }\n  });\n\n  // Separate dravya entries routes - completely isolated\n  app.get(\"/api/dravya-entries\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { userId } = req.query;\n      const { query } = await import(\"./db\");\n      \n      let sql: string, values: any[];\n      \n      if (userId) {\n        // Specific user requested - only for admin/operator or current user\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          sql = \"SELECT * FROM dravya_entries WHERE user_id = $1 ORDER BY id DESC\";\n          values = [targetUserId];\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else {\n        // No specific user - use role-based logic\n        if (user.role === \"admin\" || user.role === \"operator\") {\n          sql = \"SELECT * FROM dravya_entries ORDER BY id DESC\";\n          values = [];\n        } else {\n          sql = \"SELECT * FROM dravya_entries WHERE user_id = $1 ORDER BY id DESC\";\n          values = [user.id];\n        }\n      }\n      \n      const result = await query(sql, values);\n      const dravyaEntries = result.rows.map(row => ({\n        ...row,\n        userId: row.user_id,\n        userName: row.user_name,\n        userMobile: row.user_mobile,\n        userAddress: row.user_address,\n        entryDate: row.entry_date,\n        createdBy: row.created_by,\n        updatedAt: row.updated_at\n      }));\n      \n      res.json(dravyaEntries);\n    } catch (error) {\n      console.error(\"Error fetching dravya entries:\", error);\n      res.status(500).json({ message: \"Failed to fetch dravya entries\" });\n    }\n  });\n\n  // Get deleted entries (admin only) - MUST come before /api/entries/:id\n  app.get(\"/api/entries/deleted\", isAdmin, async (req, res) => {\n    try {\n      const { query } = await import(\"./db\");\n      \n      // Get all deleted entries\n      const result = await query(`\n        SELECT e.*, u.name as user_name, u.mobile as user_mobile, u.address as user_address\n        FROM entries e\n        LEFT JOIN users u ON e.user_id = u.id\n        WHERE e.entry_status = 'deleted'\n        ORDER BY e.id DESC\n      `);\n      \n      res.json(result.rows);\n    } catch (error) {\n      console.error(\"Error fetching deleted entries:\", error);\n      res.status(500).json({ message: \"Failed to fetch deleted entries\" });\n    }\n  });\n\n  // Restore deleted entry (admin only)\n  app.put(\"/api/entries/:id/restore\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const user = req.user as any;\n      \n      // Get the entry first to check if it exists and is deleted\n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      if (entry.entryStatus !== 'deleted') {\n        return res.status(400).json({ message: \"Entry is not deleted\" });\n      }\n      \n      // Restore - set entry_status back to 'active' and restore payment statuses\n      const { query } = await import(\"./db\");\n      \n      // Restore payments (remove 'deleted' status, revert to original)\n      const restoredPayments = entry.payments.map(payment => {\n        const { status, ...rest } = payment;\n        return rest; // Remove the 'deleted' status\n      });\n      \n      // Update entry to restore it\n      const updateSql = `\n        UPDATE entries \n        SET entry_status = $1,\n            payments = $2,\n            updated_at = $3\n        WHERE id = $4\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        'active',\n        JSON.stringify(restoredPayments),\n        new Date().toISOString(),\n        entryId\n      ];\n      \n      await query(updateSql, updateValues);\n      \n      // Log the restoration\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Restored boli entry #${entryId}: ${entry.description}`,\n        entry.totalAmount,\n        'credit',\n        JSON.stringify({\n          entryId,\n          description: entry.description,\n          totalAmount: entry.totalAmount,\n          userName: entry.userName\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      res.status(200).json({ message: \"Entry restored successfully\" });\n    } catch (error) {\n      console.error(\"Error restoring entry:\", error);\n      res.status(500).json({ message: \"Server error while restoring entry\" });\n    }\n  });\n\n  app.get(\"/api/entries/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const entry = await storage.getEntry(entryId);\n      \n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      const user = req.user as any;\n      if (user.role !== \"admin\" && user.role !== \"operator\" && entry.userId !== user.id) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      res.json(entry);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entry\" });\n    }\n  });\n\n  // Only operators can create entries\n  // Separate endpoint for creating dravya entries\n  app.post(\"/api/dravya-entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      console.log(\"Dravya entry creation data:\", req.body);\n      \n      // Parse and validate the data using Zod\n      const dravyaData = insertDravyaEntrySchema.parse(req.body);\n      console.log(\"Parsed dravya entry data:\", dravyaData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      const { query } = await import(\"./db\");\n      \n      // Get the user data\n      const user = await storage.getUser(dravyaData.userId);\n      \n      // Create the dravya entry\n      const sql = `\n        INSERT INTO dravya_entries (\n          user_id, user_name, user_mobile, user_address,\n          description, occasion, entry_date, created_by, updated_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7, $8, $9\n        ) RETURNING *\n      `;\n      \n      const values = [\n        dravyaData.userId,\n        user?.name || dravyaData.userName || 'Unknown User',\n        user?.mobile || '',\n        user?.address || '',\n        dravyaData.description || '',\n        dravyaData.occasion || '',\n        dravyaData.entryDate || new Date().toISOString().split('T')[0],\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing dravya SQL with values:\", values);\n      \n      const result = await query(sql, values);\n      console.log(\"Dravya entry creation result:\", result.rows[0]);\n      \n      // Map the raw DB object to our format\n      const rawEntry = result.rows[0];\n      const dravyaEntry = {\n        ...rawEntry,\n        userId: rawEntry.user_id,\n        userName: rawEntry.user_name,\n        userMobile: rawEntry.user_mobile,\n        userAddress: rawEntry.user_address,\n        entryDate: rawEntry.entry_date,\n        createdBy: rawEntry.created_by,\n        updatedAt: rawEntry.updated_at\n      };\n      \n      console.log(\"Dravya entry created successfully:\", dravyaEntry);\n      \n      // Send mobile notification for dravya entry\n      console.log(`[MOBILE NOTIFICATION] New dravya entry created for ${dravyaEntry.userName} (${dravyaEntry.userMobile})`);\n      console.log(`Dravya Entry: ${dravyaEntry.description}`);\n      \n      res.status(201).json(dravyaEntry);\n    } catch (error) {\n      console.error(\"Error creating dravya entry:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create dravya entry\" });\n    }\n  });\n\n  // GET expense entries (only for operators) with optional date filtering\n  app.get(\"/api/expense-entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      const { query } = await import(\"./db\");\n      \n      let sql = 'SELECT * FROM expense_entries WHERE 1=1';\n      const params: any[] = [];\n      \n      // Add date range filtering if provided\n      if (startDate) {\n        sql += ` AND expense_date >= $${params.length + 1}`;\n        params.push(startDate);\n      }\n      \n      if (endDate) {\n        sql += ` AND expense_date <= $${params.length + 1}`;\n        params.push(endDate);\n      }\n      \n      sql += ' ORDER BY expense_date DESC, id DESC';\n      \n      const result = await query(sql, params);\n      res.json(result.rows);\n    } catch (error) {\n      console.error(\"Error fetching expense entries:\", error);\n      res.status(500).json({ message: \"Failed to fetch expense entries\" });\n    }\n  });\n\n  // POST new expense entry (only for operators) with file uploads\n  app.post(\"/api/expense-entries\", isAdminOrOperator, upload.fields([\n    { name: 'receiptFile', maxCount: 1 },\n    { name: 'paymentScreenshot', maxCount: 1 }\n  ]), async (req, res) => {\n    try {\n      console.log(\"Expense entry creation data:\", req.body);\n      console.log(\"Uploaded files:\", req.files);\n      \n      const files = req.files as { [fieldname: string]: Express.Multer.File[] };\n      \n      // Parse form data from multipart request\n      const expenseData = {\n        firmName: req.body.firmName || null,\n        billNo: req.body.billNo || null,\n        billDate: req.body.billDate || null,\n        description: req.body.description,\n        amount: parseInt(req.body.amount),\n        quantity: req.body.quantity ? parseInt(req.body.quantity) : null,\n        reason: req.body.reason || null,\n        expenseDate: req.body.expenseDate,\n        paymentMode: req.body.paymentMode,\n        approvedBy: req.body.approvedBy,\n        paidBy: req.body.paidBy,\n        createdBy: req.body.createdBy\n      };\n      \n      // Validate the parsed data\n      const validatedData = insertExpenseEntrySchema.parse(expenseData);\n      console.log(\"Parsed expense entry data:\", validatedData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Handle file uploads\n      let receiptUrl = null;\n      let paymentScreenshotUrl = null;\n      \n      if (files.receiptFile && files.receiptFile[0]) {\n        receiptUrl = `/uploads/${files.receiptFile[0].filename}`;\n      }\n      \n      if (files.paymentScreenshot && files.paymentScreenshot[0]) {\n        paymentScreenshotUrl = `/uploads/${files.paymentScreenshot[0].filename}`;\n      }\n      \n      // Create expense entry with raw SQL\n      const { query } = await import(\"./db\");\n      \n      const sql = `\n        INSERT INTO expense_entries (\n          firm_name, bill_no, bill_date, description, amount, quantity, reason,\n          expense_date, payment_mode, attachment_url, approved_by, paid_by,\n          created_by, updated_at\n        ) VALUES (\n          $1, $2, $3, $4, $5, $6, $7,\n          $8, $9, $10, $11, $12,\n          $13, $14\n        ) RETURNING *\n      `;\n      \n      // Combine receipt and payment screenshot URLs\n      const attachmentUrls = [receiptUrl, paymentScreenshotUrl].filter(Boolean).join(';');\n      \n      const values = [\n        validatedData.firmName,\n        validatedData.billNo,\n        validatedData.billDate,\n        validatedData.description,\n        validatedData.amount,\n        validatedData.quantity,\n        validatedData.reason,\n        validatedData.expenseDate,\n        validatedData.paymentMode,\n        attachmentUrls || null,\n        validatedData.approvedBy,\n        validatedData.paidBy,\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing expense SQL with values:\", values);\n      \n      const result = await query(sql, values);\n      console.log(\"Expense entry creation result:\", result.rows[0]);\n      \n      const expenseEntry = result.rows[0];\n      \n      console.log(\"Expense entry created successfully:\", expenseEntry);\n      \n      // Send mobile notification for expense entry\n      console.log(`[MOBILE NOTIFICATION] New expense entry created: ${expenseEntry.description}`);\n      console.log(`Amount: ‚Çπ${(expenseEntry.amount / 100).toFixed(2)} | Approved by: ${expenseEntry.approved_by}`);\n      \n      res.status(201).json(expenseEntry);\n    } catch (error) {\n      console.error(\"Error creating expense entry:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create expense entry\" });\n    }\n  });\n\n  // PATCH expense entry (edit) - accessible by admin and operator\n  app.patch(\"/api/expense-entries/:id\", isAdminOrOperator, upload.fields([\n    { name: 'receiptFile', maxCount: 1 },\n    { name: 'paymentScreenshot', maxCount: 1 }\n  ]), async (req, res) => {\n    try {\n      const expenseId = parseInt(req.params.id);\n      console.log(\"Updating expense entry ID:\", expenseId);\n      console.log(\"Update data:\", req.body);\n      console.log(\"Uploaded files:\", req.files);\n      \n      const { query } = await import(\"./db\");\n      \n      // Check if expense entry exists\n      const existingResult = await query('SELECT * FROM expense_entries WHERE id = $1', [expenseId]);\n      if (existingResult.rows.length === 0) {\n        return res.status(404).json({ message: \"Expense entry not found\" });\n      }\n      \n      const existingEntry = existingResult.rows[0];\n      const files = req.files as { [fieldname: string]: Express.Multer.File[] };\n      \n      // Parse form data from multipart request\n      const expenseData = {\n        firmName: req.body.firmName || null,\n        billNo: req.body.billNo || null,\n        billDate: req.body.billDate || null,\n        description: req.body.description,\n        amount: parseInt(req.body.amount),\n        quantity: req.body.quantity ? parseInt(req.body.quantity) : null,\n        reason: req.body.reason || null,\n        expenseDate: req.body.expenseDate,\n        paymentMode: req.body.paymentMode,\n        approvedBy: req.body.approvedBy,\n        paidBy: req.body.paidBy,\n        createdBy: req.body.createdBy\n      };\n      \n      // Validate the parsed data\n      const validatedData = insertExpenseEntrySchema.parse(expenseData);\n      console.log(\"Validated expense entry data:\", validatedData);\n      \n      const currentUser = req.user as any;\n      \n      // Handle file uploads\n      let receiptUrl = null;\n      let paymentScreenshotUrl = null;\n      \n      // Parse existing attachments\n      const existingAttachments = existingEntry.attachment_url ? existingEntry.attachment_url.split(';').filter(Boolean) : [];\n      const existingReceipt = existingAttachments.find((url: string) => url.includes('receiptFile')) || null;\n      const existingPaymentScreenshot = existingAttachments.find((url: string) => url.includes('paymentScreenshot')) || null;\n      \n      // Use new files if uploaded, otherwise keep existing\n      if (files.receiptFile && files.receiptFile[0]) {\n        receiptUrl = `/uploads/${files.receiptFile[0].filename}`;\n      } else {\n        receiptUrl = existingReceipt;\n      }\n      \n      if (files.paymentScreenshot && files.paymentScreenshot[0]) {\n        paymentScreenshotUrl = `/uploads/${files.paymentScreenshot[0].filename}`;\n      } else {\n        paymentScreenshotUrl = existingPaymentScreenshot;\n      }\n      \n      // Combine receipt and payment screenshot URLs\n      const attachmentUrls = [receiptUrl, paymentScreenshotUrl].filter(Boolean).join(';');\n      \n      const sql = `\n        UPDATE expense_entries SET\n          firm_name = $1,\n          bill_no = $2,\n          bill_date = $3,\n          description = $4,\n          amount = $5,\n          quantity = $6,\n          reason = $7,\n          expense_date = $8,\n          payment_mode = $9,\n          attachment_url = $10,\n          approved_by = $11,\n          paid_by = $12,\n          updated_at = $13\n        WHERE id = $14\n        RETURNING *\n      `;\n      \n      const values = [\n        validatedData.firmName,\n        validatedData.billNo,\n        validatedData.billDate,\n        validatedData.description,\n        validatedData.amount,\n        validatedData.quantity,\n        validatedData.reason,\n        validatedData.expenseDate,\n        validatedData.paymentMode,\n        attachmentUrls || null,\n        validatedData.approvedBy,\n        validatedData.paidBy,\n        new Date().toISOString(),\n        expenseId\n      ];\n      \n      console.log(\"Executing expense update SQL with values:\", values);\n      \n      const result = await query(sql, values);\n      const updatedEntry = result.rows[0];\n      \n      console.log(\"Expense entry updated successfully:\", updatedEntry);\n      \n      res.json(updatedEntry);\n    } catch (error) {\n      console.error(\"Error updating expense entry:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to update expense entry\" });\n    }\n  });\n\n  // DELETE expense entry - accessible only by admin\n  app.delete(\"/api/expense-entries/:id\", isAdmin, async (req, res) => {\n    try {\n      const expenseId = parseInt(req.params.id);\n      console.log(\"Deleting expense entry ID:\", expenseId);\n      \n      const { query } = await import(\"./db\");\n      \n      // Check if expense entry exists\n      const existingResult = await query('SELECT * FROM expense_entries WHERE id = $1', [expenseId]);\n      if (existingResult.rows.length === 0) {\n        return res.status(404).json({ message: \"Expense entry not found\" });\n      }\n      \n      // Delete the expense entry\n      await query('DELETE FROM expense_entries WHERE id = $1', [expenseId]);\n      \n      console.log(`Expense entry ${expenseId} deleted successfully`);\n      \n      res.json({ message: \"Expense entry deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting expense entry:\", error);\n      res.status(500).json({ message: \"Failed to delete expense entry\" });\n    }\n  });\n\n  // Function to calculate remaining advance payments for a user\n  async function calculateRemainingAdvancePayment(userId: number): Promise<number> {\n    const { query } = await import(\"./db\");\n    \n    // Get total advance payments for the user\n    const advanceResult = await query(\n      'SELECT COALESCE(SUM(amount), 0) as total_advance FROM advance_payments WHERE user_id = $1',\n      [userId]\n    );\n    \n    // Get total used advance payments (payments made using advance)\n    const usedResult = await query(\n      'SELECT COALESCE(SUM(amount), 0) as total_used FROM advance_payment_usage WHERE user_id = $1',\n      [userId]\n    );\n    \n    const totalAdvance = parseInt(advanceResult.rows[0]?.total_advance || '0');\n    const totalUsed = parseInt(usedResult.rows[0]?.total_used || '0');\n    \n    console.log(`[DEBUG] User ${userId} - Total Advance: ${totalAdvance}, Total Used: ${totalUsed}`);\n    \n    const remainingBalance = totalAdvance - totalUsed;\n    \n    console.log(`[DEBUG] User ${userId} - Calculated Balance: ${remainingBalance}`);\n    \n    // Return 0 if balance would be negative (user can't have negative advance balance)\n    const finalBalance = Math.max(0, remainingBalance);\n    console.log(`[DEBUG] User ${userId} - Final Balance: ${finalBalance}`);\n    \n    return finalBalance;\n  }\n\n  // Function to auto-process boli payment using advance payment\n  async function autoProcessBoliPayment(entryId: number, userId: number, boliAmount: number, boliDate: string, createdBy: string): Promise<void> {\n    const { query } = await import(\"./db\");\n    \n    const remainingAdvance = await calculateRemainingAdvancePayment(userId);\n    \n    if (remainingAdvance > 0) {\n      const paymentAmount = Math.min(remainingAdvance, boliAmount);\n      \n      // Record the advance payment usage\n      await query(\n        'INSERT INTO advance_payment_usage (user_id, entry_id, amount, date, created_by, created_at) VALUES ($1, $2, $3, $4, $5, $6)',\n        [userId, entryId, paymentAmount, boliDate, createdBy, new Date().toISOString()]\n      );\n      \n      // Create payment record\n      const paymentRecord = {\n        date: boliDate,\n        amount: paymentAmount,\n        mode: 'advance_payment' as any,\n        receiptNo: `ADV${new Date().getFullYear()}${String(Date.now()).slice(-6)}`,\n        updatedBy: createdBy\n      };\n      \n      // Update the entry with the payment\n      const entry = await storage.getEntry(entryId);\n      if (entry) {\n        const updatedPayments = [...entry.payments, paymentRecord];\n        const newReceivedAmount = entry.receivedAmount + paymentAmount;\n        const newPendingAmount = entry.totalAmount - newReceivedAmount;\n        \n        let newStatus: PaymentStatusType;\n        if (newPendingAmount <= 0) {\n          newStatus = PaymentStatus.FULL;\n        } else if (newReceivedAmount > 0) {\n          newStatus = PaymentStatus.PARTIAL;\n        } else {\n          newStatus = PaymentStatus.PENDING;\n        }\n        \n        await query(\n          `UPDATE entries SET \n           payments = $1, received_amount = $2, pending_amount = $3, status = $4, updated_at = $5\n           WHERE id = $6`,\n          [JSON.stringify(updatedPayments), newReceivedAmount, newPendingAmount, newStatus, new Date().toISOString(), entryId]\n        );\n      }\n    }\n  }\n\n  // API endpoint to process advance payment for a boli entry\n  app.post(\"/api/entries/:id/advance-payment\", isAuthenticated, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const { amount, date } = req.body;\n      const user = req.user as any;\n      const userId = user?.id;\n\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      if (!amount || amount <= 0) {\n        return res.status(400).json({ message: \"Invalid payment amount\" });\n      }\n\n      const { query } = await import(\"./db\");\n\n      // Get the boli entry to find the user\n      const entryResult = await query('SELECT * FROM entries WHERE id = $1', [entryId]);\n      if (entryResult.rows.length === 0) {\n        return res.status(404).json({ message: \"Boli entry not found\" });\n      }\n      \n      const entry = entryResult.rows[0];\n      const entryUserId = entry.user_id;\n\n      // Get user's advance payment balance\n      const remainingBalance = await calculateRemainingAdvancePayment(entryUserId);\n      \n      if (remainingBalance < amount) {\n        return res.status(400).json({ message: \"Insufficient advance payment balance\" });\n      }\n\n      // Record the advance payment usage\n      await query(\n        'INSERT INTO advance_payment_usage (user_id, entry_id, amount, date, created_by, created_at) VALUES ($1, $2, $3, $4, $5, $6)',\n        [entryUserId, entryId, amount, date, user.username, new Date().toISOString()]\n      );\n\n      // Create payment record with advance payment mode using unified SPDJMSJ receipt number\n      const receiptNo = await generateUnifiedReceiptNumber(date);\n      \n      const paymentData = {\n        date,\n        amount,\n        mode: 'advance_payment',\n        receiptNo,\n        updatedBy: user.username\n      };\n\n      // Get current entry payments\n      const currentEntry = await query('SELECT payments FROM entries WHERE id = $1', [entryId]);\n      const currentPayments = currentEntry.rows[0]?.payments || [];\n      \n      // Add new payment\n      const updatedPayments = [...currentPayments, paymentData];\n      \n      // Calculate new totals\n      const totalReceived = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const pendingAmount = entry.total_amount - totalReceived;\n      const status = pendingAmount <= 0 ? 'full' : totalReceived > 0 ? 'partial' : 'pending';\n\n      // Update the entry\n      await query(\n        'UPDATE entries SET payments = $1, received_amount = $2, pending_amount = $3, status = $4, updated_at = $5 WHERE id = $6',\n        [JSON.stringify(updatedPayments), totalReceived, pendingAmount, status, new Date().toISOString(), entryId]\n      );\n\n      // Log the transaction\n      await query(\n        'INSERT INTO transaction_logs (entry_id, user_id, username, transaction_type, amount, description, date, details, timestamp) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)',\n        [\n          entryId,\n          entryUserId,\n          user.username,\n          'advance_payment_applied',\n          amount,\n          `Applied ‚Çπ${amount} from advance payment balance`,\n          date,\n          JSON.stringify({ \n            receiptNo,\n            previousStatus: entry.status,\n            newStatus: status,\n            remainingBalance: remainingBalance - amount\n          }),\n          new Date().toISOString()\n        ]\n      );\n\n      res.json({ \n        success: true, \n        payment: paymentData, \n        entry: {\n          ...entry,\n          payments: updatedPayments,\n          received_amount: totalReceived,\n          pending_amount: pendingAmount,\n          status\n        }\n      });\n\n    } catch (error) {\n      console.error(\"Error processing advance payment:\", error);\n      res.status(500).json({ message: \"Failed to process advance payment\" });\n    }\n  });\n\n  // API endpoint to get remaining advance payment balance for a user\n  app.get(\"/api/users/:id/advance-balance\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      console.log(`Calculating advance balance for user ${userId}`);\n      const remainingBalance = await calculateRemainingAdvancePayment(userId);\n      console.log(`Advance balance result for user ${userId}: ${remainingBalance}`);\n      \n      // Set cache headers to prevent caching\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      res.json(remainingBalance); // Return just the number, not an object\n    } catch (error) {\n      console.error(\"Error fetching user advance balance:\", error);\n      res.status(500).json({ message: \"Failed to fetch advance balance\" });\n    }\n  });\n\n  // Advance payments routes (completely separate module)\n  app.get(\"/api/advance-payments\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { startDate, endDate, userId } = req.query;\n      const { query } = await import(\"./db\");\n      \n      let sql = `SELECT ap.*, u.address as user_address \n                 FROM advance_payments ap \n                 LEFT JOIN users u ON ap.user_id = u.id \n                 WHERE 1=1`;\n      const params: any[] = [];\n      \n      // Add user filtering if specified\n      if (userId) {\n        const targetUserId = parseInt(userId.toString());\n        if (user.role === \"admin\" || user.role === \"operator\" || user.id === targetUserId) {\n          sql += ` AND ap.user_id = $${params.length + 1}`;\n          params.push(targetUserId);\n        } else {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n      } else if (user.role !== \"admin\" && user.role !== \"operator\") {\n        // Non-admin/operator users can only see their own advance payments\n        sql += ` AND ap.user_id = $${params.length + 1}`;\n        params.push(user.id);\n      }\n      \n      // Add date range filtering if provided\n      if (startDate) {\n        sql += ` AND date >= $${params.length + 1}`;\n        params.push(startDate);\n      }\n      \n      if (endDate) {\n        sql += ` AND date <= $${params.length + 1}`;\n        params.push(endDate);\n      }\n      \n      sql += ' ORDER BY date DESC, id DESC';\n      \n      const result = await query(sql, params);\n      const advancePayments = result.rows.map(row => ({\n        ...row,\n        userId: row.user_id,\n        userName: row.user_name,\n        userMobile: row.user_mobile,\n        userAddress: row.user_address,\n        paymentMode: row.payment_mode,\n        attachmentUrl: row.attachment_url,\n        receiptNo: row.receipt_no,\n        createdBy: row.created_by,\n        createdAt: row.created_at\n      }));\n      \n      res.json(advancePayments);\n    } catch (error) {\n      console.error(\"Error fetching advance payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch advance payments\" });\n    }\n  });\n\n  // Function to generate SPDJMSJ receipt number using boli pattern\n  async function generateUnifiedReceiptNumber(paymentDate: string): Promise<string> {\n    return await generateBoliReceiptNumber(paymentDate);\n  }\n\n  // Function to generate advance payment receipt number (SPDJMSJ format only)\n  async function generateAdvancePaymentReceiptNumber(paymentDate: string): Promise<string> {\n    return await generateBoliReceiptNumber(paymentDate);\n  }\n\n  // POST new advance payment with file upload\n  app.post(\"/api/advance-payments\", isAdminOrOperator, upload.single('paymentScreenshot'), async (req, res) => {\n    try {\n      console.log(\"Advance payment creation data:\", req.body);\n      console.log(\"Uploaded file:\", req.file);\n      \n      // Parse form data from multipart request\n      const advancePaymentData = {\n        userId: parseInt(req.body.userId),\n        userName: req.body.userName,\n        userMobile: req.body.userMobile || '',\n        date: req.body.date,\n        amount: parseInt(req.body.amount), // Amount already in correct format\n        paymentMode: req.body.paymentMode,\n        createdBy: req.body.createdBy\n      };\n      \n      // Validate the parsed data\n      const validatedData = insertAdvancePaymentSchema.parse(advancePaymentData);\n      console.log(\"Parsed advance payment data:\", validatedData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Handle file upload for payment screenshot\n      let attachmentUrl = null;\n      if (req.file) {\n        attachmentUrl = `/uploads/${req.file.filename}`;\n      }\n      \n      // Generate receipt number for advance payment\n      const receiptNo = await generateAdvancePaymentReceiptNumber(validatedData.date);\n      \n      // Create advance payment with raw SQL\n      const { query } = await import(\"./db\");\n      \n      const sql = `\n        INSERT INTO advance_payments (\n          user_id, user_name, user_mobile, date,\n          amount, payment_mode, attachment_url, receipt_no, created_by, created_at\n        ) VALUES (\n          $1, $2, $3, $4,\n          $5, $6, $7, $8, $9, $10\n        ) RETURNING *\n      `;\n      \n      const values = [\n        validatedData.userId,\n        validatedData.userName,\n        validatedData.userMobile || '',\n        validatedData.date,\n        validatedData.amount,\n        validatedData.paymentMode,\n        attachmentUrl,\n        receiptNo,\n        currentUser ? currentUser.username : 'system',\n        new Date().toISOString()\n      ];\n      \n      console.log(\"Executing advance payment SQL with values:\", values);\n      \n      const result = await query(sql, values);\n      console.log(\"Advance payment creation result:\", result.rows[0]);\n      \n      const advancePayment = result.rows[0];\n      \n      console.log(\"Advance payment created successfully:\", advancePayment);\n      \n      res.status(201).json({\n        ...advancePayment,\n        userId: advancePayment.user_id,\n        userName: advancePayment.user_name,\n        userMobile: advancePayment.user_mobile,\n        paymentMode: advancePayment.payment_mode,\n        attachmentUrl: advancePayment.attachment_url,\n        receiptNo: advancePayment.receipt_no,\n        createdBy: advancePayment.created_by,\n        createdAt: advancePayment.created_at\n      });\n    } catch (error) {\n      console.error(\"Error creating advance payment:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create advance payment\" });\n    }\n  });\n\n  app.post(\"/api/entries\", isAdminOrOperator, async (req, res) => {\n    try {\n      console.log(\"Entry creation data:\", req.body);\n      const entryData = insertEntrySchema.parse(req.body);\n      console.log(\"Parsed entry data:\", entryData);\n      \n      const currentUser = req.user as any;\n      console.log(\"Current user:\", currentUser.id, currentUser.username);\n      \n      // Validate that the boli date is not in the future\n      const boliDate = new Date(entryData.auctionDate);\n      const today = new Date();\n      today.setHours(23, 59, 59, 999); // Set to end of today\n      \n      if (boliDate > today) {\n        return res.status(400).json({ \n          message: \"Boli date cannot be in the future. Please select today's date or earlier.\" \n        });\n      }\n      \n      // Create entry and pass the current user's ID (who is creating the entry)\n      // Use direct SQL to create the entry with proper column names\n      const { query } = await import(\"./db\");\n      \n      // Map the fields correctly for auction entries\n      const quantity = entryData.quantity || 1;\n      const totalAmount = entryData.amount * quantity;\n      \n      // Get the user data\n      const user = await storage.getUser(entryData.userId);\n      \n      // Create the entry with raw SQL to ensure column names match\n      const sql = `\n        INSERT INTO entries (\n          user_id, user_name, user_mobile, user_address,\n          description, amount, quantity, total_amount,\n          occasion, bedi_number, auction_date, pending_amount, received_amount,\n          status, payments, created_by\n        ) VALUES (\n          $1, $2, $3, $4,\n          $5, $6, $7, $8,\n          $9, $10, $11, $12, $13,\n          $14, $15, $16\n        ) RETURNING *\n      `;\n      \n      const values = [\n        entryData.userId,\n        user?.name || entryData.userName || 'Unknown User',\n        user?.mobile || '',\n        user?.address || '',\n        entryData.description || '',\n        entryData.amount || 0,\n        quantity,\n        totalAmount,\n        entryData.occasion || '',\n        entryData.bediNumber || '1', // ‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï\n        entryData.auctionDate || new Date().toISOString().split('T')[0],\n        totalAmount,\n        0,\n        'pending',\n        '[]',\n        currentUser ? currentUser.username : 'system'\n      ];\n      \n      console.log(\"Executing SQL with values:\", values);\n      \n      const result = await query(sql, values);\n      console.log(\"Entry creation result:\", result.rows[0]);\n      \n      // Create a transaction log for this entry creation (CREDIT)\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        result.rows[0].id,\n        currentUser.id,\n        currentUser.username,\n        `Entry created for ${user?.name || entryData.userName || 'Unknown User'} by ${currentUser.username}`,\n        totalAmount,\n        'credit', // Explicitly setting transaction_type to 'credit'\n        JSON.stringify({\n          description: entryData.description,\n          occasion: entryData.occasion,\n          auctionDate: entryData.auctionDate\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      console.log(\"Transaction log created for entry creation\");\n      \n      // Map the raw DB object to our format\n      const rawEntry = result.rows[0];\n      const entry = {\n        ...rawEntry,\n        userId: rawEntry.user_id,\n        userName: rawEntry.user_name,\n        userMobile: rawEntry.user_mobile,\n        userAddress: rawEntry.user_address,\n        totalAmount: rawEntry.total_amount,\n        pendingAmount: rawEntry.pending_amount,\n        receivedAmount: rawEntry.received_amount,\n        auctionDate: rawEntry.auction_date,\n        updatedAt: rawEntry.updated_at,\n        createdBy: rawEntry.created_by,\n        entryType: rawEntry.entry_type,\n        unitOfMeasurement: rawEntry.unit_of_measurement\n      };\n      console.log(\"Entry created successfully:\", entry);\n      \n      // Removed auto-payment processing - advance payments should only be applied manually\n      // Auto-payment was causing issues where entries were automatically paid from advance balance\n      // Now entries are created as pending and operators must manually apply advance payments when needed\n      \n      // Get the user for whom the entry was created\n      const entryUser = await storage.getUser(entry.userId);\n      \n      // If entryUser exists, send notification\n      if (entryUser) {\n        // Import is done inside the handler to avoid circular dependencies\n        const { NotificationService } = await import(\"./notification\");\n        NotificationService.notifyEntryCreated(entryUser, entry);\n      }\n      \n      res.status(201).json(entry);\n    } catch (error) {\n      console.error(\"Error creating entry:\", error);\n      \n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to create entry\" });\n    }\n  });\n\n  // Entry update endpoint (for operators and admins with role-based field restrictions)\n  app.put(\"/api/entries/:id\", isAdminOrOperator, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const currentUser = req.user as any;\n      \n      console.log(`=== ENTRY UPDATE DEBUG for ID ${entryId} ===`);\n      console.log(`User: ${currentUser.username} (${currentUser.role})`);\n      console.log(`Request body:`, JSON.stringify(req.body, null, 2));\n      \n      // Get the current entry to compare changes\n      const existingEntry = await storage.getEntry(entryId);\n      if (!existingEntry) {\n        console.log(`ERROR: Entry ${entryId} not found in database`);\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      console.log(`Existing entry:`, {\n        id: existingEntry.id,\n        userName: existingEntry.userName,\n        description: existingEntry.description,\n        totalAmount: existingEntry.totalAmount,\n        quantity: existingEntry.quantity,\n        occasion: existingEntry.occasion,\n        auctionDate: existingEntry.auctionDate\n      });\n      \n      // Parse and validate the request body\n      const updateData = insertEntrySchema.omit({ \n        createdBy: true \n      }).parse({\n        ...req.body,\n        totalAmount: req.body.totalAmount, // Keep as number for validation\n        quantity: req.body.quantity\n      });\n      \n      // Role-based field restrictions\n      if (currentUser.role === 'operator') {\n        // Operators cannot edit the totalAmount field\n        if (updateData.totalAmount !== existingEntry.totalAmount) {\n          return res.status(403).json({ \n            message: \"Operators cannot modify the total amount. Only administrators can edit this field.\" \n          });\n        }\n        \n        // Operators cannot change the user selection\n        if (updateData.userId !== existingEntry.userId) {\n          return res.status(403).json({ \n            message: \"Operators cannot change the user selection. Only administrators can edit this field.\" \n          });\n        }\n      }\n      \n      // Validate that the boli date is not in the future\n      const boliDate = new Date(updateData.auctionDate);\n      const today = new Date();\n      today.setHours(23, 59, 59, 999); // Set to end of today\n      \n      if (boliDate > today) {\n        return res.status(400).json({ \n          message: \"Boli date cannot be in the future. Please select today's date or earlier.\" \n        });\n      }\n      \n      // Use totalAmount directly in rupees (no conversion needed)\n      const updatedEntryData = {\n        ...updateData,\n        totalAmount: updateData.totalAmount,\n        updatedAt: new Date().toISOString(),\n      };\n      \n      // Update the entry\n      console.log(`Calling storage.updateEntry with:`, updatedEntryData);\n      const updatedEntry = await storage.updateEntry(entryId, updatedEntryData, currentUser.id);\n      \n      if (!updatedEntry) {\n        console.log(`ERROR: storage.updateEntry returned null/undefined for entry ${entryId}`);\n        return res.status(500).json({ message: \"Failed to update entry\" });\n      }\n      \n      console.log(`Update successful! Updated entry:`, {\n        id: updatedEntry.id,\n        userName: updatedEntry.userName,\n        description: updatedEntry.description,\n        totalAmount: updatedEntry.totalAmount,\n        quantity: updatedEntry.quantity,\n        occasion: updatedEntry.occasion,\n        auctionDate: updatedEntry.auctionDate\n      });\n      \n      // Log the transaction\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const changes = {\n        before: {\n          description: existingEntry.description,\n          totalAmount: existingEntry.totalAmount,\n          quantity: existingEntry.quantity,\n          occasion: existingEntry.occasion,\n          auctionDate: existingEntry.auctionDate\n        },\n        after: {\n          description: updateData.description,\n          totalAmount: updateData.totalAmount,\n          quantity: updateData.quantity,\n          occasion: updateData.occasion,\n          auctionDate: updateData.auctionDate\n        },\n        updatedBy: currentUser.username\n      };\n      \n      const logValues = [\n        entryId,\n        currentUser.id,\n        currentUser.username,\n        `Entry updated by ${currentUser.username} (${currentUser.role})`,\n        updateData.totalAmount,\n        'update_entry',\n        JSON.stringify(changes),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      console.log(\"Transaction log created for entry update\");\n      \n      // Let's verify the data was actually saved by fetching it again\n      const verifyEntry = await storage.getEntry(entryId);\n      console.log(`VERIFICATION: Re-fetched entry after update:`, {\n        id: verifyEntry?.id,\n        userName: verifyEntry?.userName,\n        description: verifyEntry?.description,\n        totalAmount: verifyEntry?.totalAmount,\n        quantity: verifyEntry?.quantity,\n        occasion: verifyEntry?.occasion,\n        auctionDate: verifyEntry?.auctionDate,\n        updatedAt: verifyEntry?.updatedAt\n      });\n      \n      console.log(`=== END ENTRY UPDATE DEBUG for ID ${entryId} ===`);\n      res.json(updatedEntry);\n    } catch (error) {\n      console.error(\"Error updating entry:\", error);\n      \n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to update entry\" });\n    }\n  });\n\n  // Entry deletion endpoint (only for admins)\n  // Soft delete boli entry (admin only)\n  app.delete(\"/api/entries/:id\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const user = req.user as any;\n      \n      // Get the entry first to check if it exists\n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Check if already deleted\n      if (entry.entryStatus === 'deleted') {\n        return res.status(400).json({ message: \"Entry is already deleted\" });\n      }\n      \n      // Soft delete - set entry_status to 'deleted' and mark all payments as deleted\n      const { query } = await import(\"./db\");\n      \n      // Mark all payments in the entry as deleted\n      const updatedPayments = entry.payments.map(payment => ({\n        ...payment,\n        status: 'deleted' as const\n      }));\n      \n      // Update entry with soft delete\n      const updateSql = `\n        UPDATE entries \n        SET entry_status = $1,\n            payments = $2,\n            updated_at = $3\n        WHERE id = $4\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        'deleted',\n        JSON.stringify(updatedPayments),\n        new Date().toISOString(),\n        entryId\n      ];\n      \n      const updateResult = await query(updateSql, updateValues);\n      \n      // Log the soft delete\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Soft deleted boli entry #${entryId}: ${entry.description}`,\n        entry.totalAmount,\n        'credit',\n        JSON.stringify({\n          entryId,\n          description: entry.description,\n          totalAmount: entry.totalAmount,\n          receivedAmount: entry.receivedAmount,\n          pendingAmount: entry.pendingAmount,\n          userName: entry.userName\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      res.status(200).json({ message: \"Entry deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting entry:\", error);\n      res.status(500).json({ message: \"Server error while deleting entry\" });\n    }\n  });\n  \n  // Transaction logs routes\n  app.get(\"/api/transaction-logs\", isAdmin, async (req, res) => {\n    try {\n      const logs = await storage.getTransactionLogs();\n      res.json(logs);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch transaction logs\" });\n    }\n  });\n\n  app.get(\"/api/entries/:id/transaction-logs\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const logs = await storage.getEntryTransactionLogs(entryId);\n      res.json(logs);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch entry transaction logs\" });\n    }\n  });\n  \n  // Payment management routes\n  // Payment update functionality has been disabled\n  app.put(\"/api/entries/:id/payments/:index\", isAdmin, async (req, res) => {\n    return res.status(403).json({ message: \"Payment update functionality has been disabled\" });\n  });\n\n  // Endpoint to delete a payment\n  app.delete(\"/api/entries/:id/payments/:index\", isAdmin, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const paymentIndex = parseInt(req.params.index);\n      const user = req.user as any;\n      \n      // Get the entry first to check if it exists\n      const entryToUpdate = await storage.getEntry(entryId);\n      if (!entryToUpdate) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Check if payment exists\n      if (!entryToUpdate.payments || paymentIndex >= entryToUpdate.payments.length) {\n        return res.status(404).json({ message: \"Payment record not found\" });\n      }\n      \n      // Store the payment to be deleted for logging\n      const deletedPayment = entryToUpdate.payments[paymentIndex];\n      \n      // Remove the payment from the array\n      const updatedPayments = [...entryToUpdate.payments];\n      updatedPayments.splice(paymentIndex, 1);\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entryToUpdate.totalAmount - newReceivedAmount;\n      \n      // Determine new payment status\n      let newStatus = entryToUpdate.status;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entryToUpdate.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with SQL to ensure proper column names\n      const { query } = await import(\"./db\");\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            received_amount = $2, \n            pending_amount = $3,\n            status = $4\n        WHERE id = $5\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        newReceivedAmount,\n        newPendingAmount,\n        newStatus,\n        entryId\n      ];\n      \n      const updateResult = await query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the deletion with CREDIT transaction type (since we're adding back to the account)\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Deleted payment record of ‚Çπ${deletedPayment.amount} from entry #${entryId}`,\n        deletedPayment.amount,\n        'credit', // Explicitly setting transaction_type to 'credit'\n        JSON.stringify({\n          date: deletedPayment.date,\n          mode: deletedPayment.mode,\n          amount: deletedPayment.amount,\n          fileUrl: deletedPayment.fileUrl,\n          receiptNo: deletedPayment.receiptNo\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      // If status has changed, log that too\n      if (entryToUpdate.status !== newStatus) {\n        const statusLogSql = `\n          INSERT INTO transaction_logs (\n            entry_id, user_id, username, description, \n            amount, transaction_type, details, date, timestamp\n          ) VALUES (\n            $1, $2, $3, $4, \n            $5, $6, $7, $8, $9\n          )\n        `;\n        \n        const statusLogValues = [\n          entryId,\n          user.id,\n          user.username,\n          `Payment status changed from ${entryToUpdate.status} to ${newStatus} after deleting payment`,\n          0,\n          'update_payment', // Explicitly setting transaction_type\n          JSON.stringify({\n            oldStatus: entryToUpdate.status,\n            newStatus,\n            deletedPayment\n          }),\n          new Date().toISOString().split('T')[0],\n          new Date().toISOString()\n        ];\n        \n        await query(statusLogSql, statusLogValues);\n      }\n      \n      // Map the raw DB object to our format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      res.json(mappedEntry);\n    } catch (error) {\n      console.error(\"Error deleting payment:\", error);\n      res.status(500).json({ message: \"Failed to delete payment record\" });\n    }\n  });\n  \n  // Create a dedicated upload middleware for payment attachments\n  const paymentUpload = multer({\n    storage: storage_multer,\n    limits: {\n      fileSize: 10 * 1024 * 1024, // 10MB limit\n    },\n    fileFilter: (req, file, cb) => {\n      const imageTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];\n      if (imageTypes.includes(file.mimetype)) {\n        cb(null, true);\n      } else {\n        cb(new Error('Only JPG, JPEG, PNG and PDF files are allowed'));\n      }\n    }\n  });\n  \n  // PATCH route for editing payment - role-based restrictions\n  app.patch(\"/api/entries/:id/payments/:index\", isAdminOrOperator, paymentUpload.single('file'), async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const paymentIndex = parseInt(req.params.index);\n      const user = req.user as any;\n      const isAdmin = user.role === 'admin';\n      \n      // Get the entry first to check if it exists\n      const entryToUpdate = await storage.getEntry(entryId);\n      if (!entryToUpdate) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Check if payment exists\n      if (!entryToUpdate.payments || paymentIndex >= entryToUpdate.payments.length) {\n        return res.status(404).json({ message: \"Payment record not found\" });\n      }\n      \n      // Get the existing payment\n      const existingPayment = entryToUpdate.payments[paymentIndex];\n      \n      // Build updated payment object with role-based field whitelisting\n      const updatedPayment = {\n        ...existingPayment,\n        updatedBy: user.username,\n      };\n      \n      // Role-based field restrictions\n      if (isAdmin) {\n        // Admin can update all fields\n        if (req.body.date) {\n          updatedPayment.date = req.body.date;\n        }\n        if (req.body.amount) {\n          updatedPayment.amount = parseInt(req.body.amount);\n        }\n        if (req.body.mode) {\n          updatedPayment.mode = req.body.mode;\n        }\n        if (req.file) {\n          updatedPayment.fileUrl = `/uploads/${req.file.filename}`;\n        }\n      } else {\n        // Operators can ONLY edit mode - explicitly whitelist this field\n        if (req.body.mode) {\n          // Server-side validation: If changing from cash to non-cash, file is REQUIRED\n          if (existingPayment.mode === PaymentMode.CASH && \n              req.body.mode !== PaymentMode.CASH && \n              !req.file) {\n            return res.status(400).json({ \n              message: \"Payment screenshot is required when changing from cash to UPI/other modes.\" \n            });\n          }\n          \n          updatedPayment.mode = req.body.mode;\n          \n          // Update fileUrl if screenshot provided\n          if (req.file) {\n            updatedPayment.fileUrl = `/uploads/${req.file.filename}`;\n          }\n        }\n        \n        // Explicitly reject any attempt to modify date or amount by operators\n        if (req.body.date || req.body.amount) {\n          return res.status(403).json({ \n            message: \"Operators can only edit payment mode. Date and amount changes require admin access.\" \n          });\n        }\n      }\n      \n      // Update payments array\n      const updatedPayments = [...entryToUpdate.payments];\n      updatedPayments[paymentIndex] = updatedPayment;\n      \n      // Recalculate received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entryToUpdate.totalAmount - newReceivedAmount;\n      \n      // Determine new payment status\n      let newStatus = entryToUpdate.status;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entryToUpdate.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with SQL\n      const { query } = await import(\"./db\");\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            received_amount = $2, \n            pending_amount = $3,\n            status = $4,\n            updated_at = $5\n        WHERE id = $6\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        newReceivedAmount,\n        newPendingAmount,\n        newStatus,\n        new Date().toISOString(),\n        entryId\n      ];\n      \n      const updateResult = await query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the payment edit\n      const changesSummary = [];\n      if (existingPayment.date !== updatedPayment.date) {\n        changesSummary.push(`Date: ${existingPayment.date} ‚Üí ${updatedPayment.date}`);\n      }\n      if (existingPayment.amount !== updatedPayment.amount) {\n        changesSummary.push(`Amount: ‚Çπ${existingPayment.amount} ‚Üí ‚Çπ${updatedPayment.amount}`);\n      }\n      if (existingPayment.mode !== updatedPayment.mode) {\n        changesSummary.push(`Mode: ${existingPayment.mode} ‚Üí ${updatedPayment.mode}`);\n      }\n      if (req.file) {\n        changesSummary.push(`Screenshot updated`);\n      }\n      \n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Edited payment record for entry #${entryId}: ${changesSummary.join(', ')}`,\n        updatedPayment.amount,\n        'update_payment',\n        JSON.stringify({\n          paymentIndex,\n          before: existingPayment,\n          after: updatedPayment,\n          changes: changesSummary\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      // Map the raw DB object to our format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      res.json(mappedEntry);\n    } catch (error) {\n      console.error(\"Error editing payment:\", error);\n      res.status(500).json({ message: \"Failed to edit payment record\" });\n    }\n  });\n\n  // Endpoint to update payment attachment (Admin only)\n  app.post(\"/api/payments/update-attachment\", isAdmin, paymentUpload.single('file'), async (req, res) => {\n    try {\n      const entryId = parseInt(req.body.entryId);\n      const paymentIndex = parseInt(req.body.paymentIndex);\n      const user = req.user as any;\n      \n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n      \n      // Get the entry to validate\n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Check if payment exists\n      if (!entry.payments || paymentIndex >= entry.payments.length || paymentIndex < 0) {\n        return res.status(404).json({ message: \"Payment record not found\" });\n      }\n      \n      // Store the old file URL for logging\n      const oldFileUrl = entry.payments[paymentIndex].fileUrl;\n      \n      // Update the payment with new file URL\n      const updatedPayments = [...entry.payments];\n      updatedPayments[paymentIndex] = {\n        ...updatedPayments[paymentIndex],\n        fileUrl: `/uploads/${req.file.filename}`,\n        updatedBy: user.username\n      };\n      \n      // Update the entry with new payments array using SQL\n      const { query } = await import(\"./db\");\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            updated_at = $2\n        WHERE id = $3\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        new Date().toISOString(),\n        entryId\n      ];\n      \n      const updateResult = await query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the attachment update\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Updated payment attachment for entry #${entryId}, payment #${paymentIndex + 1}`,\n        updatedPayments[paymentIndex].amount,\n        'update_payment',\n        JSON.stringify({\n          paymentIndex,\n          oldFileUrl,\n          newFileUrl: `/uploads/${req.file.filename}`,\n          updatedBy: user.username\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      // Delete old file if it exists and is different\n      if (oldFileUrl && oldFileUrl !== `/uploads/${req.file.filename}`) {\n        try {\n          const oldFilePath = path.join(process.cwd(), oldFileUrl);\n          if (fs.existsSync(oldFilePath)) {\n            fs.unlinkSync(oldFilePath);\n          }\n        } catch (fileError) {\n          console.log(\"Note: Could not delete old file:\", oldFileUrl);\n        }\n      }\n      \n      // Map the raw DB object to our format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      res.json({ \n        message: \"Payment attachment updated successfully\",\n        entry: mappedEntry \n      });\n    } catch (error) {\n      console.error(\"Error updating payment attachment:\", error);\n      res.status(500).json({ message: \"Failed to update payment attachment\" });\n    }\n  });\n  \n  // Endpoint to record a payment\n  app.post(\"/api/entries/:id/payments\", isAdminOrOperator, async (req, res) => {\n    try {\n      const entryId = parseInt(req.params.id);\n      const paymentData = recordPaymentSchema.omit({ entryId: true }).parse(req.body);\n      const user = req.user as any;\n      \n      const entry = await storage.getEntry(entryId);\n      if (!entry) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Validation 1: Do not allow payments if already fully paid\n      if (entry.status === PaymentStatus.FULL) {\n        return res.status(400).json({ message: \"Entry is already fully paid\" });\n      }\n      \n      // Validation 2: Do not allow payments if pending amount is 0\n      if (entry.pendingAmount === 0) {\n        return res.status(400).json({ message: \"Cannot add payment: Pending amount is ‚Çπ0\" });\n      }\n      \n      // Validation 3: Payment amount cannot exceed the total boli amount\n      if (paymentData.amount > entry.totalAmount) {\n        return res.status(400).json({ \n          message: `Payment amount (‚Çπ${paymentData.amount.toLocaleString()}) cannot exceed total boli amount (‚Çπ${entry.totalAmount.toLocaleString()})` \n        });\n      }\n      \n      // Validation 4: Payment amount cannot exceed pending amount\n      if (paymentData.amount > entry.pendingAmount) {\n        return res.status(400).json({ \n          message: `Payment amount (‚Çπ${paymentData.amount.toLocaleString()}) cannot exceed pending amount (‚Çπ${entry.pendingAmount.toLocaleString()})` \n        });\n      }\n      \n      // Validation 5: Payment amount must be greater than 0\n      if (paymentData.amount <= 0) {\n        return res.status(400).json({ message: \"Payment amount must be greater than ‚Çπ0\" });\n      }\n      \n      // Generate unified sequential receipt number based on the year - SPDJMSJ-YYYY-XXXXX\n      const receiptNo = await generateUnifiedReceiptNumber(paymentData.date);\n      \n      // Import query for database operations\n      const { query } = await import(\"./db\");\n      \n      // Handle advance payment processing\n      if (paymentData.mode === PaymentMode.ADVANCE_PAYMENT) {\n        // Verify user has sufficient advance balance\n        const availableBalance = await calculateRemainingAdvancePayment(entry.userId);\n        if (availableBalance < paymentData.amount) {\n          return res.status(400).json({ \n            message: `Insufficient advance balance. Available: ‚Çπ${availableBalance.toLocaleString()}, Required: ‚Çπ${paymentData.amount.toLocaleString()}` \n          });\n        }\n        \n        // Create advance payment usage record\n        const usageSql = `\n          INSERT INTO advance_payment_usage (\n            user_id, entry_id, amount, date, created_by\n          ) VALUES ($1, $2, $3, $4, $5)\n        `;\n        \n        const usageValues = [\n          entry.userId,\n          entryId,\n          paymentData.amount,\n          paymentData.date,\n          user.username\n        ];\n        \n        await query(usageSql, usageValues);\n        console.log(`Created advance payment usage record: User ${entry.userId}, Amount ${paymentData.amount}, Entry ${entryId}`);\n      }\n\n      const payment = {\n        date: paymentData.date,\n        amount: paymentData.amount,\n        mode: paymentData.mode || PaymentMode.CASH,\n        fileUrl: paymentData.fileUrl,\n        receiptNo: receiptNo, // Add unique receipt number\n        updatedBy: user.username // Add updatedBy field\n      };\n      \n      // Instead of using storage.recordPayment, we'll implement a direct approach to fix the transaction_type\n      // Get the current entry to modify\n      const entryToUpdate = await storage.getEntry(entryId);\n      if (!entryToUpdate) {\n        return res.status(404).json({ message: \"Entry not found\" });\n      }\n      \n      // Update the entry with the new payment\n      const currentPayments = entryToUpdate.payments || [];\n      const updatedPayments = [...currentPayments, payment];\n      \n      // Calculate new received and pending amounts\n      const newReceivedAmount = updatedPayments.reduce((sum, p) => sum + p.amount, 0);\n      const newPendingAmount = entryToUpdate.totalAmount - newReceivedAmount;\n      \n      // Determine payment status\n      let newStatus = entryToUpdate.status;\n      if (newReceivedAmount === 0) {\n        newStatus = PaymentStatus.PENDING;\n      } else if (newReceivedAmount < entryToUpdate.totalAmount) {\n        newStatus = PaymentStatus.PARTIAL;\n      } else {\n        newStatus = PaymentStatus.FULL;\n      }\n      \n      // Update the entry with SQL to ensure proper column names\n      const updateSql = `\n        UPDATE entries \n        SET payments = $1, \n            received_amount = $2, \n            pending_amount = $3,\n            status = $4\n        WHERE id = $5\n        RETURNING *\n      `;\n      \n      const updateValues = [\n        JSON.stringify(updatedPayments),\n        newReceivedAmount,\n        newPendingAmount,\n        newStatus,\n        entryId\n      ];\n      \n      const updateResult = await query(updateSql, updateValues);\n      const updatedEntry = updateResult.rows[0];\n      \n      // Log the payment with DEBIT transaction type\n      // Use direct SQL query to ensure transaction_type is correctly set\n      const logSql = `\n        INSERT INTO transaction_logs (\n          entry_id, user_id, username, description, \n          amount, transaction_type, details, date, timestamp\n        ) VALUES (\n          $1, $2, $3, $4, \n          $5, $6, $7, $8, $9\n        )\n      `;\n      \n      const logValues = [\n        entryId,\n        user.id,\n        user.username,\n        `Payment of ‚Çπ${payment.amount} recorded by ${user.username}`,\n        payment.amount,\n        'debit', // Explicitly setting transaction_type to 'debit'\n        JSON.stringify({\n          date: payment.date,\n          paymentMode: payment.mode,\n          receiptNo: payment.receiptNo\n        }),\n        new Date().toISOString().split('T')[0],\n        new Date().toISOString()\n      ];\n      \n      await query(logSql, logValues);\n      \n      // If status has changed, log that too\n      if (entryToUpdate.status !== newStatus) {\n        const statusLogSql = `\n          INSERT INTO transaction_logs (\n            entry_id, user_id, username, description, \n            amount, transaction_type, details, date, timestamp\n          ) VALUES (\n            $1, $2, $3, $4, \n            $5, $6, $7, $8, $9\n          )\n        `;\n        \n        const statusLogValues = [\n          entryId,\n          user.id,\n          user.username,\n          `Payment status changed from ${entryToUpdate.status} to ${newStatus}`,\n          0,\n          'update_payment', // Explicitly setting transaction_type\n          JSON.stringify({\n            payment,\n            oldStatus: entryToUpdate.status,\n            newStatus\n          }),\n          new Date().toISOString().split('T')[0],\n          new Date().toISOString()\n        ];\n        \n        await query(statusLogSql, statusLogValues);\n      }\n      \n      // Convert the response to match our expected schema format\n      const mappedEntry = {\n        ...updatedEntry,\n        userId: updatedEntry.user_id,\n        userName: updatedEntry.user_name,\n        userMobile: updatedEntry.user_mobile,\n        userAddress: updatedEntry.user_address,\n        totalAmount: updatedEntry.total_amount,\n        pendingAmount: updatedEntry.pending_amount,\n        receivedAmount: updatedEntry.received_amount,\n        auctionDate: updatedEntry.auction_date,\n        updatedAt: updatedEntry.updated_at,\n        createdBy: updatedEntry.created_by\n      };\n      \n      // Get the user for whom the payment was recorded\n      const entryUser = await storage.getUser(entryToUpdate.userId);\n      \n      // If user exists, send notification\n      if (entryUser) {\n        // Import is done inside the handler to avoid circular dependencies\n        const { NotificationService } = await import(\"./notification\");\n        NotificationService.notifyPaymentRecorded(entryUser, mappedEntry, payment);\n        \n        // If payment status changed, notify that as well\n        if (entryToUpdate.status !== newStatus) {\n          NotificationService.notifyPaymentStatusChanged(\n            entryUser,\n            mappedEntry,\n            entryToUpdate.status,\n            newStatus\n          );\n        }\n      }\n      \n      res.json(mappedEntry);\n    } catch (error) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  // Daily earnings calendar endpoint\n  app.get(\"/api/daily-earnings\", isAuthenticated, async (req, res) => {\n    try {\n      const { year } = req.query;\n      const selectedYear = year ? parseInt(year as string) : new Date().getFullYear();\n      \n      // Get entries from the selected year\n      const { query } = await import(\"./db\");\n      \n      const sql = `\n        SELECT \n          auction_date as date,\n          SUM(total_amount) as daily_total\n        FROM entries \n        WHERE auction_date LIKE $1\n        GROUP BY auction_date\n        ORDER BY auction_date\n      `;\n      \n      const result = await query(sql, [`${selectedYear}-%`]);\n      \n      // Transform data into a format easy to use in the frontend\n      const dailyEarnings: { [key: string]: number } = {};\n      result.rows.forEach(row => {\n        dailyEarnings[row.date] = parseInt(row.daily_total);\n      });\n      \n      console.log(`Daily earnings for ${selectedYear}:`, dailyEarnings);\n      \n      res.json(dailyEarnings);\n    } catch (error) {\n      console.error(\"Error fetching daily earnings:\", error);\n      res.status(500).json({ message: \"Failed to fetch daily earnings data\" });\n    }\n  });\n\n  // Daily payments calendar endpoint\n  app.get('/api/daily-payments', isAuthenticated, async (req, res) => {\n    try {\n      const { year } = req.query;\n      const selectedYear = year ? parseInt(year as string) : new Date().getFullYear();\n      \n      // Get all entries with payments for the selected year\n      const entries = await storage.getEntries();\n      \n      // Extract payment records and group by payment date\n      const dailyPayments: { [key: string]: number } = {};\n      \n      entries.forEach(entry => {\n        if (entry.payments && entry.payments.length > 0) {\n          entry.payments.forEach(payment => {\n            // Check if payment date is in the selected year\n            if (payment.date.startsWith(selectedYear.toString())) {\n              if (!dailyPayments[payment.date]) {\n                dailyPayments[payment.date] = 0;\n              }\n              dailyPayments[payment.date] += payment.amount;\n            }\n          });\n        }\n      });\n      \n      console.log(`Daily payments for ${selectedYear}:`, dailyPayments);\n      \n      res.json(dailyPayments);\n    } catch (error) {\n      console.error(\"Error fetching daily payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch daily payments data\" });\n    }\n  });\n\n  // Dashboard summary route with date range filtering - restricted to admin/operator only\n  app.get(\"/api/dashboard\", isAdminOrOperator, async (req, res) => {\n    try {\n      const user = req.user as any;\n      const { startDate, endDate } = req.query;\n      \n      // Only admin and operator can access dashboard data\n      const entries = await storage.getEntries();\n      \n      // Filter entries by date range if provided\n      let filteredEntries = entries;\n      if (startDate || endDate) {\n        filteredEntries = entries.filter(entry => {\n          const entryDate = new Date(entry.auctionDate);\n          const start = startDate ? new Date(startDate as string) : null;\n          const end = endDate ? new Date((endDate as string) + ' 23:59:59') : null;\n          \n          return (!start || entryDate >= start) && (!end || entryDate <= end);\n        });\n      }\n      \n      const totalAmount = filteredEntries.reduce((sum, entry) => sum + entry.totalAmount, 0);\n      const receivedAmount = filteredEntries.reduce((sum, entry) => sum + entry.receivedAmount, 0);\n      const pendingAmount = filteredEntries.reduce((sum, entry) => sum + entry.pendingAmount, 0);\n      \n      const pendingEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.PENDING).length;\n      const partialEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.PARTIAL).length;\n      const completedEntries = filteredEntries.filter(entry => entry.status === PaymentStatus.FULL).length;\n      \n      // Get remaining advance payments (only for admin/operator, viewers get 0)\n      let totalAdvancePayments = 0;\n      if (user.role === \"admin\" || user.role === \"operator\") {\n        try {\n          const { query } = await import(\"./db\");\n          \n          // Get all users with advance payments (don't filter by date - we want all users with any advance payments)\n          const usersWithAdvance = await query(`\n            SELECT DISTINCT user_id FROM advance_payments\n          `);\n          \n          // Calculate remaining balance for each user\n          for (const userRow of usersWithAdvance.rows) {\n            const remainingBalance = await calculateRemainingAdvancePayment(userRow.user_id);\n            // Only add positive balances (users can't have negative advance balances)\n            if (remainingBalance > 0) {\n              totalAdvancePayments += remainingBalance;\n            }\n          }\n          \n          console.log(\"Dashboard advance payments calculation:\", {\n            usersChecked: usersWithAdvance.rows.length,\n            totalAdvancePayments\n          });\n        } catch (error) {\n          console.error(\"Error calculating advance payments for dashboard:\", error);\n          totalAdvancePayments = 0; // Set to 0 if there's an error\n        }\n      }\n      \n      // Sort entries by date (most recent first)\n      const recentActivity = [...entries]\n        .sort((a, b) => new Date(b.auctionDate).getTime() - new Date(a.auctionDate).getTime())\n        .slice(0, 5);\n      \n      // Get corpus settings for overall summary calculation\n      let corpusValue = 0;\n      try {\n        const corpusResult = await query('SELECT corpus_value FROM corpus_settings LIMIT 1');\n        corpusValue = corpusResult.rows[0]?.corpus_value || 0;\n      } catch (error) {\n        console.log(\"No corpus settings found, using default value 0\");\n      }\n\n      // Get total expenses (unfiltered by date range)\n      let totalExpenses = 0;\n      try {\n        const expensesResult = await query('SELECT SUM(amount) as total FROM expense_entries');\n        totalExpenses = parseInt(expensesResult.rows[0]?.total) || 0;\n      } catch (error) {\n        console.error(\"Error calculating total expenses:\", error);\n      }\n\n      // Get total received outstanding payments from all users\n      let totalReceivedOutstanding = 0;\n      try {\n        const { query } = await import(\"./db\");\n        const result = await query(`\n          SELECT COALESCE(SUM(received_amount), 0) as total_received_outstanding\n          FROM previous_outstanding_records\n        `);\n        totalReceivedOutstanding = parseInt(result.rows[0].total_received_outstanding) || 0;\n      } catch (error) {\n        console.error(\"Error calculating received outstanding:\", error);\n        totalReceivedOutstanding = 0;\n      }\n\n      // Calculate cash in bank: ‚Çπ139,084 + ‚Çπ4,831 + ‚Çπ43,231 - ‚Çπ7,284 + Total Received Outstanding Payment\n      // Expenses are stored in rupees, calculate directly\n      const cashInBank = corpusValue + receivedAmount + totalAdvancePayments - totalExpenses + totalReceivedOutstanding;\n\n      res.json({\n        summary: {\n          totalAmount,\n          receivedAmount,\n          pendingAmount,\n          pendingEntries,\n          partialEntries,\n          completedEntries,\n          totalAdvancePayments\n        },\n        overallSummary: {\n          corpusValue,\n          totalReceived: receivedAmount,\n          totalAdvancePayments,\n          totalExpenses,\n          totalReceivedOutstanding,\n          cashInBank\n        },\n        recentActivity\n      });\n    } catch (error) {\n      console.error(\"Dashboard error:\", error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      res.status(500).json({ message: \"Failed to fetch dashboard data\", error: errorMessage });\n    }\n  });\n\n  // Database backup API - only for operators and admins\n  app.post(\"/api/database/backup\", isAdminOrOperator, async (req, res) => {\n    try {\n      const currentUser = req.user as any;\n      console.log(`Database backup requested by ${currentUser.username} (${currentUser.role})`);\n      \n      const xlsx = await import(\"xlsx\");\n      const nodemailer = await import(\"nodemailer\");\n      const path = await import(\"path\");\n      const fs = await import(\"fs\");\n      const { query } = await import(\"./db\");\n      \n      // Create workbook\n      const workbook = xlsx.utils.book_new();\n      \n      // Get all tables data with ALL columns as they exist in database (for emergency restore)\n      const tables = [\n        { name: \"Users\", query: \"SELECT id, serial_number, username, password, name, email, mobile, address, role, status FROM users ORDER BY id\" },\n        { name: \"Entries\", query: \"SELECT id, user_id, user_name, user_mobile, user_address, description, amount, quantity, total_amount, occasion, bedi_number, auction_date, status, pending_amount, received_amount, payments, updated_at, created_by FROM entries ORDER BY id\" },\n        { name: \"Dravya_Entries\", query: \"SELECT id, user_id, user_name, user_mobile, user_address, description, occasion, entry_date, created_by, updated_at FROM dravya_entries ORDER BY id\" },\n        { name: \"Expense_Entries\", query: \"SELECT id, firm_name, bill_no, bill_date, description, amount, quantity, reason, expense_date, payment_mode, attachment_url, approved_by, paid_by, created_by, updated_at FROM expense_entries ORDER BY id\" },\n        { name: \"Advance_Payments\", query: \"SELECT id, user_id, user_name, user_mobile, date, amount, payment_mode, attachment_url, receipt_no, created_by, created_at FROM advance_payments ORDER BY id\" },\n        { name: \"Advance_Payment_Usage\", query: \"SELECT id, user_id, entry_id, amount, date, created_by, created_at FROM advance_payment_usage ORDER BY id\" },\n        { name: \"Previous_Outstanding_Records\", query: \"SELECT id, serial_number, record_number, user_id, user_name, user_mobile, user_address, outstanding_amount, received_amount, pending_amount, status, payments, description, attachment_url, attachment_name, created_by, created_at, updated_at FROM previous_outstanding_records ORDER BY id\" },\n        { name: \"Transaction_Logs\", query: \"SELECT id, entry_id, user_id, username, transaction_type, amount, description, date, details, timestamp FROM transaction_logs ORDER BY id\" },\n        { name: \"Corpus_Settings\", query: \"SELECT id, corpus_value, base_date, updated_at, updated_by FROM corpus_settings ORDER BY id\" }\n      ];\n      \n      // Export each table as a worksheet\n      for (const table of tables) {\n        try {\n          const result = await query(table.query);\n          const worksheet = xlsx.utils.json_to_sheet(result.rows);\n          xlsx.utils.book_append_sheet(workbook, worksheet, table.name);\n          console.log(`Exported ${result.rows.length} rows from ${table.name}`);\n        } catch (tableError) {\n          console.error(`Error exporting ${table.name}:`, tableError);\n          // Create empty sheet for failed table\n          const emptySheet = xlsx.utils.json_to_sheet([{ error: `Failed to export ${table.name}` }]);\n          xlsx.utils.book_append_sheet(workbook, emptySheet, table.name);\n        }\n      }\n      \n      // Generate filename with timestamp\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];\n      const filename = `Database_Backup_${timestamp}.xlsx`;\n      const filepath = path.join(process.cwd(), 'uploads', filename);\n      \n      // Write Excel file\n      xlsx.writeFile(workbook, filepath);\n      console.log(`Backup file created: ${filename}`);\n      \n      // Get all operators for email distribution\n      const operatorResult = await query(\n        \"SELECT email, name FROM users WHERE role IN ('operator', 'admin') AND email IS NOT NULL AND email != ''\"\n      );\n      \n      if (operatorResult.rows.length === 0) {\n        return res.status(400).json({ message: \"No operators with valid email addresses found\" });\n      }\n      \n      // Check if SendGrid API key is available\n      if (!process.env.SENDGRID_API_KEY) {\n        console.log(\"SendGrid API key not found, skipping email sending\");\n        return res.json({ \n          message: \"Database backup created successfully. Email functionality requires SendGrid API key.\",\n          filename,\n          operatorCount: operatorResult.rows.length,\n          downloadUrl: `/uploads/${filename}`\n        });\n      }\n      \n      // Configure nodemailer with SendGrid\n      const transporter = nodemailer.createTransport({\n        host: 'smtp.sendgrid.net',\n        port: 587,\n        secure: false,\n        auth: {\n          user: 'apikey',\n          pass: process.env.SENDGRID_API_KEY\n        }\n      });\n      \n      // Email configuration\n      const emailOptions = {\n        from: 'noreply@shivnagarjaintemple.org',\n        subject: `Database Backup - ${new Date().toLocaleDateString('en-IN')}`,\n        html: `\n          <h2>‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø - Database Backup</h2>\n          <p>Dear Temple Administrator,</p>\n          <p>A database backup has been automatically generated and is attached to this email.</p>\n          \n          <h3>Backup Details:</h3>\n          <ul>\n            <li><strong>Generated by:</strong> ${currentUser.name} (${currentUser.username})</li>\n            <li><strong>Date & Time:</strong> ${new Date().toLocaleString('en-IN')}</li>\n            <li><strong>File Size:</strong> ${Math.round(fs.statSync(filepath).size / 1024)} KB</li>\n          </ul>\n          \n          <h3>Included Data:</h3>\n          <ul>\n            <li>Users Management</li>\n            <li>Boli Entries & Payments</li>\n            <li>Advance Payments</li>\n            <li>Dravya Entries</li>\n            <li>Expense Entries</li>\n            <li>Transaction Logs</li>\n          </ul>\n          \n          <p><strong>Note:</strong> Please store this backup file securely and delete it from your email after downloading.</p>\n          <p>This is an automated email from the Temple Management System.</p>\n          \n          <hr>\n          <small>‡§∂‡•ç‡§∞‡•Ä ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø, ‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞</small>\n        `,\n        attachments: [{\n          filename: filename,\n          path: filepath\n        }]\n      };\n      \n      // Send email to all operators\n      const emailPromises = operatorResult.rows.map(operator => \n        transporter.sendMail({\n          ...emailOptions,\n          to: operator.email,\n          html: emailOptions.html.replace('Dear Temple Administrator', `Dear ${operator.name}`)\n        })\n      );\n      \n      await Promise.all(emailPromises);\n      console.log(`Backup email sent to ${operatorResult.rows.length} operators`);\n      \n      // Clean up the file after sending\n      setTimeout(() => {\n        try {\n          fs.unlinkSync(filepath);\n          console.log(`Backup file ${filename} cleaned up`);\n        } catch (cleanupError) {\n          console.error(\"Error cleaning up backup file:\", cleanupError);\n        }\n      }, 300000); // Delete after 5 minutes\n      \n      res.json({\n        message: `Database backup created and emailed to ${operatorResult.rows.length} operators successfully`,\n        filename,\n        operatorCount: operatorResult.rows.length,\n        operatorEmails: operatorResult.rows.map(op => op.email),\n        downloadUrl: `/uploads/${filename}`\n      });\n      \n    } catch (error) {\n      console.error(\"Database backup error:\", error);\n      res.status(500).json({ \n        message: \"Failed to create database backup\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Previous Outstanding Records API routes\n  app.get(\"/api/previous-outstanding\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { userId } = req.query;\n      \n      let records;\n      if (userId) {\n        records = await db.select().from(previousOutstandingRecords)\n          .where(eq(previousOutstandingRecords.userId, parseInt(userId as string)));\n      } else {\n        records = await db.select().from(previousOutstandingRecords);\n      }\n      \n      // For each record, calculate payment totals\n      const recordsWithPayments = records.map((record) => {\n        const payments = record.payments || [];\n        const receivedAmount = payments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n        const pendingAmount = Math.max(0, record.outstandingAmount - receivedAmount);\n        \n        // Determine status\n        let status: 'pending' | 'partial' | 'full' = 'pending';\n        if (receivedAmount >= record.outstandingAmount) {\n          status = 'full';\n        } else if (receivedAmount > 0) {\n          status = 'partial';\n        }\n        \n        return {\n          ...record,\n          receivedAmount,\n          pendingAmount,\n          status\n        };\n      });\n      \n      res.json(recordsWithPayments);\n    } catch (error) {\n      console.error(\"Error fetching previous outstanding records:\", error);\n      res.status(500).json({ message: \"Failed to fetch previous outstanding records\" });\n    }\n  });\n\n  // Update previous outstanding record\n  app.patch(\"/api/previous-outstanding/:id\", isAdminOrOperator, upload.single('attachmentFile'), async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      const { outstandingAmount, userId, description } = req.body;\n      const currentUser = req.user as any;\n      \n      \n      // Get the existing record\n      const [existingRecord] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, recordId));\n      \n      if (!existingRecord) {\n        return res.status(404).json({ message: \"Record not found\" });\n      }\n      \n      // Calculate current received amount from payments\n      const payments = existingRecord.payments || [];\n      const receivedAmount = payments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n\n      // Prepare update data\n      const updateData: any = {\n        updatedAt: new Date().toISOString()\n      };\n      \n      // Update amount if provided\n      if (outstandingAmount !== undefined) {\n        const amount = parseFloat(outstandingAmount);\n        if (isNaN(amount) || amount < 0) {\n          return res.status(400).json({ message: \"Invalid outstanding amount\" });\n        }\n        \n        // Check if amount is less than already received\n        if (amount < receivedAmount) {\n          return res.status(400).json({ \n            message: `Outstanding amount cannot be less than already received amount of ‚Çπ${receivedAmount.toLocaleString()}` \n          });\n        }\n        \n        updateData.outstandingAmount = Math.round(amount); // Store in rupees\n        \n        // Recalculate pending amount and status\n        const newPendingAmount = Math.round(amount) - receivedAmount;\n        updateData.pendingAmount = Math.max(0, newPendingAmount);\n        \n        // Update status based on new amounts\n        if (newPendingAmount <= 0) {\n          updateData.status = PaymentStatus.FULL;\n        } else if (receivedAmount > 0) {\n          updateData.status = PaymentStatus.PARTIAL;\n        } else {\n          updateData.status = PaymentStatus.PENDING;\n        }\n      }\n\n      // Admin-only updates\n      if (currentUser.role === 'admin') {\n        // Update user if provided\n        if (userId && parseInt(userId) !== existingRecord.userId) {\n          const [newUser] = await db.select().from(users)\n            .where(eq(users.id, parseInt(userId)));\n\n          if (!newUser) {\n            return res.status(400).json({ message: \"Invalid user selected\" });\n          }\n\n          updateData.userId = newUser.id;\n          updateData.userName = newUser.name;\n          updateData.userMobile = newUser.mobile || '';\n          updateData.userAddress = newUser.address || '';\n        }\n\n        // Update description if provided\n        if (description !== undefined) {\n          updateData.description = description;\n        }\n      }\n      \n      // Handle file upload if provided\n      if (req.file) {\n        updateData.attachmentUrl = `/uploads/${req.file.filename}`;\n        updateData.attachmentName = req.file.originalname;\n      }\n      \n      // Update the record\n      const [updatedRecord] = await db.update(previousOutstandingRecords)\n        .set(updateData)\n        .where(eq(previousOutstandingRecords.id, recordId))\n        .returning();\n      \n      res.json({\n        message: \"Record updated successfully\",\n        record: updatedRecord\n      });\n    } catch (error) {\n      console.error(\"Error updating previous outstanding record:\", error);\n      res.status(500).json({ message: \"Failed to update record\" });\n    }\n  });\n\n  // Edit previous outstanding record (new comprehensive endpoint)\n  app.post(\"/api/previous-outstanding/edit\", isAdminOrOperator, upload.single('file'), async (req: Request, res: Response) => {\n    try {\n      const { recordId, amount, userId, description } = req.body;\n      const currentUser = req.user as any;\n      \n      if (!recordId) {\n        return res.status(400).json({ message: \"Record ID is required\" });\n      }\n\n      // Get the existing record\n      const [existingRecord] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, parseInt(recordId)));\n      \n      if (!existingRecord) {\n        return res.status(404).json({ message: \"Record not found\" });\n      }\n      \n      // Prepare update data\n      const updateData: any = {\n        updatedAt: new Date().toISOString()\n      };\n      \n      // Update amount (both admin and operator can do this)\n      if (amount !== undefined) {\n        const amountFloat = parseFloat(amount);\n        if (isNaN(amountFloat) || amountFloat < 0) {\n          return res.status(400).json({ message: \"Invalid outstanding amount\" });\n        }\n        \n        // Check if amount is less than already received\n        if (amountFloat < existingRecord.receivedAmount) {\n          return res.status(400).json({ \n            message: `Outstanding amount cannot be less than already received amount of ‚Çπ${existingRecord.receivedAmount.toLocaleString()}` \n          });\n        }\n        \n        updateData.outstandingAmount = Math.round(amountFloat);\n        \n        // Recalculate pending amount and status\n        const newPendingAmount = Math.round(amountFloat) - existingRecord.receivedAmount;\n        updateData.pendingAmount = Math.max(0, newPendingAmount);\n        \n        // Update status based on new amounts\n        if (newPendingAmount <= 0) {\n          updateData.status = PaymentStatus.FULL;\n        } else if (existingRecord.receivedAmount > 0) {\n          updateData.status = PaymentStatus.PARTIAL;\n        } else {\n          updateData.status = PaymentStatus.PENDING;\n        }\n      }\n\n      // Admin-only fields\n      if (currentUser.role === 'admin') {\n        // Update user assignment if provided and different\n        if (userId && parseInt(userId) !== existingRecord.userId) {\n          const [targetUser] = await db.select().from(users)\n            .where(eq(users.id, parseInt(userId)));\n          \n          if (!targetUser) {\n            return res.status(400).json({ message: \"Invalid user selected\" });\n          }\n\n          updateData.userId = parseInt(userId);\n          updateData.userName = targetUser.name;\n          updateData.userMobile = targetUser.mobile;\n          updateData.userAddress = targetUser.address;\n\n          // If user is changed, also update payment records to reflect the new user\n          if (existingRecord.payments && existingRecord.payments.length > 0) {\n            const updatedPayments = existingRecord.payments.map((payment: any) => ({\n              ...payment,\n              // Keep the payment data but note that user changed\n            }));\n            updateData.payments = updatedPayments;\n          }\n        }\n\n        // Update description if provided and different\n        if (description !== undefined && description !== existingRecord.description) {\n          updateData.description = description;\n        }\n      }\n      \n      // Handle file upload (both admin and operator can do this)\n      if (req.file) {\n        // Update the first payment record with the new file if payments exist\n        if (existingRecord.payments && existingRecord.payments.length > 0) {\n          const updatedPayments = [...existingRecord.payments];\n          updatedPayments[0] = {\n            ...updatedPayments[0],\n            fileUrl: `/uploads/${req.file.filename}`,\n            updatedBy: currentUser.username\n          };\n          updateData.payments = updatedPayments;\n        } else {\n          // If no payments exist, store file URL in attachment fields for now\n          updateData.attachmentUrl = `/uploads/${req.file.filename}`;\n          updateData.attachmentName = req.file.originalname;\n        }\n      }\n      \n      // Update the record\n      const [updatedRecord] = await db.update(previousOutstandingRecords)\n        .set(updateData)\n        .where(eq(previousOutstandingRecords.id, parseInt(recordId)))\n        .returning();\n      \n      res.json({\n        message: \"Record updated successfully\",\n        record: updatedRecord\n      });\n    } catch (error) {\n      console.error(\"Error updating previous outstanding record:\", error);\n      res.status(500).json({ message: \"Failed to update record\" });\n    }\n  });\n\n  // Get single previous outstanding record\n  app.get(\"/api/previous-outstanding/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      \n      const [record] = await db.select({\n        id: previousOutstandingRecords.id,\n        serialNumber: previousOutstandingRecords.serialNumber,\n        recordNumber: previousOutstandingRecords.recordNumber,\n        userId: previousOutstandingRecords.userId,\n        userName: users.name,\n        description: previousOutstandingRecords.description,\n        outstandingAmount: previousOutstandingRecords.outstandingAmount,\n        attachmentUrl: previousOutstandingRecords.attachmentUrl,\n        attachmentName: previousOutstandingRecords.attachmentName,\n        payments: previousOutstandingRecords.payments,\n        createdAt: previousOutstandingRecords.createdAt,\n        updatedAt: previousOutstandingRecords.updatedAt,\n      })\n        .from(previousOutstandingRecords)\n        .leftJoin(users, eq(previousOutstandingRecords.userId, users.id))\n        .where(eq(previousOutstandingRecords.id, recordId));\n      \n      if (!record) {\n        return res.status(404).json({ message: \"Previous outstanding record not found\" });\n      }\n      \n      // Calculate totals from existing payments array\n      const payments = record.payments || [];\n      const receivedAmount = payments.reduce((sum: number, payment: any) => sum + payment.amount, 0);\n      const pendingAmount = Math.max(0, record.outstandingAmount - receivedAmount);\n      \n      // Determine status\n      let status: 'pending' | 'partial' | 'full' = 'pending';\n      if (receivedAmount >= record.outstandingAmount) {\n        status = 'full';\n      } else if (receivedAmount > 0) {\n        status = 'partial';\n      }\n      \n      const result = {\n        ...record,\n        receivedAmount,\n        pendingAmount,\n        status,\n        payments: payments.sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime())\n      };\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Error fetching previous outstanding record:\", error);\n      res.status(500).json({ message: \"Failed to fetch previous outstanding record\" });\n    }\n  });\n\n\n  // Edit previous outstanding record (admin only)\n  // Get all previous outstanding payments\n  app.get(\"/api/previous-outstanding-payments\", isAuthenticated, isAdminOrOperator, async (req: Request, res: Response) => {\n    try {\n      // Get all previous outstanding records that have payments\n      const records = await db.select().from(previousOutstandingRecords);\n      \n      // Flatten all payments with user details\n      const allPayments: any[] = [];\n      \n      for (const record of records) {\n        if (record.payments && Array.isArray(record.payments)) {\n          record.payments.forEach((payment, paymentIndex) => {\n            allPayments.push({\n              id: `${record.id}-payment-${paymentIndex}`,\n              recordId: record.id,\n              recordNumber: record.recordNumber,\n              userId: record.userId,\n              userName: record.userName,\n              userMobile: record.userMobile,\n              userAddress: record.userAddress,\n              outstandingAmount: record.outstandingAmount,\n              receivedAmount: record.receivedAmount,\n              pendingAmount: record.pendingAmount,\n              status: record.status,\n              paymentDate: payment.date,\n              paymentAmount: payment.amount,\n              paymentMode: payment.mode,\n              receiptNo: payment.receiptNo || 'No Receipt Generated',\n              fileUrl: payment.fileUrl,\n              updatedBy: payment.updatedBy,\n              description: record.description,\n              createdBy: record.createdBy,\n              createdAt: record.createdAt\n            });\n          });\n        }\n      }\n      \n      // Sort by payment date (newest first)\n      allPayments.sort((a, b) => new Date(b.paymentDate).getTime() - new Date(a.paymentDate).getTime());\n      \n      res.json(allPayments);\n    } catch (error) {\n      console.error(\"Error fetching previous outstanding payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch previous outstanding payments\" });\n    }\n  });\n\n  // Generate receipt numbers for payments that don't have them and revise existing ones to new block system\n  app.post(\"/api/previous-outstanding-payments/generate-receipts\", isAuthenticated, isAdminOrOperator, async (req: Request, res: Response) => {\n    try {\n      const records = await db.select().from(previousOutstandingRecords);\n      let updatedCount = 0;\n      let revisedCount = 0;\n      \n      // First pass: collect all existing numbers to understand current state\n      const existingNumbers = new Set<number>();\n      const allPayments: any[] = [];\n      \n      for (const record of records) {\n        if (!record.payments || !Array.isArray(record.payments)) continue;\n        \n        for (const payment of record.payments) {\n          allPayments.push({ recordId: record.id, payment, index: allPayments.length });\n          \n          if (payment.receiptNo) {\n            const match = payment.receiptNo.match(/SPDJMSJ-(\\d{4})-(\\d{5})/);\n            if (match) {\n              const foundNumber = parseInt(match[2], 10);\n              if (!isNaN(foundNumber)) {\n                existingNumbers.add(foundNumber);\n              }\n            }\n          }\n        }\n      }\n      \n      // Get boli payment numbers to avoid conflicts\n      const boliLogs = await db.select()\n        .from(transactionLogs)\n        .where(eq(transactionLogs.transactionType, TransactionType.DEBIT))\n        .orderBy(desc(transactionLogs.id))\n        .limit(200);\n      \n      for (const log of boliLogs) {\n        if (!log.details) continue;\n        \n        const details = typeof log.details === 'string' \n          ? JSON.parse(log.details) \n          : log.details;\n        \n        if (!details.receiptNo) continue;\n        \n        if (typeof details.receiptNo === 'string' && \n            details.receiptNo.startsWith(`AM-2025-`)) {\n          \n          const match = details.receiptNo.match(/AM-\\d{4}-(\\d{5})/);\n          if (match && match[1]) {\n            const foundNumber = parseInt(match[1], 10);\n            if (!isNaN(foundNumber)) {\n              existingNumbers.add(foundNumber);\n            }\n          }\n        }\n      }\n      \n      // Generate new numbers starting from 201 for outstanding payments\n      let nextOutstandingNumber = 201;\n      const getNextValidOutstandingNumber = () => {\n        // Outstanding payment ranges: 201-300, 501-600, 901-1000, etc.\n        const ranges = [\n          { start: 201, end: 300 },\n          { start: 501, end: 600 },\n          { start: 901, end: 1000 },\n          { start: 1301, end: 1400 },\n          { start: 1701, end: 1800 }\n        ];\n        \n        for (const range of ranges) {\n          for (let num = range.start; num <= range.end; num++) {\n            if (!existingNumbers.has(num)) {\n              existingNumbers.add(num);\n              return num;\n            }\n          }\n        }\n        \n        // Fallback to continuing pattern\n        let rangeStart = 2101;\n        while (true) {\n          for (let num = rangeStart; num <= rangeStart + 99; num++) {\n            if (!existingNumbers.has(num)) {\n              existingNumbers.add(num);\n              return num;\n            }\n          }\n          rangeStart += 400;\n        }\n      };\n      \n      // Now update all payments with new sequential numbers\n      const recordUpdates = new Map();\n      \n      for (const { recordId, payment, index } of allPayments) {\n        const year = payment.date.split('-')[0];\n        const newNumber = getNextValidOutstandingNumber();\n        const newReceiptNo = `SPDJMSJ-${year}-${newNumber.toString().padStart(5, '0')}`;\n        \n        if (!recordUpdates.has(recordId)) {\n          const record = records.find(r => r.id === recordId);\n          recordUpdates.set(recordId, [...(record?.payments || [])]);\n        }\n        \n        const payments = recordUpdates.get(recordId);\n        const paymentIndex = payments.findIndex((p: any) => \n          p.date === payment.date && p.amount === payment.amount\n        );\n        \n        if (paymentIndex !== -1) {\n          const wasEmpty = !payments[paymentIndex].receiptNo;\n          payments[paymentIndex] = {\n            ...payments[paymentIndex],\n            receiptNo: newReceiptNo\n          };\n          \n          if (wasEmpty) {\n            updatedCount++;\n          } else {\n            revisedCount++;\n          }\n        }\n      }\n      \n      // Apply all updates to database\n      const recordIds = Array.from(recordUpdates.keys());\n      for (const recordId of recordIds) {\n        const updatedPayments = recordUpdates.get(recordId);\n        await db.update(previousOutstandingRecords)\n          .set({ \n            payments: updatedPayments,\n            updatedAt: new Date().toISOString() \n          })\n          .where(eq(previousOutstandingRecords.id, recordId));\n      }\n      \n      res.json({ \n        message: `Updated ${updatedCount} missing receipt numbers and revised ${revisedCount} existing ones to new block system (starting from 201)`,\n        updatedCount,\n        revisedCount\n      });\n    } catch (error) {\n      console.error(\"Error generating receipt numbers:\", error);\n      res.status(500).json({ message: \"Failed to generate receipt numbers\" });\n    }\n  });\n\n  app.post(\"/api/previous-outstanding\", isAdminOrOperator, upload.single('attachmentFile'), async (req: Request, res: Response) => {\n    try {\n      const { userId, userName, userMobile, userAddress, outstandingAmount, description, createdBy } = req.body;\n      \n      // Debug logging\n      console.log(\"Raw request body:\", req.body);\n      console.log(\"Parsed values:\", { userId, userName, userMobile, userAddress, outstandingAmount, description, createdBy });\n      \n      // Validate required fields\n      const validationData = {\n        userId: parseInt(userId) || 0,\n        userName: userName || '',\n        userMobile: userMobile || '',\n        userAddress: userAddress || '',\n        outstandingAmount: parseInt(outstandingAmount) || 0, // Amount in rupees\n        description: description || 'Previous Outstanding Amount',\n        createdBy: createdBy || 'system'\n      };\n      \n      console.log(\"Validation data:\", validationData);\n\n      const validatedData = insertPreviousOutstandingRecordSchema.parse(validationData);\n\n      // Handle file upload\n      let attachmentUrl = null;\n      let attachmentName = null;\n      \n      if (req.file) {\n        const uploadDir = path.join(process.cwd(), 'uploads');\n        if (!fs.existsSync(uploadDir)) {\n          fs.mkdirSync(uploadDir, { recursive: true });\n        }\n        \n        const filename = `previous-outstanding-${Date.now()}-${req.file.originalname}`;\n        const filepath = path.join(uploadDir, filename);\n        \n        fs.renameSync(req.file.path, filepath);\n        attachmentUrl = `/uploads/${filename}`;\n        attachmentName = req.file.originalname;\n      }\n\n      // Get the next record number\n      const [maxRecord] = await db.select({ maxRecordNumber: max(previousOutstandingRecords.recordNumber) })\n        .from(previousOutstandingRecords);\n      const nextRecordNumber = (maxRecord.maxRecordNumber || 0) + 1;\n\n      // Create record\n      const [record] = await db.insert(previousOutstandingRecords).values({\n        ...validatedData,\n        recordNumber: nextRecordNumber,\n        attachmentUrl,\n        attachmentName\n      }).returning();\n\n      console.log(`Previous outstanding record created: ‚Çπ${validationData.outstandingAmount/100} for user ${validationData.userName} by ${validationData.createdBy}`);\n      res.json(record);\n    } catch (error) {\n      console.error(\"Error creating previous outstanding record:\", error);\n      if (error instanceof ZodError) {\n        const validationError = fromZodError(error);\n        return res.status(400).json({ message: validationError.message });\n      }\n      res.status(500).json({ message: \"Failed to create previous outstanding record\" });\n    }\n  });\n\n  // Record payment for previous outstanding record\n  app.post(\"/api/previous-outstanding/:id/payment\", isAuthenticated, isAdminOrOperator, upload.single('paymentFile'), async (req: Request, res: Response) => {\n    try {\n      const recordId = parseInt(req.params.id);\n      const { amount, date, mode, receiptNo } = req.body;\n      const user = req.user as any;\n\n      // Validate payment data\n      const paymentData = {\n        entryId: recordId,\n        amount: parseInt(amount),\n        date,\n        mode,\n        receiptNo: receiptNo || undefined\n      };\n\n      const validatedPayment = recordPaymentSchema.parse(paymentData);\n\n      // Get the previous outstanding record\n      const [record] = await db.select().from(previousOutstandingRecords)\n        .where(eq(previousOutstandingRecords.id, recordId));\n\n      if (!record) {\n        return res.status(404).json({ message: \"Previous outstanding record not found\" });\n      }\n\n      // Validate file upload for non-cash payments\n      let fileUrl = null;\n      if (req.file) {\n        fileUrl = `/uploads/${req.file.filename}`;\n      }\n      \n      // Require file upload for non-cash payment modes\n      const nonCashModes = ['upi', 'cheque', 'netbanking', 'bank_transfer'];\n      if (nonCashModes.includes(mode.toLowerCase()) && !fileUrl) {\n        return res.status(400).json({ \n          message: \"Payment screenshot/proof is required for UPI, Cheque, NetBanking, and Bank Transfer payments\" \n        });\n      }\n\n      // Generate receipt number if not provided\n      let receiptNumber = validatedPayment.receiptNo;\n      if (!receiptNumber) {\n        receiptNumber = await generatePreviousOutstandingReceiptNumber(validatedPayment.date);\n      }\n\n      // Create payment record\n      const newPayment = {\n        date: validatedPayment.date,\n        amount: validatedPayment.amount,\n        mode: validatedPayment.mode,\n        fileUrl: fileUrl || undefined,\n        receiptNo: receiptNumber,\n        updatedBy: user.username\n      };\n\n      // Update the record with new payment\n      const updatedPayments = [...(record.payments || []), newPayment];\n      const newReceivedAmount = record.receivedAmount + validatedPayment.amount;\n      const newPendingAmount = record.outstandingAmount - newReceivedAmount;\n      \n      // Determine payment status\n      let status: PaymentStatusType;\n      if (newPendingAmount <= 0) {\n        status = PaymentStatus.FULL;\n      } else if (newReceivedAmount > 0) {\n        status = PaymentStatus.PARTIAL;\n      } else {\n        status = PaymentStatus.PENDING;\n      }\n\n      // Update the record\n      await db.update(previousOutstandingRecords)\n        .set({\n          payments: updatedPayments,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: Math.max(0, newPendingAmount),\n          status: status,\n          updatedAt: new Date().toISOString()\n        })\n        .where(eq(previousOutstandingRecords.id, recordId));\n\n      res.json({ \n        message: \"Payment recorded successfully\",\n        payment: newPayment,\n        updatedRecord: {\n          id: recordId,\n          receivedAmount: newReceivedAmount,\n          pendingAmount: Math.max(0, newPendingAmount),\n          status: status\n        }\n      });\n    } catch (error) {\n      console.error(\"Error recording payment:\", error);\n      if (error instanceof ZodError) {\n        const validationError = fromZodError(error);\n        return res.status(400).json({ message: validationError.message });\n      }\n      res.status(500).json({ message: \"Failed to record payment\" });\n    }\n  });\n\n  // Download route for differential Excel files\n  app.get(\"/api/download/:filename\", (req, res) => {\n    try {\n      const filename = req.params.filename;\n      const filepath = path.join(process.cwd(), filename);\n      \n      // Security check - only allow specific files\n      const allowedFiles = [\n        'Address_Differential_Users.xlsx',\n        'Missing_Users_Differential.xlsx',\n        'Address_Mobile_Differential_Users.xlsx',\n        'Duplicate_Mobile_Users_2025-08-09.xlsx'\n      ];\n      \n      if (!allowedFiles.includes(filename)) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      \n      if (!fs.existsSync(filepath)) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      \n      // Set appropriate headers for Excel download\n      res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n      \n      // Stream the file\n      const fileStream = fs.createReadStream(filepath);\n      fileStream.pipe(res);\n      \n    } catch (error) {\n      console.error(\"Error serving download:\", error);\n      res.status(500).json({ message: \"Failed to download file\" });\n    }\n  });\n\n  // Corpus Settings API endpoints (Admin only)\n  app.get(\"/api/corpus-settings\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Only allow admin access\n      if (user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied. Admin role required.\" });\n      }\n      \n      const [settings] = await db.select().from(corpusSettings).limit(1);\n      \n      // Return default values if no settings exist\n      if (!settings) {\n        return res.json({\n          corpusValue: 0,\n          baseDate: \"2025-07-31\",\n          updatedAt: null,\n          updatedBy: null\n        });\n      }\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching corpus settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch corpus settings\" });\n    }\n  });\n\n  app.post(\"/api/corpus-settings\", isAuthenticated, async (req, res) => {\n    try {\n      const user = req.user as any;\n      \n      // Only allow admin access\n      if (user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied. Admin role required.\" });\n      }\n      \n      const validatedData = insertCorpusSettingsSchema.parse({\n        ...req.body,\n        corpusValue: req.body.corpusValue, // Keep as rupees\n        updatedBy: user.username\n      });\n      \n      // Check if settings already exist\n      const [existingSettings] = await db.select().from(corpusSettings).limit(1);\n      \n      let result;\n      if (existingSettings) {\n        // Update existing settings\n        [result] = await db.update(corpusSettings)\n          .set(validatedData)\n          .where(eq(corpusSettings.id, existingSettings.id))\n          .returning();\n      } else {\n        // Create new settings\n        [result] = await db.insert(corpusSettings).values(validatedData).returning();\n      }\n      \n      console.log(`Corpus settings updated by ${user.username}: ‚Çπ${req.body.corpusValue} as of ${validatedData.baseDate}`);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error updating corpus settings:\", error);\n      if (error instanceof ZodError) {\n        return res.status(400).json({ message: fromZodError(error).message });\n      }\n      res.status(500).json({ message: \"Failed to update corpus settings\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":137550},"client/src/pages/user-detail.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { ArrowLeft, User, Wallet, Receipt, DollarSign, TrendingUp, TrendingDown, FileText } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { HindiReceipt } from \"@/components/hindi-receipt\";\nimport { PreviousOutstandingSection } from \"@/components/previous-outstanding-section\";\nimport type { User as UserType, Entry, AdvancePayment, DravyaEntry, PaymentRecord } from \"@shared/schema\";\n\nexport default function UserDetail() {\n  const [, params] = useRoute(\"/users/:id\");\n  const [, myAccountParams] = useRoute(\"/my-account\");\n  const { user: currentUser } = useAuth();\n  \n  // If accessing /my-account, use current user's ID\n  const userId = myAccountParams ? currentUser?.id : (params?.id ? parseInt(params.id) : null);\n  \n  // State for receipt dialog\n  const [selectedReceiptData, setSelectedReceiptData] = useState<{\n    entry: Entry;\n    payment: PaymentRecord;\n    paymentIndex: number;\n  } | null>(null);\n\n\n\n  // Fetch user details\n  const { data: user, isLoading: userLoading } = useQuery<UserType>({\n    queryKey: [`/api/users/${userId}`],\n    enabled: !!userId,\n  });\n\n  // Fetch user's boli entries\n  const { data: entries = [], isLoading: entriesLoading } = useQuery<Entry[]>({\n    queryKey: [`/api/entries?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  // Fetch user's advance payments\n  const { data: advancePayments = [], isLoading: advanceLoading } = useQuery<AdvancePayment[]>({\n    queryKey: [`/api/advance-payments?userId=${userId}`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch to show latest data\n    gcTime: 0, // Don't cache\n  });\n\n  // Fetch user's dravya entries\n  const { data: dravyaEntries = [], isLoading: dravyaLoading } = useQuery<DravyaEntry[]>({\n    queryKey: [`/api/dravya-entries?userId=${userId}`],\n    enabled: !!userId,\n  });\n\n  // Get advance payment balance from server calculation\n  const { data: serverAdvanceBalance = 0 } = useQuery<number>({\n    queryKey: [`/api/users/${userId}/advance-balance`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch\n    gcTime: 0, // Don't cache\n  });\n\n  // Use server-calculated balance as the source of truth\n  const totalAdvancePayments = serverAdvanceBalance;\n\n  // Fetch user's previous outstanding records\n  const { data: previousOutstandingRecords = [] } = useQuery<any[]>({\n    queryKey: [`/api/previous-outstanding?userId=${userId}`],\n    enabled: !!userId,\n    staleTime: 0, // Always refetch to show latest data\n    gcTime: 0, // Don't cache\n  });\n\n  // Calculate totals for previous outstanding records\n  const totalPreviousOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.outstandingAmount || 0),\n    0\n  );\n  \n  const totalReceivedOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.receivedAmount || 0),\n    0\n  );\n  \n  const totalPendingOutstanding = previousOutstandingRecords.reduce(\n    (sum, record) => sum + (record.pendingAmount ?? 0),\n    0\n  );\n\n\n\n  if (!userId) {\n    return <div>Invalid user ID</div>;\n  }\n\n  if (userLoading) {\n    return <div className=\"p-4\">Loading user details...</div>;\n  }\n\n  if (!user) {\n    return <div className=\"p-4\">User not found</div>;\n  }\n\n  // Calculate summary statistics\n  const totalBoliAmount = entries.reduce((sum, entry) => sum + entry.totalAmount, 0);\n  const totalReceived = entries.reduce((sum, entry) => sum + entry.receivedAmount, 0);\n  const totalPending = entries.reduce((sum, entry) => sum + entry.pendingAmount, 0);\n  const totalDravyaEntries = dravyaEntries.length;\n\n  // Get all payments from entries\n  const allPayments = entries.flatMap(entry => {\n    if (entry.payments && Array.isArray(entry.payments)) {\n      return entry.payments.map(payment => ({\n        ...payment,\n        entryId: entry.id,\n        entryDescription: entry.description,\n        entryOccasion: entry.occasion,\n        entryBoliDate: entry.auctionDate,\n        userName: entry.userName,\n      }));\n    }\n    return [];\n  });\n\n  // Get all payments from previous outstanding records\n  const allOutstandingPayments = previousOutstandingRecords.flatMap(record => {\n    if (record.payments && Array.isArray(record.payments)) {\n      return record.payments.map((payment: any) => ({\n        ...payment,\n        recordId: record.id,\n        recordDescription: record.description,\n        recordNumber: record.recordNumber,\n      }));\n    }\n    return [];\n  });\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'full': return 'bg-green-100 text-green-800';\n      case 'partial': return 'bg-yellow-100 text-yellow-800';\n      case 'pending': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'full': return 'Fully Paid';\n      case 'partial': return 'Partially Paid';\n      case 'pending': return 'Pending';\n      default: return status;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-7xl\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        {/* Hide \"Back to Users\" button for viewer role or when viewing own account */}\n        {currentUser?.role !== 'viewer' && !myAccountParams && (\n          <Link href=\"/users\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Users\n            </Button>\n          </Link>\n        )}\n        <div>\n          <h1 className=\"text-2xl font-bold\">{user.name}</h1>\n          <p className=\"text-muted-foreground\">@{user.username}</p>\n          {user.address && (\n            <p className=\"text-sm text-muted-foreground\">üìç {user.address}</p>\n          )}\n          {user.mobile && (\n            <p className=\"text-sm text-muted-foreground\">üì± {user.mobile}</p>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"space-y-4 mb-6\">\n        {/* First Row - Outstanding Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Card className=\"h-32\">\n            <CardHeader className=\"flex flex-row items-start justify-between space-y-0 pb-2 h-16\">\n              <CardTitle className=\"text-sm font-bold leading-tight\">Total Outstanding (Till 31st Jul'25)</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n            </CardHeader>\n            <CardContent className=\"pt-0\">\n              <div className=\"text-2xl font-bold\">‚Çπ{totalPreviousOutstanding.toLocaleString()}</div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"h-32\">\n            <CardHeader className=\"flex flex-row items-start justify-between space-y-0 pb-2 h-16\">\n              <CardTitle className=\"text-sm font-bold leading-tight\">Received Amount against 31st Jul'25 Outstanding</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\n            </CardHeader>\n            <CardContent className=\"pt-0\">\n              <div className=\"text-2xl font-bold text-green-600\">‚Çπ{totalReceivedOutstanding.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {totalPreviousOutstanding > 0 ? Math.round((totalReceivedOutstanding / totalPreviousOutstanding) * 100) : 0}% collected\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"h-32\">\n            <CardHeader className=\"flex flex-row items-start justify-between space-y-0 pb-2 h-16\">\n              <CardTitle className=\"text-sm font-bold leading-tight\">Balance Outstanding (31st Jul'25)</CardTitle>\n              <TrendingDown className=\"h-4 w-4 text-red-600 flex-shrink-0\" />\n            </CardHeader>\n            <CardContent className=\"pt-0\">\n              <div className=\"text-2xl font-bold text-red-600\">‚Çπ{totalPendingOutstanding.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {totalPreviousOutstanding > 0 ? Math.round((totalPendingOutstanding / totalPreviousOutstanding) * 100) : 0}% remaining\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Second Row - Boli Cards */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-bold\">Total Boli Daan</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">‚Çπ{totalBoliAmount.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">{entries.length} entries</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-bold\">Received Amount</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">‚Çπ{totalReceived.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {totalBoliAmount > 0 ? Math.round((totalReceived / totalBoliAmount) * 100) : 0}% collected\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-bold\">Pending Amount</CardTitle>\n              <TrendingDown className=\"h-4 w-4 text-red-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-600\">‚Çπ{totalPending.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {totalBoliAmount > 0 ? Math.round((totalPending / totalBoliAmount) * 100) : 0}% pending\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-bold\">Total Advance Payment Remaining</CardTitle>\n              <Wallet className=\"h-4 w-4 text-blue-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-blue-600\">‚Çπ{totalAdvancePayments.toLocaleString()}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {totalAdvancePayments > 0 ? \"remaining balance\" : \"no balance remaining\"}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Detailed Sections */}\n      <Tabs defaultValue=\"boli-entries\" className=\"w-full\">\n        <TabsList className=\"w-full flex flex-col sm:grid sm:grid-cols-4 gap-1 h-auto\">\n          <TabsTrigger value=\"boli-entries\" className=\"w-full justify-start text-sm px-3 py-2 sm:px-4\">\n            Boli Entries Status\n          </TabsTrigger>\n          <TabsTrigger value=\"payments\" className=\"w-full justify-start text-sm px-3 py-2 sm:px-4\">\n            Payments & Receipts\n          </TabsTrigger>\n          <TabsTrigger value=\"dravya\" className=\"w-full justify-start text-sm px-3 py-2 sm:px-4\">\n            Dravya Daan\n          </TabsTrigger>\n          <TabsTrigger value=\"previous-outstanding\" className=\"w-full justify-start text-sm px-3 py-2 sm:px-4\">\n            Previous Outstanding\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Boli Entries Tab */}\n        <TabsContent value=\"boli-entries\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Boli Entries</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {entriesLoading ? (\n                <div>Loading entries...</div>\n              ) : entries.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No boli entries found for this user.\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table className=\"text-base\">\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"text-base font-semibold\">Boli Date</TableHead>\n                        <TableHead className=\"text-base font-semibold\">Description</TableHead>\n                        <TableHead className=\"text-base font-semibold\">Amount</TableHead>\n                        <TableHead className=\"text-base font-semibold\">Status</TableHead>\n                        <TableHead className=\"text-base font-semibold\">Occasion</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {entries.map((entry) => (\n                        <TableRow key={entry.id}>\n                          <TableCell className=\"text-base font-medium\">{formatDate(entry.auctionDate)}</TableCell>\n                          <TableCell className=\"text-base font-medium\">{entry.description}</TableCell>\n                          <TableCell className=\"text-base\">‚Çπ{entry.totalAmount.toLocaleString()}</TableCell>\n                          <TableCell className=\"text-base\">\n                            <Badge className={`${getStatusColor(entry.status)} text-sm`}>\n                              {getStatusText(entry.status)}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-base\">{entry.occasion}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Payments & Receipts Tab */}\n        <TabsContent value=\"payments\">\n          <div className=\"space-y-6\">\n            {/* Boli Payments */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Boli Entry Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {allPayments.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No payments found for this user.\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Receipt No.</TableHead>\n                          <TableHead>Entry Description</TableHead>\n                          <TableHead>Amount</TableHead>\n                          <TableHead>Mode</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {allPayments.map((payment, index) => (\n                          <TableRow key={`${payment.entryId}-${index}`}>\n                            <TableCell className=\"font-medium\">{payment.receiptNo}</TableCell>\n                            <TableCell>{payment.entryDescription}</TableCell>\n                            <TableCell>‚Çπ{payment.amount.toLocaleString()}</TableCell>\n                            <TableCell>{payment.mode}</TableCell>\n                            <TableCell>{formatDate(payment.date)}</TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  // Find the entry that contains this payment\n                                  const entry = entries.find(e => e.id === payment.entryId);\n                                  if (entry) {\n                                    setSelectedReceiptData({\n                                      entry,\n                                      payment,\n                                      paymentIndex: index\n                                    });\n                                  }\n                                }}\n                              >\n                                <Receipt className=\"h-4 w-4 mr-2\" />\n                                Receipt\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Previous Outstanding Payments */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Previous Outstanding Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {allOutstandingPayments.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No outstanding payments found for this user.\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Receipt No.</TableHead>\n                          <TableHead>Record Description</TableHead>\n                          <TableHead>Amount</TableHead>\n                          <TableHead>Mode</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {allOutstandingPayments.map((payment, index) => (\n                          <TableRow key={`${payment.recordId}-${index}`}>\n                            <TableCell className=\"font-medium\">\n                              {payment.receiptNo || 'N/A'}\n                            </TableCell>\n                            <TableCell>\n                              {payment.recordDescription || 'Previous Outstanding'}\n                              {payment.recordNumber && (\n                                <div className=\"text-xs text-muted-foreground\">\n                                  Record #{payment.recordNumber}\n                                </div>\n                              )}\n                            </TableCell>\n                            <TableCell>‚Çπ{payment.amount.toLocaleString()}</TableCell>\n                            <TableCell>{payment.mode}</TableCell>\n                            <TableCell>{formatDate(payment.date)}</TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                disabled\n                                title=\"Receipt functionality coming soon\"\n                              >\n                                <Receipt className=\"h-4 w-4 mr-2\" />\n                                Receipt\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Advance Payments */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Advance Payments</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {advanceLoading ? (\n                  <div>Loading advance payments...</div>\n                ) : advancePayments.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No advance payments found for this user.\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Receipt No.</TableHead>\n                          <TableHead>Amount</TableHead>\n                          <TableHead>Payment Mode</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Actions</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {advancePayments.map((payment) => (\n                          <TableRow key={payment.id}>\n                            <TableCell className=\"font-medium\">{payment.receiptNo}</TableCell>\n                            <TableCell>‚Çπ{payment.amount.toLocaleString()}</TableCell>\n                            <TableCell>{payment.paymentMode}</TableCell>\n                            <TableCell>{formatDate(payment.date)}</TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                disabled\n                                title=\"Receipt functionality coming soon\"\n                              >\n                                <Receipt className=\"h-4 w-4 mr-2\" />\n                                Receipt\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Dravya Daan Tab */}\n        <TabsContent value=\"dravya\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Dravya Daan Transactions</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {dravyaLoading ? (\n                <div>Loading dravya entries...</div>\n              ) : dravyaEntries.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No dravya daan entries found for this user.\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Description</TableHead>\n                        <TableHead>Occasion</TableHead>\n                        <TableHead>Date</TableHead>\n                        <TableHead>Created By</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {dravyaEntries.map((entry) => (\n                        <TableRow key={entry.id}>\n                          <TableCell className=\"font-medium\">{entry.description}</TableCell>\n                          <TableCell>{entry.occasion}</TableCell>\n                          <TableCell>{formatDate(entry.entryDate)}</TableCell>\n                          <TableCell>{entry.createdBy}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Previous Outstanding Tab */}\n        <TabsContent value=\"previous-outstanding\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Previous Outstanding Records</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Historical outstanding amounts from old system\n              </p>\n            </CardHeader>\n            <CardContent>\n              <PreviousOutstandingSection userId={userId!} />\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Receipt Dialog */}\n      {selectedReceiptData && (\n        <HindiReceipt\n          entry={selectedReceiptData.entry}\n          payment={selectedReceiptData.payment}\n          paymentIndex={selectedReceiptData.paymentIndex}\n          isOpen={!!selectedReceiptData}\n          onClose={() => setSelectedReceiptData(null)}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":25074},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Format a date string to a more readable format\n * @param dateString String date in YYYY-MM-DD format\n * @returns Formatted date string\n */\nexport function formatDate(dateString: string) {\n  try {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  } catch (e) {\n    return dateString;\n  }\n}\n","size_bytes":574},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1230},"client/src/components/payment-receipt.tsx":{"content":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { type Entry, type PaymentRecord } from '@shared/schema';\nimport { formatDate } from '@/lib/utils';\n\ninterface PaymentReceiptProps {\n  entry: Entry;\n  payment: PaymentRecord;\n  onClose: () => void;\n}\n\nexport function PaymentReceipt({ entry, payment, onClose }: PaymentReceiptProps) {\n  const printReceipt = () => {\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n    \n    // Helper functions for Hindi conversion\n    const getPaymentModeHindi = (mode: string): string => {\n      const modeMap: { [key: string]: string } = {\n        'cash': '‡§®‡§ó‡§¶',\n        'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à', \n        'cheque': '‡§ö‡•á‡§ï',\n        'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó',\n        'advance_payment': '‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®'\n      };\n      return modeMap[mode.toLowerCase()] || mode;\n    };\n\n    const formatHindiDate = (dateString: string): string => {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('hi-IN', {\n        day: '2-digit',\n        month: '2-digit', \n        year: '2-digit'\n      });\n    };\n\n    // Add cache breaker for images\n    const cacheBreaker = Date.now();\n\n    const html = `\n      <!DOCTYPE html>\n      <html lang=\"hi\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <title>‡§¨‡•ã‡§≤‡•Ä ‡§∞‡§∏‡•Ä‡§¶: ${payment.receiptNo || '‡§∞‡§∏‡•Ä‡§¶'}</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n            \n            body {\n              font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n              margin: 0;\n              padding: 5px;\n              background-color: #f5f5f5;\n              color: #000;\n              font-size: 14px;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 600px;\n              margin: 0 auto;\n              border: 2px solid #000;\n              border-radius: 8px;\n              padding: 0;\n              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            }\n            \n            .receipt-header {\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              padding: 12px;\n              border-bottom: 3px solid #000;\n              background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n              position: relative;\n            }\n            \n            .left-logo {\n              position: absolute;\n              top: 12px;\n              left: 15px;\n              width: 60px;\n              height: 60px;\n              object-fit: contain;\n            }\n            \n            .center-content {\n              flex-grow: 1;\n              text-align: center;\n              margin: 0 20px;\n            }\n            \n            .temple-name {\n              font-size: 18px;\n              font-weight: 700;\n              margin: 5px 0 3px 0;\n              color: #d97706;\n              text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n            }\n            \n            .temple-subtitle {\n              font-size: 11px;\n              color: #374151;\n              margin: 3px 0;\n              font-weight: 500;\n            }\n            \n            .receipt-title {\n              font-size: 14px;\n              font-weight: 700;\n              color: #1f2937;\n              margin: 8px 0 3px 0;\n              padding: 6px 12px;\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 4px;\n              display: inline-block;\n            }\n            \n            .right-logo {\n              position: absolute;\n              top: 12px;\n              right: 15px;\n              width: 60px;\n              height: 60px;\n              object-fit: contain;\n            }\n            \n            .receipt-body {\n              padding: 10px 15px;\n              flex: 1;\n            }\n            \n            .info-section {\n              margin-bottom: 12px;\n            }\n            \n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n              font-size: 11px;\n            }\n            \n            .left-info, .right-info {\n              flex: 1;\n              color: #333;\n            }\n            \n            .left-info {\n              text-align: left;\n            }\n            \n            .right-info {\n              text-align: right;\n            }\n            \n            .amount-section {\n              background: #f3f4f6;\n              padding: 15px;\n              border: 1px solid #d1d5db;\n              margin: 20px 0;\n              text-align: center;\n            }\n            \n            .amount-hindi {\n              font-size: 18px;\n              font-weight: 700;\n              color: #dc2626;\n            }\n            \n            .signature-area {\n              margin-top: 20px;\n              display: flex;\n              justify-content: space-between;\n              align-items: end;\n            }\n            \n            .signature-box {\n              width: 180px;\n              text-align: center;\n            }\n            \n            .signature-line {\n              border-top: 1px solid #000;\n              padding-top: 6px;\n              margin-top: 30px;\n              font-size: 11px;\n            }\n            \n            @media print {\n              .no-print { display: none; }\n              body { padding: 10px; }\n              .receipt-container { max-width: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt-container\">\n            <!-- Header with logos -->\n            <div class=\"receipt-header\">\n              <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" class=\"left-logo\">\n              \n              <div class=\"center-content\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§¨‡•ã‡§≤‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" class=\"right-logo\">\n            </div>\n            \n            <!-- Receipt body -->\n            <div class=\"receipt-body\">\n              <div class=\"info-section\">\n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${payment.receiptNo || 'N/A'}</div>\n                  <div class=\"right-info\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(payment.date)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä: ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä ${entry.userName}</div>\n                  <div class=\"right-info\">‡§¨‡•ã‡§≤‡•Ä ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(entry.auctionDate)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§™‡§§‡§æ: ${entry.userAddress || '‡§™‡§§‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</div>\n                  <div class=\"right-info\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø: ${getPaymentModeHindi(payment.mode)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§¨‡§æ‡§¨‡§§: ${entry.description}</div>\n                  <div class=\"right-info\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${entry.bediNumber}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞: ${entry.occasion}</div>\n                  <div class=\"right-info\"></div>\n                </div>\n              </div>\n              \n              <!-- Amount section -->\n              <div class=\"amount-section\">\n                <div style=\"margin-bottom: 10px;\">\n                  <strong>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.amount.toLocaleString()}</strong>\n                </div>\n                <div style=\"font-size: 12px; color: #666;\">\n                  ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.totalAmount.toLocaleString()} | \n                  ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${entry.pendingAmount.toLocaleString()}\n                </div>\n              </div>\n              \n              <!-- Signature area -->\n              <div class=\"signature-area\">\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n              </div>\n              \n            </div>\n          </div>\n          \n          <div class=\"no-print\" style=\"text-align: center; margin-top: 20px;\">\n            <button onclick=\"window.print();\" style=\"padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Noto Sans Devanagari', Arial, sans-serif;\">\n              ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n            </button>\n          </div>\n        </body>\n      </html>\n    `;\n    \n    printWindow.document.open();\n    printWindow.document.write(html);\n    printWindow.document.close();\n  };\n\n  return (\n    <div className=\"p-4 bg-white rounded-lg shadow-md\">\n      <h2 className=\"text-xl font-bold mb-4\">Payment Receipt</h2>\n      <p className=\"text-sm text-gray-500 mb-4\">Receipt No: {payment.receiptNo || 'N/A'}</p>\n      \n      <div className=\"grid grid-cols-2 gap-4 mb-4\">\n        <div>\n          <p className=\"text-sm font-semibold\">Name:</p>\n          <p>{entry.userName}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Date:</p>\n          <p>{formatDate(payment.date)}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Amount:</p>\n          <p className=\"font-bold\">‚Çπ{payment.amount.toLocaleString()}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Payment Mode:</p>\n          <p>{payment.mode.toUpperCase()}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Description:</p>\n          <p>{entry.description}</p>\n        </div>\n        <div>\n          <p className=\"text-sm font-semibold\">Occasion:</p>\n          <p>{entry.occasion}</p>\n        </div>\n      </div>\n      \n      <div className=\"flex justify-end gap-2 mt-4\">\n        <Button variant=\"outline\" onClick={onClose}>Close</Button>\n        <Button onClick={printReceipt}>Print Receipt</Button>\n      </div>\n    </div>\n  );\n}\n\nexport default PaymentReceipt;","size_bytes":11111},"local-deployment/client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"local-deployment/client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1877},"DATABASE-RESTORATION-STEPS.md":{"content":"# üóÑÔ∏è Database Restoration Steps for ‡§¶‡§æ‡§®-‡§¶‡§∞‡•ç‡§™‡§£\n\n## Package: `daan-darpan-local-v1.1.tar.gz`\n\nThis updated package includes comprehensive database backup and restore functionality.\n\n## Step-by-Step Restoration Process\n\n### Step 1: Extract and Setup Application\n\n```bash\n# Create directory and extract package\nmkdir -p ~/Desktop/daan-darpan-local\ncd ~/Desktop/daan-darpan-local\ntar -xzf ~/Downloads/daan-darpan-local-v1.1.tar.gz\n\n# Run initial setup\nchmod +x setup.sh scripts/*.sh\n./setup.sh\n```\n\n### Step 2: Configure PostgreSQL Database\n\n```bash\n# Setup PostgreSQL database and user\nsudo -u postgres psql -f setup_database.sql\n\n# Verify database creation\nsudo -u postgres psql -c \"\\l\" | grep daan_darpan\n```\n\n### Step 3: Configure Environment\n\n```bash\n# Edit environment variables\nnano .env\n\n# Ensure these settings match your PostgreSQL:\n# DATABASE_URL=postgresql://daan_user:daan_password@localhost:5432/daan_darpan\n# PGHOST=localhost\n# PGPORT=5432\n# PGUSER=daan_user\n# PGPASSWORD=daan_password\n# PGDATABASE=daan_darpan\n```\n\n### Step 4: Choose Database Setup Method\n\n#### Method A: Fresh Installation with Sample Data\n\n```bash\n# Install dependencies\nnpm install\n\n# Create database schema\nnpm run db:push\n\n# Create sample data for testing\nnpm run sample-data\n```\n\n**Sample Data Includes:**\n- 5 users with different roles (admin, operator, viewer, sample members)\n- Financial records: boli entries, payments, expenses, advance payments\n- Corpus setting: ‚Çπ139,084\n- Complete transaction history\n\n**Login Credentials (Password: admin123):**\n- `admin` - Full administrative access\n- `operator1` - Operator role access  \n- `viewer1` - Read-only access\n- `ramesh_ji` - Sample temple member\n- `sunita_devi` - Sample temple member\n\n#### Method B: Restore from Production Backup\n\n```bash\n# Install dependencies\nnpm install\n\n# Place your backup file\nmkdir -p database-backups\ncp /path/to/your/production-backup.sql.gz database-backups/\n\n# Restore database (this will create schema automatically)\nnpm run restore database-backups/your-backup.sql.gz\n\n# Or restore latest backup\nnpm run restore latest\n```\n\n### Step 5: Start Application\n\n```bash\n# Development mode (recommended for testing)\nnpm run dev\n\n# Production mode\nnpm run build\nnpm start\n```\n\n### Step 6: Access Application\n\nOpen your browser and navigate to:\n- **Local Network:** http://223.190.85.106:5000\n- **Localhost:** http://localhost:5000\n\n## Database Backup Operations\n\n### Create Backup\n\n```bash\n# Create new backup\nnpm run backup\n\n# Backup files stored in database-backups/ directory\n# Format: daan_darpan_backup_YYYYMMDD_HHMMSS.sql.gz\n```\n\n### Restore Backup\n\n```bash\n# Restore specific backup\nnpm run restore database-backups/daan_darpan_backup_20250817_120000.sql.gz\n\n# Restore latest backup\nnpm run restore latest\n```\n\n## Backup File Structure\n\n```\ndatabase-backups/\n‚îú‚îÄ‚îÄ daan_darpan_backup_20250817_120000.sql.gz  # Timestamped backup\n‚îú‚îÄ‚îÄ daan_darpan_backup_20250817_140000.sql.gz  # Another backup\n‚îú‚îÄ‚îÄ latest_backup.sql.gz                       # Symlink to latest\n‚îî‚îÄ‚îÄ restoration-logs/                          # Restore operation logs\n```\n\n## What's Included in Backups\n\n### Core Data Tables\n- **users** - All user accounts and authentication\n- **boli_entries** - Auction/bid entries with payment tracking\n- **boli_payments** - Individual payment records with receipts\n- **advance_payments** - Prepaid amounts from users\n- **expense_entries** - Temple expenses with documentation\n- **dravya_entries** - Spiritual donations (separate system)\n- **previous_outstanding_records** - Historical debt tracking\n\n### Configuration & System\n- **corpus_settings** - Temple capital/corpus amount\n- **receipt_counter** - Auto-incrementing receipt numbers (SPDJMSJ format)\n- **transaction_logs** - Complete audit trail for all operations\n\n### Application Features Preserved\n- Role-based access control (Admin, Operator, Viewer)\n- Hindi receipt generation with proper formatting\n- Payment tracking (pending, partial, full)\n- Advance payment integration\n- Comprehensive dashboard calculations\n- Complete transaction history\n\n## Verification Steps\n\nAfter restoration, verify the application:\n\n1. **Login Test**: Try logging in with admin credentials\n2. **Dashboard Check**: Verify financial calculations are correct\n3. **Data Integrity**: Check sample entries are visible\n4. **Receipt Generation**: Test Hindi receipt creation\n5. **Role Access**: Verify different user roles work properly\n\n## Troubleshooting Common Issues\n\n### 1. Database Connection Error\n```bash\n# Check PostgreSQL status\nsudo systemctl status postgresql\n\n# Verify database exists\nsudo -u postgres psql -l | grep daan_darpan\n\n# Check credentials in .env\ncat .env | grep DATABASE_URL\n```\n\n### 2. Backup/Restore Fails\n```bash\n# Check file permissions\nls -la scripts/\nchmod +x scripts/*.sh\n\n# Verify backup file exists\nls -la database-backups/\n\n# Check PostgreSQL user permissions\nsudo -u postgres psql -c \"\\du\"\n```\n\n### 3. Application Won't Start\n```bash\n# Check if port 5000 is free\nsudo netstat -tlnp | grep :5000\n\n# Kill existing processes\npkill -f \"tsx server/index.ts\"\npkill -f \"node dist/index.js\"\n\n# Check for Node.js errors\nnpm run dev\n```\n\n### 4. Missing Sample Data\n```bash\n# Recreate sample data\nnpm run sample-data\n\n# Or restore from backup\nnpm run restore latest\n```\n\n## Production Deployment Checklist\n\n- [ ] Extract package to production server\n- [ ] Configure PostgreSQL with proper credentials\n- [ ] Update .env with production settings\n- [ ] Restore production backup or create sample data\n- [ ] Test all user roles and functionality\n- [ ] Set up automated daily backups\n- [ ] Configure firewall for port 5000\n- [ ] Set up process monitoring (PM2 recommended)\n- [ ] Backup uploads/ directory separately\n- [ ] Document admin credentials securely\n\n## Automated Backup Setup\n\nFor production, set up automated daily backups:\n\n```bash\n# Add to crontab (run daily at 2 AM)\ncrontab -e\n\n# Add this line:\n0 2 * * * cd /path/to/daan-darpan-local && npm run backup\n\n# Weekly cleanup (keep only 30 days of backups)\n0 3 * * 0 find /path/to/daan-darpan-local/database-backups -name \"*.gz\" -mtime +30 -delete\n```\n\n---\n\n**Updated Package:** `daan-darpan-local-v1.1.tar.gz`  \n**Release Date:** August 17, 2025  \n**Features:** Complete backup/restore system, sample data generation, production-ready deployment","size_bytes":6370},"local-deployment/client/src/pages/advance-payments.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Plus, Search, Calendar, FileText, Eye, Receipt } from \"lucide-react\";\nimport { AdvancePaymentReceipt } from \"@/components/advance-payment-receipt\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\ninterface AdvancePayment {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile?: string;\n  userAddress?: string;\n  date: string;\n  amount: number;\n  paymentMode: string;\n  attachmentUrl?: string;\n  receiptNo?: string;\n  createdBy: string;\n  createdAt: string;\n}\n\nexport default function AdvancePayments() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  \n  // Filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [paymentModeFilter, setPaymentModeFilter] = useState(\"all-modes\");\n  const [startDate, setStartDate] = useState<Date | null>(null);\n  const [endDate, setEndDate] = useState<Date | null>(null);\n  \n  // Receipt modal state\n  const [selectedAdvancePayment, setSelectedAdvancePayment] = useState<AdvancePayment | null>(null);\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\n\n  // Fetch advance payments with date range query params\n  const queryParams = new URLSearchParams();\n  if (startDate) {\n    queryParams.append('startDate', startDate.toISOString().split('T')[0]);\n  }\n  if (endDate) {\n    queryParams.append('endDate', endDate.toISOString().split('T')[0]);\n  }\n\n  const { data: advancePayments, isLoading } = useQuery<AdvancePayment[]>({\n    queryKey: ['/api/advance-payments', queryParams.toString()],\n  });\n\n  // Apply filters\n  const filteredPayments = useMemo(() => {\n    return (advancePayments || []).filter(payment => {\n      const matchesSearch = !searchTerm || \n        payment.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        payment.userMobile?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        payment.createdBy.toLowerCase().includes(searchTerm.toLowerCase());\n      \n      const matchesPaymentMode = !paymentModeFilter || paymentModeFilter === \"all-modes\" || \n        payment.paymentMode?.toLowerCase() === paymentModeFilter.toLowerCase();\n      \n      const paymentDate = new Date(payment.date);\n      const matchesDateRange = (!startDate || paymentDate >= startDate) && \n                              (!endDate || paymentDate <= endDate);\n      \n      return matchesSearch && matchesPaymentMode && matchesDateRange;\n    });\n  }, [advancePayments, searchTerm, paymentModeFilter, startDate, endDate]);\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setPaymentModeFilter(\"all-modes\");\n    setStartDate(null);\n    setEndDate(null);\n  };\n\n  const formatAmount = (amountInRupees: number) => {\n    return amountInRupees.toLocaleString();\n  };\n\n  const getPaymentModeColor = (mode: string) => {\n    switch (mode?.toLowerCase()) {\n      case 'cash': return 'bg-green-100 text-green-800';\n      case 'upi': return 'bg-blue-100 text-blue-800';\n      case 'cheque': return 'bg-yellow-100 text-yellow-800';\n      case 'netbanking': return 'bg-purple-100 text-purple-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-IN');\n  };\n\n  // Calculate totals for filtered data\n  const totalAmount = filteredPayments.reduce((sum, payment) => sum + payment.amount, 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-4\">\n        <div className=\"text-center py-8\">Loading advance payments...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-4 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">All Advance Payments</h1>\n          <p className=\"text-gray-600\">\n            Total: ‚Çπ{formatAmount(totalAmount)} ({filteredPayments.length} payments)\n          </p>\n        </div>\n        {(user?.role === 'admin' || user?.role === 'operator') && (\n          <Button onClick={() => setLocation('/advance-payment-form')}>\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Advance Payment\n          </Button>\n        )}\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Filters</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Search</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Search by user, mobile, or creator\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-8\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Payment Mode</label>\n              <Select value={paymentModeFilter} onValueChange={setPaymentModeFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all-modes\">All Modes</SelectItem>\n                  <SelectItem value=\"cash\">Cash</SelectItem>\n                  <SelectItem value=\"upi\">UPI</SelectItem>\n                  <SelectItem value=\"cheque\">Cheque</SelectItem>\n                  <SelectItem value=\"netbanking\">Net Banking</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">From Date</label>\n              <div className=\"relative\">\n                <Calendar className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400 pointer-events-none z-10\" />\n                <DatePicker\n                  selected={startDate}\n                  onChange={setStartDate}\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"Select start date\"\n                  className=\"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  isClearable\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">To Date</label>\n              <div className=\"relative\">\n                <Calendar className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400 pointer-events-none z-10\" />\n                <DatePicker\n                  selected={endDate}\n                  onChange={setEndDate}\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"Select end date\"\n                  className=\"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  isClearable\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex gap-2 mt-4\">\n            <Button variant=\"outline\" size=\"sm\" onClick={clearFilters}>\n              Clear Filters\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Desktop Table View */}\n      <div className=\"hidden md:block\">\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">User</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Date</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Amount</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Payment Mode</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Receipt No</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Created By</th>\n                    <th className=\"px-4 py-3 text-left text-sm font-medium text-gray-500\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-gray-200\">\n                  {filteredPayments.map((payment) => (\n                    <tr key={payment.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-4 py-3\">\n                        <div>\n                          <div className=\"font-medium text-gray-900\">{payment.userName}</div>\n                          {payment.userMobile && (\n                            <div className=\"text-sm text-gray-500\">{payment.userMobile}</div>\n                          )}\n                        </div>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {formatDate(payment.date)}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm font-semibold text-gray-900\">\n                        ‚Çπ{formatAmount(payment.amount)}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <Badge className={getPaymentModeColor(payment.paymentMode)}>\n                          {payment.paymentMode?.toUpperCase() || 'UNKNOWN'}\n                        </Badge>\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {payment.receiptNo || 'N/A'}\n                      </td>\n                      <td className=\"px-4 py-3 text-sm text-gray-900\">\n                        {payment.createdBy}\n                      </td>\n                      <td className=\"px-4 py-3\">\n                        <div className=\"flex gap-2\">\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\"\n                            onClick={() => {\n                              setSelectedAdvancePayment(payment);\n                              setIsReceiptOpen(true);\n                            }}\n                          >\n                            <Receipt className=\"h-4 w-4 mr-1\" />\n                            Receipt\n                          </Button>\n                          {payment.attachmentUrl && (\n                            <Dialog>\n                              <DialogTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\">\n                                  <Eye className=\"h-4 w-4 mr-1\" />\n                                  View\n                                </Button>\n                              </DialogTrigger>\n                              <DialogContent className=\"max-w-4xl\">\n                                <DialogHeader>\n                                  <DialogTitle>Payment Screenshot - {payment.userName}</DialogTitle>\n                                </DialogHeader>\n                                <div className=\"mt-4\">\n                                  {payment.attachmentUrl.toLowerCase().endsWith('.pdf') ? (\n                                    <div className=\"text-center\">\n                                      <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n                                      <p className=\"text-gray-600 mb-4\">PDF Document</p>\n                                      <Button asChild>\n                                        <a href={payment.attachmentUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                                          Open PDF\n                                        </a>\n                                      </Button>\n                                    </div>\n                                  ) : (\n                                    <img \n                                      src={payment.attachmentUrl} \n                                      alt=\"Payment Screenshot\"\n                                      className=\"w-full h-auto max-h-96 object-contain mx-auto\"\n                                    />\n                                  )}\n                                </div>\n                              </DialogContent>\n                            </Dialog>\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Mobile Card View */}\n      <div className=\"md:hidden space-y-4\">\n        {filteredPayments.map((payment) => (\n          <Card key={payment.id}>\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <h3 className=\"font-semibold text-gray-900\">{payment.userName}</h3>\n                    {payment.userMobile && (\n                      <p className=\"text-sm text-gray-500\">{payment.userMobile}</p>\n                    )}\n                  </div>\n                  <Badge className={getPaymentModeColor(payment.paymentMode)}>\n                    {payment.paymentMode?.toUpperCase() || 'UNKNOWN'}\n                  </Badge>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-gray-500\">Date:</span>\n                    <br />\n                    <span className=\"font-medium\">{formatDate(payment.date)}</span>\n                  </div>\n                  <div>\n                    <span className=\"text-gray-500\">Amount:</span>\n                    <br />\n                    <span className=\"font-semibold text-lg\">‚Çπ{formatAmount(payment.amount)}</span>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"text-sm\">\n                    <span className=\"text-gray-500\">Receipt No:</span>\n                    <br />\n                    <span className=\"font-medium\">{payment.receiptNo || 'N/A'}</span>\n                  </div>\n                  <div className=\"text-sm\">\n                    <span className=\"text-gray-500\">Created by:</span>\n                    <br />\n                    <span className=\"font-medium\">{payment.createdBy}</span>\n                  </div>\n                </div>\n                \n                <div className=\"flex gap-2 mt-3\">\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => {\n                      setSelectedAdvancePayment(payment);\n                      setIsReceiptOpen(true);\n                    }}\n                  >\n                    <Receipt className=\"h-4 w-4 mr-1\" />\n                    Receipt\n                  </Button>\n                  {payment.attachmentUrl && (\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Eye className=\"h-4 w-4 mr-1\" />\n                          View\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"max-w-4xl\">\n                        <DialogHeader>\n                          <DialogTitle>Payment Screenshot - {payment.userName}</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"mt-4\">\n                          {payment.attachmentUrl.toLowerCase().endsWith('.pdf') ? (\n                            <div className=\"text-center\">\n                              <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-2\" />\n                              <p className=\"text-gray-600 mb-4\">PDF Document</p>\n                              <Button asChild>\n                                <a href={payment.attachmentUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                                  Open PDF\n                                </a>\n                              </Button>\n                            </div>\n                          ) : (\n                            <img \n                              src={payment.attachmentUrl} \n                              alt=\"Payment Screenshot\"\n                              className=\"w-full h-auto max-h-96 object-contain mx-auto\"\n                            />\n                          )}\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {filteredPayments.length === 0 && (\n        <div className=\"text-center py-8\">\n          <p className=\"text-gray-500\">No advance payments found.</p>\n        </div>\n      )}\n      \n      {/* Receipt Modal */}\n      {selectedAdvancePayment && (\n        <AdvancePaymentReceipt\n          advancePayment={selectedAdvancePayment}\n          isOpen={isReceiptOpen}\n          onClose={() => {\n            setIsReceiptOpen(false);\n            setSelectedAdvancePayment(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":18020},"server/index.js":{"content":"import express from \"express\";\nimport { registerRoutes } from \"./routes.js\";\nimport { setupVite, serveStatic, log } from \"./vite.js\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err, _req, res, _next) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // Serve the app on configurable port\n  // Use 5000 for Replit development, 8484 for deployment\n  const defaultPort = app.get(\"env\") === \"development\" ? \"5000\" : \"8484\";\n  const port = parseInt(process.env.PORT || defaultPort);\n  const host = process.env.HOST || \"0.0.0.0\";\n  \n  server.listen({\n    port,\n    host,\n    reusePort: true,\n  }, () => {\n    log(`serving on host ${host} port ${port}`);\n  });\n})();","size_bytes":1939},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json({ limit: '1mb' }));\napp.use(express.urlencoded({ extended: false, limit: '1mb' }));\n\n// Add cache control headers to prevent stale cached data\napp.use((req, res, next) => {\n  // Prevent caching for API routes and HTML pages\n  if (req.path.startsWith('/api') || req.path === '/' || req.path.endsWith('.html')) {\n    res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, private');\n    res.setHeader('Pragma', 'no-cache');\n    res.setHeader('Expires', '0');\n  }\n  // Allow caching for static assets like CSS, JS, images\n  else if (req.path.match(/\\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$/)) {\n    res.setHeader('Cache-Control', 'public, max-age=3600'); // Cache for 1 hour\n  }\n  next();\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // Serve the app on configurable port\n  // Use 5000 for Replit development, 8484 for deployment\n  const defaultPort = app.get(\"env\") === \"development\" ? \"5000\" : \"8484\";\n  const port = parseInt(process.env.PORT || defaultPort);\n  const host = process.env.HOST || \"0.0.0.0\";\n  \n  server.listen({\n    port,\n    host,\n    reusePort: true,\n  }, () => {\n    log(`serving on host ${host} port ${port}`);\n  });\n})();\n","size_bytes":2712},"client/src/lib/excel-export.ts":{"content":"import { utils, writeFile } from \"xlsx\";\n\n// Common Excel export utility function\nexport function exportToExcel<T>(data: T[], filename: string, sheetName: string = \"Data\") {\n  if (!data || data.length === 0) {\n    alert(\"No data to export\");\n    return;\n  }\n\n  try {\n    const workbook = utils.book_new();\n    const worksheet = utils.json_to_sheet(data);\n    utils.book_append_sheet(workbook, worksheet, sheetName);\n    \n    const timestamp = new Date().toISOString().split('T')[0];\n    const fullFilename = `${filename}_${timestamp}.xlsx`;\n    \n    writeFile(workbook, fullFilename);\n  } catch (error) {\n    console.error(\"Error exporting to Excel:\", error);\n    alert(\"Failed to export data to Excel\");\n  }\n}\n\n// Format data for export by removing unnecessary fields and flattening objects\nexport function formatDataForExport<T extends Record<string, any>>(\n  data: T[], \n  fieldsToExclude: string[] = []\n): Record<string, any>[] {\n  return data.map(item => {\n    const formatted: Record<string, any> = {};\n    \n    Object.entries(item).forEach(([key, value]) => {\n      if (!fieldsToExclude.includes(key)) {\n        // Handle nested objects by flattening them\n        if (value && typeof value === 'object' && !Array.isArray(value) && !(value instanceof Date)) {\n          Object.entries(value).forEach(([nestedKey, nestedValue]) => {\n            formatted[`${key}_${nestedKey}`] = nestedValue;\n          });\n        } else {\n          formatted[key] = value;\n        }\n      }\n    });\n    \n    return formatted;\n  });\n}\n\n// Specific export functions for different data types\nexport function exportBoliEntries(entries: any[]) {\n  const formattedData = formatDataForExport(entries, ['payments']);\n  exportToExcel(formattedData, \"Boli_Entries\", \"Boli Entries\");\n}\n\nexport function exportUsers(users: any[]) {\n  const formattedData = formatDataForExport(users, ['password']);\n  exportToExcel(formattedData, \"Users\", \"Users\");\n}\n\nexport function exportAdvancePayments(payments: any[]) {\n  const formattedData = formatDataForExport(payments);\n  exportToExcel(formattedData, \"Advance_Payments\", \"Advance Payments\");\n}\n\nexport function exportDravyaEntries(entries: any[]) {\n  const formattedData = formatDataForExport(entries);\n  exportToExcel(formattedData, \"Dravya_Entries\", \"Dravya Entries\");\n}\n\nexport function exportExpenseEntries(expenses: any[]) {\n  const formattedData = formatDataForExport(expenses);\n  exportToExcel(formattedData, \"Expense_Entries\", \"Expense Entries\");\n}\n\nexport function exportPreviousOutstanding(records: any[]) {\n  const formattedData = formatDataForExport(records, ['payments']);\n  exportToExcel(formattedData, \"Previous_Outstanding\", \"Previous Outstanding\");\n}\n\nexport function exportBoliPayments(payments: any[]) {\n  const formattedData = formatDataForExport(payments);\n  exportToExcel(formattedData, \"Boli_Payments\", \"Boli Payments\");\n}","size_bytes":2866},"local-deployment/client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n      onError: (error: any) => {\n        // Handle authentication errors globally\n        if (error?.message?.includes('401')) {\n          queryClient.setQueryData(['/api/auth/user'], null);\n        }\n      },\n    },\n  },\n});\n","size_bytes":1586},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"local-deployment/client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5046},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"client/src/components/outstanding-payment-receipt.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Printer } from \"lucide-react\";\nimport { formatDate } from \"@/lib/utils\";\n\ninterface PreviousOutstandingRecord {\n  id: number;\n  userId: number;\n  userName: string;\n  userMobile: string;\n  userAddress: string;\n  outstandingAmount: number;\n  receivedAmount: number;\n  pendingAmount: number;\n  status: 'pending' | 'partial' | 'full';\n  payments: PaymentRecord[];\n  description: string;\n  createdBy: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface PaymentRecord {\n  date: string;\n  amount: number;\n  mode: string;\n  fileUrl?: string;\n  receiptNo?: string;\n  updatedBy?: string;\n}\n\ninterface OutstandingPaymentReceiptProps {\n  record: PreviousOutstandingRecord;\n  payment: PaymentRecord;\n  onClose: () => void;\n}\n\n// Editable receipt fields\ninterface ReceiptFields {\n  dharmanuyayi: string;\n  address: string;\n  description: string;\n  occasion: string;\n  bediNumber: string;\n}\n\nconst RECEIPT_FIELDS_KEY = 'outstanding_receipt_fields';\n\nexport function OutstandingPaymentReceipt({ record, payment, onClose }: OutstandingPaymentReceiptProps) {\n  // Receipt fields state\n  const [receiptFields, setReceiptFields] = useState<ReceiptFields>({\n    dharmanuyayi: record.userName || '',\n    address: record.userAddress || '',\n    description: record.description || '',\n    occasion: '',\n    bediNumber: '1',\n  });\n\n  // Load saved values on component mount\n  useEffect(() => {\n    const saved = localStorage.getItem(RECEIPT_FIELDS_KEY);\n    if (saved) {\n      try {\n        const savedFields = JSON.parse(saved);\n        // Only use saved values for empty fields, don't overwrite data from record\n        setReceiptFields(prev => ({\n          ...prev,\n          occasion: savedFields.occasion || '',\n          bediNumber: savedFields.bediNumber || '1'\n        }));\n      } catch (error) {\n        console.error('Error loading saved fields:', error);\n      }\n    }\n  }, []);\n\n  // Save fields to localStorage\n  const handleSaveFields = () => {\n    localStorage.setItem(RECEIPT_FIELDS_KEY, JSON.stringify(receiptFields));\n    alert('‡§´‡•Ä‡§≤‡•ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•á ‡§ó‡§è!');\n  };\n\n  // Helper functions for Hindi conversion - exactly from boli receipt\n  const getPaymentModeHindi = (mode: string): string => {\n    const modeMap: { [key: string]: string } = {\n      'cash': '‡§®‡§ó‡§¶',\n      'upi': '‡§Ø‡•Ç‡§™‡•Ä‡§Ü‡§à', \n      'cheque': '‡§ö‡•á‡§ï',\n      'netbanking': '‡§®‡•á‡§ü ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó',\n      'advance_payment': '‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®'\n    };\n    return modeMap[mode.toLowerCase()] || mode;\n  };\n\n  const formatHindiDate = (dateString: string): string => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('hi-IN', {\n      day: '2-digit',\n      month: '2-digit', \n      year: '2-digit'\n    });\n  };\n\n  const printReceipt = () => {\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n    \n    // Add cache breaker for images - exactly from boli receipt\n    const cacheBreaker = Date.now();\n\n    const html = `\n      <!DOCTYPE html>\n      <html lang=\"hi\">\n        <head>\n          <meta charset=\"UTF-8\">\n          <title>‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶: ${payment.receiptNo || '‡§∞‡§∏‡•Ä‡§¶'}</title>\n          <style>\n            @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&display=swap');\n            \n            body {\n              font-family: 'Noto Sans Devanagari', 'Arial', sans-serif;\n              margin: 0;\n              padding: 5px;\n              background-color: #f5f5f5;\n              color: #000;\n              font-size: 14px;\n              line-height: 1.4;\n            }\n            \n            .receipt-container {\n              max-width: 600px;\n              margin: 0 auto;\n              border: 2px solid #000;\n              border-radius: 8px;\n              padding: 0;\n              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            }\n            \n            .receipt-header {\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              padding: 12px;\n              border-bottom: 3px solid #000;\n              background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n              position: relative;\n            }\n            \n            .left-logo {\n              position: absolute;\n              top: 12px;\n              left: 15px;\n              width: 60px;\n              height: 60px;\n              object-fit: contain;\n            }\n            \n            .center-content {\n              flex-grow: 1;\n              text-align: center;\n              margin: 0 20px;\n            }\n            \n            .temple-name {\n              font-size: 18px;\n              font-weight: 700;\n              margin: 5px 0 3px 0;\n              color: #d97706;\n              text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n            }\n            \n            .temple-subtitle {\n              font-size: 11px;\n              color: #374151;\n              margin: 3px 0;\n              font-weight: 500;\n            }\n            \n            .receipt-title {\n              font-size: 14px;\n              font-weight: 700;\n              color: #1f2937;\n              margin: 8px 0 3px 0;\n              padding: 6px 12px;\n              background: #fef3c7;\n              border: 1px solid #f59e0b;\n              border-radius: 4px;\n              display: inline-block;\n            }\n            \n            .right-logo {\n              position: absolute;\n              top: 12px;\n              right: 15px;\n              width: 60px;\n              height: 60px;\n              object-fit: contain;\n            }\n            \n            .receipt-body {\n              padding: 10px 15px;\n              flex: 1;\n            }\n            \n            .info-section {\n              margin-bottom: 12px;\n            }\n            \n            .info-row {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 6px;\n              font-size: 11px;\n            }\n            \n            .left-info, .right-info {\n              flex: 1;\n              color: #333;\n            }\n            \n            .left-info {\n              text-align: left;\n            }\n            \n            .right-info {\n              text-align: right;\n            }\n            \n            .amount-section {\n              background: #f3f4f6;\n              padding: 15px;\n              border: 1px solid #d1d5db;\n              margin: 20px 0;\n              text-align: center;\n            }\n            \n            .amount-hindi {\n              font-size: 18px;\n              font-weight: 700;\n              color: #dc2626;\n            }\n            \n            .signature-area {\n              margin-top: 20px;\n              display: flex;\n              justify-content: space-between;\n              align-items: end;\n            }\n            \n            .signature-box {\n              width: 180px;\n              text-align: center;\n            }\n            \n            .signature-line {\n              border-top: 1px solid #000;\n              padding-top: 6px;\n              margin-top: 30px;\n              font-size: 11px;\n            }\n            \n            @media print {\n              .no-print { display: none; }\n              body { padding: 10px; }\n              .receipt-container { max-width: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt-container\">\n            <!-- Header with logos - exactly from boli receipt -->\n            <div class=\"receipt-header\">\n              <img src=\"/uploads/jain-stabh-logo.jpg?v=${cacheBreaker}\" alt=\"‡§ú‡•à‡§® ‡§∏‡•ç‡§§‡§Ç‡§≠\" class=\"left-logo\">\n              \n              <div class=\"center-content\">\n                <div class=\"temple-name\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</div>\n                <div class=\"temple-subtitle\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</div>\n                <div class=\"receipt-title\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</div>\n              </div>\n              \n              <img src=\"/uploads/new-logo-mandir-color.jpg?v=${cacheBreaker}\" alt=\"‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§≤‡•ã‡§ó‡•ã\" class=\"right-logo\">\n            </div>\n            \n            <!-- Receipt body - exactly same structure as boli receipt -->\n            <div class=\"receipt-body\">\n              <div class=\"info-section\">\n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${payment.receiptNo || 'N/A'}</div>\n                  <div class=\"right-info\">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(payment.date)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä: ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä ${receiptFields.dharmanuyayi}</div>\n                  <div class=\"right-info\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${formatHindiDate(payment.date)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§™‡§§‡§æ: ${receiptFields.address || '‡§™‡§§‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</div>\n                  <div class=\"right-info\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø: ${getPaymentModeHindi(payment.mode)}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§¨‡§æ‡§¨‡§§: ${receiptFields.description}</div>\n                  <div class=\"right-info\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: ${receiptFields.bediNumber}</div>\n                </div>\n                \n                <div class=\"info-row\">\n                  <div class=\"left-info\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞: ${receiptFields.occasion}</div>\n                  <div class=\"right-info\"></div>\n                </div>\n              </div>\n              \n              <!-- Amount section - exactly from boli receipt -->\n              <div class=\"amount-section\">\n                <div style=\"margin-bottom: 10px;\">\n                  <strong>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${payment.amount.toLocaleString()}</strong>\n                </div>\n                <div style=\"font-size: 12px; color: #666;\">\n                  ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${record.outstandingAmount.toLocaleString()} | \n                  ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${record.pendingAmount.toLocaleString()}\n                </div>\n              </div>\n              \n              <!-- Signature area - exactly from boli receipt -->\n              <div class=\"signature-area\">\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n                <div class=\"signature-box\">\n                  <div class=\"signature-line\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n                </div>\n              </div>\n              \n            </div>\n          </div>\n          \n          <div class=\"no-print\" style=\"text-align: center; margin-top: 20px;\">\n            <button onclick=\"window.print();\" style=\"padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: 'Noto Sans Devanagari', Arial, sans-serif;\">\n              ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n            </button>\n          </div>\n        </body>\n      </html>\n    `;\n    \n    printWindow.document.open();\n    printWindow.document.write(html);\n    printWindow.document.close();\n  };\n\n  return (\n    <Dialog open={true} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶ - Preview & Edit</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Editable Fields Preview */}\n          <div className=\"bg-blue-50 p-4 rounded-lg\">\n            <h3 className=\"font-semibold mb-3\">‡§∞‡§∏‡•Ä‡§¶ ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ (‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç)</h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"dharmanuyayi\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä</Label>\n                <Input\n                  id=\"dharmanuyayi\"\n                  value={receiptFields.dharmanuyayi}\n                  onChange={(e) => setReceiptFields({...receiptFields, dharmanuyayi: e.target.value})}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"address\">‡§™‡§§‡§æ</Label>\n                <Input\n                  id=\"address\"\n                  value={receiptFields.address}\n                  onChange={(e) => setReceiptFields({...receiptFields, address: e.target.value})}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"description\">‡§¨‡§æ‡§¨‡§§</Label>\n                <Input\n                  id=\"description\"\n                  value={receiptFields.description}\n                  onChange={(e) => setReceiptFields({...receiptFields, description: e.target.value})}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"occasion\">‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞</Label>\n                <Input\n                  id=\"occasion\"\n                  value={receiptFields.occasion}\n                  onChange={(e) => setReceiptFields({...receiptFields, occasion: e.target.value})}\n                  placeholder=\"‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"bediNumber\">‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</Label>\n                <Input\n                  id=\"bediNumber\"\n                  value={receiptFields.bediNumber}\n                  onChange={(e) => setReceiptFields({...receiptFields, bediNumber: e.target.value})}\n                />\n              </div>\n            </div>\n            \n            <div className=\"flex gap-2 mt-4\">\n              <Button onClick={handleSaveFields} variant=\"outline\">\n                ‡§´‡•Ä‡§≤‡•ç‡§°‡•ç‡§∏ ‡§∏‡§π‡•á‡§ú‡•á‡§Ç\n              </Button>\n            </div>\n          </div>\n\n          {/* Receipt Preview - matching boli receipt exactly */}\n          <div className=\"border rounded-lg p-4 bg-white\">\n            <div className=\"text-center mb-4\">\n              <div className=\"flex items-center justify-center gap-4 mb-2\">\n                <div className=\"w-12 h-12 bg-gray-200 rounded\"></div>\n                <div>\n                  <h1 className=\"text-lg font-bold text-orange-600\">‡§∂‡•ç‡§∞‡•Ä ‡§™‡§æ‡§∞‡•ç‡§∂‡•ç‡§µ‡§®‡§æ‡§• ‡§¶‡§ø‡§ó‡§Æ‡•ç‡§¨‡§∞ ‡§ú‡•à‡§® ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§∏‡§Æ‡§ø‡§§‡§ø</h1>\n                  <p className=\"text-xs text-gray-600\">‡§∂‡§ø‡§µ‡§®‡§ó‡§∞, ‡§ú‡§¨‡§≤‡§™‡•Å‡§∞ (‡§Æ.‡§™‡•ç‡§∞.)</p>\n                </div>\n                <div className=\"w-12 h-12 bg-gray-200 rounded\"></div>\n              </div>\n              <h2 className=\"text-sm font-semibold bg-yellow-100 border border-yellow-400 rounded px-3 py-1 inline-block\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§∏‡•Ä‡§¶</h2>\n            </div>\n\n            <div className=\"space-y-2 text-xs\">\n              <div className=\"flex justify-between\">\n                <span>‡§Ö‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: {payment.receiptNo || 'N/A'}</span>\n                <span>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: {formatHindiDate(payment.date)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä: ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä {receiptFields.dharmanuyayi}</span>\n                <span>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: {formatHindiDate(payment.date)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>‡§™‡§§‡§æ: {receiptFields.address || '‡§™‡§§‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç'}</span>\n                <span>‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ß‡§ø: {getPaymentModeHindi(payment.mode)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>‡§¨‡§æ‡§¨‡§§: {receiptFields.description}</span>\n                <span>‡§¨‡•á‡§¶‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï: {receiptFields.bediNumber}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Ö‡§µ‡§∏‡§∞: {receiptFields.occasion}</span>\n                <span></span>\n              </div>\n            </div>\n\n            <div className=\"bg-gray-100 p-4 my-4 text-center border\">\n              <div className=\"font-bold mb-2\">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∞‡§æ‡§∂‡§ø: ‚Çπ{payment.amount.toLocaleString()}</div>\n              <div className=\"text-xs text-gray-600\">\n                ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ{record.outstandingAmount.toLocaleString()} | \n                ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ{record.pendingAmount.toLocaleString()}\n              </div>\n            </div>\n\n            <div className=\"flex justify-between mt-6\">\n              <div className=\"text-center w-40\">\n                <div className=\"border-t border-black mt-8 pt-1 text-xs\">‡§ß‡§∞‡•ç‡§Æ‡§æ‡§®‡•Å‡§Ø‡§æ‡§Ø‡•Ä ‡§ï‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n              </div>\n              <div className=\"text-center w-40\">\n                <div className=\"border-t border-black mt-8 pt-1 text-xs\">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞</div>\n              </div>\n            </div>\n\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex justify-end gap-2\">\n            <Button variant=\"outline\" onClick={onClose}>\n              ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç\n            </Button>\n            <Button onClick={printReceipt} className=\"bg-red-600 hover:bg-red-700\">\n              <Printer className=\"h-4 w-4 mr-2\" />\n              ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":18390},"server/analyze-excel.ts":{"content":"import XLSX from 'xlsx';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ninterface ExcelUser {\n  name: string;\n  username: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\ninterface DatabaseUser {\n  id: number;\n  serialNumber: number;\n  username: string;\n  name: string;\n  email: string;\n  mobile: string;\n  address: string;\n  role: string;\n  status: string;\n}\n\nasync function analyzeExcelFile() {\n  try {\n    // Read Excel file\n    console.log('Reading Excel file...');\n    const filePath = path.join(process.cwd(), '..', 'attached_assets', 'Shivnagar Worksheet_1754753646977.xlsx');\n    const workbook = XLSX.readFile(filePath);\n    const sheetName = workbook.SheetNames[0];\n    const worksheet = workbook.Sheets[sheetName];\n    \n    // Convert to JSON\n    const excelData: any[] = XLSX.utils.sheet_to_json(worksheet);\n    console.log(`Found ${excelData.length} rows in Excel file`);\n\n    // Get all users from database\n    console.log('Fetching users from database...');\n    const dbUsers: DatabaseUser[] = await db.select().from(users);\n    console.log(`Found ${dbUsers.length} users in database`);\n\n    // Normalize and compare data\n    const missingUsers: ExcelUser[] = [];\n    \n    for (const excelRow of excelData) {\n      // Normalize Excel row data\n      const excelUser: ExcelUser = {\n        name: String(excelRow.Name || excelRow.name || '').trim(),\n        username: String(excelRow.Username || excelRow.username || '').trim(),\n        email: String(excelRow.Email || excelRow.email || '').trim().toLowerCase(),\n        mobile: String(excelRow.Mobile || excelRow.mobile || excelRow.phone || '').trim(),\n        address: String(excelRow.Address || excelRow.address || '').trim(),\n        role: String(excelRow.Role || excelRow.role || 'viewer').trim().toLowerCase(),\n        status: String(excelRow.Status || excelRow.status || 'active').trim().toLowerCase()\n      };\n\n      // Skip empty rows\n      if (!excelUser.name && !excelUser.username && !excelUser.email) {\n        continue;\n      }\n\n      // Check if this user's address exists in database\n      const addressExistsInDb = dbUsers.some(dbUser => {\n        // Compare only address field (case-insensitive)\n        const addressMatch = dbUser.address.toLowerCase().trim() === excelUser.address.toLowerCase();\n        return addressMatch;\n      });\n\n      // Check if this user's mobile exists in database\n      const mobileExistsInDb = dbUsers.some(dbUser => {\n        // Compare only mobile field (exact match)\n        const mobileMatch = dbUser.mobile.trim() === excelUser.mobile.trim();\n        return mobileMatch;\n      });\n\n      // Only include users where BOTH address and mobile are new (not found in database)\n      if (!addressExistsInDb && !mobileExistsInDb) {\n        missingUsers.push(excelUser);\n      }\n    }\n\n    console.log(`Found ${missingUsers.length} users with new addresses AND new mobiles`);\n\n    // Create differential Excel file\n    if (missingUsers.length > 0) {\n      const newWorkbook = XLSX.utils.book_new();\n      const newWorksheet = XLSX.utils.json_to_sheet(missingUsers);\n      XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, 'New Address & Mobile Users');\n      \n      const outputPath = path.join(process.cwd(), 'Address_Mobile_Differential_Users.xlsx');\n      XLSX.writeFile(newWorkbook, outputPath);\n      console.log(`Address and mobile differential Excel file created: ${outputPath}`);\n    }\n\n    // Return summary\n    return {\n      totalExcelRows: excelData.length,\n      totalDbUsers: dbUsers.length,\n      missingUsersCount: missingUsers.length,\n      missingUsers: missingUsers,\n      outputFile: missingUsers.length > 0 ? 'Address_Mobile_Differential_Users.xlsx' : null\n    };\n\n  } catch (error) {\n    console.error('Error analyzing Excel file:', error);\n    throw error;\n  }\n}\n\n// Run the analysis\nanalyzeExcelFile()\n  .then(result => {\n    console.log('\\n=== ANALYSIS COMPLETE ===');\n    console.log(`Total rows in Excel: ${result.totalExcelRows}`);\n    console.log(`Total users in database: ${result.totalDbUsers}`);\n    console.log(`Users with new addresses AND mobiles: ${result.missingUsersCount}`);\n    if (result.outputFile) {\n      console.log(`Address and mobile differential file created: ${result.outputFile}`);\n    } else {\n      console.log('No new addresses and mobiles found - all Excel data exists in database');\n    }\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Analysis failed:', error);\n    process.exit(1);\n  });","size_bytes":4603},"local-deployment/client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"local-deployment/client/src/pages/logs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { TransactionType, type TransactionLog } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\n\n// Define interface for the transaction log with details typed\ninterface EnhancedTransactionLog extends TransactionLog {\n  details: Record<string, any>;\n}\nimport DatePicker from \"react-datepicker\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\n// Helper function to format dates from ISO string to readable format\nconst formatDate = (isoString: string) => {\n  if (!isoString) return \"N/A\";\n  const date = new Date(isoString);\n  return date.toLocaleDateString();\n};\n\nexport default function TransactionLogs() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateRange, setDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [filterByType, setFilterByType] = useState(\"\");\n  \n  // Fetch all transaction logs\n  const { data: logs, isLoading } = useQuery<EnhancedTransactionLog[]>({\n    queryKey: ['/api/transaction-logs'],\n    // Only enable this query for admins\n    enabled: user?.role === 'admin',\n  });\n  \n  // Apply filters\n  const filteredLogs = logs?.filter(log => {\n    // Search filter (case insensitive)\n    const searchMatches = !searchQuery || \n      log.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      log.username?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    // Date range filter\n    let dateMatches = true;\n    if (dateRange[0] || dateRange[1]) {\n      const logDate = new Date(log.date);\n      \n      if (dateRange[0]) {\n        // Start date is set, check if log date is on or after it\n        const startDate = new Date(dateRange[0]);\n        startDate.setHours(0, 0, 0, 0);\n        if (logDate < startDate) {\n          dateMatches = false;\n        }\n      }\n      \n      if (dateRange[1]) {\n        // End date is set, check if log date is on or before it\n        const endDate = new Date(dateRange[1]);\n        // Set to end of day to include the full day\n        endDate.setHours(23, 59, 59, 999);\n        if (logDate > endDate) {\n          dateMatches = false;\n        }\n      }\n    }\n    \n    // Transaction type filter\n    const typeMatches = !filterByType || filterByType === 'all' || log.transactionType === filterByType;\n    \n    return searchMatches && dateMatches && typeMatches;\n  }) || [];\n  \n  // Sort logs by timestamp (most recent first)\n  const sortedLogs = [...filteredLogs].sort((a, b) => \n    new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n  );\n\n  // Calculate total balance\n  const totalCredits = logs?.reduce((sum, log) => \n    log.transactionType === TransactionType.CREDIT ? sum + log.amount : sum, 0) || 0;\n    \n  const totalDebits = logs?.reduce((sum, log) => \n    log.transactionType === TransactionType.DEBIT ? sum + log.amount : sum, 0) || 0;\n    \n  // Calculate updates (might be positive or negative)\n  const totalUpdates = logs?.reduce((sum, log) => \n    (log.transactionType === TransactionType.UPDATE_PAYMENT || \n     log.transactionType === TransactionType.UPDATE_ENTRY) \n      ? sum + log.amount : sum, 0) || 0;\n    \n  const balance = totalCredits - totalDebits + totalUpdates;\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading transaction logs...</div>;\n  }\n\n  if (user?.role !== 'admin') {\n    return (\n      <div className=\"flex-grow flex items-center justify-center p-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-xl font-medium mb-2\">Access Denied</h1>\n          <p className=\"text-neutral-500\">You don't have permission to view transaction logs.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-xl font-medium\">Transaction Logs</h1>\n        <p className=\"text-sm text-neutral-500\">Track all debit and credit activities</p>\n      </div>\n      \n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Total Credits</h3>\n            <div className=\"text-2xl font-bold text-green-500\">‚Çπ{totalCredits.toLocaleString()}</div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Total Debits</h3>\n            <div className=\"text-2xl font-bold text-red-500\">‚Çπ{totalDebits.toLocaleString()}</div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Current Balance</h3>\n            <div className={`text-2xl font-bold ${balance >= 0 ? 'text-green-500' : 'text-red-500'}`}>\n              ‚Çπ{balance.toLocaleString()}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow-md mb-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Search */}\n          <div>\n            <Label htmlFor=\"search\" className=\"mb-1 block\">Search</Label>\n            <div className=\"relative\">\n              <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n                <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n              </span>\n              <Input \n                id=\"search\"\n                placeholder=\"Search by description or user\" \n                className=\"pl-10 pr-4 py-2\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n              />\n            </div>\n          </div>\n          \n          {/* Date Range Filter */}\n          <div>\n            <Label htmlFor=\"dateFilter\" className=\"mb-1 block\">Date Range</Label>\n            <div className=\"datepicker-container w-full\">\n              <DatePicker\n                selectsRange={true}\n                startDate={dateRange[0]}\n                endDate={dateRange[1]}\n                onChange={(update) => {\n                  setDateRange(update);\n                }}\n                isClearable={true}\n                placeholderText=\"Select date range\"\n                className=\"w-full border rounded-md p-2 text-sm\"\n                dateFormat=\"MMM d, yyyy\"\n                showMonthYearPicker={false}\n                calendarStartDay={1}\n                fixedHeight\n                calendarClassName=\"custom-datepicker\"\n                monthsShown={2}\n                onCalendarOpen={() => {\n                  // This forces the second month to be next month\n                  setTimeout(() => {\n                    const calendars = document.querySelectorAll('.react-datepicker__month-container');\n                    if (calendars.length > 1) {\n                      const secondCalendar = calendars[1];\n                      const monthHeader = secondCalendar.querySelector('.react-datepicker__current-month');\n                      if (monthHeader) {\n                        // Get current date and create next month\n                        const currentDate = new Date();\n                        const nextMonth = new Date(currentDate);\n                        nextMonth.setMonth(currentDate.getMonth() + 1);\n                        // Set text to \"June 2025\"\n                        monthHeader.textContent = nextMonth.toLocaleString('en-US', { month: 'long', year: 'numeric' });\n                      }\n                    }\n                  }, 0);\n                }}\n                renderMonthContent={(month, shortMonth) => <div>{shortMonth}</div>}\n                renderCustomHeader={({\n                  date,\n                  decreaseMonth,\n                  increaseMonth,\n                  prevMonthButtonDisabled,\n                  nextMonthButtonDisabled,\n                }) => (\n                  <div className=\"flex items-center justify-between px-2 py-2\">\n                    <button\n                      onClick={decreaseMonth}\n                      disabled={prevMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_left</span>\n                    </button>\n                    <div className=\"text-lg font-medium\">\n                      {date.toLocaleDateString('en-US', {\n                        month: 'long',\n                        year: 'numeric',\n                      })}\n                    </div>\n                    <button\n                      onClick={increaseMonth}\n                      disabled={nextMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_right</span>\n                    </button>\n                  </div>\n                )}\n              />\n            </div>\n          </div>\n          \n          {/* Transaction Type Filter */}\n          <div>\n            <Label htmlFor=\"typeFilter\" className=\"mb-1 block\">Transaction Type</Label>\n            <Select\n              value={filterByType}\n              onValueChange={setFilterByType}\n            >\n              <SelectTrigger id=\"typeFilter\">\n                <SelectValue placeholder=\"All types\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All types</SelectItem>\n                <SelectItem value={TransactionType.CREDIT}>Credit</SelectItem>\n                <SelectItem value={TransactionType.DEBIT}>Debit</SelectItem>\n                <SelectItem value={TransactionType.UPDATE_PAYMENT}>Payment Update</SelectItem>\n                <SelectItem value={TransactionType.UPDATE_ENTRY}>Entry Update</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </div>\n      \n      {/* Transaction logs table */}\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Date</TableHead>\n              <TableHead>User</TableHead>\n              <TableHead>Type</TableHead>\n              <TableHead>Amount</TableHead>\n              <TableHead>Description</TableHead>\n              <TableHead>Details</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {sortedLogs.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={6} className=\"text-center text-neutral-500 py-8\">\n                  No transaction logs found\n                </TableCell>\n              </TableRow>\n            ) : (\n              sortedLogs.map((log) => (\n                <TableRow key={log.id} className=\"hover:bg-neutral-50\">\n                  <TableCell>{formatDate(log.date)}</TableCell>\n                  <TableCell>{log.username}</TableCell>\n                  <TableCell>\n                    <Badge className={\n                      log.transactionType === TransactionType.CREDIT ? \"bg-green-500 text-white\" : \n                      log.transactionType === TransactionType.DEBIT ? \"bg-red-500 text-white\" :\n                      log.transactionType === TransactionType.UPDATE_PAYMENT ? \"bg-blue-500 text-white\" :\n                      \"bg-amber-500 text-white\"\n                    }>\n                      {log.transactionType.replace('_', ' ')}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className={`font-medium ${\n                    log.transactionType === TransactionType.CREDIT ? 'text-green-500' : \n                    log.transactionType === TransactionType.DEBIT ? 'text-red-500' :\n                    log.transactionType === TransactionType.UPDATE_PAYMENT ? 'text-blue-500' :\n                    'text-amber-500'\n                  }`}>\n                    ‚Çπ{log.amount.toLocaleString()}\n                  </TableCell>\n                  <TableCell>{log.description}</TableCell>\n                  <TableCell>\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"ghost\" size=\"sm\">\n                          View Details\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Transaction Details</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"space-y-4 py-2\">\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Transaction Type</h3>\n                            <p className=\"font-medium\">{log.transactionType}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Amount</h3>\n                            <p className={`font-medium ${log.transactionType === TransactionType.CREDIT ? 'text-green-500' : 'text-red-500'}`}>\n                              ‚Çπ{log.amount.toLocaleString()}\n                            </p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Description</h3>\n                            <p className=\"font-medium\">{log.description}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">User</h3>\n                            <p className=\"font-medium\">{log.username}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Date</h3>\n                            <p className=\"font-medium\">{formatDate(log.date)}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Timestamp</h3>\n                            <p className=\"font-medium\">{new Date(log.timestamp).toLocaleString()}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Entry ID</h3>\n                            <Button \n                              variant=\"link\" \n                              className=\"p-0 h-auto\"\n                              onClick={() => {\n                                setLocation(`/entries/${log.entryId}`);\n                              }}\n                            >\n                              View Entry #{log.entryId}\n                            </Button>\n                          </div>\n                          <div>\n                              <h3 className=\"text-sm font-medium text-neutral-500\">Additional Details</h3>\n                              <pre className=\"text-xs bg-neutral-50 p-2 rounded mt-1 overflow-auto max-h-40\">\n                                {log.details ? JSON.stringify(log.details, null, 2) : \"No additional details\"}\n                              </pre>\n                            </div>\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </TableCell>\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  );\n}","size_bytes":16320},"client/src/pages/logs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { TransactionType, type TransactionLog } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\n\n// Define interface for the transaction log with details typed\ninterface EnhancedTransactionLog extends TransactionLog {\n  details: Record<string, any>;\n}\nimport DatePicker from \"react-datepicker\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\n// Helper function to format dates from ISO string to readable format\nconst formatDate = (isoString: string) => {\n  if (!isoString) return \"N/A\";\n  const date = new Date(isoString);\n  return date.toLocaleDateString();\n};\n\nexport default function TransactionLogs() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [dateRange, setDateRange] = useState<[Date | null, Date | null]>([null, null]);\n  const [filterByType, setFilterByType] = useState(\"\");\n  \n  // Fetch all transaction logs\n  const { data: logs, isLoading } = useQuery<EnhancedTransactionLog[]>({\n    queryKey: ['/api/transaction-logs'],\n    // Only enable this query for admins\n    enabled: user?.role === 'admin',\n  });\n  \n  // Apply filters\n  const filteredLogs = logs?.filter(log => {\n    // Search filter (case insensitive)\n    const searchMatches = !searchQuery || \n      log.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      log.username?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    // Date range filter\n    let dateMatches = true;\n    if (dateRange[0] || dateRange[1]) {\n      const logDate = new Date(log.date);\n      \n      if (dateRange[0]) {\n        // Start date is set, check if log date is on or after it\n        const startDate = new Date(dateRange[0]);\n        startDate.setHours(0, 0, 0, 0);\n        if (logDate < startDate) {\n          dateMatches = false;\n        }\n      }\n      \n      if (dateRange[1]) {\n        // End date is set, check if log date is on or before it\n        const endDate = new Date(dateRange[1]);\n        // Set to end of day to include the full day\n        endDate.setHours(23, 59, 59, 999);\n        if (logDate > endDate) {\n          dateMatches = false;\n        }\n      }\n    }\n    \n    // Transaction type filter\n    const typeMatches = !filterByType || filterByType === 'all' || log.transactionType === filterByType;\n    \n    return searchMatches && dateMatches && typeMatches;\n  }) || [];\n  \n  // Sort logs by timestamp (most recent first)\n  const sortedLogs = [...filteredLogs].sort((a, b) => \n    new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\n  );\n\n  // Calculate total balance\n  const totalCredits = logs?.reduce((sum, log) => \n    log.transactionType === TransactionType.CREDIT ? sum + log.amount : sum, 0) || 0;\n    \n  const totalDebits = logs?.reduce((sum, log) => \n    log.transactionType === TransactionType.DEBIT ? sum + log.amount : sum, 0) || 0;\n    \n  // Calculate updates (might be positive or negative)\n  const totalUpdates = logs?.reduce((sum, log) => \n    (log.transactionType === TransactionType.UPDATE_PAYMENT || \n     log.transactionType === TransactionType.UPDATE_ENTRY) \n      ? sum + log.amount : sum, 0) || 0;\n    \n  const balance = totalCredits - totalDebits + totalUpdates;\n\n  if (isLoading) {\n    return <div className=\"flex justify-center p-8\">Loading transaction logs...</div>;\n  }\n\n  if (user?.role !== 'admin') {\n    return (\n      <div className=\"flex-grow flex items-center justify-center p-8\">\n        <div className=\"text-center\">\n          <h1 className=\"text-xl font-medium mb-2\">Access Denied</h1>\n          <p className=\"text-neutral-500\">You don't have permission to view transaction logs.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-grow p-4 pb-20\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-xl font-medium\">Transaction Logs</h1>\n        <p className=\"text-sm text-neutral-500\">Track all debit and credit activities</p>\n      </div>\n      \n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Total Credits</h3>\n            <div className=\"text-2xl font-bold text-green-500\">‚Çπ{totalCredits.toLocaleString()}</div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Total Debits</h3>\n            <div className=\"text-2xl font-bold text-red-500\">‚Çπ{totalDebits.toLocaleString()}</div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4\">\n            <h3 className=\"text-sm font-medium text-neutral-500 mb-1\">Current Balance</h3>\n            <div className={`text-2xl font-bold ${balance >= 0 ? 'text-green-500' : 'text-red-500'}`}>\n              ‚Çπ{balance.toLocaleString()}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* Filters */}\n      <div className=\"bg-white p-4 rounded-lg shadow-md mb-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* Search */}\n          <div>\n            <Label htmlFor=\"search\" className=\"mb-1 block\">Search</Label>\n            <div className=\"relative\">\n              <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\n                <span className=\"material-icons text-neutral-500 text-lg\">search</span>\n              </span>\n              <Input \n                id=\"search\"\n                placeholder=\"Search by description or user\" \n                className=\"pl-10 pr-4 py-2\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n              />\n            </div>\n          </div>\n          \n          {/* Date Range Filter */}\n          <div>\n            <Label htmlFor=\"dateFilter\" className=\"mb-1 block\">Date Range</Label>\n            <div className=\"datepicker-container w-full\">\n              <DatePicker\n                selectsRange={true}\n                startDate={dateRange[0]}\n                endDate={dateRange[1]}\n                onChange={(update) => {\n                  setDateRange(update);\n                }}\n                isClearable={true}\n                placeholderText=\"Select date range\"\n                className=\"w-full border rounded-md p-2 text-sm\"\n                dateFormat=\"MMM d, yyyy\"\n                showMonthYearPicker={false}\n                calendarStartDay={1}\n                fixedHeight\n                calendarClassName=\"custom-datepicker\"\n                monthsShown={2}\n                onCalendarOpen={() => {\n                  // This forces the second month to be next month\n                  setTimeout(() => {\n                    const calendars = document.querySelectorAll('.react-datepicker__month-container');\n                    if (calendars.length > 1) {\n                      const secondCalendar = calendars[1];\n                      const monthHeader = secondCalendar.querySelector('.react-datepicker__current-month');\n                      if (monthHeader) {\n                        // Get current date and create next month\n                        const currentDate = new Date();\n                        const nextMonth = new Date(currentDate);\n                        nextMonth.setMonth(currentDate.getMonth() + 1);\n                        // Set text to \"June 2025\"\n                        monthHeader.textContent = nextMonth.toLocaleString('en-US', { month: 'long', year: 'numeric' });\n                      }\n                    }\n                  }, 0);\n                }}\n                renderMonthContent={(month, shortMonth) => <div>{shortMonth}</div>}\n                renderCustomHeader={({\n                  date,\n                  decreaseMonth,\n                  increaseMonth,\n                  prevMonthButtonDisabled,\n                  nextMonthButtonDisabled,\n                }) => (\n                  <div className=\"flex items-center justify-between px-2 py-2\">\n                    <button\n                      onClick={decreaseMonth}\n                      disabled={prevMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_left</span>\n                    </button>\n                    <div className=\"text-lg font-medium\">\n                      {date.toLocaleDateString('en-US', {\n                        month: 'long',\n                        year: 'numeric',\n                      })}\n                    </div>\n                    <button\n                      onClick={increaseMonth}\n                      disabled={nextMonthButtonDisabled}\n                      type=\"button\"\n                      className=\"p-1 rounded-full hover:bg-neutral-100\"\n                    >\n                      <span className=\"material-icons\">chevron_right</span>\n                    </button>\n                  </div>\n                )}\n              />\n            </div>\n          </div>\n          \n          {/* Transaction Type Filter */}\n          <div>\n            <Label htmlFor=\"typeFilter\" className=\"mb-1 block\">Transaction Type</Label>\n            <Select\n              value={filterByType}\n              onValueChange={setFilterByType}\n            >\n              <SelectTrigger id=\"typeFilter\">\n                <SelectValue placeholder=\"All types\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All types</SelectItem>\n                <SelectItem value={TransactionType.CREDIT}>Credit</SelectItem>\n                <SelectItem value={TransactionType.DEBIT}>Debit</SelectItem>\n                <SelectItem value={TransactionType.UPDATE_PAYMENT}>Payment Update</SelectItem>\n                <SelectItem value={TransactionType.UPDATE_ENTRY}>Entry Update</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </div>\n      \n      {/* Transaction logs table */}\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead>Date</TableHead>\n              <TableHead>User</TableHead>\n              <TableHead>Type</TableHead>\n              <TableHead>Amount</TableHead>\n              <TableHead>Description</TableHead>\n              <TableHead>Details</TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {sortedLogs.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={6} className=\"text-center text-neutral-500 py-8\">\n                  No transaction logs found\n                </TableCell>\n              </TableRow>\n            ) : (\n              sortedLogs.map((log) => (\n                <TableRow key={log.id} className=\"hover:bg-neutral-50\">\n                  <TableCell>{formatDate(log.date)}</TableCell>\n                  <TableCell>{log.username}</TableCell>\n                  <TableCell>\n                    <Badge className={\n                      log.transactionType === TransactionType.CREDIT ? \"bg-green-500 text-white\" : \n                      log.transactionType === TransactionType.DEBIT ? \"bg-red-500 text-white\" :\n                      log.transactionType === TransactionType.UPDATE_PAYMENT ? \"bg-blue-500 text-white\" :\n                      \"bg-amber-500 text-white\"\n                    }>\n                      {log.transactionType.replace('_', ' ')}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className={`font-medium ${\n                    log.transactionType === TransactionType.CREDIT ? 'text-green-500' : \n                    log.transactionType === TransactionType.DEBIT ? 'text-red-500' :\n                    log.transactionType === TransactionType.UPDATE_PAYMENT ? 'text-blue-500' :\n                    'text-amber-500'\n                  }`}>\n                    ‚Çπ{log.amount.toLocaleString()}\n                  </TableCell>\n                  <TableCell>{log.description}</TableCell>\n                  <TableCell>\n                    <Dialog>\n                      <DialogTrigger asChild>\n                        <Button variant=\"ghost\" size=\"sm\">\n                          View Details\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>Transaction Details</DialogTitle>\n                        </DialogHeader>\n                        <div className=\"space-y-4 py-2\">\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Transaction Type</h3>\n                            <p className=\"font-medium\">{log.transactionType}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Amount</h3>\n                            <p className={`font-medium ${log.transactionType === TransactionType.CREDIT ? 'text-green-500' : 'text-red-500'}`}>\n                              ‚Çπ{log.amount.toLocaleString()}\n                            </p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Description</h3>\n                            <p className=\"font-medium\">{log.description}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">User</h3>\n                            <p className=\"font-medium\">{log.username}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Date</h3>\n                            <p className=\"font-medium\">{formatDate(log.date)}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Timestamp</h3>\n                            <p className=\"font-medium\">{new Date(log.timestamp).toLocaleString()}</p>\n                          </div>\n                          <div>\n                            <h3 className=\"text-sm font-medium text-neutral-500\">Entry ID</h3>\n                            <Button \n                              variant=\"link\" \n                              className=\"p-0 h-auto\"\n                              onClick={() => {\n                                setLocation(`/entries/${log.entryId}`);\n                              }}\n                            >\n                              View Entry #{log.entryId}\n                            </Button>\n                          </div>\n                          <div>\n                              <h3 className=\"text-sm font-medium text-neutral-500\">Additional Details</h3>\n                              <pre className=\"text-xs bg-neutral-50 p-2 rounded mt-1 overflow-auto max-h-40\">\n                                {log.details ? JSON.stringify(log.details, null, 2) : \"No additional details\"}\n                              </pre>\n                            </div>\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </TableCell>\n                </TableRow>\n              ))\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  );\n}","size_bytes":16320},"local-deployment/client/src/hooks/use-media-query.tsx":{"content":"import { useState, useEffect } from 'react';\n\nexport function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(false);\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const media = window.matchMedia(query);\n      \n      // Initial check\n      setMatches(media.matches);\n      \n      // Update matches when media query changes\n      const listener = (e: MediaQueryListEvent) => {\n        setMatches(e.matches);\n      };\n      \n      // Add event listener\n      media.addEventListener('change', listener);\n      \n      // Cleanup\n      return () => {\n        media.removeEventListener('change', listener);\n      };\n    }\n    \n    return undefined;\n  }, [query]);\n\n  return matches;\n}","size_bytes":733},"server/regenerate-passwords.ts":{"content":"import postgres from 'postgres';\nimport bcrypt from 'bcrypt';\nimport XLSX from 'xlsx';\nimport { fileURLToPath } from 'url';\nimport { dirname, join } from 'path';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nconst PRODUCTION_DATABASE_URL = 'postgresql://neondb_owner:npg_mBci23HfkDMX@ep-wandering-boat-a6irfxyp.us-west-2.aws.neon.tech/neondb?sslmode=require';\n\nfunction generatePassword(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n  let password = '';\n  for (let i = 0; i < 8; i++) {\n    password += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return password;\n}\n\nasync function regenerateAllPasswords() {\n  const client = postgres(PRODUCTION_DATABASE_URL);\n  \n  try {\n    console.log('‚úÖ Connected to production database');\n\n    const result = await client`SELECT id, username, role FROM users ORDER BY id`;\n    console.log(`üìä Found ${result.length} users`);\n\n    const userCredentials: Array<{\n      'Serial No': number;\n      'Username': string;\n      'Password': string;\n      'Role': string;\n    }> = [];\n\n    for (let i = 0; i < result.length; i++) {\n      const user = result[i];\n      const newPassword = generatePassword();\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\n\n      await client`UPDATE users SET password = ${hashedPassword} WHERE id = ${user.id}`;\n\n      userCredentials.push({\n        'Serial No': i + 1,\n        'Username': user.username,\n        'Password': newPassword,\n        'Role': user.role\n      });\n\n      if ((i + 1) % 100 === 0) {\n        console.log(`‚úÖ Processed ${i + 1}/${result.length} users`);\n      }\n    }\n\n    console.log('‚úÖ All passwords updated in database');\n\n    const worksheet = XLSX.utils.json_to_sheet(userCredentials);\n    const workbook = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'User Credentials');\n\n    const exportsDir = join(__dirname, '..', 'exports');\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('.')[0];\n    const filename = join(exportsDir, `PRODUCTION_user_credentials_${timestamp}.xlsx`);\n    \n    XLSX.writeFile(workbook, filename);\n    console.log(`‚úÖ Excel file saved: ${filename}`);\n\n    console.log('\\nüìã Sample credentials (first 5 users):');\n    userCredentials.slice(0, 5).forEach(u => {\n      console.log(`  ${u.Username}: ${u.Password} (${u.Role})`);\n    });\n\n    await client.end();\n    console.log('\\n‚úÖ Process completed successfully!');\n    \n  } catch (error) {\n    console.error('‚ùå Error:', error);\n    await client.end();\n    process.exit(1);\n  }\n}\n\nregenerateAllPasswords();\n","size_bytes":2639}},"version":2}